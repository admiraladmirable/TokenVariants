(()=>{"use strict";var __webpack_modules__={15:(e,t,i)=>{i.d(t,{A:()=>EffectMappingForm,T:()=>y});var a=i(652),n=i(634),o=i(126),r=i(924);class EditJsonConfig extends FormApplication{constructor(e,t){super({},{}),this.config=e,this.callback=t}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-config-json-edit",classes:["sheet"],template:"modules/token-variants/token-variants/templates/configJsonEdit.html",resizable:!0,minimizable:!1,title:"Edit Token Configuration",width:400,height:380})}async getData(e){const t=super.getData(e);return t.hasConfig=null!=this.config&&0!==Object.keys(this.config).length,t.config=JSON.stringify(t.hasConfig?this.config:{},null,2),t}activateListeners(e){super.activateListeners(e),e.on("input",".command textarea",this._validateJSON.bind(this)),e.on("keydown",".command textarea",(function(e){if("Tab"===e.key&&!e.shiftKey){e.preventDefault();var t=this.selectionStart,i=this.selectionEnd;return this.value=this.value.substring(0,t)+"  "+this.value.substring(i),this.selectionStart=this.selectionEnd=t+2,!1}})),e.querySelector(".remove").click(this._onRemove.bind(this)),e.querySelector(".format").click(this._onFormat.bind(this))}async _validateJSON(e){const t=e.target.closest("form").find('button[type="submit"], button.format');try{this.config=JSON.parse(e.target.value),this.config=foundry.utils.expandObject(this.config),this.flag=this.config.flag,t.prop("disabled",!1)}catch(e){t.prop("disabled",!0)}}async _onRemove(e){this.config={},this.submit()}async _onFormat(e){e.target.closest("form").find('textarea[name="config"]').val(JSON.stringify(this.config,null,2))}async _updateObject(e,t){this.callback&&this.callback(this.config)}}class EditScriptConfig extends FormApplication{constructor(e,t){super({},{}),this.script=e,this.callback=t}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-config-script-edit",classes:["sheet"],template:"modules/token-variants/token-variants/templates/configScriptEdit.html",resizable:!0,minimizable:!1,title:"Scripts",width:640,height:640})}async getData(e){const t=super.getData(e),i=this.script?this.script:{};return t.hasScript=!foundry.utils.isEmpty(i),t.onApply=i.onApply,t.onRemove=i.onRemove,t.macroOnApply=i.macroOnApply,t.macroOnRemove=i.macroOnRemove,t.tmfxPreset=i.tmfxPreset,t.tmfxActive=game.modules.get("tokenmagic")?.active,t.tmfxActive&&(t.tmfxPresets=TokenMagic.getPresets().map((e=>e.name))),t.ceActive=game.modules.get("dfreds-convenient-effects")?.active,t.ceActive&&(t.ceEffect=i.ceEffect??{apply:!0,remove:!0},t.ceEffects=game.dfreds.effectInterface.findEffects().map((e=>e.name))),t.macros=game.macros.map((e=>e.name)),t}activateListeners(e){super.activateListeners(e),e.on("keydown",".command textarea",(function(e){if("Tab"===e.key&&!e.shiftKey){e.preventDefault();var t=this.selectionStart,i=this.selectionEnd;return this.value=this.value.substring(0,t)+"  "+this.value.substring(i),this.selectionStart=this.selectionEnd=t+2,!1}})),e.querySelector(".remove").click(this._onRemove.bind(this))}async _onRemove(e){this.callback&&this.callback(null),this.close()}async _updateObject(e,t){t=foundry.utils.expandObject(t),["onApply","onRemove","macroOnApply","macroOnRemove"].forEach((e=>{t[e]=t[e].trim()})),t.ceEffect?.name&&(t.ceEffect.name=t.ceEffect.name.trim()),t.onApply||t.onRemove||t.tmfxPreset||t.ceEffect.name||t.macroOnApply||t.macroOnRemove?this.callback&&this.callback(t):this.callback&&this.callback(null)}}var s=i(548),l=i(111),c=i(113),p=i(309),f=i(605),u=i(869);let d;const h="modules\\token-variants\\img\\empty.webp";class EffectMappingForm extends FormApplication{constructor(e,{globalMappings:t=!1,callback:i=null,createMapping:a=null}={}){super({},{}),this.token=e,t&&(this.globalMappings=foundry.utils.deepClone(r.Ll.globalMappings).filter(Boolean)),t||(this.objectToFlag=game.actors.get(e.actorId)),this.callback=i,d=game.settings.get("token-variants","effectMappingToggleGroups")||{Default:!0},this.createMapping=a}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-active-effect-config",classes:["sheet"],template:"modules/token-variants/token-variants/templates/effectMappingForm.html",resizable:!0,minimizable:!1,closeOnSubmit:!1,width:1020,height:"auto",scrollY:["ol.token-variant-table"]})}get title(){let e="GLOBAL";return this.globalMappings||(e=this.objectToFlag.name),`[${e}] Mappings`}_processConfig(e){e.config||(e.config={});let t=Object.keys(e.config).filter((t=>e.config[t])).length;return e.config.flags&&t--,e.config.tv_script&&t--,{id:e.id||foundry.utils.randomID(8),label:e.label,expression:e.expression,codeExp:e.codeExp,hasCodeExp:Boolean(e.codeExp),highlightedExpression:g(e.expression),imgName:e.imgName,imgSrc:e.imgSrc,isVideo:!!e.imgSrc&&(0,n.cZ)(e.imgSrc),priority:e.priority,hasConfig:!!e.config&&!foundry.utils.isEmpty(e.config),hasScript:e.config&&e.config.tv_script,hasTokenConfig:t>0,config:e.config,overlay:e.overlay,alwaysOn:e.alwaysOn,tokens:e.tokens,tokensString:e.tokens?.join(",")??"",tokenIDs:e.tokens?.length?"Assigned Tokens\n"+e.tokens.join("\n")+"\n\n[CLICK TO UNASSIGN]":"",disabled:e.disabled,overlayConfig:e.overlayConfig,targetActors:e.targetActors,group:e.group,parentID:e.overlayConfig?.parentID}}async getData(e){const t=super.getData(e);t.NO_IMAGE=h;let i=[];if(this.object.mappings)i=this.object.mappings.map(this._processConfig);else{const e=this.globalMappings??(0,r.SL)(this.objectToFlag);i=e.map(this._processConfig),this.createMapping&&!e.find((e=>e.expression===this.createMapping.expression))&&i.push(this._processConfig(this._getNewEffectConfig(this.createMapping))),this.createMapping=null}i=i.sort(((e,t)=>{if(!e.label&&t.label)return-1;if(e.label&&!t.label)return 1;if(!e.overlayConfig?.parentID&&t.overlayConfig?.parentID)return-1;if(e.overlayConfig?.parentID&&!t.overlayConfig?.parentID)return 1;let i=e.priority-t.priority;return 0===i?e.label.localeCompare(t.label):i}));const[a,n]=y(i);return t.groups=Object.keys(n),this.object.mappings=a,t.groupedMappings=n,t.global=Boolean(this.globalMappings),t}activateListeners(e){super.activateListeners(e),e.querySelector(".delete-mapping").click(this._onRemove.bind(this)),e.querySelector(".clone-mapping").click(this._onClone.bind(this)),e.querySelector(".create-mapping").click(this._onCreate.bind(this)),e.querySelector(".save-mappings").click(this._onSaveMappings.bind(this)),e.querySelector(".save-mappings-close").click(this._onSaveMappingsClose.bind(this)),r.Ll.permissions.image_path_button[game.user.role]&&(e.querySelector(".mapping-image img").click(this._onImageClick.bind(this)),e.querySelector(".mapping-image img").mousedown(this._onImageMouseDown.bind(this)),e.querySelector(".mapping-image video").click(this._onImageClick.bind(this)),e.querySelector(".mapping-target.btn").click(this._onConfigureApplicableActors.bind(this))),e.querySelector(".mapping-image img").contextmenu(this._onImageRightClick.bind(this)),e.querySelector(".mapping-image video").contextmenu(this._onImageRightClick.bind(this)),e.querySelector(".mapping-config i.config").click(this._onConfigClick.bind(this)),e.querySelector(".mapping-config i.config-edit").click(this._onConfigEditClick.bind(this)),e.querySelector(".mapping-config i.config-script").click(this._onConfigScriptClick.bind(this)),e.querySelector(".mapping-overlay i.overlay-config").click(this._onOverlayConfigClick.bind(this)),e.on("contextmenu",".mapping-overlay i.overlay-config",this._onOverlayConfigRightClick.bind(this)),e.querySelector(".mapping-overlay input").on("change",this._onOverlayChange).trigger("change"),e.querySelector(".div-input").on("input paste focus",this._onExpressionChange);e.find(".group-toggle > a").on("click",this._onGroupToggle.bind(this)).each((function(){const e=this.closest(".group-toggle").data("group");d[e]||this.trigger("click")})),this.setPosition({width:1020}),e.querySelector(".mapping-disable > input").on("change",this._onDisable.bind(this)),e.querySelector(".group-disable > a").on("click",this._onGroupDisable.bind(this)),e.querySelector(".group-delete").on("click",this._onGroupDelete.bind(this)),e.querySelector(".mapping-group > input").on("change",this._onGroupChange.bind(this)),e.querySelector(".expression-switch").on("click",this._onExpressionSwitch.bind(this)),e.find(".expression-code textarea").focus((e=>e.target.animate({height:"10em"},500,(()=>this.setPosition())))).focusout((e=>e.target.animate({height:"1em"},500,(()=>{this._state===Application.RENDER_STATES.RENDERED&&this.setPosition()})))),e.querySelector(".tokens").on("click",this._onTokensRemove.bind(this))}async _onTokensRemove(e){await this._onSubmit(e);const t=e.currentTarget.closest(".table-row");this.object.mappings[t.dataset.index].tokens=void 0,this.render()}_onExpressionSwitch(e){const t=e.target.closest(".expression-container"),i=t.find(".div-input"),a=t.find(".expression-code");a.hasClass("hidden")?(a.removeClass("hidden"),i.addClass("hidden")):(a.addClass("hidden"),i.removeClass("hidden"))}async _onDisable(e){const t=e.target.closest(".table-row").data("group"),i=e.target.closest(".token-variant-table").find(`.group-disable[data-group="${t}"]`),a=e.target.closest(".token-variant-table").find(`[data-group="${t}"] > .mapping-disable`),n=a.find("input:checked").length;a.length!==n?i.addClass("active"):i.removeClass("active")}async _onGroupDisable(e){const t=e.target.closest(".group-disable"),i=t.data("group"),a=e.target.closest("form").find(`[data-group="${i}"]`).find(".mapping-disable > input");t.hasClass("active")?(t.removeClass("active"),a.prop("checked",!0)):(t.addClass("active"),a.prop("checked",!1))}async _onGroupDelete(e){const t=e.target.closest(".group-delete").data("group");await this._onSubmit(e),this.object.mappings=this.object.mappings.filter((e=>e.group!==t)),this.render()}async _onGroupChange(e){const t=e.target;let i=t.val().trim();i||(i="Default"),t.val(i),await this._onSubmit(e),this.render()}_onGroupToggle(e){const t=e.target.closest(".group-toggle"),i=t.data("group");e.target.closest("form").find(`li[data-group="${i}"]`).toggle(),t.hasClass("active")?(t.removeClass("active"),t.find("i").addClass("fa-rotate-180"),d[i]=!1):(t.addClass("active"),t.find("i").removeClass("fa-rotate-180"),d[i]=!0),game.settings.set("token-variants","effectMappingToggleGroups",d),this.setPosition({height:"auto"})}async _onExpressionChange(e){var t=e.target;if(t.siblings("input").val(e.target.innerText),!t.childNodes.length)return;const i=window.getSelection(),a=i.focusNode;let n=i.focusOffset;for(const e of t.childNodes){if(e===a||e.childNodes[0]===a)break;n+="SPAN"===e.nodeName?e.innerText.length:e.length}let o=g(e.target.innerText);e.target.html(o),m(t,n)}async _onOverlayChange(e){e.target.checked?e.target.siblings("a").show():e.target.siblings("a").hide()}async _onOverlayConfigClick(e){const t=e.currentTarget.closest(".table-row"),i=this.object.mappings[t.dataset.index];new s.r(i.overlayConfig,(e=>{i.overlayConfig=e;const a=t.find(".mapping-overlay > a");e?.parentID&&"TOKEN"!==e.parentID?(a.addClass("child"),a.attr("title","Child Of: "+e.parentID)):(a.removeClass("child"),a.attr("title",""))}),this.token,{mapping:i,global:Boolean(this.globalMappings),actor:this.objectToFlag}).render(!0)}async _onOverlayConfigRightClick(e){const t=e.currentTarget.closest(".table-row"),i=this.object.mappings[t.dataset.index];(0,l.MF)(i.overlayConfig,(e=>i.overlayConfig=e))}async _toggleActiveControls(e){const t=e.currentTarget.closest(".table-row"),i=this.object.mappings[t.dataset.index],a=e.target.closest(".mapping-config").find(".config"),n=e.target.closest(".mapping-config").find(".config-edit"),o=e.target.closest(".mapping-config").find(".config-script");let r=Object.keys(i.config).filter((e=>i.config[e])).length;i.config.flags&&r--,i.config.tv_script&&r--,r?a.addClass("active"):a.removeClass("active"),Object.keys(i.config).filter((e=>i.config[e])).length?n.addClass("active"):n.removeClass("active"),i.config.tv_script?o.addClass("active"):o.removeClass("active")}async _onConfigScriptClick(e){const t=e.currentTarget.closest(".table-row"),i=this.object.mappings[t.dataset.index];new EditScriptConfig(i.config?.tv_script,(t=>{i.config||(i.config={}),t?i.config.tv_script=t:delete i.config.tv_script,this._toggleActiveControls(e)})).render(!0)}async _onConfigEditClick(e){const t=e.currentTarget.closest(".table-row"),i=this.object.mappings[t.dataset.index];new EditJsonConfig(i.config,(t=>{i.config=t,this._toggleActiveControls(e)})).render(!0)}async _onConfigClick(e){const t=e.currentTarget.closest(".table-row"),i=this.object.mappings[t.dataset.index];new o.A(this.token,{},null,null,(t=>{t&&!foundry.utils.isEmpty(t)||((t={}).tv_script=i.config.tv_script,t.flags=i.config.flags),i.config=t,this._toggleActiveControls(e)}),i.config?i.config:{}).render(!0)}_removeImage(e){const t=e.target.closest(".mapping-image").find("video"),i=e.target.closest(".mapping-image").find("img");t.add(i).attr("src","").attr("title",""),t.hide(),i.show(),i.attr("src",h),e.target.siblings(".imgSrc").val(""),e.target.siblings(".imgName").val("")}async _onImageMouseDown(e){2===e.which&&this._removeImage(e)}async _onImageClick(e){if((0,n._l)("config"))return void this._removeImage(e);let t=this.token.name;if("Unknown"===t){const i=e.currentTarget.closest(".table-row");t=this.object.mappings[i.dataset.index].label}(0,a.n)(t,{searchType:n.Cp.TOKEN,callback:(t,i)=>{const a=e.target.closest(".mapping-image").find("video"),o=e.target.closest(".mapping-image").find("img");a.add(o).attr("src",t).attr("title",i),(0,n.cZ)(t)?(a.show(),o.hide()):(a.hide(),o.show()),e.target.siblings(".imgSrc").val(t),e.target.siblings(".imgName").val(i)}})}async _onImageRightClick(e){if((0,n._l)("config"))return void this._removeImage(e);const t=e.currentTarget.closest(".table-row"),i=this.object.mappings[t.dataset.index];new FilePicker({type:"imagevideo",current:i.imgSrc,callback:t=>{const i=e.target.closest(".mapping-image").find("video"),a=e.target.closest(".mapping-image").find("img");i.add(a).attr("src",t).attr("title",(0,n.WP)(t)),(0,n.cZ)(t)?(i.show(),a.hide()):(i.hide(),a.show()),e.target.siblings(".imgSrc").val(t),e.target.siblings(".imgName").val((0,n.WP)(t))}}).render()}async _onRemove(e){e.preventDefault(),await this._onSubmit(e);const t=e.currentTarget.closest(".table-row");this.object.mappings.splice(t.dataset.index,1),this.render()}async _onClone(e){e.preventDefault(),await this._onSubmit(e);const t=e.currentTarget.closest(".table-row"),i=foundry.utils.deepClone(this.object.mappings[t.dataset.index]);i.label=i.label+" - Copy",i.id=foundry.utils.randomID(8),this.object.mappings.push(i),this.render()}async _onCreate(e){e.preventDefault(),await this._onSubmit(e),this.object.mappings.push(this._getNewEffectConfig()),this.render()}_getNewEffectConfig({label:e="",expression:t=""}={}){return d.Default=!0,foundry.utils.mergeObject(foundry.utils.deepClone(c.OH),{label:e,expression:t,id:foundry.utils.randomID(8)})}_getHeaderButtons(){const e=super._getHeaderButtons();return e.unshift({label:"Export",class:"token-variants-export",icon:"fas fa-file-export",onclick:e=>this._exportConfigs(e)}),e.unshift({label:"Import",class:"token-variants-import",icon:"fas fa-file-import",onclick:e=>this._importConfigs(e)}),e.unshift({label:"Templates",class:"token-variants-templates",icon:"fa-solid fa-book",onclick:async e=>{new u.I({mappings:this.globalMappings??(0,r.SL)(this.objectToFlag),callback:(t,i)=>{this._insertMappings(e,i)}}).render(!0)}}),this.globalMappings||(e.unshift({label:"Copy Global Config",class:"token-variants-copy-global",icon:"fas fa-globe",onclick:e=>this._copyGlobalConfig(e)}),e.unshift({label:"Open Global",class:"token-variants-open-global",icon:"fas fa-globe",onclick:async e=>{await this.close(),new EffectMappingForm(this.token,{globalMappings:!0}).render(!0)}}),e.unshift({label:"",class:"token-variants-print-token",icon:"fa fa-print",onclick:()=>(0,l.H$)(canvas.tokens.get(this.token._id))})),e}async _exportConfigs(e){let t="",i=await new Promise((e=>{(0,l.Ov)(this.globalMappings??(0,r.SL)(this.objectToFlag),{callback:e})}));if(i&&!foundry.utils.isEmpty(i)){if(this.globalMappings)t="token-variants-global-mappings.json";else{let e=this.objectToFlag.name??"Actor";e=e.replace(/[/\\?%*:|"<>]/g,"-"),t="token-variants-"+e+".json"}saveDataToFile(JSON.stringify({globalMappings:i},null,2),"text/json",t)}}async _importConfigs(e){const t=await renderTemplate("templates/apps/import-data.html",{entity:"token-variants",name:"settings"});let i=new Promise(((i,a)=>{new Dialog({title:"Import Effect Configurations",content:t,buttons:{import:{icon:'<i class="fas fa-file-import"></i>',label:game.i18n.localize("token-variants.common.import"),callback:t=>{const a=t.querySelector("form")[0];if(!a.data.files.length)return ui.notifications?.error("You did not upload a data file!");readTextFromFile(a.data.files[0]).then((t=>{if(!(t=JSON.parse(t))||!("globalMappings"in t))return ui.notifications?.error("No mappings found within the file!");this._insertMappings(e,(0,r.dm)(t.globalMappings)),i(!0)}))}},no:{icon:'<i class="fas fa-times"></i>',label:"Cancel",callback:e=>i(!1)}},default:"import"},{width:400}).render(!0)}));return await i}_copyGlobalConfig(e){(0,l.Ov)(r.Ll.globalMappings,{title1:"Global Mappings",title2:"Select Mappings to Copy:",buttonTitle:"Copy",callback:t=>{this._insertMappings(e,t)}})}async _insertMappings(e,t){const i=foundry.utils.deepClone(t).map(this._processConfig);await this._onSubmit(e),(0,n.SQ)(i,this.object.mappings),this.render()}_onConfigureApplicableActors(e){const t=e.currentTarget.closest(".table-row"),i=this.object.mappings[t.dataset.index];let a=Object.keys(game.system.documentTypes.Actor),n=[];for(const e of a){const t=CONFIG.Actor?.typeLabels?.[e]??e;n.push({id:e,label:game.i18n.has(t)?game.i18n.localize(t):e,enabled:!i.targetActors||i.targetActors.includes(e)})}let o='<form style="overflow-y: scroll; height:250x;">';for(const e of n)o+=`\n      <div class="form-group">\n        <label>${e.label}</label>\n        <div class="form-fields">\n            <input type="checkbox" name="${e.id}" data-dtype="Boolean" ${e.enabled?"checked":""}>\n        </div>\n      </div>\n      `;o+='</form><div class="form-group"><button type="button" class="select-all">Select all</div>',new Dialog({title:"Configure Applicable Actors",content:o,buttons:{Ok:{label:"Save",callback:async e=>{let t=[];e.querySelector('input[type="checkbox"]').each((function(){this.checked&&t.push(this.name)})),i.targetActors=t}}},render:e=>{e.querySelector(".select-all").click((()=>{e.querySelector('input[type="checkbox"]').prop("checked",!0)}))}}).render(!0)}async _onSaveMappingsClose(e){await this._onSaveMappings(e),this.close()}async _onSaveMappings(e){if(await this._onSubmit(e),this.objectToFlag||this.globalMappings){let e=this.object.mappings;e=e.filter((e=>Boolean(e.label?.trim())||Boolean(e.expression?.trim())));for(const t of e)t.priority=t.priority?t.priority:50,t.overlayConfig=t.overlayConfig??{},t.overlayConfig.label=t.label;if(0!==e.length){const t=e.map((e=>foundry.utils.mergeObject(c.OH,e,{inplace:!1,insertKeys:!1,recursive:!1})));this.globalMappings?(0,r.Xx)({globalMappings:t}):await this.objectToFlag.setFlag("token-variants","effectMappings",t)}else this.globalMappings?(0,r.Xx)({globalMappings:[]}):await this.objectToFlag.unsetFlag("token-variants","effectMappings");const t=this.globalMappings?canvas.tokens.placeables:this.objectToFlag.getActiveTokens();for(const e of t)r.Ll.filterEffectIcons&&await e.drawEffects(),await(0,p.he)(e),(0,f.uv)(e);const i={handlerName:"drawOverlays",args:{all:!0,sceneId:canvas.scene.id},type:"UPDATE"};game.socket?.emit("module.token-variants",i)}this.callback&&this.callback()}async _updateObject(e,t){const i=foundry.utils.expandObject(t).mappings??{};for(let e=0;e<this.object.mappings.length;e++){const t=i[e],a=this.object.mappings[e];a.id=t.id,a.label=t.label.replaceAll(String.fromCharCode(160)," "),a.expression=t.expression.replaceAll(String.fromCharCode(160)," "),a.codeExp=t.codeExp?.trim(),a.imgSrc=t.imgSrc,a.imgName=t.imgName,a.priority=t.priority,a.overlay=t.overlay,a.alwaysOn=t.alwaysOn,a.tokens=t.tokens?.split(","),a.disabled=t.disabled,a.group=t.group}}}function g(e){const t=new RegExp('([a-zA-Z0-9\\.\\-\\|\\+]+)([><=]+)(".*?"|-?\\d+)(%{0,1})',"gi");e=e.replace(t,(function(e){return'<span class="hp-expression">'+e+"</span>"}));for(const t of["\\(","\\)","&&","||","\\!","\\*","\\{","\\}"])e=e.replaceAll(t,`<span>${t}</span>`);return e}function m(e,t){for(var i of e.childNodes)if(3==i.nodeType){if(i.length>=t){var a=document.createRange(),n=window.getSelection();return a.setStart(i,t),a.collapse(!0),n.removeAllRanges(),n.addRange(a),-1}t-=i.length}else if(-1==(t=m(i,t)))return-1;return t}function y(e){e.sort(((e,t)=>{if(!e.label&&t.label)return-1;if(e.label&&!t.label)return 1;if(!e.overlayConfig?.parentID&&t.overlayConfig?.parentID)return-1;if(e.overlayConfig?.parentID&&!t.overlayConfig?.parentID)return 1;let i=e.priority-t.priority;return 0===i?e.label.localeCompare(t.label):i}));let t={Default:{list:[],active:!1}};return e.forEach(((e,i)=>{e.i=i,e.group&&e.group.trim()||(e.group="Default"),e.group in t||(t[e.group]={list:[],active:!1}),e.disabled||(t[e.group].active=!0),t[e.group].list.push(e)})),[e,t]}},21:(e,t,i)=>{i.d(t,{in:()=>K,Hr:()=>G,R7:()=>Y,ic:()=>q});var a=i(924);const n="EffectIcons";var o=i(771),r=i(652),s=i(634);const l="ArtSelect";function c(e,t){(0,o.$L)(t,"texture.src",{search:e.object.name,searchType:s.Cp.TOKEN})}function p(e,t){(0,o.$L)(t,"texture",{search:"Template",searchType:s.Cp.TILE})}function f(e,t){(0,o.$L)(t,"texture",{search:"Drawing",searchType:a.Ll.customImageCategories.includes("Drawing")?"Drawing":s.Cp.TILE})}function u(e,t){(0,o.$L)(t,"icon.custom",{search:"Note",searchType:a.Ll.customImageCategories.includes("Note")?"Note":s.Cp.ITEM})}function d(e,t){(0,o.$L)(t,"background.src",{search:e.object.name,searchType:a.Ll.customImageCategories.includes("Scene")?"Scene":s.Cp.TILE}),(0,o.$L)(t,"foreground",{search:e.object.name,searchType:a.Ll.customImageCategories.includes("Scene")?"Scene":s.Cp.TILE}),(0,o.$L)(t,"fogOverlay",{search:e.object.name,searchType:a.Ll.customImageCategories.includes("Fog")?"Fog":s.Cp.TILE})}function h(e,t){(0,o.$L)(t,"texture.src",{search:e.object.getFlag("token-variants","tileName")||"Tile",searchType:s.Cp.TILE})}function g(e,t){if(!(0,o.$L)(t,"icon",{search:e.object.name||"Active Effect",searchType:a.Ll.customImageCategories.includes("Active Effect")?"Active Effect":s.Cp.ITEM})){const i=t.find(".effect-icon");i.on("contextmenu",(()=>{(0,r.n)(e.object?.name??"Active Effect",{searchType:s.Cp.ITEM,callback:e=>i.attr("src",e)})}))}}function m(e,t,i){t.find('img.profile, .profile-img, [data-edit="img"]').on("contextmenu",(()=>{const t=e.object;t&&(0,r.n)(t.name,{searchType:s.Cp.ITEM,callback:e=>t.update({img:e})})}))}function y(e,t,i){const a=t.find(".sheet-header > img");a.on("contextmenu",(()=>{(0,r.n)(e.object?.name??"Macro",{searchType:s.Cp.MACRO,callback:e=>a.attr("src",e)})}))}function v(e,t,i){t.find(".header-button.entry-image").on("contextmenu",(()=>{const t=e.object;t&&(0,r.n)(t.name,{searchType:s.Cp.JOURNAL,callback:e=>t.update({img:e})})}))}function k(e,t){t.find(".result-image").on("contextmenu",(t=>{const i=e.object;if(!i)return;const n=t.target.closest(".result-image").find("img");(0,r.n)(i.name,{searchType:a.Ll.customImageCategories.includes("RollTable")?"RollTable":s.Cp.ITEM,callback:i=>{n.attr("src",i),e._onSubmit(t)}})}))}function b(e,t,i){if(i.editable&&a.Ll.permissions.portrait_right_click[game.user.role]){let i=null,a={all:[".profile",".profile-img",".profile-image",".portrait"],pf2e:[".player-image",".actor-icon",".sheet-header img",".actor-image"]};for(let e of a.all)if(i=t[0].querySelector(e),i)break;if(!i&&game.system.id in a)for(let e of a[game.system.id])if(i=t[0].querySelector(e),i)break;if(!i)return void console.warn("TVA |",game.i18n.localize("token-variants.notifications.warn.profile-image-not-found"));i.addEventListener("contextmenu",(function(t){(0,r.n)(e.object.name,{callback:(t,i)=>(0,s.Gj)(e.object,t),searchType:s.Cp.PORTRAIT,object:e.object})}),!1)}}var _=i(526),O=i(309),w=i(207),S=i(853),T=i(179);async function C(e,t,i,n="",o=null){const r=e.object;if(!a.Ll.hud.enableSideMenu||!a.Ll.tilesEnabled)return;const l=$(`\n  <div class="control-icon" data-action="token-variants-side-selector">\n    <img\n      id="token-variants-side-button"\n      src="modules/token-variants/token-variants/img/token-images.svg"\n      width="36"\n      height="36"\n      title="${game.i18n.localize("token-variants.windows.art-select.select-variant")}"\n    />\n  </div>\n`);t.querySelector("div.right").last().append(l),t.querySelector("div.right").click(x),l.click((e=>async function(e,t){if((0,s._l)("config"))return void function(e){const t=e.document.getFlag("token-variants","tileName")||e.id;new Dialog({title:"Assign a name to the Tile (3+ chars)",content:`<table style="width:100%"><tr><th style="width:50%"><label>Tile Name</label></th><td style="width:50%"><input type="text" name="input" value="${t}"/></td></tr></table>`,buttons:{Ok:{label:"Save",callback:t=>{const i=t.querySelector("input").val();i&&(canvas.tiles.hud.clear(),e.document.setFlag("token-variants","tileName",i))}}}}).render(!0)}(t);const i=e.target.closest(".control-icon");i.closest("div.right").find("div.control-icon.effects").removeClass("active"),i.closest("div.right").find(".status-effects").removeClass("active"),i.find(".contextmenu").remove(),i.classList.toggle("active");let a=i.find(".token-variants-wrap");if(i.hasClass("active")){if(!a.length){if(a=await E(t),!a)return;i.find("img").after(a)}a.addClass("active")}else a.removeClass("active")}(e,r))),l.contextmenu((e=>function(e,t){const i=e.target.closest(".control-icon");i.hasClass("active")||i.addClass("active");if(i.find(".contextmenu").length)i.find(".contextmenu").remove(),i.removeClass("active").trigger("click");else{i.find(".token-variants-wrap.images").removeClass("active");const e=$('\n    <div class="token-variants-wrap contextmenu active">\n      <div class="token-variants-context-menu active">\n        <input class="token-variants-side-search" type="text" />\n        <button class="flags" type="button"><i class="fab fa-font-awesome-flag"></i><label>Flags</label></button>\n        <button class="file-picker" type="button"><i class="fas fa-file-import fa-fw"></i><label>Browse Folders</label></button>\n      </div>\n    </div>\n      ');i.append(e),e.find(".token-variants-side-search").on("keydown",(e=>async function(e,t){if("Enter"===e.key||13===e.keyCode){if(e.preventDefault(),e.target.value.length>=3){const i=e.target.closest(".control-icon");i.find(".token-variants-wrap").remove();const a=await E(t,e.target.value);a&&(a.addClass("active"),i.append(a))}return!1}}(e,t))).on("click",(e=>{e.preventDefault(),e.stopPropagation()})),e.find(".flags").click((e=>{e.preventDefault(),e.stopPropagation(),new w.A(t).render(!0)})),e.find(".file-picker").click((async e=>{e.preventDefault(),e.stopPropagation(),new FilePicker({type:"folder",callback:async(e,a)=>{let n=(await FilePicker.browse(a.activeSource,a.result.target)).files.filter((e=>(0,s.wu)(e)||(0,s.cZ)(e)));if(n.length){i.find(".token-variants-wrap").remove();const e=await E(t,null,n);e&&(e.addClass("active"),i.append(e))}}}).render(!0)}))}}(e,r)))}function x(e){switch(e.target.closest(".control-icon").attr("data-action")){case"effects":case"thwildcard-selector":break;default:return}e.target.closest("div.right").find('.control-icon[data-action="token-variants-side-selector"]').removeClass("active"),e.target.closest("div.right").find(".token-variants-wrap").removeClass("active")}async function E(e,t=null,i=null){const n=a.Ll.hud,o=a.Ll.worldHud,r=a.Ll.permissions.hudFullAccess[game.user.role];let l=[],c=[],p=new Set;const f=e=>{p.has(e.path)?l.find((t=>t.path===e.path&&t.name===e.name))||l.push(e):(l.push(e),p.add(e.path))};if(i)l=i.map((e=>({path:e,name:(0,s.WP)(e)})));else{if(null!==t&&!t)return;if(!t){c=e.document.getFlag("token-variants","variants")||[],c.forEach((e=>{for(const t of e.names)f({path:e.imgSrc,name:t})}));const t=e.document.getFlag("token-variants","directory");if(t){let e;try{let i=t.path,a=t.source,n="";a.startsWith("s3:")&&(n=a.substring(3,a.length),a="s3");e=(await FilePicker.browse(a,i,{type:"imagevideo",bucket:n})).files}catch(t){e=[]}e.forEach((e=>{((0,s.wu)(e)||(0,s.cZ)(e))&&f({path:e,name:(0,s.WP)(e)})}))}}const i=t??e.document.getFlag("token-variants","tileName");let a=!i||!t&&o.displayOnlySharedImages?null:await(0,S.RY)(i,{searchType:s.Cp.TILE,searchOptions:{keywordSearch:o.includeKeywords}});a&&a.forEach((e=>{l.push(...e)}))}let u=e.document.getFlag("token-variants","name");u||(u=(0,s.WP)(e.document.texture.src));let d=[];for(const t of l){const i=(0,s.wu)(t.path),a=(0,s.cZ)(t.path);let n=!1;game.user.isGM&&c.forEach((e=>{e.imgSrc===t.path&&e.names.includes(t.name)&&(n=!0)}));const o=e.document.getFlag("token-variants","userMappings")||{},[r,l]=P(o,t.path,t.name);d.push({route:t.path,name:t.name,used:t.path===e.document.texture.src&&t.name===u,img:i,vid:a,unknownType:!i&&!a,shared:n,hasConfig:!1,title:r,style:game.user.isGM&&l?"box-shadow: "+l+";":null})}const h=n.displayAsImage,g=n.imageOpacity/100,m=await renderTemplate("modules/token-variants/token-variants/templates/sideSelect.html",{imagesParsed:d,imageDisplay:h,imageOpacity:g,autoplay:!a.Ll.playVideoOnHover});return m.find("video").hover((function(){a.Ll.playVideoOnHover&&(this.play(),this.siblings(".fa-play").hide())}),(function(){a.Ll.pauseVideoOnHoverOut&&(this.pause(),this.currentTime=0,this.siblings(".fa-play").show())})),m.find(".token-variants-button-select").click((t=>async function(e,t){if(e.preventDefault(),e.stopPropagation(),!t)return;const i=e.target.closest(".token-variants-button-select"),a=i.attr("data-name"),n=i.attr("data-filename");if(a){canvas.tiles.hud.clear(),await t.document.update({"texture.src":a});try{(0,s.WP)(a)!==n&&await t.document.setFlag("token-variants","name",n)}catch(e){}}}(t,e))),r&&m.find(".token-variants-button-select").on("contextmenu",(t=>async function(e,t){if(e.preventDefault(),e.stopPropagation(),!t)return;const i=e.target.closest(".token-variants-button-select"),a=i.attr("data-name"),n=i.attr("data-filename");if(!a||!n)return;if((0,s._l)("config")&&game.user.isGM){const e=(e,t)=>{const a=e.document.getFlag("token-variants","userMappings")||{},n=i.attr("data-filename"),[o,r]=P(a,t,n);i.closest(".token-variants-wrap").find(`.token-variants-button-select[data-name='${t}']`).css("box-shadow",r).prop("title",o)};return void new T.A(t,a,e).render(!0)}let o=t.document.getFlag("token-variants","variants")||[],r=!1,l=!1;for(let e of o)if(e.imgSrc===a){let t=e.names.filter((e=>e!=e));0===t.length?r=!0:t.length===e.names.length&&t.push(n),e.names=t,l=!0;break}r?o=o.filter((e=>e.imgSrc!==a)):l||o.push({imgSrc:a,names:[n]});t.document.unsetFlag("token-variants","variants"),o.length>0&&t.document.setFlag("token-variants","variants",o);i.find(".fa-share").classList.toggle("active")}(t,e))),m}function P(e,t,i){let n=a.Ll.worldHud.showFullPath?t:i,o="",r=2;for(const[i,a]of Object.entries(e))if(a===t){const e=game.users.get(i);if(!e)continue;0===o.length?o=`inset 0 0 0 ${r}px ${e.color}`:o+=`, inset 0 0 0 ${r}px ${e.color}`,r+=2,n+=`\nDisplayed to: ${e.name}`}return[n,o]}var I=i(683);const M="HUD";const D="UserMappings";async function A(e,t){if(t.flags?.["token-variants"]&&("userMappings"in t.flags["token-variants"]||"-=userMappings"in t.flags["token-variants"])){const t=canvas.tokens.get(e.id);t&&(await t.draw(),canvas.visibility.restrictVisibility())}}async function F(e,t){if(t.flags?.["token-variants"]&&("userMappings"in t.flags["token-variants"]||"-=userMappings"in t.flags["token-variants"])){const t=canvas.tiles.get(e.id);t&&(await t.draw(),canvas.visibility.restrictVisibility())}}function R(){if(!game.user.isGM){for(let e of canvas.tokens.placeables)j(e)&&(e.visible=!1);for(let e of canvas.tiles.placeables)j(e)&&(e.visible=!1)}}function j(e){const t=(e.document.getFlag("token-variants","userMappings")||{})?.[game.userId];return t===a.Ll.invisibleImage}const N="Wildcards";async function L(e,t){const i=t.querySelector('input[name="randomImg"]');if(i.length&&!t.querySelector(".token-variants-proto").length){const a=e.actor?.prototypeToken?.flags["token-variants"]?.randomImgDefault||e.actor?.prototypeToken?.flags["token-hud-wildcard"]?.default||"",n=await renderTemplate("/modules/token-variants/token-variants/token-variants/templates/protoTokenElement.html",{defaultImg:a,disableHUDButton:e.object?.getFlag("token-variants","disableHUDButton")});i.closest(".form-group").after(n);const r=t.querySelector(".token-variants-proto");r.find("button").click((e=>{e.preventDefault();const t=r.find("input");new FilePicker({current:t.val(),field:t[0]}).browse(a)})),(0,o.$L)(r,"flags.token-variants.randomImgDefault",{search:e.object.name,searchType:s.Cp.TOKEN});const l=r.find(".imagevideo").closest(".form-group"),c=function(t){t?l.show():l.hide(),e.setPosition()};i.on("click",(e=>c(e.target.checked))),c(i.is(":checked"))}}function H(e,t,i,n){if(game.user.id!==n)return;const o={};if(e.actor?.prototypeToken?.randomImg){const t=e.actor?.prototypeToken?.flags["token-variants"]?.randomImgDefault||e.actor?.prototypeToken?.flags["token-hud-wildcard"]?.default||"";t&&(o["texture.src"]=t)}(a.Ll.imgNameContainsDimensions||a.Ll.imgNameContainsFADimensions)&&(0,s.mX)(o["texture.src"]??e.texture.src,{token:e,update:o}),foundry.utils.isEmpty(o)||e.updateSource(o)}const U="PopUpAndRandomize";async function X(e,t,i){if(i&&game.user.id!=i)return;const n=game.actors.get(e.actorId)?.getFlag("token-variants","randomizerSettings"),o=foundry.utils.mergeObject(a.Ll.randomizer,n??{},{inplace:!1,recursive:!1});let l=(0,s._l)("v");const c=(e.actor?game.actors.get(e.actor.id):e.document??e).getFlag("token-variants","popups");if(l&&o.tokenCopyPaste||!l&&o.tokenCreate){let t=!0;if(n?t=Boolean(n):(o.representedActorDisable&&e.actor&&(t=!1),o.linkedActorDisable&&e.actorLink&&(t=!1),W(o,e.actor)&&(t=!1)),t){const t=await(0,s.M7)(o);t&&e.update({name:t});const i=await(0,S.v_)(e.name,{searchType:s.Cp.TOKEN,actor:e.actor,randomizerOptions:o});if(i&&await(0,s.mX)(i[0],{token:e,actor:e.actor,imgName:i[1]}),o.diffImages){let t;if(o.syncImages){if(!i)return;t=await(0,S.jk)(i[1],{searchType:s.Cp.PORTRAIT})}else o.tokenName||o.actorName||(o.tokenName=!0),o.wildcard=!1,o.shared=!1,t=await(0,S.v_)(e.name,{searchType:s.Cp.PORTRAIT,actor:e.actor,randomizerOptions:o});t&&await(0,s.Gj)(e.actor,t[0])}else if(o.tokenToPortrait){if(!i)return;await(0,s.Gj)(e.actor,i[0])}return}if(null==c&&!o.popupOnDisable)return}else if(o.tokenCreate||o.tokenCopyPaste)return;if(!a.Ll.permissions.popups[game.user.role])return;let p=(0,s._l)("popupOverride");if(!l||!a.Ll.popup.disableAutoPopupOnTokenCopyPaste){if(!p||p&&l){if(a.Ll.popup.disableAutoPopupOnTokenCreate&&!l)return;if(null==c&&z(e.actor))return;if(null!=c&&!c)return}(0,r.n)(e.name,{callback:async function(t,i){a.Ll.popup.twoPopups?(await(0,s.Gj)(e.actor,t),V(e.actor,t,i,e)):(0,s.mX)(t,{actor:e.actor,imgName:i,token:e})},searchType:a.Ll.popup.twoPopups?s.Cp.PORTRAIT:s.Cp.TOKEN,object:e,preventClose:a.Ll.popup.twoPopups&&a.Ll.popup.twoPopupsNoDialog})}}async function B(e,t,i){if(i&&game.user.id!=i)return;const n=a.Ll.randomizer;if(n.actorCreate){let t=!0;if(n.linkedActorDisable&&e.prototypeToken.actorLink&&(t=!1),W(n,e)&&(t=!1),t){const t=await(0,S.v_)(e.name,{searchType:s.Cp.PORTRAIT,actor:e});if(t&&await(0,s.Gj)(e,t[0]),!t)return;if(n.diffImages){let i;i=n.syncImages?await(0,S.jk)(t[1],{searchType:s.Cp.TOKEN}):await(0,S.v_)(e.name,{searchType:s.Cp.TOKEN,actor:e}),i&&await(0,s.mX)(i[0],{actor:e,imgName:i[1]})}return}if(!n.popupOnDisable)return}a.Ll.permissions.popups[game.user.role]&&(a.Ll.popup.disableAutoPopupOnActorCreate&&!(0,s._l)("popupOverride")||z(e)||(0,r.n)(e.name,{callback:async function(t,i){const n=e.getActiveTokens(),o=1===n.length?n[0]:null;await(0,s.Gj)(e,t),a.Ll.popup.twoPopups?V(e,t,i,o):(0,s.mX)(t,{actor:e,imgName:i,token:o})},searchType:a.Ll.popup.twoPopups?s.Cp.PORTRAIT:s.Cp.PORTRAIT_AND_TOKEN,object:e,preventClose:a.Ll.popup.twoPopups&&a.Ll.popup.twoPopupsNoDialog}))}function W(e,t){return!!t&&(e[`${t.type}Disable`]??!1)}function z(e){return!!e&&(a.Ll.popup[`${e.type}Disable`]??!1)}function V(e,t,i,n){if(a.Ll.popup.twoPopups&&a.Ll.popup.twoPopupsNoDialog)(0,r.n)((n??e.prototypeToken).name,{callback:(t,i)=>(0,s.mX)(t,{actor:e,imgName:i,token:n}),searchType:s.Cp.TOKEN,object:n||e,force:!0});else if(a.Ll.popup.twoPopups){let a=new Dialog({title:"Portrait -> Token",content:`<p>${game.i18n.localize("token-variants.windows.art-select.apply-same-art")}</p>`,buttons:{one:{icon:'<i class="fas fa-check"></i>',callback:()=>{(0,s.mX)(t,{actor:e,imgName:i,token:n});const a=Object.values(ui.windows).filter((e=>e instanceof ArtSelect));for(const e of a)e.close()}},two:{icon:'<i class="fas fa-times"></i>',callback:()=>{(0,r.n)((n??e.prototypeToken).name,{callback:(t,i)=>(0,s.mX)(t,{actor:e,imgName:i,token:n}),searchType:s.Cp.TOKEN,object:n||e,force:!0})}}},default:"one"});a.render(!0)}}const K={};function Y(e,t,i,{once:n=!1}={}){if(e in K||(K[e]={}),t in K[e])return;a.Ll.debug&&console.info("TVA | Registering Hook",{feature_id:e,name:t,fn:i,once:n});const o=Hooks.on(t,i,{once:n});K[e][t]=o}function q(e,t){e in K&&t in K[e]&&(a.Ll.debug&&console.info("TVA | Un-Registering Hook",{feature_id:e,name:t,id:K[e][t]}),Hooks.off(t,K[e][t]),delete K[e][t])}function G(){a.Xi[n]&&a.Ll.displayEffectIconsOnHover?Y(n,"hoverToken",((e,t)=>{e.effects&&(e.effects.meVisible=t)})):q(n,"hoverToken"),a.Xi[n]&&a.Ll.displayEffectIconsOnHover?Y(n,"highlightObjects",(e=>{if(canvas.tokens.active)for(const t of canvas.tokens.placeables)t.effects&&(t.effects.meVisible=e||t.hover)})):q(n,"highlightObjects"),a.Xi[n]&&a.Ll.displayEffectIconsOnHover?Y(n,"refreshToken",(e=>{e.visible&&e.effects&&(e.effects.visible=Boolean(e.effects.meVisible))})):q(n,"refreshToken"),(0,_.oT)(),a.Ll.permissions.portrait_right_click[game.user.role]?(Y(l,"renderActorSheet",b),Y(l,"renderItemSheet",m),Y(l,"renderItemActionSheet",m),Y(l,"renderJournalSheet",v),Y(l,"renderRollTableConfig",k)):["renderActorSheet","renderItemSheet","renderItemActionSheet","renderJournalSheet","renderRollTableConfig"].forEach((e=>q(l,e))),a.Ll.permissions.image_path_button[game.user.role]?(Y(l,"renderTileConfig",h),Y(l,"renderMeasuredTemplateConfig",p),Y(l,"renderTokenConfig",c),Y(l,"renderDrawingConfig",f),Y(l,"renderNoteConfig",u),Y(l,"renderSceneConfig",d),Y(l,"renderMacroConfig",y),Y(l,"renderActiveEffectConfig",g)):["renderTileConfig","renderMeasuredTemplateConfig","renderTokenConfig","renderDrawingConfig","renderNoteConfig","renderSceneConfig","renderActiveEffectConfig"].forEach((e=>q(l,e))),(0,O.n)(),a.Xi[M]&&a.Ll.tilesEnabled?Y(M,"renderTileHUD",C):q(M,"renderTileHUD"),a.Xi[M]&&(a.Ll.permissions.hudFullAccess[game.user.role]||a.Ll.permissions.hud[game.user.role])?Y(M,"renderTokenHUD",I.R):q(M,"renderTokenHUD"),a.Xi[N]?(Y(N,"renderTokenConfig",L),Y(N,"preCreateToken",H)):["renderTokenConfig","preCreateToken"].forEach((e=>q(N,e))),a.Xi[D]?(Y(D,"updateToken",A),Y(D,"updateTile",F),Y(D,"sightRefresh",R)):["updateToken","updateTile","sightRefresh"].forEach((e=>q(D,e))),a.Xi[U]?(Y(U,"createActor",B),Y(U,"createToken",X)):["createActor","createToken"].forEach((e=>q(U,e)))}},111:(e,t,i)=>{i.d(t,{BG:()=>h,H$:()=>u,MF:()=>c,Ov:()=>d,VB:()=>p,Vp:()=>f,hf:()=>g});var a=i(309),n=i(924),o=i(634),r=i(15),s=i(869),l=i(126);function c(e,t){const i=foundry.utils.deepClone(e||{});delete i.effect;let a=`<div style="height: 300px;" class="form-group stacked command"><textarea style="height: 300px;" class="configJson">${JSON.stringify(i,null,2)}</textarea></div>`;new Dialog({title:"Overlay Configuration",content:a,buttons:{yes:{icon:"<i class='fas fa-save'></i>",label:"Save",callback:e=>{let i=e.find(".configJson").val();if(i)try{i=JSON.parse(i)}catch(e){console.warn("TVA |",e),i={}}else i={};t(i)}}},default:"yes"}).render(!0)}async function p(e){e.preventDefault();const t=e.target.closest(".path-category").find("input"),i=t.val().split(","),a=o.PO.concat(n.Ll.customImageCategories);let r='<div class="token-variants-popup-settings">';const s=[];let l=[];for(let e=0;e<a.length;e++)e>0&&e+1!=a.length&&e%4==0&&(s.push(l),l=[]),l.push(a[e]);l.length&&s.push(l);for(const e of s){r+='<header class="table-header flexrow">';for(const t of e)r+=`<label>${t}</label>`;r+='</header><ul class="setting-list"><li class="setting form-group"><div class="form-fields">';for(const t of e)r+=`<input class="category" type="checkbox" name="${t}" data-dtype="Boolean" ${i.includes(t)?"checked":""}>`;r+="</div></li></ul>"}r+="</div>",new Dialog({title:"Image Categories/Filters",content:r,buttons:{yes:{icon:"<i class='fas fa-save'></i>",label:"Apply",callback:e=>{const i=[];e.find(".category").each((function(){this.is(":checked")&&i.push(this.attr("name"))})),t.val(i.join(","))}}},default:"yes"}).render(!0)}async function f(e){e.preventDefault();const t=e.target.closest(".path-config").find("input");let i={};try{i=JSON.parse(t.val())}catch(e){}const a=game.settings.get("core",DefaultTokenConfig.SETTING),n=new foundry.data.PrototypeToken(a),o=new TokenDocument(n,{actor:null});new l.A(o,{},null,null,(e=>{e||(e={}),(null==e.flags||foundry.utils.isEmpty(e.flags))&&delete e.flags,t.val(JSON.stringify(e));const i=t.siblings(".select-config");foundry.utils.isEmpty(e)?i.removeClass("active"):i.addClass("active")}),i).render(!0)}async function u(e){if(!e)return;let t=`<form>\n<div class="form-group">\n  <label>Image Name</label>\n  <input type="text" name="name" value="${e.name}">\n</div>\n<div class="form-group">\n  <label>Image Path</label>\n    <div class="form-fields">\n      <input type="text" name="path" value="modules/token-variants/">\n      <button type="button" class="file-picker" data-type="folder" data-target="path" title="Browse Folders" tabindex="-1">\n        <i class="fas fa-file-import fa-fw"></i>\n      </button>\n    </div>\n</div>\n<div class="form-group slim">\n  <label>Width <span class="units">(pixels)</span></label>\n  <div class="form-fields">\n      <input type="number" step="1" name="width" value="${e.mesh.texture.width}">\n  </div>\n</div>\n<div class="form-group slim">\n  <label>Height <span class="units">(pixels)</span></label>\n  <div class="form-fields">\n      <input type="number" step="1" name="height" value="${e.mesh.texture.height}">\n  </div>\n</div>\n<div class="form-group slim">\n  <label>Scale</label>\n  <div class="form-fields">\n    <input type="number" step="any" name="scale" value="3">\n  </div>\n</div>\n</form>`;new Dialog({title:"Save Token/Overlay Image",content:t,buttons:{yes:{icon:"<i class='fas fa-save'></i>",label:"Save",callback:t=>{const i={};t.find("[name]").each((function(){let e=parseFloat(this.value);isNaN(e)&&(e=this.value),i[this.name]=e})),(0,o.ez)(e,i)}}},render:e=>{e.querySelector(".file-picker").click((()=>{new FilePicker({type:"folder",current:e.querySelector('[name="path"]').val(),callback:t=>{e.querySelector('[name="path"]').val(t)}}).render()}))},default:"yes"}).render(!0)}function d(e,{title1:t="Mappings",title2:i="Select Mappings",buttonTitle:a="Confirm",callback:n=null}={}){if(!e||!e.length)return;let o=`<form style="overflow-y: scroll; height:400px;"><h2>${i}</h2>`;const[s,l]=(0,r.T)(e);for(const[e,t]of Object.entries(l))if(t.list.length){o+=`<h4 style="text-align:center;"><b>${e}</b></h4>`;for(const e of t.list)o+=`\n        <div class="form-group">\n          <label>${e.label}</label>\n          <div class="form-fields">\n              <input type="checkbox" name="${e.id}" data-dtype="Boolean">\n          </div>\n        </div>\n        `}o+='</form><div class="form-group"><button type="button" class="select-all">Select all</div>',new Dialog({title:t,content:o,buttons:{Ok:{label:a,callback:async t=>{if(!n)return;const i=[];t.querySelector('input[type="checkbox"]').each((function(){if(this.checked){const t=e.find((e=>e.id===this.name));if(t){const e=foundry.utils.deepClone(t);i.push(e),delete e.targetActors}}})),n(i)}}},close:()=>n(null),render:e=>{e.querySelector(".select-all").click((()=>{e.querySelector('input[type="checkbox"]').prop("checked",!0)}))}}).render(!0)}function h(e){let t;t=new Dialog({title:"Mapping Templates",content:'\n<div class="form-group">\n  <label>Template Name</label>\n  <div class="form-fields">\n    <input type="text" name="templateName" data-dtype="String" value="">\n  </div>\n</div>\n<div class="form-group">\n  <label>Hover Text (optional)</label>\n  <div class="form-fields">\n    <input type="text" name="templateHint" data-dtype="String" value="">\n  </div>\n</div>\n<div class="form-group">\n  <label>Hover Image (optional)</label>\n  <div class="form-fields">\n    <input type="text" name="img" data-dtype="String" value="">\n  </div>\n</div>',buttons:{create:{label:"Create Template",callback:t=>{const i=t.querySelector('[name="templateName"]').val().trim(),a=t.querySelector('[name="templateHint"]').val().trim(),o=t.querySelector('[name="img"]').val().trim();i.trim()&&(n.Ll.templateMappings.push({id:foundry.utils.randomID(),name:i,hint:a,img:o,mappings:foundry.utils.deepClone(e)}),(0,n.Xx)({templateMappings:n.Ll.templateMappings}))}},cancel:{label:"Cancel"}},default:"cancel"}),t.render(!0)}function g(){new s.I({callback:(e,t)=>(0,a.l7)(e,t)}).render(!0)}},113:(e,t,i)=>{i.d(t,{OH:()=>a,_z:()=>o,ag:()=>r,mi:()=>n});const a={id:"",label:"",expression:"",codeExp:"",imgName:"",imgSrc:"",priority:50,config:null,overlay:!1,alwaysOn:!1,tokens:void 0,disabled:!1,overlayConfig:null,targetActors:null,group:"Default"},n={img:"",imgLinked:!1,alpha:1,scaleX:1,scaleY:1,offsetX:0,offsetY:0,angle:0,filter:"NONE",filterOptions:{},inheritTint:!1,top:!1,bottom:!1,underlay:!1,linkRotation:!0,linkMirror:!0,linkOpacity:!1,linkScale:!0,linkDimensionX:!1,linkDimensionY:!1,linkStageScale:!1,mirror:!1,tint:null,loop:!0,playOnce:!1,animation:{rotate:!1,duration:5e3,clockwise:!0,relative:!1},limitedUsers:[],limitedToOwner:!1,limitOnProperty:"",alwaysVisible:!1,text:{text:"",align:CONFIG.canvasTextStyle.align,fontSize:CONFIG.canvasTextStyle.fontSize,fontFamily:CONFIG.canvasTextStyle.fontFamily,fill:CONFIG.canvasTextStyle.fill,dropShadow:CONFIG.canvasTextStyle.dropShadow,strokeThickness:CONFIG.canvasTextStyle.strokeThickness,stroke:CONFIG.canvasTextStyle.stroke,curve:{angle:0,radius:0,invert:!1},letterSpacing:CONFIG.canvasTextStyle.letterSpacing,repeating:!1,wordWrap:!1,wordWrapWidth:200,breakWords:!1,maxHeight:0},parentID:"",id:null,anchor:{x:.5,y:.5},shapes:[],variables:[],interactivity:[],ui:!1},o={Rectangle:{type:"rectangle",x:0,y:0,width:100,height:100,radius:0,repeating:!1},Ellipse:{type:"ellipse",x:0,y:0,width:50,height:50,repeating:!1},Polygon:{type:"polygon",x:0,y:0,points:"0,1,0.95,0.31,0.59,-0.81,-0.59,-0.81,-0.95,0.31",scale:50,repeating:!1},Torus:{type:"torus",x:0,y:0,innerRadius:50,outerRadius:100,startAngle:0,endAngle:180,repeating:!1},CutCircle:{type:"cutCircle",x:0,y:0,radius:50,cut:.5,rotation:0,repeating:!1}},r={line:{width:1,color:"#000000",alpha:1},fill:{color:"#ffffff",color2:"",prc:"",alpha:1}}},126:(e,t,i)=>{i.d(t,{A:()=>TokenCustomConfig});var a=i(634);class TokenCustomConfig extends TokenConfig{constructor(e,t,i,a,n,o){let r;r=e instanceof Actor?new TokenDocument(e.token,{actor:e}):new TokenDocument(e.document,{actor:game.actors.get(e.actorId)}),super(r,t),this.imgSrc=i,this.imgName=a,this.callback=n,this.config=o,this.config&&(this.flags=this.config.flags,this.tv_script=this.config.tv_script)}_getSubmitData(e={}){if(!this.form)throw new Error("The FormApplication subclass has no registered form element");let t=new FormDataExtended(this.form,{editors:this.editors}).object;return e&&(t=foundry.utils.flattenObject(foundry.utils.mergeObject(t,e))),"detectionModes.0.id"in t||(t.detectionModes=[]),t["bar1.attribute"]||=null,t["bar2.attribute"]||=null,t}async _updateObject(e,t){const i={};if(e.target.closest("form").find(".form-group").each((function(e){const a=this.find(".tva-config-checkbox > input");a.length&&a.is(":checked")&&this.find("[name]").each((function(e){const a=this.attr("name");i[a]=t[a]}))})),this.tv_script&&(i.tv_script=this.tv_script),this.config){let e=foundry.utils.expandObject(i);e.flags=e.flags?foundry.utils.mergeObject(this.flags||{},e.flags):this.flags,this.callback&&this.callback(e)}else{const e=(0,a.iB)(this.imgSrc,this.imgName,i);this.callback&&this.callback(e)}}applyCustomConfig(){const e=foundry.utils.flattenObject(this.config||(0,a.mR)(this.imgSrc,this.imgName)),t=this.form;for(const i of Object.keys(e)){const a=t.find(`[name="${i}"]`);a.is(":checkbox")?a.prop("checked",e[i]):a.val(e[i]),a.trigger("change")}}async activateListeners(e){await super.activateListeners(e),e.find(".token-variants-image-select-button").prop("disabled",!0),e.find(".file-picker").prop("disabled",!0),e.find(".image").prop("disabled",!0),e.find(".assign-token").remove();const t=this.config||(0,a.mR)(this.imgSrc,this.imgName);this.tv_script=t.tv_script,e.on("change",".tva-config-checkbox",this._onCheckboxChange);const i=function(e){if(!e.find('[name="img"]').length){let i=!1;if(t){const a=foundry.utils.flattenObject(t);e.find("[name]").each((function(e){this.attr("name")in a&&(i=!0)}))}const a=$(`<div class="tva-config-checkbox"><input type="checkbox" data-dtype="Boolean" ${i?'checked=""':""}></div>`);e.find("p.hint").length?e.find("p.hint").before(a):e.append(a),a.find("input").trigger("change")}};e.find(".form-group").each((function(e){i(this)})),e.find(".sheet-footer > button").remove(),e.find(".sheet-footer").append('<button type="submit" value="1"><i class="far fa-save"></i> Save Config</button>'),t&&(e.find(".sheet-footer").append('<button type="button" class="remove-config"><i class="fas fa-trash"></i> Remove Config</button>'),e.querySelector(".remove-config").click(this._onRemoveConfig.bind(this))),e.find('.tabs > .item[data-tab="image"] > i').trigger("click"),e.find('.tabs > .item[data-tab="appearance"] > i').trigger("click"),document.activeElement.blur();new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{"DIV"===e.nodeName&&"form-group"===e.className&&(i(e),this.applyCustomConfig())}))}))})).observe(e[0],{characterData:!1,attributes:!1,childList:!0,subtree:!0}),e.on("change","input, select",n),e.on("click","button",n),this.applyCustomConfig()}async _onCheckboxChange(e){const t=e.target;t.closest(".form-group").css({"outline-color":t.is(":checked")?"green":"#ffcc6e","outline-width":"2px","outline-style":"dotted","margin-bottom":"5px"}),t.closest(".tva-config-checkbox").css({"outline-color":t.is(":checked")?"green":"#ffcc6e","outline-width":"2px","outline-style":"solid"})}async _onRemoveConfig(e){if(this.config)this.callback&&this.callback({});else{const e=(0,a.iB)(this.imgSrc,this.imgName,null);this.callback&&this.callback(e)}this.close()}get id(){return`token-custom-config-${this.object.id}`}_getHeaderButtons(){return super._getHeaderButtons()}}async function n(e){"tva-config-checkbox"!==e.target.parentNode.className&&e.target.closest(".form-group").find(".tva-config-checkbox input").prop("checked",!0)}},163:(e,t,i)=>{i.d(t,{A:()=>ConfigureSettings});var a=i(853),n=i(924),o=i(634),r=i(15),s=i(111);class ConfigureSettings extends FormApplication{constructor(e,{searchPaths:t=!0,searchFilters:i=!0,searchAlgorithm:a=!0,randomizer:o=!0,popup:r=!0,permissions:s=!0,worldHud:l=!0,misc:c=!0,activeEffects:p=!0,features:f=!1}={}){super({},{}),this.enabledTabs={searchPaths:t,searchFilters:i,searchAlgorithm:a,randomizer:o,features:f,popup:r,permissions:s,worldHud:l,misc:c,activeEffects:p},this.settings=foundry.utils.deepClone(n.Ll),e&&(this.settings=foundry.utils.mergeObject(this.settings,e,{insertKeys:!1}),this.dummySettings=e)}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-configure-settings",classes:["sheet"],template:"modules/token-variants/token-variants/templates/configureSettings.html",resizable:!1,minimizable:!1,title:"Configure Settings",width:700,height:"auto",tabs:[{navSelector:".sheet-tabs",contentSelector:".content",initial:"searchPaths"}]})}async getData(e){const t=super.getData(e),i=this.settings;t.enabledTabs=this.enabledTabs;const a=i.searchPaths.map((e=>{const t={};return t.text=e.text,t.icon=this._pathIcon(e.source||""),t.cache=e.cache,t.source=e.source||"",t.types=e.types.join(","),t.config=JSON.stringify(e.config??{}),t.hasConfig=e.config&&!foundry.utils.isEmpty(e.config),t}));t.searchPaths=a,t.searchFilters=i.searchFilters;for(const e in t.searchFilters)t.searchFilters[e].label=e;t.algorithm=foundry.utils.deepClone(i.algorithm),t.algorithm.fuzzyThreshold=100-100*t.algorithm.fuzzyThreshold,t.randomizer=foundry.utils.deepClone(i.randomizer);const n=game.documentTypes.Actor;t.randomizer.actorTypes=n.reduce(((e,t)=>{const a=CONFIG.Actor?.typeLabels?.[t]??t;return e[t]={label:game.i18n.has(a)?game.i18n.localize(a):t,disable:i.randomizer[`${t}Disable`]??!1},e}),{}),t.randomizer.tokenToPortraitDisabled=!(i.randomizer.tokenCreate||i.randomizer.tokenCopyPaste)||t.randomizer.diffImages,t.popup=foundry.utils.deepClone(i.popup),t.popup.actorTypes=n.reduce(((e,t)=>{const a=CONFIG.Actor?.typeLabels?.[t]??t;return e[t]={type:t,label:game.i18n.has(a)?game.i18n.localize(a):t,disable:i.popup[`${t}Disable`]??!1},e}),{});let o=[],r=[],s=0;for(const[e,i]of Object.entries(t.popup.actorTypes))r.push(i),s++,s%3==0&&(o.push(r),r=[]);return r.length>0&&o.push(r),t.popup.actorTypes=o,t.permissions=i.permissions,t.worldHud=foundry.utils.deepClone(i.worldHud),t.worldHud.tokenHUDWildcardActive=game.modules.get("token-hud-wildcard")?.active,t.internalEffects=foundry.utils.deepClone(i.internalEffects),t.keywordSearch=i.keywordSearch,t.excludedKeywords=i.excludedKeywords,t.systemHpPath=i.systemHpPath,t.runSearchOnPath=i.runSearchOnPath,t.imgurClientId=i.imgurClientId,t.enableStatusConfig=i.enableStatusConfig,t.disableNotifs=i.disableNotifs,t.staticCache=i.staticCache,t.staticCacheFile=i.staticCacheFile,t.stackStatusConfig=i.stackStatusConfig,t.mergeGroup=i.mergeGroup,t.customImageCategories=i.customImageCategories.join(","),t.disableEffectIcons=i.disableEffectIcons,t.displayEffectIconsOnHover=i.displayEffectIconsOnHover,t.filterEffectIcons=i.filterEffectIcons,t.hideElevationTooltip=i.hideElevationTooltip,t.hideTokenBorder=i.hideTokenBorder,t.filterCustomEffectIcons=i.filterCustomEffectIcons,t.filterIconList=i.filterIconList.join(","),t.tilesEnabled=i.tilesEnabled,t.updateTokenProto=i.updateTokenProto,t.imgNameContainsDimensions=i.imgNameContainsDimensions,t.imgNameContainsFADimensions=i.imgNameContainsFADimensions,t.playVideoOnHover=i.playVideoOnHover,t.pauseVideoOnHoverOut=i.pauseVideoOnHoverOut,t.disableImageChangeOnPolymorphed=i.disableImageChangeOnPolymorphed,t.disableImageUpdateOnNonPrototype=i.disableImageUpdateOnNonPrototype,t.disableTokenUpdateAnimation=i.disableTokenUpdateAnimation,t.evaluateOverlayOnHover=i.evaluateOverlayOnHover,t.pathfinder=["pf1e","pf2e"].includes(game.system.id),t.dnd5e="dnd5e"===game.system.id,t}activateListeners(e){super.activateListeners(e),super.activateListeners(e),e.querySelector("a.create-path").click(this._onCreatePath.bind(this)),e.on("input",".searchSource",this._onSearchSourceTextChange.bind(this)),e.on("click","a.delete-path",this._onDeletePath.bind(this)),e.on("click","a.convert-imgur",this._onConvertImgurPath.bind(this)),e.on("click","a.convert-json",this._onConvertJsonPath.bind(this)),e.on("click",".path-image.source-icon a",this._onBrowseFolder.bind(this)),e.on("click","a.select-category",s.VB.bind(this)),e.on("click","a.select-config",s.Vp.bind(this)),e.on("input","input.filterRegex",this._validateRegex.bind(this));const t=e.querySelector('[name="disableEffectIcons"]'),i=e.querySelector('[name="filterEffectIcons"]');t.on("change",(e=>{e.target.checked&&i.prop("checked",!1)})).trigger("change"),i.on("change",(e=>{e.target.checked&&t.prop("checked",!1)}));const n=e.find('div[data-tab="searchAlgorithm"]');n.find('input[name="algorithm.exact"]').change((e=>{e.target.closest("form").find('input[name="algorithm.fuzzy"]').prop("checked",!e.target.checked)})),n.find('input[name="algorithm.fuzzy"]').change((e=>{e.target.closest("form").find('input[name="algorithm.exact"]').prop("checked",!e.target.checked)})),n.find('input[name="algorithm.fuzzyThreshold"]').change((e=>{e.target.siblings(".token-variants-range-value").html(`${e.target.value}%`)}));const o=e.querySelector('input[name="randomizer.tokenCreate"]'),l=e.querySelector('input[name="randomizer.tokenCopyPaste"]'),c=e.querySelector('input[name="randomizer.tokenToPortrait"]'),p=()=>{c.prop("disabled",!(o.is(":checked")||l.is(":checked")))};o.change(p),l.change(p);const f=e.querySelector('input[name="randomizer.diffImages"]'),u=e.querySelector('input[name="randomizer.syncImages"]');f.change((()=>{u.prop("disabled",!f.is(":checked")),c.prop("disabled",f.is(":checked"))})),e.querySelector('input[name="worldHud.updateActorImage"]').change((e=>{e.target.closest("form").find('input[name="worldHud.useNameSimilarity"]').prop("disabled",!e.target.checked)})),e.querySelector("button.token-variants-cache-images").click((e=>{const t=e.target.closest(".tab"),i=t.find('input[name="staticCache"]'),n=t.find('input[name="staticCacheFile"]');(0,a.Vl)({staticCache:i.is(":checked"),staticCacheFile:n.val()})})),e.querySelector("button.token-variants-global-mapping").click((()=>{const e=game.settings.get("core",DefaultTokenConfig.SETTING),t=new foundry.data.PrototypeToken(e),i=new TokenDocument(t,{actor:null});new r.A(i,{globalMappings:!0}).render(!0)}))}async _validateRegex(e){this._validRegex(e.target.value)?e.target.style.backgroundColor="":e.target.style.backgroundColor="#ff7066"}_validRegex(e){if(e)try{new RegExp(e)}catch(e){return!1}return!0}async _onBrowseFolder(e){const t=e.target.closest(".table-row").find(".path-text input"),i=e.target.closest(".table-row").find(".path-source input");let a=i.val()||"data",n=t.val();if(a.startsWith("s3:")){const e=a.replace("s3:","");n=`${game.data.files.s3?.endpoint.protocol}//${e}.${game.data.files.s3?.endpoint.host}/${n}`}else if(a.startsWith("rolltable")){let e='<select style="width: 100%;" name="table-name" id="output-tableKey">';return game.tables.forEach((t=>{e+=`<option value='${t.name}'>${t.name}</option>`})),e+="</select>",void new Dialog({title:"Select a Rolltable",content:e,buttons:{yes:{icon:"<i class='fas fa-check'></i>",label:"Select",callback:e=>{t.val();const i=e.querySelector("select[name='table-name']").val();t.val(i)}}},default:"yes"}).render(!0)}"json"===a?new FilePicker({type:"text",activeSource:"data",current:n,callback:(e,i)=>{t.val(e)}}).render(!0):new FilePicker({type:"folder",activeSource:a,current:n,callback:(e,a)=>{t.val(a.result.target),"s3"===a.activeSource?i.val(`s3:${a.result.bucket}`):i.val(a.activeSource)}}).render(!0)}async _onConvertImgurPath(e){e.preventDefault();const t=e.target.closest(".table-row").find(".path-text input"),i=e.target.closest(".table-row").find(".path-source input"),a=t.val(),o=""===n.Ll.imgurClientId?"df9d991443bb222":n.Ll.imgurClientId;fetch("https://api.imgur.com/3/gallery/album/"+a,{headers:{Authorization:"Client-ID "+o,Accept:"application/json"}}).then((e=>e.json())).then(async function(e){if(!e.success&&"localhost"===location.hostname)return void ui.notifications.warn(game.i18n.format("token-variants.notifications.warn.imgur-localhost"));const n=e.data;let o=[];n.images.forEach(((e,t)=>{o.push({type:0,text:e.title??e.description??"",weight:1,range:[t+1,t+1],collection:"Text",drawn:!1,img:e.link})})),await RollTable.create({name:n.title,description:"Token Variant Art auto generated RollTable: https://imgur.com/gallery/"+a,results:o,replacement:!0,displayRoll:!0,img:"modules/token-variants/token-variants/img/token-images.svg"}),t.val(n.title),i.val("rolltable").trigger("input")}.bind(this)).catch((e=>console.warn("TVA | ",e)))}async _onConvertJsonPath(e){e.preventDefault();const t=e.target.closest(".table-row").find(".path-text input"),i=e.target.closest(".table-row").find(".path-source input"),a=t.val();fetch(a,{headers:{Accept:"application/json"}}).then((e=>e.json())).then(async function(e){if(!e.length>0)return void ui.notifications.warn(game.i18n.format("token-variants.notifications.warn.json-localhost"));const n=e;n.title=(0,o.WP)(a);let r=[];n.forEach(((e,t)=>{r.push({type:0,text:e.name??"",weight:1,range:[t+1,t+1],collection:"Text",drawn:!1,img:e.path})})),await RollTable.create({name:n.title,description:"Token Variant Art auto generated RollTable: "+a,results:r,replacement:!0,displayRoll:!0,img:"modules/token-variants/token-variants/img/token-images.svg"}),t.val(n.title),i.val("rolltable").trigger("input")}.bind(this)).catch((e=>console.warn("TVA | ",e)))}async _onCreatePath(e){e.preventDefault();const t=e.currentTarget.closest(".token-variant-table");let i=`\n    <li class="table-row flexrow">\n        <div class="path-image source-icon">\n            <a><i class="${this._pathIcon("")}"></i></a>\n        </div>\n        <div class="path-source">\n          <input class="searchSource" type="text" name="searchPaths.source" value="" placeholder="data"/>\n        </div>\n        <div class="path-text">\n            <input class="searchPath" type="text" name="searchPaths.text" value="" placeholder="Path to folder"/>\n        </div>\n        <div class="imgur-control">\n            <a class="convert-imgur" title="Convert to Rolltable"><i class="fas fa-angle-double-left"></i></a>\n        </div>\n        <div class="json-control">\n          <a class="convert-json" title="Convert to Rolltable"><i class="fas fa-angle-double-left"></i></a>\n        </div>\n        <div class="path-category">\n            <a class="select-category" title="Select image categories/filters"><i class="fas fa-swatchbook"></i></a>\n            <input type="hidden" name="searchPaths.types" value="Portrait,Token,PortraitAndToken">\n        </div>\n        <div class="path-config">\n          <a class="select-config" title="Apply configuration to images under this path."><i class="fas fa-cog fa-lg"></i></a>\n          <input type="hidden" name="searchPaths.config" value="{}">\n         </div>\n        <div class="path-cache">\n            <input type="checkbox" name="searchPaths.cache" data-dtype="Boolean" checked/>\n        </div>\n        <div class="path-controls">\n            <a class="delete-path" title="Delete path"><i class="fas fa-trash"></i></a>\n        </div>\n    </li>\n  `;t.append(i),this._reIndexPaths(t),this.setPosition()}async _reIndexPaths(e){e.find(".path-source").find("input").each((function(e){this.attr("name",`searchPaths.${e}.source`)})),e.find(".path-text").find("input").each((function(e){this.attr("name",`searchPaths.${e}.text`)})),e.find(".path-cache").find("input").each((function(e){this.attr("name",`searchPaths.${e}.cache`)})),e.find(".path-category").find("input").each((function(e){this.attr("name",`searchPaths.${e}.types`)})),e.find(".path-config").find("input").each((function(e){this.attr("name",`searchPaths.${e}.config`)}))}async _onDeletePath(e){e.preventDefault();e.currentTarget.closest(".table-row").remove();const t=e.currentTarget.closest(".token-variant-table");this._reIndexPaths(t),this.setPosition()}async _onSearchSourceTextChange(e){const t=this._pathIcon(e.target.value),i="fas fa-info"===t,a="fas fa-brackets-curly"===t,n=e.currentTarget.closest(".table-row").find(".imgur-control");i?n.addClass("active"):n.removeClass("active");const o=e.currentTarget.closest(".table-row").find(".json-control");a?o.addClass("active"):o.removeClass("active"),e.currentTarget.closest(".table-row").find(".path-image i").attr("class",t)}_pathIcon(e){return e.startsWith("s3")?"fas fa-database":e.startsWith("rolltable")?"fas fa-dice":e.startsWith("forgevtt")||e.startsWith("forge-bazaar")?"fas fa-hammer":e.startsWith("imgur")?"fas fa-info":e.startsWith("json")?"fas fa-brackets-curly":"fas fa-folder"}async _updateObject(e,t){const i=this.settings;t=foundry.utils.expandObject(t),i.searchPaths=t.hasOwnProperty("searchPaths")?Object.values(t.searchPaths):[],i.searchPaths.forEach((e=>{if(e.source||(e.source="data"),e.types?e.types=e.types.split(","):e.types=[],e.config)try{e.config=JSON.parse(e.config)}catch(t){delete e.config}else delete e.config}));for(const e in t.searchFilters)this._validRegex(t.searchFilters[e].regex)||(t.searchFilters[e].regex="");foundry.utils.mergeObject(i.searchFilters,t.searchFilters),t.algorithm.fuzzyLimit=parseInt(t.algorithm.fuzzyLimit),(isNaN(t.algorithm.fuzzyLimit)||t.algorithm.fuzzyLimit<1)&&(t.algorithm.fuzzyLimit=50),t.algorithm.fuzzyThreshold=(100-t.algorithm.fuzzyThreshold)/100,foundry.utils.mergeObject(i.algorithm,t.algorithm),foundry.utils.mergeObject(i.randomizer,t.randomizer),foundry.utils.mergeObject(i.popup,t.popup),foundry.utils.mergeObject(i.permissions,t.permissions),foundry.utils.mergeObject(i.worldHud,t.worldHud),foundry.utils.mergeObject(i.internalEffects,t.internalEffects),foundry.utils.mergeObject(i,{keywordSearch:t.keywordSearch,excludedKeywords:t.excludedKeywords,systemHpPath:t.systemHpPath?.trim(),runSearchOnPath:t.runSearchOnPath,imgurClientId:t.imgurClientId,enableStatusConfig:t.enableStatusConfig,disableNotifs:t.disableNotifs,staticCache:t.staticCache,staticCacheFile:t.staticCacheFile,tilesEnabled:t.tilesEnabled,stackStatusConfig:t.stackStatusConfig,mergeGroup:t.mergeGroup,customImageCategories:(t.customImageCategories||"").split(",").map((e=>e.trim())).filter((e=>e)),disableEffectIcons:t.disableEffectIcons,displayEffectIconsOnHover:t.displayEffectIconsOnHover,filterEffectIcons:t.filterEffectIcons,hideElevationTooltip:t.hideElevationTooltip,hideTokenBorder:t.hideTokenBorder,filterCustomEffectIcons:t.filterCustomEffectIcons,filterIconList:(t.filterIconList||"").split(",").map((e=>e.trim())).filter((e=>e)),updateTokenProto:t.updateTokenProto,imgNameContainsDimensions:t.imgNameContainsDimensions,imgNameContainsFADimensions:t.imgNameContainsFADimensions,playVideoOnHover:t.playVideoOnHover,pauseVideoOnHoverOut:t.pauseVideoOnHoverOut,disableImageChangeOnPolymorphed:t.disableImageChangeOnPolymorphed,disableImageUpdateOnNonPrototype:t.disableImageUpdateOnNonPrototype,disableTokenUpdateAnimation:t.disableTokenUpdateAnimation,evaluateOverlayOnHover:t.evaluateOverlayOnHover}),i.globalMappings=n.Ll.globalMappings,this.dummySettings?l(this.dummySettings,i,{insertKeys:!1}):(0,n.Xx)(i)}}function l(e,t={},{insertKeys:i=!0,insertValues:a=!0,overwrite:n=!0,recursive:o=!0,inplace:r=!0,enforceTypes:s=!1}={},l=0){if(t=t||{},!(e instanceof Object&&t instanceof Object))throw new Error("One of original or other are not Objects!");const f={insertKeys:i,insertValues:a,overwrite:n,recursive:o,inplace:r,enforceTypes:s};0===l&&(r||(e=foundry.utils.deepClone(e)),Object.keys(e).some((e=>/\./.test(e)))&&(e=foundry.utils.expandObject(e)),Object.keys(t).some((e=>/\./.test(e)))&&(t=foundry.utils.expandObject(t)));for(let i of Object.keys(t)){const a=t[i];e.hasOwnProperty(i)?p(e,i,a,f,l+1):c(e,i,a,f,l+1)}return e}function c(e,t,i,{insertKeys:a,insertValues:n}={},o){if(i?.constructor===Object&&a)return void(e[t]=l({},i,{insertKeys:!0,inplace:!0}));if(t.startsWith("-="))return void delete e[t.slice(2)];(o<=1&&a||o>1&&n)&&(e[t]=i)}function p(e,t,i,{insertKeys:a,insertValues:n,enforceTypes:o,overwrite:r,recursive:s}={},c){const p=e[t],f=foundry.utils.getType(i),u=foundry.utils.getType(p);if("Object"===f&&"Object"===u&&s)return l(p,i,{insertKeys:a,insertValues:n,overwrite:r,inplace:!0,enforceTypes:o},c);if(r){if("undefined"!==u&&f!==u&&o)throw new Error("Mismatched data types encountered during object merge.");e[t]=i}}},170:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{I:()=>TVAOverlay});var _applications_overlayConfig_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(548),_hooks_effectMappingHooks_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(309),_hooks_overlayHooks_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(526),_models_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(113),_token_overlay_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(605),_utils_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(634),_HTMLOverlay_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(722);class TVAOverlay extends PrimarySpriteMesh{constructor(e,t,i){super({name:"TVAOverlay",object:t}),e.shapes&&(e.shapes=this.addChild(e.shapes)),this.pseudoTexture=e,this.texture=e.texture,this.occludedAlpha=1,this.ready=!1,this.overlaySort=0,this.filtersApplied=!1,this.overlayConfig=foundry.utils.mergeObject(_models_js__WEBPACK_IMPORTED_MODULE_3__.mi,i,{inplace:!1}),e.html&&this.addHTMLOverlay(),!("linkDimensionsX"in this.overlayConfig)&&this.overlayConfig.linkDimensions&&(this.overlayConfig.linkDimensionsX=!0,this.overlayConfig.linkDimensionsY=!0),this._registerHooks(this.overlayConfig),this._tvaPlay().then((()=>this.refresh())),Object.defineProperty(this,"visible",{get:this._customVisible,set:function(){},configurable:!0}),this.eventMode="none"}enableInteractivity(){if(this.mouseInteractionManager&&!this.overlayConfig.interactivity?.length)return this.removeAllListeners(),this.mouseInteractionManager=null,this.cursor=null,void(this.eventMode="none");if(this.mouseInteractionManager||!this.overlayConfig.interactivity?.length)return;this.overlayConfig.ui||"passive"===canvas.primary.eventMode&&(canvas.primary.eventMode="passive"),this.eventMode="static";let e=this.parent;for(;e instanceof TVAOverlay||e?.parent instanceof TVAOverlay;)e.eventMode="passive",e=e.parent;this.cursor="pointer";const t=this.object,i=this,a=function(e,a){i.overlayConfig.interactivity.forEach((i=>{i.listener===a&&(e.preventDefault(),e.stopPropagation(),i.script&&(0,_utils_js__WEBPACK_IMPORTED_MODULE_5__.Uh)(i.script,{token:t}),i.macro&&(0,_utils_js__WEBPACK_IMPORTED_MODULE_5__.KW)(i.macro,t),i.ceEffect&&(0,_utils_js__WEBPACK_IMPORTED_MODULE_5__.OE)(t,i.ceEffect),i.tmfxPreset&&(0,_utils_js__WEBPACK_IMPORTED_MODULE_5__.Rz)(t,i.tmfxPreset))}))},n={hoverIn:e=>a(e,"hoverIn"),hoverOut:e=>a(e,"hoverOut"),clickLeft:e=>a(e,"clickLeft"),clickLeft2:e=>a(e,"clickLeft2"),clickRight:e=>a(e,"clickRight"),clickRight2:e=>a(e,"clickRight2"),dragLeftStart:null,dragLeftMove:null,dragLeftDrop:null,dragLeftCancel:null,dragRightStart:null,dragRightMove:null,dragRightDrop:null,dragRightCancel:null,longPress:null},o=new MouseInteractionManager(this,canvas.stage,{hoverIn:()=>!0,hoverOut:()=>!0,clickLeft:()=>!0,clickLeft2:()=>!0,clickRight:()=>!0,clickRight2:()=>!0,dragStart:()=>!1},n,{target:null});this.mouseInteractionManager=o.activate()}_onAdded(){}_customVisible(){const e=this.overlayConfig;if(!this.ready||!this.object.visible&&!e.alwaysVisible)return!1;if(e.limitedToOwner&&!this.object.isOwner)return!1;if(e.limitedUsers?.length&&!e.limitedUsers.includes(game.user.id))return!1;if(e.limitOnEffect||e.limitOnProperty){const t=ChatMessage.getSpeaker();let i=canvas.ready?canvas.tokens.get(t.token):null;if(!i)return!1;if(e.limitOnEffect&&!(0,_hooks_effectMappingHooks_js__WEBPACK_IMPORTED_MODULE_1__.AI)(i).includes(e.limitOnEffect))return!1;if(e.limitOnProperty&&!(0,_hooks_effectMappingHooks_js__WEBPACK_IMPORTED_MODULE_1__.y5)(i.document,e.limitOnProperty))return!1}return 1===this.object.detectionLevel?Boolean(e.impreciseVisible):!(e.limitOnHover||e.limitOnControl||e.limitOnHighlight||e.limitOnHUD||e.limitOnTarget||e.limitOnAnyTarget)||(!(!e.limitOnHover||canvas.controls.ruler._state!==Ruler.STATES.INACTIVE||!this.object.hover)||(!(!e.limitOnControl||!this.object.controlled)||(!(!e.limitOnHighlight||!(canvas.tokens.highlightObjects??canvas.tokens._highlight))||(!(!e.limitOnHUD||!this.object.hasActiveHUD)||(!(!e.limitOnAnyTarget||!this.object.targeted.size)||!(!e.limitOnTarget||!this.object.targeted.some((e=>e.id===game.userId))))))))}get sortLayer(){return this.object.mesh?.sortLayer||0}get zIndex(){let e=this.object.mesh.zIndex;return this.overlayConfig.ui&&this.overlayConfig.bottom&&(e-=9999),e}get sort(){const e=this.object.mesh.sort;return this.overlayConfig.top?e+9999:this.overlayConfig.bottom?e-9999:e}get _lastSortedIndex(){return(this.object.mesh._lastSortedIndex||0)+this.overlaySort}get elevation(){const e=this.object.mesh?.elevation;return this.overlayConfig.bottom&&e>0?0:this.overlayConfig.top?e+9999:e}set _lastSortedIndex(e){}async _tvaPlay(){const e=this.texture?.baseTexture?.resource?.source;if("VIDEO"===e?.tagName){const t=e.cloneNode(!0);this.overlayConfig.playOnce&&(t.onended=()=>{this.alpha=0,this.tvaVideoEnded=!0}),await new Promise((e=>t.oncanplay=e)),this.texture=PIXI.Texture.from(t,{resourceOptions:{autoPlay:!1}});const i={loop:this.overlayConfig.loop&&!this.overlayConfig.playOnce,volume:0,offset:0,playing:!0};game.video.play(t,i)}}addChildAuto(...e){return this.pseudoTexture?.shapes?this.pseudoTexture.shapes.addChild(...e):this.addChild(...e)}setTexture(e,{preview:t=!1,refresh:i=!0,configuration:a=null,refreshFilters:n=!1}={}){t?(this._swapChildren(e),this.originalTexture?this._destroyTexture():(this.originalTexture=this.pseudoTexture,this.originalTexture.shapes&&this.removeChild(this.originalTexture.shapes)),this.pseudoTexture=e,this.texture=e.texture,e.shapes&&(e.shapes=this.addChild(e.shapes))):this.originalTexture?(this._swapChildren(this.originalTexture),this._destroyTexture(),this.pseudoTexture=this.originalTexture,this.texture=this.originalTexture.texture,this.originalTexture.shapes&&(this.pseudoTexture.shapes=this.addChild(this.originalTexture.shapes)),delete this.originalTexture):(this._swapChildren(e),this._destroyTexture(),this.pseudoTexture=e,this.texture=e.texture,e.shapes&&(this.pseudoTexture.shapes=this.addChild(e.shapes))),this.pseudoTexture.html&&this.addHTMLOverlay(),i&&this.refresh(a,{fullRefresh:!t,refreshFilters:n})}refresh(e,{preview:t=!1,fullRefresh:i=!0,previewTexture:a=null,refreshFilters:n=!1}={}){if(!this.overlayConfig||!this.texture)return;(a||this.originalTexture)&&this.setTexture(a,{preview:Boolean(a),refresh:!1}),e&&this._registerHooks(e);const o=foundry.utils.mergeObject(this.overlayConfig,e??{},{inplace:!t});if(t&&this.htmlOverlay&&this.htmlOverlay.render(o,!0),this.enableInteractivity(o),i){const e=foundry.utils.getProperty(this.texture,"baseTexture.resource.source");e&&"VIDEO"===e.tagName&&(!e.loop&&o.loop?game.video.play(e):e.loop&&!o.loop&&game.video.stop(e),e.loop=o.loop)}const r=this.pseudoTexture.shapes,s=r??this.texture;if(o.linkScale&&!o.parentID){const e=this.scale;s.width/s.height>=1?(e.x=this.object.w*Math.abs(this.object.document.texture.scaleX)/s.width,e.y=Number(e.x)):(e.y=this.object.h*Math.abs(this.object.document.texture.scaleY)/s.height,e.x=Number(e.y))}else o.linkStageScale?(this.scale.x=1/canvas.stage.scale.x,this.scale.y=1/canvas.stage.scale.y):o.linkDimensionsX||o.linkDimensionsY?(o.linkDimensionsX&&(this.scale.x=this.object.document.width),o.linkDimensionsY&&(this.scale.y=this.object.document.height)):(this.scale.x=o.width?o.width/s.width:1,this.scale.y=o.height?o.height/s.height:1);this.scale.x=this.scale.x*o.scaleX,this.scale.y=this.scale.y*o.scaleY,o.linkMirror&&!o.parentID&&(this.scale.x=Math.abs(this.scale.x)*(this.object.document.texture.scaleX<0?-1:1),this.scale.y=Math.abs(this.scale.y)*(this.object.document.texture.scaleY<0?-1:1)),this.anchor&&(o.anchor?this.anchor.set(o.anchor.x,o.anchor.y):this.anchor.set(.5,.5));let l=0,c=0;r?(r.position.x=-this.anchor.x*r.width,r.position.y=-this.anchor.y*r.height,o.animation.relative&&(this.pivot.set(0,0),r.pivot.set((.5-this.anchor.x)*r.width,(.5-this.anchor.y)*r.height),l=r.pivot.x*this.scale.x,c=r.pivot.y*this.scale.y)):o.animation.relative&&(l=(.5-this.anchor.x)*this.width,c=(.5-this.anchor.y)*this.height,this.pivot.set((.5-this.anchor.x)*this.texture.width,(.5-this.anchor.y)*this.texture.height));const p=o.pOffsetX||0,f=o.pOffsetY||0;if(o.parentID){const e=this.parent.anchor??{x:0,y:0},t=(this.parent.shapesWidth??this.parent.width)/this.parent.scale.x,i=(this.parent.shapesHeight??this.parent.height)/this.parent.scale.y;this.position.set(p+-o.offsetX*t-e.x*t+t/2,f+-o.offsetY*i-e.y*i+i/2)}else o.animation.relative?this.position.set(this.object.document.x+this.object.w/2+p+-o.offsetX*this.object.w+l,this.object.document.y+this.object.h/2+f+-o.offsetY*this.object.h+c):(this.position.set(this.object.document.x+this.object.w/2,this.object.document.y+this.object.h/2),this.pivot.set(-p/this.scale.x+o.offsetX*this.object.w/this.scale.x,-f/this.scale.y+o.offsetY*this.object.h/this.scale.y));this.tvaVideoEnded||(this.alpha=o.linkOpacity?this.object.document.alpha:o.alpha),i?o.linkRotation?this.angle=this.object.document.rotation+o.angle:this.angle=o.angle:o.animation.rotate||o.linkRotation&&(this.angle=this.object.document.rotation+o.angle);const u=o.inheritTint?this.object.document.texture.tint:(0,_token_overlay_js__WEBPACK_IMPORTED_MODULE_4__.De)(o.tint,o.interpolateColor,!0);this.tint=u?Color.from(u):16777215,r&&(r.tint=this.tint,r.alpha=this.alpha),i&&(o.animation.rotate?this.animate(o):this.stopAnimation()),!i||!n&&this.filtersApplied||this._applyFilters(o),t&&this.children&&this.children.forEach((e=>{e instanceof TVAOverlay&&e.refresh(null,{preview:!0})})),this.htmlOverlay&&this.htmlOverlay.setPosition({left:this.x-this.pivot.x*this.scale.x-this.width*this.anchor.x,top:this.y-this.pivot.y*this.scale.y-this.height*this.anchor.y,width:this.width,height:this.height,angle:this.angle}),this.ready=!0}_activateTicker(){this._deactivateTicker(),canvas.app.ticker.add(this.updatePosition,this,PIXI.UPDATE_PRIORITY.HIGH)}_deactivateTicker(){canvas.app.ticker.remove(this.updatePosition,this)}updatePosition(){let e=canvas.canvasCoordinatesFromClient({x:window.innerWidth/2+this.overlayConfig.offsetX*window.innerWidth,y:window.innerHeight/2+this.overlayConfig.offsetY*window.innerHeight});this.position.set(e.x,e.y)}async _applyFilters(e){this.filtersApplied=!0;const t=e.filter,i=PIXI.filters[t],a=foundry.utils.mergeObject(_applications_overlayConfig_js__WEBPACK_IMPORTED_MODULE_0__.S[t]?.defaultValues||{},e.filterOptions);let n;if(i)if("args"===_applications_overlayConfig_js__WEBPACK_IMPORTED_MODULE_0__.S[t]?.argType){let e=[];const o=_applications_overlayConfig_js__WEBPACK_IMPORTED_MODULE_0__.S[t]?.controls;o&&o.forEach((t=>e.push(a[t.name]))),n=new i(...e)}else n="options"===_applications_overlayConfig_js__WEBPACK_IMPORTED_MODULE_0__.S[t]?.argType?new i(a):new i;else if("OutlineOverlayFilter"===t)n=OutlineFilter.create(a),n.thickness=a.trueThickness??1,n.animated=a.animate??!1;else if("Token Magic FX"===t)return void this.applyTVAFilters(await constructTMFXFilters(a.params||[],this));n?(this.applyTVAFilters([n]),this.filters=[n]):this.removeTVAFilters()}applyTVAFilters(e){e?.length&&(this.removeTVAFilters(),this.filters=(this.filters||[]).concat(e))}removeTVAFilters(){this.filters&&(this.filters=this.filters.filter((e=>!e.tvaFilter)))}async stopAnimation(){this.animationName&&CanvasAnimation.terminateAnimation(this.animationName)}async animate(e){this.animationName||(this.animationName=this.object.sourceId+"."+foundry.utils.randomID(5));const t=[{parent:this,attribute:"angle",to:this.angle+(e.animation.clockwise?360:-360)}];await CanvasAnimation.animate(t,{duration:e.animation.duration,name:this.animationName})&&this.animate(e)}_registerHooks(e){e.linkStageScale?(0,_hooks_overlayHooks_js__WEBPACK_IMPORTED_MODULE_2__.Mr)(this,"canvasPan"):(0,_hooks_overlayHooks_js__WEBPACK_IMPORTED_MODULE_2__.eC)(this,"canvasPan")}_swapChildren(e){const t=this.pseudoTexture;if(t.shapes){this.removeChild(this.pseudoTexture.shapes);const i=t.shapes.removeChildren();e?.shapes?i.forEach((t=>e.shapes.addChild(t)?.refresh())):i.forEach((e=>this.addChild(e)?.refresh()))}else if(e?.shapes){this.removeChildren().forEach((t=>e.shapes.addChild(t)?.refresh()))}}_destroyTexture(){(this.texture.textLabel||this.texture.destroyable)&&this.texture.destroy(!0),this.pseudoTexture?.shapes?(this.removeChild(this.pseudoTexture.shapes),this.pseudoTexture.shapes.destroy()):this.pseudoTexture?.html&&this.removeHTMLOverlay()}destroy(){if(this.stopAnimation(),(0,_hooks_overlayHooks_js__WEBPACK_IMPORTED_MODULE_2__.eC)(this),this.children){for(const e of this.children)e instanceof TVAOverlay&&(e.tvaRemove=!0);(0,_token_overlay_js__WEBPACK_IMPORTED_MODULE_4__.Ev)(this.object),this.pseudoTexture.shapes&&(this.pseudoTexture.shapes.children.forEach((e=>e.destroy())),this.removeChild(this.pseudoTexture.shapes)?.destroy())}if(this.texture.textLabel||this.texture.destroyable)return super.destroy(!0);"VIDEO"===this.texture?.baseTexture.resource?.source?.tagName&&this.texture.baseTexture.destroy(),this.removeHTMLOverlay(),super.destroy()}calculateTrimmedVertices(){return PIXI.Sprite.prototype.calculateTrimmedVertices.call(this)}addHTMLOverlay(){this.htmlOverlay||(this.htmlOverlay=new _HTMLOverlay_js__WEBPACK_IMPORTED_MODULE_6__.E(this.overlayConfig,this.object))}removeHTMLOverlay(){this.htmlOverlay&&this.htmlOverlay.remove(),this.htmlOverlay=null}}async function constructTMFXFilters(paramsArray,sprite){if("undefined"==typeof TokenMagic||!("filterTypes"in TokenMagic))return[];try{paramsArray=eval(paramsArray)}catch(e){return[]}if(Array.isArray(paramsArray)||(paramsArray=TokenMagic.getPreset(paramsArray)),!(paramsArray instanceof Array&&paramsArray.length>0))return[];let filters=[];for(const e of paramsArray){if(!e.hasOwnProperty("filterType")||!TokenMagic.filterTypes.hasOwnProperty(e.filterType))return[];e.hasOwnProperty("rank")||(e.rank=5e3),e.hasOwnProperty("filterId")&&null!=e.filterId||(e.filterId=foundry.utils.randomID()),e.hasOwnProperty("enabled")&&"boolean"==typeof e.enabled||(e.enabled=!0),e.filterInternalId=foundry.utils.randomID();const t=game.users.filter((e=>e.isGM));e.filterOwner=t.length?t[0].id:game.data.userId,e.updateId=foundry.utils.randomID();const i=TokenMagic.filterTypes[e.filterType];if(i){class ModTMFX extends i{assignPlaceable(){this.targetPlaceable=sprite.object,this.placeableImg=sprite}async _TMFXsetAnimeFlag(){}}const t=new ModTMFX(e);t&&(t.placeableImg=sprite,t.targetPlaceable=sprite.object,t.tvaFilter=!0,filters.unshift(t))}}return filters}class OutlineFilter extends OutlineOverlayFilter{static createFragmentShader(){return`\n    varying vec2 vTextureCoord;\n    varying vec2 vFilterCoord;\n    uniform sampler2D uSampler;\n    \n    uniform vec2 thickness;\n    uniform vec4 outlineColor;\n    uniform vec4 filterClamp;\n    uniform float alphaThreshold;\n    uniform float time;\n    uniform bool knockout;\n    uniform bool wave;\n    \n    ${this.CONSTANTS}\n    ${this.WAVE()}\n    \n    void main(void) {\n        float dist = distance(vFilterCoord, vec2(0.5)) * 2.0;\n        vec4 ownColor = texture2D(uSampler, vTextureCoord);\n        vec4 wColor = wave ? outlineColor * \n                             wcos(0.0, 1.0, dist * 75.0, \n                                  -time * 0.01 + 3.0 * dot(vec4(1.0), ownColor)) \n                             * 0.33 * (1.0 - dist) : vec4(0.0);\n        float texAlpha = smoothstep(alphaThreshold, 1.0, ownColor.a);\n        vec4 curColor;\n        float maxAlpha = 0.;\n        vec2 displaced;\n        for ( float angle = 0.0; angle <= TWOPI; angle += ${this.#e.toFixed(7)} ) {\n            displaced.x = vTextureCoord.x + thickness.x * cos(angle);\n            displaced.y = vTextureCoord.y + thickness.y * sin(angle);\n            curColor = texture2D(uSampler, clamp(displaced, filterClamp.xy, filterClamp.zw));\n            curColor.a = clamp((curColor.a - 0.6) * 2.5, 0.0, 1.0);\n            maxAlpha = max(maxAlpha, curColor.a);\n        }\n        float resultAlpha = max(maxAlpha, texAlpha);\n        vec3 result = (ownColor.rgb + outlineColor.rgb * (1.0 - texAlpha)) * resultAlpha;\n        gl_FragColor = vec4((ownColor.rgb + outlineColor.rgb * (1. - ownColor.a)) * resultAlpha, resultAlpha);\n    }\n    `}static get#e(){switch(canvas.performance.mode){case CONST.CANVAS_PERFORMANCE_MODES.LOW:return 2*Math.PI/10;case CONST.CANVAS_PERFORMANCE_MODES.MED:return 2*Math.PI/20;default:return 2*Math.PI/30}}}},179:(e,t,i)=>{i.d(t,{A:()=>UserList});var a=i(924),n=i(634),o=i(771);class UserList extends FormApplication{constructor(e,t,i){super({},{}),this.object=e,this.img=t,this.regenStyle=i}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-user-list",classes:["sheet"],template:"modules/token-variants/token-variants/templates/userList.html",resizable:!1,minimizable:!1,title:"User To Image",width:300})}async getData(e){const t=super.getData(e),i=this.object.document.getFlag("token-variants","userMappings")||{};let n=[];return game.users.forEach((e=>{n.push({avatar:e.avatar,name:e.name,apply:e.id in i&&i[e.id]===this.img,userId:e.id,color:e.color})})),t.users=n,t.invisibleImage=a.Ll.invisibleImage,t}activateListeners(e){super.activateListeners(e),(0,o.$L)(e,"invisibleImage",{search:"Invisible Image",searchType:n.Cp.TOKEN})}async _updateObject(e,t){const i=this.object.document.getFlag("token-variants","userMappings")||{};t.invisibleImage!==a.Ll.invisibleImage&&(0,a.Xx)({invisibleImage:(0,n.b3)(t.invisibleImage)}),delete t.invisibleImage;const o=[this.img];for(const[e,a]of Object.entries(t))a?(i[e]&&i[e]!==this.img&&o.push(i[e]),i[e]=this.img):i[e]===this.img&&(delete i[e],i["-="+e]=null);0===Object.keys(i).filter((e=>!e.startsWith("-="))).length?await this.object.document.unsetFlag("token-variants","userMappings"):await this.object.document.setFlag("token-variants","userMappings",i);for(const e of o)this.regenStyle(this.object,e)}}},207:(e,t,i)=>{i.d(t,{A:()=>FlagsConfig});class FlagsConfig extends FormApplication{constructor(e){super({},{}),e instanceof Tile?(this.objectToFlag=e.document,this.isTile=!0):this.objectToFlag=game.actors.get(e.document.actorId)||e.document}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-token-flags",classes:["sheet"],template:"modules/token-variants/token-variants/templates/flagsConfig.html",resizable:!0,minimizable:!1,title:"Flags",width:500})}async getData(e){const t=super.getData(e),i=this.objectToFlag.getFlag("token-variants","popups"),a=this.objectToFlag.getFlag("token-variants","disableNameSearch"),n=this.objectToFlag.getFlag("token-variants","directory")||{};return foundry.utils.mergeObject(t,{popups:i,popupsSetFlag:null!=i,disableNameSearch:a,disableNameSearchSetFlag:null!=a,directory:n.path,directorySource:n.source,directorySetFlag:!foundry.utils.isEmpty(n),tile:this.isTile})}activateListeners(e){super.activateListeners(e),e.find(".controlFlag").click((e=>{e.target.siblings(".flag").prop("disabled",!e.target.checked)})),e.find(".directory-fp").click((t=>{new FilePicker({type:"folder",activeSource:"data",callback:(i,a)=>{e.find('[name="directory"]').val(a.result.target),t.target.closest("button").attr("title","Directory: "+a.result.target);const n=e.find('[name="directorySource"]');"s3"===a.activeSource?n.val(`s3:${a.result.bucket}`):n.val(a.activeSource)}}).render(!0)}))}async _updateObject(e,t){"directory"in t&&(t.directory={path:t.directory,source:t.directorySource}),["popups","disableNameSearch","directory"].forEach((e=>{e in t?this.objectToFlag.setFlag("token-variants",e,t[e]):this.objectToFlag.unsetFlag("token-variants",e)}))}}},262:(e,t,i)=>{i.d(t,{g:()=>a});const a=[{name:"Tint Red when HP is below 10%",hint:"Tint token red when HP falls below 10%",img:"https://user-images.githubusercontent.com/7693704/243428871-c52130b3-2f12-4de7-a86e-fabc67e865a9.png",group:"Health",mappings:[{id:"MmLSOlJx",label:"Tint Red",expression:"hp<=10%",imgName:"",imgSrc:"",priority:50,config:{texture:{tint:"#ff0000"}},overlay:!1,alwaysOn:!1,disabled:!1,overlayConfig:{label:"Tint Red"},group:"Low HP",i:0}],id:"Ob9LP35K"},{name:"Health State Text Overlay",hint:"Displays text overlay based on percentage health. \n0% < hp <= 25% : Critical\n25% < hp <= 50% : Bloodied\n50% < hp <= 75% : Wounded\n75% < hp : Healthy",img:"https://user-images.githubusercontent.com/7693704/243426356-ceab629c-c16c-42b3-9004-af7dafb62eb7.png",group:"Health",mappings:[{id:"jqaFdwkQ",label:"Bloodied",expression:"hp>25% && hp<=50%",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{parent:"",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionX:!1,linkDimensionY:!1,linkOpacity:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:.51,scaleX:.76,scaleY:.76,angle:0,anchor:{x:.5,y:1},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Bloodied",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#ff5900",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:null}},label:"Bloodied",id:"jqaFdwkQ"},group:"Health State Overlay",i:0},{id:"m4GQVz5O",label:"Critical",expression:"hp>0 && hp<=25%",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{parent:"",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionX:!1,linkDimensionY:!1,linkOpacity:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:.51,scaleX:.76,scaleY:.76,angle:0,anchor:{x:.5,y:1},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Critical",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#ff0000",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:null}},label:"Critical",id:"m4GQVz5O"},group:"Health State Overlay",i:1},{id:"H1wrS5N1",label:"Healthy",expression:"hp>75%",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{parent:"",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionX:!1,linkDimensionY:!1,linkOpacity:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:.51,scaleX:.76,scaleY:.76,angle:0,anchor:{x:.5,y:1},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Healthy",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#2bff00",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:null}},label:"Healthy",id:"H1wrS5N1"},group:"Health State Overlay",i:2},{id:"IojJZS7v",label:"Wounded",expression:"hp>50% && hp<=75%",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{parent:"",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionX:!1,linkDimensionY:!1,linkOpacity:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:.51,scaleX:.76,scaleY:.76,angle:0,anchor:{x:.5,y:1},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Wounded",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#ffbb00",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:null}},label:"Wounded",id:"IojJZS7v"},group:"Health State Overlay",i:3}],id:"JNClkgGU"},{name:"Health State Text Overlay - Passed Check",hint:"Same as Health State Text Overlay except also requiring the Token actor to have Reveal Health active effect applied to it.",img:"https://user-images.githubusercontent.com/7693704/243429385-f62b111c-3d9c-4cd8-9c27-f5b13e09fea2.png",group:"Health",mappings:[{id:"k0XbFE7a",label:"Bloodied",expression:"Reveal Health && hp>25% && hp<=50%",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{parent:"",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionX:!1,linkDimensionY:!1,linkOpacity:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:.51,scaleX:.76,scaleY:.76,angle:0,anchor:{x:.5,y:1},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Bloodied",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#ff5900",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:null}},label:"Bloodied",id:"k0XbFE7a"},group:"Health State Overlay - Passed Check",i:0},{id:"a1VxhnWK",label:"Critical",expression:"Reveal Health && hp>0 && hp<=25%",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{parent:"",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionX:!1,linkDimensionY:!1,linkOpacity:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:.51,scaleX:.76,scaleY:.76,angle:0,anchor:{x:.5,y:1},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Critical",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#ff0000",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:null}},label:"Critical",id:"a1VxhnWK"},group:"Health State Overlay - Passed Check",i:1},{id:"DNuBTXe8",label:"Healthy",expression:"Reveal Health && hp>75%",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{parent:"",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionX:!1,linkDimensionY:!1,linkOpacity:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:.51,scaleX:.76,scaleY:.76,angle:0,anchor:{x:.5,y:1},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Healthy",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#2bff00",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:null}},label:"Healthy",id:"DNuBTXe8"},group:"Health State Overlay - Passed Check",i:2},{id:"ROPjrvLu",label:"Wounded",expression:"Reveal Health && hp>50% && hp<=75%",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{parent:"",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionX:!1,linkDimensionY:!1,linkOpacity:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:.51,scaleX:.76,scaleY:.76,angle:0,anchor:{x:.5,y:1},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Wounded",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#ffbb00",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:null}},label:"Wounded",id:"ROPjrvLu"},group:"Health State Overlay - Passed Check",i:3}],id:"0ZJQiOdD"},{name:"Fancy Nameplate",hint:"Displays a curved red nameplate underneath the token.",img:"https://user-images.githubusercontent.com/7693704/244439674-12510686-2f72-44b3-8a1d-e6cc7fbb00c6.png",mappings:[{id:"DTbwvQiG",label:"Token Nameplate",expression:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{parent:"",underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionX:!1,linkDimensionY:!1,linkOpacity:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:-.51,scaleX:.68,scaleY:.68,angle:0,anchor:{x:.5,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"{{name}}",fontFamily:"Modesto Condensed",fontSize:36,letterSpacing:0,fill:"#ff0000",dropShadow:"true",strokeThickness:3,stroke:"#111111",curve:{radius:450,invert:!0}},shapes:[{line:{width:1,color:"#111111",alpha:1},fill:{color:"#111111",alpha:1}}],label:"Token Nameplate"},group:"Nameplate",i:0}],id:"Ik1uNcWU"},{name:"Info Box #1",hint:"Displays information about the token/actor when hovering over or controlling them. This box will adjust to canvas zoom.",img:"https://user-images.githubusercontent.com/7693704/244441852-b50f3ca6-e0c3-4ce0-b498-ddd00edcbdca.png",system:"dnd5e",group:"Info",mappings:[{id:"W8BPK9hv",label:"Box Background",expression:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"W8BPK9hv",parentID:"",ui:!0,underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!0,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.55,offsetY:0,scaleX:.73,scaleY:.73,angle:0,anchor:{x:0,y:.5},filter:"DropShadowFilter",filterOptions:{rotation:45,distance:16.9,color:"#000000",alpha:.52,shadowOnly:!1,blur:2,quality:3},alwaysVisible:!1,limitedUsers:[],limitOnHover:!0,limitOnHighlight:!1,limitOnControl:!0,limitOnEffect:"",limitOnProperty:"",text:{text:"",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},shapes:[{shape:{type:"rectangle",x:"0",y:"0",width:"450",height:"200",radius:"0"},label:"",line:{width:2,color:"#ffffff",alpha:1},fill:{color:"#508fe2",color2:"",prc:"",alpha:.55}}],effect:"",label:"Box Background"},group:"Info Box",i:0},{id:"bkoP4Qpo",label:"Legendary Actions",expression:"actor.system.resources.legact.max>0",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{id:"bkoP4Qpo",parentID:"W8BPK9hv",underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.47,offsetY:-.02,scaleX:.5,scaleY:.5,angle:0,anchor:{x:0,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Legendary: Action {{actor.system.resources.legact.value}}/{{actor.system.resources.legact.max}} Resistance {{actor.system.resources.legres.value}}/{{actor.system.resources.legres.max}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Legendary Actions"},group:"Info Box",i:1},{id:"OvcWUW13",label:"Mods",expression:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"OvcWUW13",parentID:"W8BPK9hv",underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:-.38,scaleX:.57,scaleY:.57,angle:0,anchor:{x:.5,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"STR {{actor.system.abilities.str.mod}}  DEX {{actor.system.abilities.dex.mod}}  CON {{actor.system.abilities.con.mod}}  INT {{actor.system.abilities.int.mod}}  WIS {{actor.system.abilities.wis.mod}}  CHA {{actor.system.abilities.cha.mod}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Mods"},group:"Info Box",i:2},{id:"jybTYLTB",label:"Token Name",expression:"",imgName:"",imgSrc:"",priority:51,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"jybTYLTB",parentID:"W8BPK9hv",underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.47,offsetY:.35,scaleX:.77,scaleY:.77,angle:0,anchor:{x:0,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Name: {{name}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Token Name"},group:"Info Box",i:3},{id:"bGbHPbw6",label:"HP",expression:"hp>40%",imgName:"",imgSrc:"",priority:52,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{id:"bGbHPbw6",parentID:"W8BPK9hv",underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.47,offsetY:.23,scaleX:.82,scaleY:.82,angle:0,anchor:{x:0,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"HP: {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#6b6b6b",curve:{radius:0,invert:!1}},effect:"",label:"HP"},group:"Info Box",i:4},{id:"S9gXdyGY",label:"Low HP",expression:"hp<=40%",imgName:"",imgSrc:"",priority:52,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{id:"S9gXdyGY",parentID:"W8BPK9hv",underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.47,offsetY:.23,scaleX:.82,scaleY:.82,angle:0,anchor:{x:0,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"HP: {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#ff0000",dropShadow:"true",strokeThickness:1,stroke:"#6b6b6b",curve:{radius:0,invert:!1}},effect:"",label:"Low HP"},group:"Info Box",i:5},{id:"k9Ws74Hc",label:"Actor AC",expression:"",imgName:"",imgSrc:"",priority:53,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"k9Ws74Hc",parentID:"W8BPK9hv",underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.25,offsetY:.46,scaleX:1,scaleY:1,angle:0,anchor:{x:0,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"AC: {{actor.system.attributes.ac.value}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Actor AC"},group:"Info Box",i:6},{id:"eIxjLZmy",label:"Movement Label",expression:"",imgName:"",imgSrc:"",priority:54,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"eIxjLZmy",parentID:"W8BPK9hv",underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.25,offsetY:.2,scaleX:.61,scaleY:.61,angle:0,anchor:{x:0,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Movement",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Movement Label"},group:"Info Box",i:7},{id:"k5xYpZAZ",label:"Movement Walk",expression:"",imgName:"",imgSrc:"",priority:55,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"k5xYpZAZ",parentID:"W8BPK9hv",underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.36,offsetY:-.03,scaleX:1,scaleY:1,angle:0,anchor:{x:.5,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"{{actor.system.attributes.movement.walk}}ft",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Movement Walk"},group:"Info Box",i:8},{id:"dHHZRQXG",label:"Movement Fly",expression:"",imgName:"",imgSrc:"",priority:56,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"dHHZRQXG",parentID:"W8BPK9hv",underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.36,offsetY:-.16,scaleX:.33,scaleY:.33,angle:0,anchor:{x:.5,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Fly {{actor.system.attributes.movement.fly}}, Swim {{actor.system.attributes.movement.swim}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Movement Fly"},group:"Info Box",i:9}],id:"wuMcLy3T"},{name:"Info Box #2",hint:"Displays information about the token/actor when hovering over or controlling them. This box will adjust to canvas zoom.",img:"https://user-images.githubusercontent.com/7693704/244750685-81988600-5153-4d29-acb0-2c62111bed14.png",system:"dnd5e",mappings:[{id:"f0pV6Pnl",label:"Box Background",expression:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"f0pV6Pnl",parentID:"",ui:!0,underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!0,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.55,offsetY:0,scaleX:1,scaleY:1,angle:0,anchor:{x:0,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!0,limitOnHighlight:!1,limitOnControl:!0,limitOnEffect:"",limitOnProperty:"",text:{text:"",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},shapes:[{shape:{type:"rectangle",x:"0",y:"0",width:"200",height:"300",radius:"0"},label:"",line:{width:2,color:"#ffffff",alpha:1},fill:{color:"#2e5a94",color2:"",prc:"",alpha:.9}}],effect:"",label:"Box Background"},group:"Info Box #2",i:0},{id:"n2Adi1fi",label:"HP",expression:"",imgName:"",imgSrc:"",priority:51,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"n2Adi1fi",parentID:"f0pV6Pnl",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.45,offsetY:.42,scaleX:.84,scaleY:.84,angle:0,anchor:{x:0,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"HP: {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"HP"},group:"Info Box #2",i:1},{id:"hCKVzw3Z",label:" AC",expression:"",imgName:"",imgSrc:"",priority:52,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"hCKVzw3Z",parentID:"f0pV6Pnl",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.45,offsetY:.31,scaleX:.84,scaleY:.84,angle:0,anchor:{x:0,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"AC: {{actor.system.attributes.ac.value}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:" AC"},group:"Info Box #2",i:2},{id:"2nYmUTwu",label:" Speed",expression:"",imgName:"",imgSrc:"",priority:53,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"2nYmUTwu",parentID:"f0pV6Pnl",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.45,offsetY:.2,scaleX:.84,scaleY:.84,angle:0,anchor:{x:0,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Speed: {{actor.system.attributes.movement.walk}}ft",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:" Speed"},group:"Info Box #2",i:3},{id:"s1NtDiUV",label:"Perception",expression:"",imgName:"",imgSrc:"",priority:54,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"s1NtDiUV",parentID:"f0pV6Pnl",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:.15,scaleX:.84,scaleY:.84,angle:0,anchor:{x:.5,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Perception",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Perception"},group:"Info Box #2",i:4},{id:"jYeRIoG2",label:"Passive Perception",expression:"",imgName:"",imgSrc:"",priority:55,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"jYeRIoG2",parentID:"f0pV6Pnl",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.47,offsetY:0,scaleX:.51,scaleY:.51,angle:0,anchor:{x:0,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Passive: {{actor.system.skills.prc.passive}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Passive Perception"},group:"Info Box #2",i:5},{id:"KYMdkTVI",label:"Active Perception",expression:"",imgName:"",imgSrc:"",priority:56,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"KYMdkTVI",parentID:"f0pV6Pnl",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.48,offsetY:0,scaleX:.51,scaleY:.51,angle:0,anchor:{x:1,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Active: {{actor.system.skills.prc.total}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Active Perception"},group:"Info Box #2",i:6},{id:"Ewbg54II",label:"CHA",expression:"",imgName:"",imgSrc:"",priority:57,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"Ewbg54II",parentID:"f0pV6Pnl",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.31,offsetY:-.3,scaleX:.51,scaleY:.51,angle:0,anchor:{x:.5,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"CHA\\n{{actor.system.abilities.cha.mod}} {{actor.system.abilities.cha.save}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"CHA"},group:"Info Box #2",i:7},{id:"2le1Nagp",label:"CON",expression:"",imgName:"",imgSrc:"",priority:57,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"2le1Nagp",parentID:"f0pV6Pnl",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.31,offsetY:-.11,scaleX:.51,scaleY:.51,angle:0,anchor:{x:.5,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"CON\\n{{actor.system.abilities.con.mod}} {{actor.system.abilities.con.save}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"CON"},group:"Info Box #2",i:8},{id:"ahKmjzLj",label:"DEX",expression:"",imgName:"",imgSrc:"",priority:57,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"ahKmjzLj",parentID:"f0pV6Pnl",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:-.11,scaleX:.51,scaleY:.51,angle:0,anchor:{x:.5,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"DEX\\n{{actor.system.abilities.dex.mod}} {{actor.system.abilities.dex.save}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"DEX"},group:"Info Box #2",i:9},{id:"gQzyq0zm",label:"INT",expression:"",imgName:"",imgSrc:"",priority:57,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"gQzyq0zm",parentID:"f0pV6Pnl",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.32,offsetY:-.3,scaleX:.51,scaleY:.51,angle:0,anchor:{x:.5,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"INT\\n{{actor.system.abilities.int.mod}} {{actor.system.abilities.int.save}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"INT"},group:"Info Box #2",i:10},{id:"hYGg1oAt",label:"STR",expression:"",imgName:"",imgSrc:"",priority:57,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"hYGg1oAt",parentID:"f0pV6Pnl",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.32,offsetY:-.11,scaleX:.51,scaleY:.51,angle:0,anchor:{x:.5,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"STR\\n{{actor.system.abilities.str.mod}} {{actor.system.abilities.str.save}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"STR"},group:"Info Box #2",i:11},{id:"uQ5zS3K6",label:"WIS",expression:"",imgName:"",imgSrc:"",priority:57,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"uQ5zS3K6",parentID:"f0pV6Pnl",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:-.3,scaleX:.51,scaleY:.51,angle:0,anchor:{x:.5,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"WIS\\n{{actor.system.abilities.wis.mod}} {{actor.system.abilities.wis.save}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"WIS"},group:"Info Box #2",i:12}],id:"Wtq9HDsX"},{name:"Info Box #3",hint:"Displays information about the token/actor when hovering over or controlling them. This box will adjust to canvas zoom.",img:"https://user-images.githubusercontent.com/7693704/244750246-794625b9-9e1d-4322-9265-fc295f02ca2b.png",system:"dnd5e",mappings:[{id:"Gt11vjXV",label:"Box Background",expression:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"Gt11vjXV",parentID:"",ui:!0,underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!0,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.55,offsetY:0,scaleX:1,scaleY:1,angle:0,anchor:{x:0,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!0,limitOnHighlight:!1,limitOnControl:!0,limitOnEffect:"",limitOnProperty:"",text:{text:"",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},shapes:[{shape:{type:"rectangle",x:"0",y:"0",width:"240",height:"300",radius:"0"},label:"",line:{width:2,color:"#ffffff",alpha:1},fill:{color:"#2e5a94",color2:"",prc:"",alpha:.9}}],effect:"",label:"Box Background"},group:"Info Box #3",i:0},{id:"o4XWzdDM",label:"HP",expression:"",imgName:"",imgSrc:"",priority:51,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"o4XWzdDM",parentID:"Gt11vjXV",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.44,offsetY:.42,scaleX:.84,scaleY:.84,angle:0,anchor:{x:0,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:" {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"HP"},group:"Info Box #3",i:1},{id:"eAv2dSV6",label:"AC",expression:"",imgName:"",imgSrc:"",priority:52,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"eAv2dSV6",parentID:"Gt11vjXV",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.43,offsetY:.28,scaleX:.84,scaleY:.84,angle:0,anchor:{x:0,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:" {{actor.system.attributes.ac.value}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"AC"},group:"Info Box #3",i:2},{id:"SCfkWTni",label:"Fly Speed",expression:"",imgName:"",imgSrc:"",priority:53,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"SCfkWTni",parentID:"Gt11vjXV",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.04,offsetY:.13,scaleX:.84,scaleY:.84,angle:0,anchor:{x:0,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:" {{actor.system.attributes.movement.fly}}ft",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Fly Speed"},group:"Info Box #3",i:3},{id:"e5LPzVta",label:"Walk Speed",expression:"",imgName:"",imgSrc:"",priority:53,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"e5LPzVta",parentID:"Gt11vjXV",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.45,offsetY:.13,scaleX:.84,scaleY:.84,angle:0,anchor:{x:0,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:" {{actor.system.attributes.movement.walk}}ft",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Walk Speed"},group:"Info Box #3",i:4},{id:"XlopagaT",label:"Passive Perception",expression:"",imgName:"",imgSrc:"",priority:55,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"XlopagaT",parentID:"Gt11vjXV",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.45,offsetY:-.02,scaleX:.83,scaleY:.83,angle:0,anchor:{x:0,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:" {{actor.system.skills.prc.passive}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Passive Perception"},group:"Info Box #3",i:5},{id:"CeXgVxA0",label:"Active Perception",expression:"",imgName:"",imgSrc:"",priority:56,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"CeXgVxA0",parentID:"Gt11vjXV",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.03,offsetY:-.02,scaleX:.83,scaleY:.83,angle:0,anchor:{x:0,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:" {{actor.system.skills.prc.total}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Active Perception"},group:"Info Box #3",i:6},{id:"0WWf1iGM",label:"CHA",expression:"",imgName:"",imgSrc:"",priority:57,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"0WWf1iGM",parentID:"Gt11vjXV",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.31,offsetY:-.3,scaleX:.51,scaleY:.51,angle:0,anchor:{x:.5,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"CHA\\n{{actor.system.abilities.cha.mod}}  {{actor.system.abilities.cha.save}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"CHA"},group:"Info Box #3",i:7},{id:"AU8tTXat",label:"CON",expression:"",imgName:"",imgSrc:"",priority:57,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"AU8tTXat",parentID:"Gt11vjXV",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.31,offsetY:-.11,scaleX:.51,scaleY:.51,angle:0,anchor:{x:.5,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"CON\\n{{actor.system.abilities.con.mod}}  {{actor.system.abilities.con.save}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"CON"},group:"Info Box #3",i:8},{id:"JZKNmgvY",label:"DEX",expression:"",imgName:"",imgSrc:"",priority:57,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"JZKNmgvY",parentID:"Gt11vjXV",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:-.11,scaleX:.51,scaleY:.51,angle:0,anchor:{x:.5,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"DEX\\n{{actor.system.abilities.dex.mod}}  {{actor.system.abilities.dex.save}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"DEX"},group:"Info Box #3",i:9},{id:"AUGurJtx",label:"INT",expression:"",imgName:"",imgSrc:"",priority:57,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"AUGurJtx",parentID:"Gt11vjXV",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.32,offsetY:-.3,scaleX:.51,scaleY:.51,angle:0,anchor:{x:.5,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"INT\\n{{actor.system.abilities.int.mod}}  {{actor.system.abilities.int.save}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"INT"},group:"Info Box #3",i:10},{id:"z0PMTFxo",label:"STR",expression:"",imgName:"",imgSrc:"",priority:57,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"z0PMTFxo",parentID:"Gt11vjXV",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:.32,offsetY:-.11,scaleX:.51,scaleY:.51,angle:0,anchor:{x:.5,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"STR\\n{{actor.system.abilities.str.mod}}  {{actor.system.abilities.str.save}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"STR"},group:"Info Box #3",i:11},{id:"YXUiGPBv",label:"WIS",expression:"",imgName:"",imgSrc:"",priority:57,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"YXUiGPBv",parentID:"Gt11vjXV",underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!0,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:-.3,scaleX:.51,scaleY:.51,angle:0,anchor:{x:.5,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"WIS\\n{{actor.system.abilities.wis.mod}}  {{actor.system.abilities.wis.save}}",fontFamily:"Signika",fontSize:36,letterSpacing:0,fill:"#FFFFFF",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"WIS"},group:"Info Box #3",i:12}],id:"vQJ3coCJ"},{name:"Facing Direction",hint:"Displays an arrow in the top-right corner of the token showing the direction it is facing.",img:"https://user-images.githubusercontent.com/7693704/244647284-2213caf5-6d49-4413-ab5f-83901ffbc8e6.png",mappings:[{id:"9UEOkJ1J",label:"Arrow",expression:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"9UEOkJ1J",parentID:"",underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!0,animation:{relative:!0,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.5,offsetY:.5,scaleX:.51,scaleY:.51,angle:90,anchor:{x:.5,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"➢",fontFamily:"Signika",fontSize:63,letterSpacing:0,fill:"#ff0000",dropShadow:null,strokeThickness:3,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Arrow"},group:"Facing Direction",i:0}],id:"Z8CTgmOg"},{name:"Combat Markers",hint:"Displays rotating markers for tokens in combat.",img:"https://user-images.githubusercontent.com/7693704/257478593-81b9192d-1ffe-4f0b-8e5d-806218d7e25f.png",mappings:[{id:"9R3glzOK",label:"Your Turn is Next!",expression:"combat-turn-next",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{label:"Your Turn is Next!",parent:"",underlay:!0,bottom:!0,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!0,duration:3e4,clockwise:!0},linkMirror:!1,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!1,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:0,scaleX:1.6,scaleY:1.6,angle:0,anchor:{x:.5,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"Next Turn  =  = =  =  =  = Next turn =  =  =  =  = ",fontFamily:"Signika",fontSize:41,letterSpacing:0,fill:"#e6a800",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:125,invert:!1}},effect:""},group:"Combat",i:0},{id:"qoWG5AD0",label:"Your Turn!",expression:"combat-turn",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{label:"Your Turn!",parent:"",underlay:!0,bottom:!0,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!0,duration:3e4,clockwise:!0},linkMirror:!1,linkScale:!0,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!1,playOnce:!1,img:"",alpha:1,tint:"",offsetX:0,offsetY:0,scaleX:1.6,scaleY:1.6,angle:0,anchor:{x:.5,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"= Your Turn  =  = =  =  =  = Your turn =  =  =  =  =  ",fontFamily:"Signika",fontSize:41,letterSpacing:0,fill:"#00ace6",dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:125,invert:!1}},effect:""},group:"Combat",i:1}],id:"YpoX5zxO"},{name:"Disposition Markers",hint:"Displays circles underneath tokens coloured based on their disposition.",img:"https://user-images.githubusercontent.com/7693704/246497702-5de47dc9-21ef-43a1-86db-b3f85eb8ddb1.png",mappings:[{id:"TzP6MBC1",label:"Friendly",expression:"disposition=1",codeExp:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{id:"TzP6MBC1",parentID:"",underlay:!0,bottom:!0,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:"5000",clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",imgLinked:!1,repeating:!1,alpha:"1",tint:"#1acb2f",interpolateColor:{color2:"",prc:""},width:"",height:"",scaleX:"0.24",scaleY:"0.24",angle:"0",pOffsetX:"",pOffsetY:"",offsetX:"0",offsetY:"0",anchor:{x:.5,y:.5},filter:"NONE",alwaysVisible:!1,limitedToOwner:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnHUD:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"",repeating:!1,fontFamily:"Signika",fill:"#FFFFFF",interpolateColor:{color2:"",prc:""},fontSize:"36",align:"center",letterSpacing:"0",dropShadow:"true",strokeThickness:"1",stroke:"#111111",wordWrap:!1,wordWrapWidth:"200",breakWords:!1,maxHeight:"0",curve:{angle:"0",radius:"0",invert:!1}},shapes:[{shape:{type:"ellipse",x:"0",y:"0",width:"{{object.w}} * @scale",height:"{{object.h}} * @scale"},label:"",line:{width:"0",color:"#000000",alpha:"1"},fill:{color:"#ffffff",alpha:"0.75",interpolateColor:{color2:"",prc:""}},repeating:!1},{shape:{type:"ellipse",x:"{{object.w}} * @inner",y:"{{object.w}} * @inner",width:"{{object.w}} * @scale - {{object.w}} * @inner",height:"{{object.h}} * @scale - {{object.h}} * @inner"},label:"",line:{width:"0",color:"#000000",alpha:"1"},fill:{color:"#b8b8b8",alpha:"0.7",interpolateColor:{color2:"",prc:""}},repeating:!1}],variables:[{name:"scale",value:"2.3"},{name:"inner",value:"0.3"}],effect:"",interactivity:[],label:"Friendly"},group:"Disposition Markers",i:2},{id:"oIsQWISB",label:"Hostile",expression:"disposition=-1",codeExp:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{id:"oIsQWISB",parentID:"",underlay:!0,bottom:!0,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:"5000",clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",imgLinked:!1,repeating:!1,alpha:"1",tint:"#eb0000",interpolateColor:{color2:"",prc:""},width:"",height:"",scaleX:"0.24",scaleY:"0.24",angle:"0",pOffsetX:"",pOffsetY:"",offsetX:"0",offsetY:"0",anchor:{x:.5,y:.5},filter:"NONE",alwaysVisible:!1,limitedToOwner:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnHUD:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"",repeating:!1,fontFamily:"Signika",fill:"#FFFFFF",interpolateColor:{color2:"",prc:""},fontSize:"36",align:"center",letterSpacing:"0",dropShadow:"true",strokeThickness:"1",stroke:"#111111",wordWrap:!1,wordWrapWidth:"200",breakWords:!1,maxHeight:"0",curve:{angle:"0",radius:"0",invert:!1}},shapes:[{shape:{type:"ellipse",x:"0",y:"0",width:"{{object.w}} * @scale",height:"{{object.h}} * @scale"},label:"",line:{width:"0",color:"#000000",alpha:"1"},fill:{color:"#ffffff",alpha:"0.75",interpolateColor:{color2:"",prc:""}},repeating:!1},{shape:{type:"ellipse",x:"{{object.w}} * @inner",y:"{{object.w}} * @inner",width:"{{object.w}} * @scale - {{object.w}} * @inner",height:"{{object.h}} * @scale - {{object.h}} * @inner"},label:"",line:{width:"0",color:"#000000",alpha:"1"},fill:{color:"#b8b8b8",alpha:"0.7",interpolateColor:{color2:"",prc:""}},repeating:!1}],variables:[{name:"scale",value:"2.3"},{name:"inner",value:"0.3"}],effect:"",interactivity:[],label:"Hostile"},group:"Disposition Markers",i:3},{id:"fYxJ9Bbc",label:"Neutral",expression:"disposition=0",codeExp:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{id:"fYxJ9Bbc",parentID:"",underlay:!0,bottom:!0,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:"5000",clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",imgLinked:!1,repeating:!1,alpha:"1",tint:"",interpolateColor:{color2:"",prc:""},width:"",height:"",scaleX:"0.24",scaleY:"0.24",angle:"0",pOffsetX:"",pOffsetY:"",offsetX:"0",offsetY:"0",anchor:{x:.5,y:.5},filter:"NONE",alwaysVisible:!1,limitedToOwner:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnHUD:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"",repeating:!1,fontFamily:"Signika",fill:"#FFFFFF",interpolateColor:{color2:"",prc:""},fontSize:"36",align:"center",letterSpacing:"0",dropShadow:"true",strokeThickness:"1",stroke:"#111111",wordWrap:!1,wordWrapWidth:"200",breakWords:!1,maxHeight:"0",curve:{angle:"0",radius:"0",invert:!1}},shapes:[{shape:{type:"ellipse",x:"0",y:"0",width:"{{object.w}} * @scale",height:"{{object.h}} * @scale"},label:"",line:{width:"0",color:"#000000",alpha:"1"},fill:{color:"#ffffff",alpha:"0.75",interpolateColor:{color2:"",prc:""}},repeating:!1},{shape:{type:"ellipse",x:"{{object.w}} * @inner",y:"{{object.w}} * @inner",width:"{{object.w}} * @scale - {{object.w}} * @inner",height:"{{object.h}} * @scale - {{object.h}} * @inner"},label:"",line:{width:"0",color:"#000000",alpha:"1"},fill:{color:"#b8b8b8",alpha:"0.7",interpolateColor:{color2:"",prc:""}},repeating:!1}],variables:[{name:"scale",value:"2.3"},{name:"inner",value:"0.3"}],effect:"",interactivity:[],label:"Neutral"},group:"Disposition Markers",i:4},{id:"PyEXXb5J",label:"Secret",expression:"disposition=-2",codeExp:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!1,disabled:!1,overlayConfig:{id:"PyEXXb5J",parentID:"",underlay:!0,bottom:!0,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:"5000",clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",imgLinked:!1,repeating:!1,alpha:"1",tint:"#ba24ff",interpolateColor:{color2:"",prc:""},width:"",height:"",scaleX:"0.24",scaleY:"0.24",angle:"0",pOffsetX:"",pOffsetY:"",offsetX:"0",offsetY:"0",anchor:{x:.5,y:.5},filter:"NONE",alwaysVisible:!1,limitedToOwner:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnHUD:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"",repeating:!1,fontFamily:"Signika",fill:"#FFFFFF",interpolateColor:{color2:"",prc:""},fontSize:"36",align:"center",letterSpacing:"0",dropShadow:"true",strokeThickness:"1",stroke:"#111111",wordWrap:!1,wordWrapWidth:"200",breakWords:!1,maxHeight:"0",curve:{angle:"0",radius:"0",invert:!1}},shapes:[{shape:{type:"ellipse",x:"0",y:"0",width:"{{object.w}} * @scale",height:"{{object.h}} * @scale"},label:"",line:{width:"0",color:"#000000",alpha:"1"},fill:{color:"#ffffff",alpha:"0.75",interpolateColor:{color2:"",prc:""}},repeating:!1},{shape:{type:"ellipse",x:"{{object.w}} * @inner",y:"{{object.w}} * @inner",width:"{{object.w}} * @scale - {{object.w}} * @inner",height:"{{object.h}} * @scale - {{object.h}} * @inner"},label:"",line:{width:"0",color:"#000000",alpha:"1"},fill:{color:"#b8b8b8",alpha:"0.7",interpolateColor:{color2:"",prc:""}},repeating:!1}],variables:[{name:"scale",value:"2.3"},{name:"inner",value:"0.3"}],effect:"",interactivity:[],label:"Secret"},group:"Disposition Markers",i:5}],id:"yjqfAagB"},{name:"Health Bar",hint:"A recreation of the standard health bar using Overlays.",img:"https://user-images.githubusercontent.com/7693704/257246890-d41894a0-7f40-4e91-a47a-bc10d6f198e6.png",group:"Health",mappings:[{id:"dgIBKbcU",label:"Health Bar",expression:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"dgIBKbcU",parentID:"",ui:!0,underlay:!0,bottom:!0,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",repeating:!1,alpha:1,tint:"",interpolateColor:{color2:"",prc:""},offsetX:0,offsetY:-.5,scaleX:1,scaleY:1,angle:0,anchor:{x:.5,y:1},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"",repeating:!1,fontFamily:"Signika",fill:"#FFFFFF",interpolateColor:{color2:"",prc:""},fontSize:36,align:"left",letterSpacing:0,dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},shapes:[{shape:{type:"rectangle",x:"0",y:"0",width:"{{object.w}}",height:"{{object.h}} * @height",radius:"3"},label:"",line:{width:1,color:"#000000",alpha:1},fill:{color:"#5c5c5c",alpha:.65,interpolateColor:{color2:"",prc:""}},repeating:!1},{shape:{type:"rectangle",x:"0",y:"0",width:"{{object.w}} * ( {{hp}} / {{hpMax}} )",height:"{{object.h}} * @height",radius:"3"},label:"",line:{width:1,color:"#000000",alpha:1},fill:{color:"#ff0000",alpha:1,interpolateColor:{color2:"#74da0e",prc:"{{hp}} / {{hpMax}}"}},repeating:!1}],variables:[{name:"height",value:"0.079"}],effect:"",label:"Health Bar"},group:"Health Bar",i:0}],id:"GDyvkEB4"},{name:"Health Ring",hint:"A ring shaped health bar.",img:"https://user-images.githubusercontent.com/7693704/257246432-a339394f-489a-4436-9d4b-427c285d4f27.png",group:"Health",mappings:[{id:"erOTHzIc",label:"Health Ring",expression:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"erOTHzIc",parentID:"",ui:!0,underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",repeating:!1,alpha:1,tint:"",interpolateColor:{color2:"",prc:""},offsetX:0,offsetY:0,scaleX:1.02,scaleY:1.02,angle:-90,anchor:{x:.5,y:.5},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"",repeating:!1,fontFamily:"Signika",fill:"#ffffff",interpolateColor:{color2:"",prc:""},fontSize:36,align:"left",letterSpacing:0,dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},shapes:[{shape:{type:"torus",x:"0",y:"0",innerRadius:"{{object.w}} / @ringScale * @innerRadius",outerRadius:"{{object.w}} / @ringScale * @outerRadius",startAngle:"0",endAngle:"360"},label:"Background",line:{width:0,color:"#000000",alpha:1},fill:{color:"#b0b0b0",alpha:.6,interpolateColor:{color2:"",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"{{object.w}} / @ringScale * @innerRadius",outerRadius:"{{object.w}} / @ringScale * @outerRadius",startAngle:"0",endAngle:"{{hp}} / {{hpMax}} * 360"},label:"Health Tracker",line:{width:0,color:"#000000",alpha:1},fill:{color:"#ff0000",alpha:1,interpolateColor:{color2:"#74da0e",prc:"{{hp}} / {{hpMax}}"}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"{{object.w}} / @ringScale * @innerRadius",outerRadius:"{{object.w}} / @ringScale * @outerRadius",startAngle:"0",endAngle:"360"},label:"Outline",line:{width:1,color:"#000000",alpha:1},fill:{color:"#b0b0b0",alpha:0,interpolateColor:{color2:"",prc:""}},repeating:!1}],variables:[{name:"ringScale",value:"1.8"},{name:"innerRadius",value:"0.9"},{name:"outerRadius",value:"1.0"}],effect:"",label:"Health Ring"},group:"Health Ring",i:0}],id:"yITi94hC"},{name:"Health Hearts",hint:"Displays up to 10 hearts to the right of the token based on their current health. Each heart is representative of 10% of the health.",img:"https://user-images.githubusercontent.com/7693704/257349483-1864d4ca-a2de-468d-872d-6d8c2847434a.png",group:"Health",mappings:[{id:"4uCpbtHY",label:"Hearts",expression:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"4uCpbtHY",parentID:"",ui:!0,underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!0,linkDimensionsY:!0,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",alpha:1,tint:"",offsetX:-.53,offsetY:.5,scaleX:.5,scaleY:.5,angle:0,anchor:{x:0,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:" ",repeating:!0,repeat:{value:"{{hp}}",increment:"10",isPercentage:!0,maxValue:"{{hpMax}}",perRow:"2",maxRows:""},fontFamily:"Signika",fill:"#ff0000",fontSize:36,align:"left",letterSpacing:0,dropShadow:null,strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},effect:"",label:"Hearts"},group:"Health Hearts",i:0}],id:"T2DrD0Em"},{name:"Health Circles",hint:"Displays up to 10 circles to the right of the token based on their current health. Each circle is representative of 10% of the health.",img:"https://user-images.githubusercontent.com/7693704/257476414-c42bdbc0-c57b-4367-8207-3e2e4273094f.png",group:"Health",mappings:[{id:"0vETg18v",label:"Health Circles",expression:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"0vETg18v",parentID:"",ui:!0,underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!0,linkDimensionsY:!0,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",repeating:!1,alpha:1,tint:"",interpolateColor:{color2:"",prc:""},offsetX:-.52,offsetY:.6,scaleX:.46,scaleY:.46,angle:0,anchor:{x:0,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"",repeating:!1,fontFamily:"Signika",fill:"#ffffff",interpolateColor:{color2:"",prc:""},fontSize:36,align:"left",letterSpacing:0,dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},shapes:[{shape:{type:"ellipse",x:"0",y:"0",width:"25",height:"25"},label:"",line:{width:1,color:"#000000",alpha:1},fill:{color:"#ff0000",alpha:1,interpolateColor:{color2:"#74da0e",prc:"{{hp}} / {{hpMax}}"}},repeating:!0,repeat:{value:"{{hp}}",increment:"10",isPercentage:!0,maxValue:"{{hpMax}}",perRow:"2",maxRows:"",paddingX:"3",paddingY:"3"}}],effect:"",label:"Health Circles"},group:"Health Circles",i:0}],id:"kJ0Fi54w"},{name:"Health Squares",hint:"Displays up to 10 squares to the right of the token based on their current health. Each square is representative of 10% of the health.",img:"https://user-images.githubusercontent.com/7693704/257477099-689cd23a-0e4a-4d9a-aaa2-bf88b169ede8.png",group:"Health",mappings:[{id:"0vETg18v",label:"Health Squares",expression:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"0vETg18v",parentID:"",ui:!0,underlay:!1,bottom:!1,top:!1,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:5e3,clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!0,linkDimensionsY:!0,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",repeating:!1,alpha:1,tint:"",interpolateColor:{color2:"",prc:""},offsetX:-.52,offsetY:.6,scaleX:.46,scaleY:.46,angle:0,anchor:{x:0,y:0},filter:"NONE",alwaysVisible:!1,limitedUsers:[],limitOnHover:!1,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"",repeating:!1,fontFamily:"Signika",fill:"#ffffff",interpolateColor:{color2:"",prc:""},fontSize:36,align:"left",letterSpacing:0,dropShadow:"true",strokeThickness:1,stroke:"#111111",curve:{radius:0,invert:!1}},shapes:[{shape:{type:"rectangle",x:"0",y:"0",width:"50",height:"50",radius:"0"},label:"",line:{width:1,color:"#000000",alpha:1},fill:{color:"#ff0000",alpha:1,interpolateColor:{color2:"#74da0e",prc:"{{hp}} / {{hpMax}}"}},repeating:!0,repeat:{value:"{{hp}}",increment:"10",isPercentage:!0,maxValue:"{{hpMax}}",perRow:"2",maxRows:"",paddingX:"3",paddingY:"3"}}],effect:"",label:"Health Squares"},group:"Health Squares",i:0}],id:"zzeRhmmk"},{name:"Spell Slot Ring",hint:"Remaining spell slots represented as a ring.",img:"https://user-images.githubusercontent.com/7693704/261663740-444d86b9-ee9f-4a2f-963f-6886a2af29cc.png",system:"dnd5e",mappings:[{id:"1SS3KhwM",label:"Spell Slot Ring",expression:"",imgName:"",imgSrc:"",priority:50,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"1SS3KhwM",parentID:"",ui:!0,underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:"5000",clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",repeating:!1,alpha:"1",tint:"",interpolateColor:{color2:"",prc:""},width:"{{object.w}} * @Scale",height:"{{object.w}} * @Scale",scaleX:"1",scaleY:"1",angle:"0",offsetX:"0",offsetY:"0",anchor:{x:.5,y:.5},filter:"NONE",alwaysVisible:!1,limitedToOwner:!0,limitedUsers:[],limitOnHover:!0,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"",repeating:!1,fontFamily:"Signika",fill:"#ffffff",interpolateColor:{color2:"",prc:""},fontSize:"36",align:"left",letterSpacing:"0",dropShadow:"true",strokeThickness:"1",stroke:"#111111",wordWrap:!1,wordWrapWidth:"200",breakWords:!1,maxHeight:"0",curve:{angle:"0",radius:"0",invert:!1}},shapes:[{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer ",startAngle:"0",endAngle:"360"},label:"BaseLayer",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#3b3b3b",alpha:"1",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90",endAngle:"-90 + ( {{actor.system.spells.spell1.value}} * @Tick )"},label:"1st level",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff0000",alpha:"1",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 4 * @Tick )",endAngle:"-90 + ( 4 * @Tick ) + ( {{actor.system.spells.spell2.value}} * @Tick )"},label:"2nd Level",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff8800",alpha:"1",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 7 * @Tick )",endAngle:"-90 + ( 7 * @Tick ) + ( {{actor.system.spells.spell3.value}} * @Tick )"},label:"3rd Level",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ffdd00",alpha:"1",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 10 * @Tick )",endAngle:"-90 + ( 10 * @Tick ) + ( {{actor.system.spells.spell4.value}} * @Tick )"},label:"4th Level",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#37ff00",alpha:"1",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 13 * @Tick )",endAngle:"-90 + ( 13 * @Tick ) + ( {{actor.system.spells.spell5.value}} * @Tick )"},label:"5th Level",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#00ffcc",alpha:"0.95",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 16 * @Tick )",endAngle:"-90 + ( 16 * @Tick ) + ( {{actor.system.spells.spell6.value}} * @Tick )"},label:"6th Level",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#00b3ff",alpha:"1",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 18 * @Tick )",endAngle:"-90 + ( 18 * @Tick ) + ( {{actor.system.spells.spell7.value}} * @Tick )"},label:"7th Level",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#001eff",alpha:"1",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 20 * @Tick )",endAngle:"-90 + ( 20 * @Tick ) + ( {{actor.system.spells.spell8.value}} * @Tick )"},label:"8th Level",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ae00ff",alpha:"1",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 21 * @Tick )",endAngle:"-90 + ( 21 * @Tick ) + ( {{actor.system.spells.spell9.value}} * @Tick )"},label:"9th Level - Copy",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"1",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90",endAngle:"-90 + ( 1 * @Tick )"},label:"Outline 1",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 1 * @Tick )",endAngle:"-90 + ( 2 * @Tick )"},label:"Outline 2",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 2 * @Tick )",endAngle:"-90 + ( 3 * @Tick )"},label:"Outline 3",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 3 * @Tick )",endAngle:"-90 + ( 4 * @Tick )"},label:"Outline 4",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 4 * @Tick )",endAngle:"-90 + ( 5 * @Tick )"},label:"Outline 5",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 5 * @Tick )",endAngle:"-90 + ( 6 * @Tick )"},label:"Outline 6",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 6 * @Tick )",endAngle:"-90 + ( 7 * @Tick )"},label:"Outline 7",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 7 * @Tick )",endAngle:"-90 + ( 8 * @Tick )"},label:"Outline 8",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 8 * @Tick )",endAngle:"-90 + ( 9 * @Tick )"},label:"Outline 9",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 9 * @Tick )",endAngle:"-90 + ( 10 * @Tick )"},label:"Outline 10",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 10 * @Tick )",endAngle:"-90 + ( 11 * @Tick )"},label:"Outline 11",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 11 * @Tick )",endAngle:"-90 + ( 12 * @Tick )"},label:"Outline 12",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 12 * @Tick )",endAngle:"-90 + ( 13 * @Tick )"},label:"Outline 13",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 13 * @Tick )",endAngle:"-90 + ( 14 * @Tick )"},label:"Outline 14",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 14 * @Tick )",endAngle:"-90 + ( 15 * @Tick )"},label:"Outline 15",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 15 * @Tick )",endAngle:"-90 + ( 16 * @Tick )"},label:"Outline 16",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 16 * @Tick )",endAngle:"-90 + ( 17 * @Tick )"},label:"Outline 17",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 17 * @Tick )",endAngle:"-90 + ( 18 * @Tick )"},label:"Outline 18",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 18 * @Tick )",endAngle:"-90 + ( 19 * @Tick )"},label:"Outline 19",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 19 * @Tick )",endAngle:"-90 + ( 20 * @Tick )"},label:"Outline 20",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 20 * @Tick )",endAngle:"-90 + ( 21 * @Tick )"},label:"Outline 21",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1},{shape:{type:"torus",x:"0",y:"0",innerRadius:"@Inner",outerRadius:"@Outer",startAngle:"-90 + ( 21 * @Tick )",endAngle:"-90 + ( 22 * @Tick )"},label:"Outline 22",line:{width:"1",color:"#000000",alpha:"1"},fill:{color:"#ff00ea",alpha:"0",interpolateColor:{color2:"#ffffff",prc:""}},repeating:!1}],variables:[{name:"Tick",value:"16.3636363636363636"},{name:"Inner",value:"66"},{name:"Outer",value:"80"},{name:"Scale",value:"1.8"}],effect:"",label:"Spell Slot Ring"},group:"Spell Slot Ring",i:0},{id:"3IAo8ZUu",label:"Spell Slot Numbers",expression:"",imgName:"",imgSrc:"",priority:60,config:{},overlay:!0,alwaysOn:!0,disabled:!1,overlayConfig:{id:"3IAo8ZUu",parentID:"",ui:!0,underlay:!1,bottom:!1,top:!0,inheritTint:!1,linkRotation:!1,animation:{relative:!1,rotate:!1,duration:"5000",clockwise:!0},linkMirror:!1,linkScale:!1,linkDimensionsX:!1,linkDimensionsY:!1,linkOpacity:!1,linkStageScale:!1,loop:!0,playOnce:!1,img:"",repeating:!1,alpha:"1",tint:"",interpolateColor:{color2:"",prc:""},width:"{{object.w}} * @Scale",height:"{{object.w}} * @Scale",scaleX:"1",scaleY:"1",angle:"1",offsetX:"0",offsetY:"0.009",anchor:{x:.5,y:.5},filter:"NONE",alwaysVisible:!1,limitedToOwner:!0,limitedUsers:[],limitOnHover:!0,limitOnHighlight:!1,limitOnControl:!1,limitOnEffect:"",limitOnProperty:"",text:{text:"4455566778911112223334",repeating:!1,fontFamily:"Signika",fill:"#ffffff",interpolateColor:{color2:"",prc:""},fontSize:"45",align:"left",letterSpacing:"41.5",dropShadow:null,strokeThickness:"4",stroke:"#111111",wordWrap:!1,wordWrapWidth:"200",breakWords:!1,maxHeight:"0",curve:{angle:"360",radius:"220",invert:!1}},variables:[{name:"Scale",value:"1.85"}],effect:"",label:"Spell Slot Numbers"},group:"Spell Slot Ring",i:1}],id:"FeFzTjjE"}]},309:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{AI:()=>getTokenEffects,AT:()=>VALID_EXPRESSION,U9:()=>getTokenHP,he:()=>updateWithEffectMapping,ju:()=>toggleTemplate,l7:()=>toggleTemplateOnSelected,mU:()=>getAllEffectMappings,n:()=>registerEffectMappingHooks,ps:()=>setOverlayVisibility,y5:()=>evaluateComparator});var _settings_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(924),_utils_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(634),_token_overlay_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(605),_hooks_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(21),_mappingTemplates_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(262);const EXPRESSION_MATCH_RE=/(\\\()|(\\\))|(\|\|)|(\&\&)|(\\\!)/g,PF2E_ITEM_TYPES=["condition","effect","weapon","equipment"],ITEM_TYPES=["equipment","weapon"],feature_id="EffectMappings";function registerEffectMappingHooks(){if(!_settings_js__WEBPACK_IMPORTED_MODULE_0__.Xi[feature_id])return void["canvasReady","createActiveEffect","deleteActiveEffect","preUpdateActiveEffect","updateActiveEffect","createCombatant","deleteCombatant","preUpdateCombat","updateCombat","deleteCombat","preUpdateToken","preUpdateActor","updateActor","updateToken","createToken","preUpdateItem","updateItem","createItem","deleteItem"].forEach((e=>(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.ic)(feature_id,e)));game.user.isGM&&((0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"canvasReady",_refreshTokenMappings),_refreshTokenMappings()),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"createActiveEffect",((e,t,i)=>{if(e.disabled||game.userId!==i)return;_updateImageOnEffectChange(e.name??e.label,e,!0)})),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"deleteActiveEffect",((e,t,i)=>{if(e.disabled||game.userId!==i)return;_updateImageOnEffectChange(e.name??e.label,e,!1)})),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"preUpdateActiveEffect",_preUpdateActiveEffect),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"updateActiveEffect",_updateActiveEffect),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"preUpdateToken",_preUpdateToken),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"preUpdateActor",_preUpdateActor),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"updateActor",_updateActor),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"updateToken",_updateToken),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"createToken",_createToken),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"createCombatant",_createCombatant),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"deleteCombatant",((e,t,i)=>{game.userId===i&&_deleteCombatant(e)})),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"preUpdateCombat",_preUpdateCombat),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"updateCombat",_updateCombat),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"deleteCombat",((e,t,i)=>{game.userId===i&&e.combatants.forEach((e=>{_deleteCombatant(e)}))}));const e="pf2e"===game.system.id?PF2E_ITEM_TYPES:ITEM_TYPES;(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"preUpdateItem",((t,i,a,n)=>{game.user.id===n&&e.includes(t.type)&&(a["token-variants-old-name"]=t.name),_preUpdateAssign(getActorParent(t),i,a)})),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"createItem",((t,i,a)=>{game.userId===a&&e.includes(t.type)&&_updateImageOnEffectChange(t.name,t,!0)})),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"deleteItem",((t,i,a)=>{game.userId===a&&e.includes(t.type)&&!t.disabled&&_updateImageOnEffectChange(t.name,t,!1)})),(0,_hooks_js__WEBPACK_IMPORTED_MODULE_3__.R7)(feature_id,"updateItem",_updateItem)}async function _refreshTokenMappings(){for(const e of canvas.tokens.placeables)await updateWithEffectMapping(e)}function _createCombatant(e,t,i){if(game.userId!==i)return;const a=e._token||canvas.tokens.get(e.tokenId);a&&a.actor&&updateWithEffectMapping(a,{added:["token-variants-combat"]})}function _preUpdateActiveEffect(e,t,i,a){game.userId===a&&getActorParent(e)&&"name"in t&&(i["token-variants-old-name"]=e.name)}function _updateActiveEffect(e,t,i,a){if(game.userId!==a||!getActorParent(e))return;const n=[],o=[];"disabled"in t&&(t.disabled?o.push(e.name):n.push(e.name)),"name"in t&&(o.push(i["token-variants-old-name"]),n.push(t.name)),(n.length||o.length)&&_updateImageOnMultiEffectChange(getActorParent(e),n,o)}function _preUpdateToken(e,t,i,a){if(game.user.id!==a||t.actorId&&e.actorId!==t.actorId)return;const n=getTokenEffects(e,!0);n.length&&foundry.utils.setProperty(i,"token-variants.preUpdateEffects",n),"dnd5e"===game.system.id&&e.actor?.isPolymorphed&&foundry.utils.setProperty(i,"token-variants.wasPolymorphed",!0)}async function _updateToken(e,t,i,a){if(game.user.id!==a||t.actorId)return;e.object?.tvaOverlays?.forEach((e=>e.htmlOverlay?.render()));const n=new Set,o=new Set,r=foundry.utils.getProperty(i,"token-variants.preUpdateEffects")||[],s=getTokenEffects(e,!0);(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.qp)(n,o,s,r),n.size||o.size||"actorLink"in t?updateWithEffectMapping(e,{added:Array.from(n),removed:Array.from(o)}):foundry.utils.getProperty(i,"token-variants.wasPolymorphed")&&!e.actor?.isPolymorphed&&updateWithEffectMapping(e),game.userId===a&&"hidden"in t&&updateWithEffectMapping(e,{added:t.hidden?["token-variants-visibility"]:[],removed:t.hidden?[]:["token-variants-visibility"]})}function _preUpdateActor(e,t,i,a){game.user.id===a&&_preUpdateAssign(e,t,i)}async function _updateActor(e,t,i,a){if(game.user.id===a){if("flags"in t&&"token-variants"in t.flags){const i=t.flags["token-variants"];if("effectMappings"in i||"-=effectMappings"in i){const t=e.token?[e.token]:(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.nv)(e,!0,!1);t.forEach((e=>updateWithEffectMapping(e)));for(const e of t)e.object&&_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.filterEffectIcons&&await e.object.drawEffects()}}_preUpdateCheck(e,i)}}function _preUpdateAssign(e,t,i){if(!e)return;const a=e.token?[e.token]:(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.nv)(e,!0,!1);_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.internalEffects.hpChange.enabled&&a.length&&applyHpChangeEffect(e,t,a);for(const e of a){const t=getTokenEffects(e,!0);t.length&&foundry.utils.setProperty(i,"token-variants."+e.id+".preUpdateEffects",t)}}function _preUpdateCheck(e,t,i=[],a=[]){if(!e)return;const n=e.token?[e.token]:(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.nv)(e,!0,!1);for(const e of n){const n=new Set([...i]),o=new Set([...a]),r=getTokenEffects(e,!0),s=foundry.utils.getProperty(t,"token-variants."+e.id+".preUpdateEffects")??[];(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.qp)(n,o,r,s),(n.size||o.size)&&updateWithEffectMapping(e,{added:Array.from(n),removed:Array.from(o)})}}function _createToken(e,t,i){i&&i===game.user.id&&updateWithEffectMapping(e)}function _preUpdateCombat(e,t,i,a){game.userId===a&&(i["token-variants"]={combatantId:e?.combatant?.token?.id,nextCombatantId:e?.nextCombatant?.token?.id})}function _updateCombat(e,t,i,a){if(game.userId!==a)return;const n=i["token-variants"]?.combatantId,o=i["token-variants"]?.nextCombatantId,r=e?.combatant?.token?.id,s=e?.nextCombatant?.token?.id,l=function(e,t=[],i=[]){if(game.user.isGM){const a=canvas.tokens.get(e);a&&updateWithEffectMapping(a,{added:t,removed:i})}else{const a={handlerName:"effectMappings",args:{tokenId:e,sceneId:canvas.scene.id,added:t,removed:i},type:"UPDATE"};game.socket?.emit("module.token-variants",a)}};n!==r&&(n&&l(n,[],["combat-turn"]),r&&l(r,["combat-turn"],[])),o!==s&&(o&&l(o,[],["combat-turn-next"]),s&&l(s,["combat-turn-next"],[]))}function _updateItem(e,t,i,a){const n=[],o=[];game.user.id===a&&(null!=i["token-variants-old-name"]&&i["token-variants-old-name"]!==e.name&&(n.push(e.name),o.push(i["token-variants-old-name"])),_preUpdateCheck(getActorParent(e),i,n,o))}let EFFECT_M_QUEUES={},EFFECT_M_TIMER;async function updateWithEffectMapping(e,{added:t=[],removed:i=[]}={}){if(clearTimeout(EFFECT_M_TIMER),e.id in EFFECT_M_QUEUES){const a=EFFECT_M_QUEUES[e.id].opts;t.forEach((e=>a.added.add(e))),i.forEach((e=>a.removed.add(e)))}else EFFECT_M_QUEUES[e.id]={token:e,opts:{added:new Set(t),removed:new Set(i)}};EFFECT_M_TIMER=setTimeout((function(){for(const e of Object.keys(EFFECT_M_QUEUES)){const t=EFFECT_M_QUEUES[e];_updateWithEffectMapping(t.token,t.opts.added,t.opts.removed)}EFFECT_M_QUEUES={}}),100)}async function _updateWithEffectMapping(e,t,i){const a=e.object??e._object??e,n=(e=e.document??e).getFlag("token-variants","name")||(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.WP)(e.texture.src);let o=e.getFlag("token-variants","defaultImg");const r=!_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.disableTokenUpdateAnimation,s={},l=e.object?.hasActiveHUD,c=canvas.tokens.hud.object?.id===e.id&&canvas.tokens.hud._statusEffects;let p=getTokenEffects(e);for(const e of t){const t=p.findIndex((t=>t===e));-1===t?p.push(e):t<p.length-1&&(p.splice(t,1),p.push(e))}for(const e of i){const t=p.findIndex((t=>t===e));-1!==t&&p.splice(t,1)}const f=getAllEffectMappings(e);for(const a of f)evaluateMappingExpression(a,p,e,t,i);const u=[],d=[];for(const t of i){const i=f.find((e=>e.id===t))?.config?.tv_script;i&&(i.onRemove&&(i.onRemove.includes("tvaUpdate")?d.push(i.onRemove):u.push({script:i.onRemove,token:e})),i.tmfxPreset&&u.push({tmfxPreset:i.tmfxPreset,token:e,action:"remove"}),i.ceEffect?.name&&u.push({ceEffect:i.ceEffect,token:e,action:"remove"}),i.macroOnApply&&u.push({macro:i.macroOnApply,token:e}))}for(const i of t){const t=f.find((e=>e.id===i))?.config?.tv_script;t&&(t.onApply&&(t.onApply.includes("tvaUpdate")?d.push(t.onApply):u.push({script:t.onApply,token:e})),t.tmfxPreset&&u.push({tmfxPreset:t.tmfxPreset,token:e,action:"apply"}),t.ceEffect?.name&&u.push({ceEffect:t.ceEffect,token:e,action:"apply"}),t.macroOnRemove&&u.push({macro:t.macroOnRemove,token:e}))}p=f.filter((e=>p.includes(e.id))).sort(((e,t)=>e.priority-t.priority));let h,g=!1;if(_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.disableImageChangeOnPolymorphed&&e.actor?.isPolymorphed)g=!0;else if(_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.disableImageUpdateOnNonPrototype&&e.actor?.prototypeToken?.texture?.src!==e.texture.src){g=!0;const t=e.texture.src;for(const e of f)if(e.imgSrc===t){g=!1;break}}if(g&&(o=""),p.length>0){const i={imgSrc:"",imgName:""};if(!g)for(let a=p.length-1;a>=0;a--)if(p[a].imgSrc){let n=p[a].imgSrc;if((n.includes("*")||n.includes("{")&&n.includes("}"))&&!t.has(p[a].overlayConfig?.effect)){i.imgSrc=e.texture.src,i.imgName=(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.WP)(i.imgSrc);break}i.imgSrc=p[a].imgSrc,i.imgName=p[a].imgName;break}let a;if(_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.stackStatusConfig){a={};for(const e of p)a=foundry.utils.mergeObject(a,e.config)}else for(let e=p.length-1;e>=0;e--)if(p[e].config&&0!==Object.keys(p[e].config).length){a=p[e].config;break}!i.imgSrc&&o?(delete s.flags?.["token-variants"]?.defaultImg,foundry.utils.setProperty(s,"flags.token-variants.-=defaultImg",null),i.imgSrc=o.imgSrc,i.imgName=o.imgName):!o&&i.imgSrc&&foundry.utils.setProperty(s,"flags.token-variants.defaultImg",{imgSrc:e.texture.src,imgName:n}),h=()=>(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.mX)(i.imgSrc??null,{token:e,imgName:i.imgName?i.imgName:n,tokenUpdate:s,callback:_postTokenUpdateProcessing.bind(null,e,l,c,u),config:a,animate:r})}if(0===p.length&&o?(delete s.flags?.["token-variants"]?.defaultImg,foundry.utils.setProperty(s,"flags.token-variants.-=defaultImg",null),h=()=>(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.mX)(o.imgSrc,{token:e,imgName:o.imgName,tokenUpdate:s,callback:_postTokenUpdateProcessing.bind(null,e,l,c,u),animate:r})):0===p.length&&e.getFlag("token-variants","usingCustomConfig")&&(h=()=>(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.mX)(e.texture.src,{token:e,imgName:n,tokenUpdate:s,callback:_postTokenUpdateProcessing.bind(null,e,l,c,u),animate:r})),h)if(d.length)for(let t=0;t<d.length;t++)t===d.length-1?await(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.Uh)(d[t],{token:e,tvaUpdate:()=>{h()}}):await(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.Uh)(d[t],{token:e,tvaUpdate:()=>{}});else h();else(u.length||d.length)&&(_postTokenUpdateProcessing(e,l,c,u),_postTokenUpdateProcessing(e,l,c,d));(0,_token_overlay_js__WEBPACK_IMPORTED_MODULE_2__.R3)(a)}async function _postTokenUpdateProcessing(e,t,i,a){t&&e.object&&(canvas.tokens.hud.bind(e.object),i&&canvas.tokens.hud._toggleStatusEffects(!0));for(const t of a)t.script?await(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.Uh)(t.script,{token:t.token}):t.tmfxPreset?await(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.VC)(t.token,t.tmfxPreset,t.action):t.ceEffect?await(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.w4)(t.token,t.ceEffect,t.action):t.macro&&await(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.KW)(t.macro,e)}function getAllEffectMappings(e=null,t=!1){let i=(0,_settings_js__WEBPACK_IMPORTED_MODULE_0__.SL)(e);const a=new Set;i.forEach((e=>a.add(_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.mergeGroup?e.group:e.label)));let n=_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.globalMappings;if(e?.actor?.type){const t=e.actor.type;n=n.filter((e=>!(e.targetActors&&!e.targetActors.includes(t))&&!a.has(_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.mergeGroup?e.group:e.label)))}return i=i.concat(n),t||(i=i.filter((e=>!e.disabled))),i}async function setOverlayVisibility({userName:e=null,userId:t=null,label:i=null,group:a=null,token:n=null,visible:o=!0}={}){if(!i&&!a)return;if(e&&(t=game.users.find((t=>t.name===e))?.id),!t)return;let r=(0,_settings_js__WEBPACK_IMPORTED_MODULE_0__.SL)(n),s=_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.globalMappings,l=!1,c=!1;const p=function(e){let n=!1;return(e=e.filter((e=>e.overlay&&(e.label===i||e.group===a)))).length&&(n=!0),e.forEach((e=>{const i=e.overlayConfig;o?(i.limitedUsers||(i.limitedUsers=[]),i.limitedUsers.find((e=>e===t))||i.limitedUsers.push(t)):i.limitedUsers&&(i.limitedUsers=i.limitedUsers.filter((e=>e!==t)))})),n};if(l=p(r),c=p(s),c&&await(0,_settings_js__WEBPACK_IMPORTED_MODULE_0__.Xx)({globalMappings:s}),l){const e=game.actors.get(n.document.actorId);e&&await e.setFlag("token-variants","effectMappings",r)}(l||c)&&(0,_token_overlay_js__WEBPACK_IMPORTED_MODULE_2__.uv)(n)}function _getTemplateMappings(e){return(_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.templateMappings.find((t=>t.name===e))??_mappingTemplates_js__WEBPACK_IMPORTED_MODULE_4__.g.find((t=>t.name===e)))?.mappings}async function applyTemplate(e,t=null,i=null){if(t&&(i=_getTemplateMappings(t)),!e||!i)return;const a=game.actors.get(e.actor.id);if(!a)return;const n=foundry.utils.deepClone(i);n.forEach((t=>t.tokens=[e.id]));const o=(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.SQ)(n,(0,_settings_js__WEBPACK_IMPORTED_MODULE_0__.SL)(a));await a.setFlag("token-variants","effectMappings",o),await updateWithEffectMapping(e),(0,_token_overlay_js__WEBPACK_IMPORTED_MODULE_2__.uv)(e)}async function removeTemplate(e,t=null,i=null){if(t&&(i=_getTemplateMappings(t)),!e||!i)return;const a=game.actors.get(e.actor.id);if(!a)return;let n=(0,_settings_js__WEBPACK_IMPORTED_MODULE_0__.SL)(a);i.forEach((t=>{let i=n.findIndex((e=>e.id===t.id));-1!==i&&(n[i].tokens=n[i].tokens.filter((t=>t!==e.id)),0===n[i].tokens.length&&n.splice(i,1))})),n.length?await a.setFlag("token-variants","effectMappings",n):await a.unsetFlag("token-variants","effectMappings"),await updateWithEffectMapping(e),(0,_token_overlay_js__WEBPACK_IMPORTED_MODULE_2__.uv)(e)}function toggleTemplate(e,t=null,i=null){if(t&&(i=_getTemplateMappings(t)),!e||!i)return;const a=game.actors.get(e.actor.id);if(!a)return;(0,_settings_js__WEBPACK_IMPORTED_MODULE_0__.SL)(a).some((t=>i.some((i=>i.id===t.id&&t.tokens?.includes(e.id)))))?removeTemplate(e,null,i):applyTemplate(e,null,i)}function toggleTemplateOnSelected(e=null,t=null){canvas.tokens.controlled.forEach((i=>toggleTemplate(i,e,t)))}function getHPChangeEffect(e,t){const i=e.actor?.getFlag("token-variants","internalEffects")||{},a=foundry.utils.getProperty(e,"delta.flags.token-variants.internalEffects");a&&foundry.utils.mergeObject(i,a),null!=i["hp--"]&&t.push("hp--"),null!=i["hp++"]&&t.push("hp++")}function applyHpChangeEffect(e,t,i){let a=Number(_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.internalEffects.hpChange.duration);const n=foundry.utils.getProperty(t,`system.${_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.systemHpPath}.value`);if(null!=n){const[o,r]=getTokenHP(i[0]);o!==n&&(o<n?(foundry.utils.setProperty(t,"flags.token-variants.internalEffects.-=hp--",null),foundry.utils.setProperty(t,"flags.token-variants.internalEffects.hp++",n-o),a&&setTimeout((()=>{e.update({"flags.token-variants.internalEffects.-=hp++":null})}),1e3*a)):(foundry.utils.setProperty(t,"flags.token-variants.internalEffects.-=hp++",null),foundry.utils.setProperty(t,"flags.token-variants.internalEffects.hp--",n-o),a&&setTimeout((()=>{e.update({"flags.token-variants.internalEffects.-=hp--":null})}),1e3*a)))}}function getTokenEffects(e,t=!1){const i=e.document??e;let a=[];game.combats.some((e=>e.combatants.some((e=>e.tokenId===i.id))))&&a.push("token-variants-combat"),game.combat?.started&&(game.combat?.combatant?.token?.id===i.id?a.push("combat-turn"):game.combat?.nextCombatant?.token?.id===i.id&&a.push("combat-turn-next")),i.hidden&&a.push("token-variants-visibility"),_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.internalEffects.hpChange.enabled&&getHPChangeEffect(i,a),i.actorLink?getEffectsFromActor(i.actor,a):"pf2e"===game.system.id?(i.delta?.items||[]).forEach((e=>{_activePF2EItem(e)&&a.push(e.name)})):((i.actor?.effects||[]).filter((e=>!e.disabled&&!e.isSuppressed)).forEach((e=>a.push(e.name))),getEffectsFromActor(i.actor,a)),evaluateComparatorEffects(i,a),evaluateStateEffects(i,a);const n=getAllEffectMappings(i);for(const e of n)if(!e.tokens?.length||e.tokens.includes(data.id))if(e.alwaysOn)a.unshift(e.id);else if(t){evaluateMappingExpression(e,a,i)&&a.unshift(e.id)}return a}function getEffectsFromActor(e,t=[]){return e?("pf2e"===game.system.id?(e.items||[]).forEach(((e,i)=>{_activePF2EItem(e)&&t.push(e.name)})):((e.effects||[]).forEach(((e,i)=>{e.disabled||e.isSuppressed||t.push(e.name??e.label)})),"dnd5e"===game.system.id&&(e.temporaryEffects||[]).forEach(((e,i)=>{e.disabled||e.isSuppressed||t.push(e.name??e.label)})),"shadowrun5e"===game.system.id?(e.items||[]).forEach((e=>{["weapon","armor","bioware","cyberware","device","equipment"].includes(e.type)&&e.system.technology.equipped&&t.push(e.name)})):(e.items||[]).forEach((e=>{ITEM_TYPES.includes(e.type)&&e.system.equipped&&t.push(e.name??e.label)}))),t):t}function _activePF2EItem(e){return!!PF2E_ITEM_TYPES.includes(e.type)&&("active"in e?e.active:!("isEquipped"in e)||e.isEquipped)}const VALID_EXPRESSION=new RegExp('([a-zA-Z0-9\\-\\.\\+]+)([><=]+)(".*"|-?\\d+)(%{0,1})');function evaluateComparator(e,t){const i=t.match(VALID_EXPRESSION);if(i){const t=i[1];let a,n;"hp"===t?[a,n]=getTokenHP(e):"hp++"===t||"hp--"===t?([a,n]=getTokenHP(e),a=foundry.utils.getProperty(e,`actor.flags.token-variants.internalEffects.${t}`)??0):a=foundry.utils.getProperty(e._source,t),null==a&&(a=foundry.utils.getProperty(e,t)),null==a&&(a=0);const o=i[2];let r=Number(i[3]);isNaN(r)&&(r=i[3].substring(1,i[3].length-1),"true"===r&&(r=!0),"false"===r&&(r=!1),!0!==r&&!1!==r||(a=!foundry.utils.isEmpty(a)&&Boolean(a)));"rotation"===t?n=360:null==n&&(n=999999);const s=Boolean(i[4])?a/n*100:a;let l=!1;return"="===o?l=s==r:">"===o?l=s>r:"<"===o?l=s<r:">="===o?l=s>=r:"<="===o?l=s<=r:"<>"===o&&(l=s<r||s>r),l}return!1}function evaluateComparatorEffects(e,t=[]){const i=getAllEffectMappings(e=e.document??e),a=new Set;for(const t of i){const i=t.expression.split(EXPRESSION_MATCH_RE).filter(Boolean).map((e=>e.trim())).filter(Boolean);for(let t=0;t<i.length;t++)evaluateComparator(e,i[t])&&a.add(i[t])}return a.forEach((e=>t.unshift(e))),t}function evaluateStateEffects(e,t){"pf2e"===game.system.id&&(e.document??e).actor?.effects.some((e=>e.statuses.has("dead")))&&t.push("Dead")}function _findReplaceBracketWildcard(e){let t="",i=0;for(;i>=0;){let a=e.indexOf("\\\\\\{",i);if(-1===a)return t+e.substring(i,e.length);{let n=e.indexOf("\\\\\\}",a);-1!==n&&(t+=e.substring(i,a),t+="("+e.substring(a+4,n).split(",").join("|")+")"),i=n+4}}return t??e}function _testRegExEffect(e,t){let i=e.replace(/[/\-\\^$+?.()|[\]{}]/g,"\\$&").replaceAll("\\\\*",".*");return i=_findReplaceBracketWildcard(i),i=new RegExp("^"+i+"$"),t.find((e=>i.test(e)))}function evaluateMappingExpression(mapping,effects,token,added=new Set,removed=new Set){let arrExpression=mapping.expression.split(EXPRESSION_MATCH_RE).filter(Boolean).map((e=>e.trim())).filter(Boolean),temp="",hasAdded=!1,hasRemoved=!1;for(let e of arrExpression)if(_utils_js__WEBPACK_IMPORTED_MODULE_1__.F8.includes(e))temp+=e.replace("\\","");else if(/\\\*|\\{.*\\}/g.test(e)){let t=_testRegExEffect(e,effects);temp+=t?"true":"false",_testRegExEffect(e,added)?hasAdded=!0:_testRegExEffect(e,removed)&&(hasRemoved=!0)}else effects.includes(e)?temp+="true":temp+="false",!hasAdded&&added.has(e)&&(hasAdded=!0),!hasRemoved&&removed.has(e)&&(hasRemoved=!0);try{let evaluation=eval(temp);if(mapping.codeExp)try{token=token.document??token,eval(mapping.codeExp)?mapping.expression||(evaluation=!0):evaluation=!1}catch(e){evaluation=!1}return evaluation?hasAdded||hasRemoved?(added.add(mapping.id),effects.push(mapping.id)):effects.unshift(mapping.id):(hasRemoved||hasAdded)&&removed.add(mapping.id),evaluation}catch(e){}return!1}function getTokenHP(e){let t;return t=e.actorLink?foundry.utils.getProperty(e.actor?.system,_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.systemHpPath):foundry.utils.mergeObject(foundry.utils.getProperty(e.actor?.system,_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.systemHpPath)||{},foundry.utils.getProperty(e.delta?.system)||{},{inplace:!1}),[t?.value,t?.max]}async function _updateImageOnEffectChange(e,t,i=!0){const a=getActorParent(t);if(!a)return;const n=a.token?[a.token]:(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.nv)(a,!0,!1);for(const t of n)await updateWithEffectMapping(t,{added:i?[e]:[],removed:i?[]:[e]})}function getActorParent(e){for(;e&&!(e instanceof Actor);)e=e.parent;return e}async function _updateImageOnMultiEffectChange(e,t=[],i=[]){if(!e)return;const a=e.token?[e.token]:(0,_utils_js__WEBPACK_IMPORTED_MODULE_1__.nv)(e,!0,!1);for(const e of a)await updateWithEffectMapping(e,{added:t,removed:i})}async function _deleteCombatant(e){const t=e._token||canvas.tokens.get(e.tokenId);t&&t.actor&&await updateWithEffectMapping(t,{removed:["token-variants-combat"]})}},471:(e,t,i)=>{i.d(t,{Nu:()=>d,dd:()=>s,kT:()=>f,kt:()=>h,ol:()=>u});var a=i(924),n=i(634),o=i(654);const r="UserMappings";function s(){(0,o.dv)(r,"Tile.prototype.draw",l),(0,o.dv)(r,"Token.prototype.draw",l)}async function l(e,...t){let i;const a=(this.document.getFlag("token-variants","userMappings")||{})[game.userId];let n;return a?(n=this.document.texture.src,this.document.texture.src=a,this.tva_iconOverride=a,i=await e(...t),this.document.texture.src=n,c(this,a)):(c(this),i=await e(...t)),i}function c(e,t){if(t&&(0,n.b3)(t)===a.Ll.invisibleImage&&!e.tva_customVisibility){const t=p(e).get;Object.defineProperty(e,"isVisible",{get:function(){const e=t.call(this);return!(e&&!game.user.isGM)&&e},configurable:!0}),e.tva_customVisibility=!0}else!t&&e.tva_customVisibility&&(Object.defineProperty(e,"isVisible",p(e)),delete e.tva_customVisibility)}function p(e){let t=Object.getPrototypeOf(e),i=null;for(;t&&(i=Object.getOwnPropertyDescriptor(t,"isVisible"),!i);)t=Object.getPrototypeOf(t);return i}function f(e,t,{userName:i=null,userId:a=null}={}){if(!t)return d(e,{userName:i,userId:a});if(i instanceof Array){for(const a of i)f(e,t,{userName:a});return}if(a instanceof Array){for(const i of a)f(e,t,{userId:i});return}let n=a;if(!n&&i&&(n=game.users.find((e=>e.name===i))?.id),!n)return;const o=e.document??e,r=o.getFlag("token-variants","userMappings")||{};r[n]=t,o.setFlag("token-variants","userMappings",r)}function u(e,t={}){const i=[...canvas.tokens.controlled];for(const a of i)f(a,e,t)}function d(e,{userName:t=null,userId:i=null}={}){if(t instanceof Array){for(const i of t)d(e,{userName:i});return}if(i instanceof Array){for(const t of i)d(e,{userId:t});return}let a=i;if(!a&&t&&(a=game.users.find((e=>e.name===t))?.id),a){const t={};t["flags.token-variants.userMappings.-="+a]=null,(e.document??e).update(t)}else t||i||(e.document??e).unsetFlag("token-variants","userMappings")}function h(e={}){const t=[...canvas.tokens.controlled];for(const i of t)d(i,e)}},526:(e,t,i)=>{i.d(t,{Mr:()=>f,eC:()=>u,oT:()=>c});var a=i(924),n=i(722),o=i(170),r=i(605),s=i(21);const l="Overlays";function c(){a.Xi[l]?(a.Ll.evaluateOverlayOnHover||(0,s.ic)(l,"hoverToken"),a.Ll.evaluateOverlayOnHover&&(0,s.R7)(l,"hoverToken",(function(e,t){(0,r.uv)(e)})),(0,s.R7)(l,"createToken",(async function(e){e.object&&(0,r.uv)(e.object)})),(0,s.R7)(l,"updateToken",(async function(e){e.object&&(0,r.uv)(e.object)})),(0,s.R7)(l,"refreshToken",(e=>{if(e.tvaOverlays)for(const t of e.tvaOverlays)t instanceof o.I&&t.refresh(null,{preview:!1,fullRefresh:!1})})),(0,s.R7)(l,"destroyToken",(e=>{if(e.tvaOverlays)for(const t of e.tvaOverlays)t.parent?.removeChild(t)?.destroy()})),(0,s.R7)(l,"updateActor",(async function(e){e.getActiveTokens&&e.getActiveTokens(!0).forEach((e=>{(0,r.uv)(e)}))})),(0,s.R7)(l,"renderCombatTracker",(function(){for(const e of canvas.tokens.placeables)(0,r.uv)(e)})),(0,s.R7)(l,"renderHeadsUpDisplay",(()=>{n.E.hudRendered()}))):["refreshToken","destroyToken","updateActor","renderCombatTracker","updateToken","createToken","hoverToken","renderHeadsUpDisplay"].forEach((e=>(0,s.ic)(l,e)))}const p={};function f(e,t){t in p?p[t].find((t=>t==e))||p[t].push(e):((0,s.R7)("TVAOverlayRefresh",t,(()=>{p[t]?.forEach((e=>e.refresh()))})),p[t]=[e])}function u(e,t=null){const i=function(t){if(p[t]){let i=p[t].findIndex((t=>t==e));i>-1&&(p[t].splice(i,1),p[t].length||((0,s.ic)("TVAOverlayRefresh",t),delete p[t]))}};t?i(t):Object.keys(p).forEach((e=>i(e)))}},548:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>FILTERS,r:()=>OverlayConfig});var _scripts_models_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(113),_scripts_hooks_effectMappingHooks_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(309),_scripts_token_overlay_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(605),_scripts_utils_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(634),_token_variants_mjs__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(652),_effectMappingForm_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(15),_scripts_settings_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(924),_scripts_reticle_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(715);class OverlayConfig extends FormApplication{constructor(e,t,i,{mapping:a,global:n=!1,actor:o}={}){super({},{}),this.config=e??{},!this.config.img&&!this.config.imgLinked||this.config.img instanceof Array||(this.config.img=[{src:this.config.img,linked:this.config.imgLinked}]),this.config.id=a.id,this.callback=t,this.token=canvas.tokens.get(i._id),this.previewConfig=foundry.utils.deepClone(this.config),this.mapping=a,this.global=n,this.actor=o}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-overlay-config",classes:["sheet"],template:"modules/token-variants/token-variants/templates/overlayConfig.html",resizable:!1,minimizable:!1,title:"Overlay Settings",width:500,height:"auto",tabs:[{navSelector:'.tabs[data-group="main"]',contentSelector:"form",initial:"misc"},{navSelector:'.tabs[data-group="html"]',contentSelector:'.tab[data-tab="html"]',initial:"template"}]})}get title(){let e="GLOBAL";return!this.global&&this.actor&&(e=this.actor.name),`${this.mapping.label} — [${e}]`}activateListeners(html){super.activateListeners(html),html.querySelector(".reticle").on("click",(e=>{const t=this.getPreviewIcons();t.length&&_scripts_reticle_js__WEBPACK_IMPORTED_MODULE_7__.l.activate({tvaOverlay:t[0].icon,app:this,config:this.previewConfig})})),html.querySelector(".repeat").on("change",(e=>{const t=e.target.closest("fieldset"),i=t.find(".content");e.target.checked?(i.show(),t.addClass("active")):(i.hide(),t.removeClass("active")),this.setPosition()}));const shapeLegends=html.querySelector(".shape-legend");let config=this.config;shapeLegends.each((function(e){const t=this;t.append(`&nbsp;<a class="cloneShape" data-index="${e}" title="Clone"><i class="fas fa-clone"></i></a>\n         &nbsp;<a class="deleteShape" data-index="${e}" title="Remove"><i class="fas fa-trash-alt"></i></a>`),0!=e&&t.append(`&nbsp;<a class="moveShapeUp" data-index="${e}" title="Move Up"><i class="fas fa-arrow-up"></i></a>`),e!=shapeLegends.length-1&&t.append(`&nbsp;<a class="moveShapeDown" data-index="${e}" title="Move Down"><i class="fas fa-arrow-down"></i></a>`),t.append(`<input class="shape-legend-input" type="text" name="shapes.${e}.label" value="${config.shapes?.[e]?.label??""}">`)})),html.querySelector(".addShape").on("click",this._onAddShape.bind(this)),html.querySelector(".addImage").on("click",this._onAddImage.bind(this)),html.querySelector(".addEvent").on("click",this._onAddEvent.bind(this)),html.querySelector(".deleteShape").on("click",this._onDeleteShape.bind(this)),html.querySelector(".deleteImage").on("click",this._onDeleteImage.bind(this)),html.querySelector(".deleteEvent").on("click",this._onDeleteEvent.bind(this)),html.querySelector(".moveShapeUp").on("click",this._onMoveShapeUp.bind(this)),html.querySelector(".moveShapeDown").on("click",this._onMoveShapeDown.bind(this)),html.querySelector(".cloneShape").on("click",this._onCloneShape.bind(this)),html.querySelector("input,select").on("change",this._onInputChange.bind(this)),html.querySelector("color-picker").on("input",this._onInputChange.bind(this)),html.querySelector("textarea").on("change",this._onInputChange.bind(this));const parentId=html.querySelector('[name="parentID"]');parentId.on("change",(e=>{"TOKEN"===e.target.value?html.querySelector(".token-specific-fields").show():html.querySelector(".token-specific-fields").hide(),this.setPosition()})),parentId.trigger("change"),html.find('[name="ui"]').on("change",(e=>{"TOKEN"===parentId.val()&&(e.target.checked?html.querySelector(".ui-hide").hide():html.querySelector(".ui-hide").show(),this.setPosition())})).trigger("change"),html.querySelector('[name="filter"]').on("change",(e=>{html.querySelector(".filterOptions").empty();const t=genFilterOptionControls(e.target.value);html.querySelector(".filterOptions").append(t),this.setPosition({height:"auto"}),this.activateListeners(t)})),html.querySelector(".token-variants-image-select-button").click((e=>{(0,_token_variants_mjs__WEBPACK_IMPORTED_MODULE_4__.n)(this.token?.name??"overlay",{searchType:_scripts_utils_js__WEBPACK_IMPORTED_MODULE_3__.Cp.TOKEN,callback:(t,i)=>{t&&e.target.closest(".form-group").find("input").val(t).trigger("change")}})})),html.querySelector(".presetImport").on("click",(e=>{const t=e.target.closest(".form-group").find(".tmfxPreset").val();if(t){const i=TokenMagic.getPreset(t);i&&e.target.closest(".form-group").find("textarea").val(JSON.stringify(i,null,2)).trigger("change")}}));let scaleState={locked:!0};html.find(".range-value").siblings('[type="range"]').on("change",(e=>{e.target.siblings(".range-value").val(e.target.value).trigger("change")}));const lockButtons=html.find(".scaleLock > a"),sliderScaleWidth=html.find('[name="scaleX"]'),sliderScaleHeight=html.find('[name="scaleY"]'),sliderWidth=html.querySelector(".scaleX"),sliderHeight=html.querySelector(".scaleY");lockButtons.on("click",(function(){scaleState.locked=!scaleState.locked,lockButtons.html(scaleState.locked?'<i class="fas fa-link"></i>':'<i class="fas fa-unlink"></i>')})),sliderScaleWidth.on("change",(function(){scaleState.locked&&sliderScaleWidth.val()!==sliderScaleHeight.val()&&(sliderScaleHeight.val(sliderScaleWidth.val()).trigger("change"),sliderHeight.val(sliderScaleWidth.val()))})),sliderScaleHeight.on("change",(function(){scaleState.locked&&sliderScaleWidth.val()!==sliderScaleHeight.val()&&(sliderScaleWidth.val(sliderScaleHeight.val()).trigger("change"),sliderWidth.val(sliderScaleHeight.val()))})),html.on("change",".scaleX",(()=>{sliderScaleWidth.trigger("change")})),html.on("change",".scaleY",(()=>{sliderScaleHeight.trigger("change")})),html.querySelector(".me-edit-json").on("click",(async event=>{const textarea=event.target.closest(".form-group").find("textarea");let params;try{params=eval(textarea.val())}catch(e){console.warn("TVA |",e)}if(params){let e;if(Array.isArray(params))if(1===params.length)e=params[0];else{let t=await promptParamChoice(params);if(t<0)return;e=params[t]}else e=params;e&&game.modules.get("multi-token-edit").api.showGenericForm(e,e.filterType??"TMFX",{inputChangeCallback:t=>{foundry.utils.mergeObject(e,t,{inplace:!0}),textarea.val(JSON.stringify(params,null,2)).trigger("change")}})}}));const underlay=html.querySelector('[name="underlay"]'),top=html.querySelector('[name="top"]'),bottom=html.querySelector('[name="bottom"]');underlay.change((function(){this.checked?top.prop("checked",!1):bottom.prop("checked",!1)})),top.change((function(){this.checked&&(underlay.prop("checked",!1),bottom.prop("checked",!1))})),bottom.change((function(){this.checked&&(underlay.prop("checked",!0),top.prop("checked",!1))}));const linkScale=html.querySelector('[name="linkScale"]'),linkDimensions=html.querySelector('[name="linkDimensionsX"], [name="linkDimensionsY"]'),linkStageScale=html.querySelector('[name="linkStageScale"]');linkScale.change((function(){this.checked&&(linkDimensions.prop("checked",!1),linkStageScale.prop("checked",!1))})),linkDimensions.change((function(){this.checked&&(linkScale.prop("checked",!1),linkStageScale.prop("checked",!1))})),linkStageScale.change((function(){this.checked&&(linkScale.prop("checked",!1),linkDimensions.prop("checked",!1))}));const limitOnProperty=html.querySelector('[name="limitOnProperty"]');limitOnProperty.on("input",(e=>{const t=e.target;""===t.val()?(t.removeClass("tvaValid"),t.removeClass("tvaInvalid")):t.val().match(_scripts_hooks_effectMappingHooks_js__WEBPACK_IMPORTED_MODULE_1__.AT)?(t.addClass("tvaValid"),t.removeClass("tvaInvalid")):(t.addClass("tvaInvalid"),t.removeClass("tvaValid"))})),limitOnProperty.trigger("input"),html.querySelector(".create-variable").on("click",this._onCreateVariable.bind(this)),html.querySelector(".delete-variable").on("click",this._onDeleteVariable.bind(this))}_onDeleteVariable(e){let t=e.target.closest("tr").data("index");null!=t&&(this.config=this._getSubmitData(),this.config.variables||(this.config.variables=[]),this.config.variables.splice(t,1),this.render(!0))}_onCreateVariable(e){this.config=this._getSubmitData(),this.config.variables||(this.config.variables=[]),this.config.variables.push({name:"",value:""}),this.render(!0)}_onAddShape(e){let t=e.target.siblings("select").val();t=foundry.utils.deepClone(_scripts_models_js__WEBPACK_IMPORTED_MODULE_0__._z[t]),t=foundry.utils.mergeObject(foundry.utils.deepClone(_scripts_models_js__WEBPACK_IMPORTED_MODULE_0__.ag),{shape:t}),this.config=this._getSubmitData(),this.config.shapes||(this.config.shapes=[]),this.config.shapes.push(t),this.render(!0)}_onAddImage(e){this.config=this._getSubmitData(),this.config.img?this.config.img instanceof Array||(this.config.img=[{src:this.config.img,linked:this.config.imgLinked}]):this.config.img=[],this.config.img.push({src:"",linked:!1}),this.render(!0)}_onAddEvent(e){let t=e.target.siblings("select").val();this.config=this._getSubmitData(),this.config.interactivity||(this.config.interactivity=[]),this.config.interactivity.push({listener:t,macro:"",script:""}),this.render(!0)}_onDeleteShape(e){const t=e.target.closest(".deleteShape").data("index");null!=t&&(this.config=this._getSubmitData(),this.config.shapes||(this.config.shapes=[]),this.config.shapes.splice(t,1),this.render(!0))}_onDeleteImage(e){const t=e.target.closest(".deleteImage").data("index");null!=t&&(this.config=this._getSubmitData(),this.config.img instanceof Array?this.config.img.splice(t,1):this.config.img=[],this.config.img.length||(this.config.img=""),this.render(!0))}_onDeleteEvent(e){const t=e.target.closest(".deleteEvent").data("index");null!=t&&(this.config=this._getSubmitData(),this.config.interactivity||(this.config.interactivity=[]),this.config.interactivity.splice(t,1),this.render(!0))}_onCloneShape(e){const t=e.target.closest(".cloneShape").data("index");if(!t&&0!=t)return;if(this.config=this._getSubmitData(),!this.config.shapes)return;const i=foundry.utils.deepClone(this.config.shapes[t]);i.label&&(i.label=i.label+" - Copy"),this.config.shapes.push(i),this.render(!0)}_onMoveShapeUp(e){const t=e.target.closest(".moveShapeUp").data("index");t&&(this.config=this._getSubmitData(),this.config.shapes||(this.config.shapes=[]),this.config.shapes.length>=2&&this._swapShapes(t,t-1),this.render(!0))}_onMoveShapeDown(e){const t=e.target.closest(".moveShapeDown").data("index");(t||0==t)&&(this.config=this._getSubmitData(),this.config.shapes||(this.config.shapes=[]),this.config.shapes.length>=2&&this._swapShapes(t,t+1),this.render(!0))}_swapShapes(e,t){let i=this.config.shapes[e];this.config.shapes[e]=this.config.shapes[t],this.config.shapes[t]=i}_convertColor(e){try{return[...Color.fromString(e).rgb,1]}catch(e){return[1,1,1,1]}}async _onInputChange(e){if(this.previewConfig=this._getSubmitData(),"color"!==e.target.type)this._applyPreviews();else{e.target.siblings(".color").val(e.target.value).trigger("change")}}getPreviewIcons(){if(!this.config.id)return[];const e=this.token?[this.token]:canvas.tokens.placeables,t=[];for(const i of e)if(i.tvaOverlays)for(const e of i.tvaOverlays)e.overlayConfig&&e.overlayConfig.id===this.config.id&&(this.token?t.push({token:i,icon:e}):(0,_scripts_settings_js__WEBPACK_IMPORTED_MODULE_6__.SL)(i).find((e=>e.id===this.config.id))||t.push({token:i,icon:e}));return t}async _applyPreviews(){const e=this.getPreviewIcons();for(const t of e){const e=(0,_scripts_token_overlay_js__WEBPACK_IMPORTED_MODULE_2__.DH)(foundry.utils.deepClone(this.previewConfig),t.token,{overlayConfig:this.previewConfig});t.icon.refresh(e,{preview:!0,previewTexture:await(0,_scripts_token_overlay_js__WEBPACK_IMPORTED_MODULE_2__.GQ)(t.token,e),refreshFilters:!0})}}async _removePreviews(){const e=this.getPreviewIcons();for(const t of e)t.icon.refresh(null,{refreshFilters:!0})}async getData(e){const t=super.getData(e);t.filters=Object.keys(PIXI.filters),t.filters.push("OutlineOverlayFilter"),t.filters.sort(),t.tmfxActive=game.modules.get("tokenmagic")?.active,t.tmfxActive&&(t.tmfxPresets=TokenMagic.getPresets().map((e=>e.name)),t.filters.unshift("Token Magic FX")),t.filters.unshift("NONE");const i=foundry.utils.mergeObject(_scripts_models_js__WEBPACK_IMPORTED_MODULE_0__.mi,this.config,{inplace:!1});if(t.ceActive=game.modules.get("dfreds-convenient-effects")?.active,t.ceActive&&(t.ceEffects=game.dfreds.effectInterface.findEffects().map((e=>e.name))),t.macros=game.macros.map((e=>e.name)),"NONE"!==i.filter){const e=genFilterOptionControls(i.filter,i.filterOptions);i.filterOptions=e||null}else i.filterOptions=null;t.users=game.users.map((e=>({id:e.id,name:e.name,selected:i.limitedUsers.includes(e.id)}))),t.fonts=Object.keys(CONFIG.fontDefinitions).concat(Object.keys(game.settings.get("core",FontConfig.SETTING))),t.fontWeights=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"];const a=(0,_scripts_hooks_effectMappingHooks_js__WEBPACK_IMPORTED_MODULE_1__.mU)(this.token,!0).filter((e=>e.id!==this.config.id)),[n,o]=(0,_effectMappingForm_js__WEBPACK_IMPORTED_MODULE_5__.T)(a);t.parents=o,t.parentID||(t.parentID="TOKEN"),t.anchor||(t.anchor={x:.5,y:.5});for(const e of Object.keys(_scripts_models_js__WEBPACK_IMPORTED_MODULE_0__._z))await getTemplate(`modules/token-variants/token-variants/templates/partials/shape${e}.html`);return await getTemplate("modules/token-variants/token-variants/templates/partials/repeating.html"),await getTemplate("modules/token-variants/token-variants/templates/partials/interpolateColor.html"),t.allShapes=Object.keys(_scripts_models_js__WEBPACK_IMPORTED_MODULE_0__._z),t.textAlignmentOptions=[{value:"left",label:"Left"},{value:"center",label:"Center"},{value:"right",label:"Right"},{value:"justify",label:"Justify"}],t.vision5e=game.modules.get("vision-5e")?.active,!("linkDimensionsX"in i)&&i.linkDimensions&&(i.linkDimensionsX=!0,i.linkDimensionsY=!0),foundry.utils.mergeObject(t,i)}_getHeaderButtons(){const e=super._getHeaderButtons();return e.unshift({label:"Core Variables",class:".core-variables",icon:"fas fa-file-import fa-fw",onclick:()=>{new Dialog({title:"Core Variables",content:"\n        <table>\n          <tr><th>Variable</th><th>Description</th></tr>\n          <tr><td>@hp</td><td>Actor Health</td></tr>\n          <tr><td>@hpMax</td><td>Actor Health (Max)</td></tr>\n          <tr><td>@gridSize</td><td>Grid Size (Pixels)</td></tr>\n          <tr><td>@label</td><td>Mapping's Label Field</td></tr>\n        </table>\n        ",buttons:{}}).render(!0)}}),e}async close(e={}){super.close(e),this._removePreviews()}_getSubmitData(){let e=super._getSubmitData();if(e=foundry.utils.expandObject(e),e.img){const t=Object.values(e.img);1===t.length?(e.img=t[0].src,e.imgLinked=t[0].linked):e.img=t}return e.repeating||delete e.repeat,e.text.repeating||delete e.text.repeat,e.shapes&&(e.shapes=Object.values(e.shapes),e.shapes.forEach((e=>{e.repeating||delete e.repeat}))),e.interactivity?e.interactivity=Object.values(e.interactivity).map((e=>(e.macro=e.macro.trim(),e.script=e.script.trim(),e.tmfxPreset&&(e.tmfxPreset=e.tmfxPreset.trim()),e.ceEffect&&(e.ceEffect=e.ceEffect.trim()),e))).filter((e=>e.macro||e.script||e.ceEffect||e.tmfxPreset)):e.interactivity=[],e.variables&&(e.variables=Object.values(e.variables),e.variables=e.variables.filter((e=>e.name.trim()&&e.value.trim()))),e.limitedUsers?("string"===foundry.utils.getType(e.limitedUsers)&&(e.limitedUsers=[e.limitedUsers]),e.limitedUsers=e.limitedUsers.filter((e=>e))):e.limitedUsers=[],e.limitOnEffect=e.limitOnEffect.trim(),e.limitOnProperty=e.limitOnProperty.trim(),"TOKEN"===e.parentID&&(e.parentID=""),"OutlineOverlayFilter"===e.filter&&e.filterOptions?.outlineColor?e.filterOptions.outlineColor=this._convertColor(e.filterOptions.outlineColor):"BevelFilter"===e.filter?(e.filterOptions?.lightColor&&(e.filterOptions.lightColor=Number(Color.fromString(e.filterOptions.lightColor))),e.filterOptions?.shadowColor&&(e.filterOptions.shadowColor=Number(Color.fromString(e.filterOptions.shadowColor)))):["DropShadowFilter","GlowFilter","OutlineFilter","FilterFire"].includes(e.filter)&&e.filterOptions?.color&&(e.filterOptions.color=Number(Color.fromString(e.filterOptions.color))),e}async _updateObject(e,t){this.callback&&this.callback(t)}}const FILTERS={OutlineOverlayFilter:{defaultValues:{outlineColor:[0,0,0,1],trueThickness:1,animate:!1},controls:[{type:"color",name:"outlineColor"},{type:"range",label:"Thickness",name:"trueThickness",min:0,max:5,step:.01},{type:"boolean",label:"Oscillate",name:"animate"}],argType:"args"},AlphaFilter:{defaultValues:{alpha:1},controls:[{type:"range",name:"alpha",min:0,max:1,step:.01}],argType:"args"},BlurFilter:{defaultValues:{strength:8,quality:4},controls:[{type:"range",name:"strength",min:0,max:20,step:1},{type:"range",name:"quality",min:0,max:20,step:1}],argType:"args"},BlurFilterPass:{defaultValues:{horizontal:!1,strength:8,quality:4},controls:[{type:"boolean",name:"horizontal"},{type:"range",name:"strength",min:0,max:20,step:1},{type:"range",name:"quality",min:0,max:20,step:1}],argType:"args"},NoiseFilter:{defaultValues:{noise:.5,seed:4475160954091},controls:[{type:"range",name:"noise",min:0,max:1,step:.01},{type:"range",name:"seed",min:0,max:1e5,step:1}],argType:"args"},AdjustmentFilter:{defaultValues:{gamma:1,saturation:1,contrast:1,brightness:1,red:1,green:1,blue:1,alpha:1},controls:[{type:"range",name:"gamma",min:0,max:1,step:.01},{type:"range",name:"saturation",min:0,max:1,step:.01},{type:"range",name:"contrast",min:0,max:1,step:.01},{type:"range",name:"brightness",min:0,max:1,step:.01},{type:"range",name:"red",min:0,max:1,step:.01},{type:"range",name:"green",min:0,max:1,step:.01},{type:"range",name:"blue",min:0,max:1,step:.01},{type:"range",name:"alpha",min:0,max:1,step:.01}],argType:"options"},AdvancedBloomFilter:{defaultValues:{threshold:.5,bloomScale:1,brightness:1,blur:8,quality:4},controls:[{type:"range",name:"threshold",min:0,max:1,step:.01},{type:"range",name:"bloomScale",min:0,max:5,step:.01},{type:"range",name:"brightness",min:0,max:1,step:.01},{type:"range",name:"blur",min:0,max:20,step:1},{type:"range",name:"quality",min:0,max:20,step:1}],argType:"options"},AsciiFilter:{defaultValues:{size:8},controls:[{type:"range",name:"size",min:0,max:20,step:.01}],argType:"args"},BevelFilter:{defaultValues:{rotation:45,thickness:2,lightColor:16777215,lightAlpha:.7,shadowColor:0,shadowAlpha:.7},controls:[{type:"range",name:"rotation",min:0,max:360,step:1},{type:"range",name:"thickness",min:0,max:20,step:.01},{type:"color",name:"lightColor"},{type:"range",name:"lightAlpha",min:0,max:1,step:.01},{type:"color",name:"shadowColor"},{type:"range",name:"shadowAlpha",min:0,max:1,step:.01}],argType:"options"},BloomFilter:{defaultValues:{blur:2,quality:4},controls:[{type:"range",name:"blur",min:0,max:20,step:1},{type:"range",name:"quality",min:0,max:20,step:1}],argType:"args"},BulgePinchFilter:{defaultValues:{radius:100,strength:1},controls:[{type:"range",name:"radius",min:0,max:500,step:1},{type:"range",name:"strength",min:-1,max:1,step:.01}],argType:"options"},CRTFilter:{defaultValues:{curvature:1,lineWidth:1,lineContrast:.25,verticalLine:!1,noise:.3,noiseSize:1,seed:0,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3,time:0},controls:[{type:"range",name:"curvature",min:0,max:20,step:.01},{type:"range",name:"lineWidth",min:0,max:20,step:.01},{type:"range",name:"lineContrast",min:0,max:5,step:.01},{type:"boolean",name:"verticalLine"},{type:"range",name:"noise",min:0,max:2,step:.01},{type:"range",name:"noiseSize",min:0,max:20,step:.01},{type:"range",name:"seed",min:0,max:1e5,step:1},{type:"range",name:"vignetting",min:0,max:20,step:.01},{type:"range",name:"vignettingAlpha",min:0,max:1,step:.01},{type:"range",name:"vignettingBlur",min:0,max:5,step:.01},{type:"range",name:"time",min:0,max:1e4,step:1}],argType:"options"},DotFilter:{defaultValues:{scale:1,angle:5},controls:[{type:"range",name:"scale",min:0,max:50,step:1},{type:"range",name:"angle",min:0,max:360,step:.1}],argType:"args"},DropShadowFilter:{defaultValues:{rotation:45,distance:5,color:0,alpha:.5,shadowOnly:!1,blur:2,quality:3},controls:[{type:"range",name:"rotation",min:0,max:360,step:.1},{type:"range",name:"distance",min:0,max:100,step:.1},{type:"color",name:"color"},{type:"range",name:"alpha",min:0,max:1,step:.01},{type:"boolean",name:"shadowOnly"},{type:"range",name:"blur",min:0,max:20,step:.1},{type:"range",name:"quality",min:0,max:20,step:1}],argType:"options"},EmbossFilter:{defaultValues:{strength:5},controls:[{type:"range",name:"strength",min:0,max:20,step:1}],argType:"args"},GlitchFilter:{defaultValues:{slices:5,offset:100,direction:0,fillMode:0,seed:0,average:!1,minSize:8,sampleSize:512},controls:[{type:"range",name:"slices",min:0,max:50,step:1},{type:"range",name:"distance",min:0,max:1e3,step:1},{type:"range",name:"direction",min:0,max:360,step:.1},{type:"select",name:"fillMode",options:[{value:0,label:"TRANSPARENT"},{value:1,label:"ORIGINAL"},{value:2,label:"LOOP"},{value:3,label:"CLAMP"},{value:4,label:"MIRROR"}]},{type:"range",name:"seed",min:0,max:1e4,step:1},{type:"boolean",name:"average"},{type:"range",name:"minSize",min:0,max:500,step:1},{type:"range",name:"sampleSize",min:0,max:1024,step:1}],argType:"options"},GlowFilter:{defaultValues:{distance:10,outerStrength:4,innerStrength:0,color:16777215,quality:.1,knockout:!1},controls:[{type:"range",name:"distance",min:1,max:50,step:1},{type:"range",name:"outerStrength",min:0,max:20,step:1},{type:"range",name:"innerStrength",min:0,max:20,step:1},{type:"color",name:"color"},{type:"range",name:"quality",min:0,max:5,step:.1},{type:"boolean",name:"knockout"}],argType:"options"},GodrayFilter:{defaultValues:{angle:30,gain:.5,lacunarity:2.5,parallel:!0,time:0,alpha:1},controls:[{type:"range",name:"angle",min:0,max:360,step:.1},{type:"range",name:"gain",min:0,max:5,step:.01},{type:"range",name:"lacunarity",min:0,max:5,step:.01},{type:"boolean",name:"parallel"},{type:"range",name:"time",min:0,max:1e4,step:1},{type:"range",name:"alpha",min:0,max:1,step:.01}],argType:"options"},KawaseBlurFilter:{defaultValues:{blur:4,quality:3,clamp:!1},controls:[{type:"range",name:"blur",min:0,max:20,step:.1},{type:"range",name:"quality",min:0,max:20,step:1},{type:"boolean",name:"clamp"}],argType:"args"},OldFilmFilter:{defaultValues:{sepia:.3,noise:.3,noiseSize:1,scratch:.5,scratchDensity:.3,scratchWidth:1,vignetting:.3,vignettingAlpha:1,vignettingBlur:.3},controls:[{type:"range",name:"sepia",min:0,max:1,step:.01},{type:"range",name:"noise",min:0,max:1,step:.01},{type:"range",name:"noiseSize",min:0,max:5,step:.01},{type:"range",name:"scratch",min:0,max:5,step:.01},{type:"range",name:"scratchDensity",min:0,max:5,step:.01},{type:"range",name:"scratchWidth",min:0,max:20,step:.01},{type:"range",name:"vignetting",min:0,max:1,step:.01},{type:"range",name:"vignettingAlpha",min:0,max:1,step:.01},{type:"range",name:"vignettingBlur",min:0,max:5,step:.01}],argType:"options"},OutlineFilter:{defaultValues:{thickness:1,color:0,quality:.1},controls:[{type:"range",name:"thickness",min:0,max:20,step:.1},{type:"color",name:"color"},{type:"range",name:"quality",min:0,max:1,step:.01}],argType:"args"},PixelateFilter:{defaultValues:{size:1},controls:[{type:"range",name:"size",min:1,max:100,step:1}],argType:"args"},RGBSplitFilter:{defaultValues:{red:[-10,0],green:[0,10],blue:[0,0]},controls:[{type:"point",name:"red",min:0,max:50,step:1},{type:"point",name:"green",min:0,max:50,step:1},{type:"point",name:"blue",min:0,max:50,step:1}],argType:"args"},RadialBlurFilter:{defaultValues:{angle:0,center:[0,0],radius:-1},controls:[{type:"range",name:"angle",min:0,max:360,step:1},{type:"point",name:"center",min:0,max:1e3,step:1},{type:"range",name:"radius",min:-1,max:1e3,step:1}],argType:"args"},ReflectionFilter:{defaultValues:{mirror:!0,boundary:.5,amplitude:[0,20],waveLength:[30,100],alpha:[1,1],time:0},controls:[{type:"boolean",name:"mirror"},{type:"range",name:"boundary",min:0,max:1,step:.01},{type:"point",name:"amplitude",min:0,max:100,step:1},{type:"point",name:"waveLength",min:0,max:500,step:1},{type:"point",name:"alpha",min:0,max:1,step:.01},{type:"range",name:"time",min:0,max:1e4,step:1}],argType:"options"},DisplacementFilter:{defaultValues:{sprite:"",textureScale:1,displacementScale:1},controls:[{type:"text",name:"sprite"},{type:"range",name:"textureScale",min:0,max:100,step:.1},{type:"range",name:"displacementScale",min:0,max:100,step:.1}],argType:"options"},"Token Magic FX":{defaultValues:{params:[]},controls:[{type:"tmfxPreset",name:"tmfxPreset"},{type:"json",name:"params"}]}};function genFilterOptionControls(e,t={}){if(!(e in FILTERS))return;const i=getControlValues(e,foundry.utils.mergeObject(FILTERS[e].defaultValues,t)),a=FILTERS[e].controls;let n="<fieldset><legend>Options</legend>";for(const e of a)n+=genControl(e,i);return n+="</fieldset>",n}function getControlValues(e,t){return"OutlineOverlayFilter"===e?t.outlineColor=Color.fromRGB(t.outlineColor).toString():"BevelFilter"===e?(t.lightColor=Color.from(t.lightColor).toString(),t.shadowColor=Color.from(t.shadowColor).toString()):["DropShadowFilter","GlowFilter","OutlineFilter"].includes(e)&&(t.color=Color.from(t.color).toString()),t}function genControl(e,t){const i=t[e.name],a=e.name,n=e.label??a.charAt(0).toUpperCase()+a.slice(1),o=e.type;if("color"===o)return`\n<div class="form-group">\n  <label>${n}</label>\n  <div class="form-fields">\n      <input class="color" type="text" name="filterOptions.${a}" value="${i}">\n      <input type="color" value="${i}" data-edit="filterOptions.${a}">\n  </div>\n</div>\n`;if("range"===o)return`\n<div class="form-group">\n  <label>${n}</label>\n  <div class="form-fields">\n      <input type="range" name="filterOptions.${a}" value="${i}" min="${e.min}" max="${e.max}" step="${e.step}">\n      <span class="range-value">${i}</span>\n  </div>\n</div>\n`;if("boolean"===o)return`\n<div class="form-group">\n  <label>${n}</label>\n  <div class="form-fields">\n      <input type="checkbox" name="filterOptions.${a}" data-dtype="Boolean" value="${i}" ${i?"checked":""}>\n  </div>\n</div>\n    `;if("select"===o){let t=`\n    <div class="form-group">\n    <label>${n}</label>\n    <div class="form-fields">\n      <select name="${a}">\n`;for(const a of e.options)t+=`<option value="${a.value}" ${i===a.value?'selected="selected"':""}>${a.label}</option>`;return t+="</select></div></div>",t}if("point"===o)return`\n<div class="form-group">\n  <label>${n}</label>\n  <div class="form-fields">\n      <input type="range" name="filterOptions.${a}" value="${i[0]}" min="${e.min}" max="${e.max}" step="${e.step}">\n      <span class="range-value">${i[0]}</span>\n  </div>\n  <div class="form-fields">\n    <input type="range" name="filterOptions.${a}" value="${i[1]}" min="${e.min}" max="${e.max}" step="${e.step}">\n    <span class="range-value">${i[1]}</span>\n  </div>\n</div>\n`;if("json"===o){let e=`\n<div class="form-group">\n  <label>${n}</label>\n  <div class="form-fields">\n      <textarea style="width: 450px; height: 200px;" name="filterOptions.${a}">${i}</textarea>\n  </div>`;const t=game.modules.get("multi-token-edit");return t?.active&&t.api.showGenericForm&&(e+='\n  <div style="text-align: right; color: orangered;">\n      <a> <i class="me-edit-json fas fa-edit" title="Show Generic Form"></i></a>\n  </div>'),e+="</div>",e}return"text"===o?`\n<div class="form-group">\n  <label>${n}</label>\n  <div class="form-fields">\n      <input type="text" name="filterOptions.${a}" value="${i}">\n  </div>\n</div>\n`:"tmfxPreset"===o&&game.modules.get("tokenmagic")?.active?'\n      <div class="form-group">\n        <label>Preset <span class="units">(TMFX)</span></label>\n        <div class="form-fields">\n          <input list="tmfxPresets" class="tmfxPreset">\n          <button type="button" class="presetImport"><i class="fas fa-download"></i></button>\n        </div>\n      ':""}async function promptParamChoice(e){return new Promise(((t,i)=>{const a={};for(let i=0;i<e.length;i++){const n=e[i].filterType??e[i].filterId;a[n]={label:n,callback:()=>{t(i)}}}new Dialog({title:"Select Filter To Edit",content:"",buttons:a,close:()=>t(-1)}).render(!0)}))}},605:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{DH:()=>evaluateOverlayExpressions,De:()=>interpolateColor,Ev:()=>removeMarkedOverlays,GQ:()=>genTexture,R3:()=>broadcastDrawOverlays,tp:()=>FONT_LOADING,uv:()=>drawOverlays});var _settings_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(924),_sprite_TVAOverlay_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(170),_utils_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(634),_hooks_effectMappingHooks_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(309);const FONT_LOADING={};async function drawOverlays(e){if(e.tva_drawing_overlays)return;e.tva_drawing_overlays=!0;const t=(0,_hooks_effectMappingHooks_js__WEBPACK_IMPORTED_MODULE_3__.mU)(e),i=(0,_hooks_effectMappingHooks_js__WEBPACK_IMPORTED_MODULE_3__.AI)(e,!0);let a=t.filter((e=>e.overlay&&i.includes(e.id))).sort(((e,t)=>e.priority-(e.overlayConfig?.parentID?0:999)-(t.priority-(t.overlayConfig?.parentID?0:999))));a.length&&(a=_settings_js__WEBPACK_IMPORTED_MODULE_0__.Ll.stackStatusConfig?a:[a[a.length-1]]);const n=a.map((t=>(t.overlayConfig.id=t.id,evaluateOverlayExpressions(foundry.utils.deepClone(t.overlayConfig),e,t))));n.length?(0,_utils_js__WEBPACK_IMPORTED_MODULE_2__.rc)(e,(async e=>{e.tvaOverlays||(e.tvaOverlays=[]),_markAllOverlaysForRemoval(e);let t=0,i=0;for(const a of n){let n=_findTVAOverlay(a.id,e);if(n){_evaluateLinkedImages(a,e.document.texture.src);const t=foundry.utils.diffObject(n.overlayConfig,a);if(foundry.utils.isEmpty(t))(t.text?.text||t.shapes)&&n.setTexture(await genTexture(e,a),{configuration:a,refreshFilters});else{const i=Boolean(t.filter||t.filterOptions);a.img instanceof Array&&a.img.length>1?n.refresh(a,{refreshFilters:i}):t.img||t.text||t.shapes||t.repeat||t.html?n.setTexture(await genTexture(e,a),{configuration:a,refreshFilters:i}):t.parentID?(n.parent?.removeChild(n)?.destroy(),n=null):n.refresh(a,{refreshFilters:i})}if("ui"in t){n.parent.removeChild(n);n=(a.ui?canvas.tokens:canvas.primary).addChild(n)}}if(!n){if(a.parentID){const t=_findTVAOverlay(a.parentID,e);t&&!t.tvaRemove&&(n=t.addChildAuto(new _sprite_TVAOverlay_js__WEBPACK_IMPORTED_MODULE_1__.I(await genTexture(e,a),e,a)))}else{n=(a.ui?canvas.tokens:canvas.primary).addChild(new _sprite_TVAOverlay_js__WEBPACK_IMPORTED_MODULE_1__.I(await genTexture(e,a),e,a))}n&&e.tvaOverlays.push(n)}if(n?.overlayConfig.parentID){const t=_findTVAOverlay(n.overlayConfig.parentID,e);t&&!t.tvaRemove||(n=null)}n&&(n.tvaRemove=!1,n.overlayConfig.underlay?(i-=.01,n.overlaySort=i):(t+=.01,n.overlaySort=t),n.parent.sortableChildren=!0,n.parent.sortDirty=!0)}removeMarkedOverlays(e),e.tva_drawing_overlays=!1})):(_removeAllOverlays(e),e.tva_drawing_overlays=!1)}function _evaluateLinkedImages(e,t){if(e.img instanceof Array)for(const i of e.img)i.linked&&(i.src=t);else e.imgLinked&&(e.img=t)}async function genTexture(e,t){return t.img?await generateImage(e,t):null!=t.text?.text?await generateTextTexture(e,t):t.shapes?.length?await generateShapeTexture(e,t.shapes):t.html?.template?{html:!0,texture:await loadTexture("modules\\token-variants\\img\\html_bg.webp")}:{texture:await loadTexture("modules/token-variants/token-variants/img/token-images.svg")}}async function generateImage(e,t){_evaluateLinkedImages(t,e.document.texture.src);let i=t.img;i instanceof Array&&(i=i[Math.floor(Math.random()*i.length)].src);let a=await loadTexture(i,{fallback:"modules/token-variants/token-variants/img/token-images.svg"});if(t.repeating&&t.repeat){const e=t.repeat;let i;i=e.isPercentage?Math.ceil(e.value/e.maxValue/(e.increment/100)):Math.ceil(e.value/e.increment);let n=0,o=0;const r=e.maxRows??1/0;let s=0,l=0;const c=e.paddingX??0,p=e.paddingY??0;let f=new PIXI.Container;for(;i>0;){let t=new PIXI.Sprite(a);if(t.x=s,t.y=l,f.addChild(t),s+=a.width+c,i--,n++,0!=i&&n>=e.perRow){if(o+=1,o>=r)break;l+=a.height+p,s=0,n=0}}a=_renderContainer(f,a.resolution)}return{texture:a}}function _renderContainer(e,t,{width:i=null,height:a=null}={}){const n=e.getLocalBounds(),o=new PIXI.Matrix;o.tx=-n.x,o.ty=-n.y;const r=PIXI.RenderTexture.create({width:i??n.width,height:a??n.height,resolution:t});return canvas.app.renderer.render(e,{renderTexture:r,clear:!0,transform:o,skipUpdateTransform:!1}),r.destroyable=!0,r}function _drawShape(e,t,i=0,a=0){if("rectangle"===t.type)return e.drawRoundedRect(t.x+i,t.y+a,t.width,t.height,t.radius),[t.width,t.height];if("ellipse"===t.type)return e.drawEllipse(t.x+i+t.width,t.y+a+t.height,t.width,t.height),[2*t.width,2*t.height];if("polygon"===t.type)e.drawPolygon(t.points.split(",").map(((e,i)=>Number(e)*t.scale+(i%2==0?t.x:t.y))));else{if("torus"===t.type)return drawTorus(e,t.x+i+t.outerRadius,t.y+a+t.outerRadius,t.innerRadius,t.outerRadius,Math.toRadians(t.startAngle),t.endAngle>=360?2*Math.PI:Math.toRadians(t.endAngle)),[2*t.outerRadius,2*t.outerRadius];"cutCircle"===t.type&&drawCutCircle(e,t.x+i+t.radius,t.y+a+t.radius,t.radius,t.rotation,t.cut)}}async function generateShapeTexture(e,t){let i=new PIXI.Graphics;for(const e of t){i.beginFill(interpolateColor(e.fill.color,e.fill.interpolateColor),e.fill.alpha),i.lineStyle(e.line.width,(0,_utils_js__WEBPACK_IMPORTED_MODULE_2__.pP)(e.line.color),e.line.alpha);const t=e.shape;if(e.repeating&&e.repeat){const a=e.repeat;let n;n=a.isPercentage?Math.ceil(a.value/a.maxValue/(a.increment/100)):Math.ceil(a.value/a.increment);let o=0,r=0;const s=a.maxRows??1/0;let l=0,c=0;const p=a.paddingX??0,f=a.paddingY??0;for(;n>0;){const[e,u]=_drawShape(i,t,l,c);if(l+=e+p,n--,o++,0!=n&&o>=a.perRow){if(r+=1,r>=s)break;c+=u+f,l=0,o=0}}}else _drawShape(i,t)}return i.shapesWidth=Number(i.width),i.shapesHeight=Number(i.height),{texture:PIXI.Texture.EMPTY,shapes:i}}function drawTorus(e,t,i,a,n,o=0,r=2*Math.PI){if(Math.abs(r-o)>=2*Math.PI)return e.drawCircle(t,i,n).beginHole().drawCircle(t,i,a).endHole();e.finishPoly(),e.arc(t,i,a,r,o,!0).arc(t,i,n,o,r,!1).finishPoly()}function drawCutCircle(e,t,i,a,n,o){if(o>=1)return;if(o<=0)return e.drawCircle(t,i,a);let r=180*o-90+n,s=270-180*o+n;e.arc(t,i,a,Math.toRadians(r),Math.toRadians(s),!1).closePath().finishPoly()}function interpolateColor(e,t,i=!1){if(!t||!t.color2||!t.prc)return i?e:(0,_utils_js__WEBPACK_IMPORTED_MODULE_2__.pP)(e);if(!PIXI.Color)return _interpolateV10(e,t,i);const a=t.prc;e=new PIXI.Color(e);const n=new PIXI.Color(t.color2);let o=rgb2hsv(e.red,e.green,e.blue),r=rgb2hsv(n.red,n.green,n.blue),s=r[0]-o[0],l=s+(Math.abs(s)>180?s<0?360:-360:0),c=o[0]+l*a,p=(1-a)*o[1]+a*r[1],f=(1-a)*o[2]+a*r[2],u=new PIXI.Color({h:c,s:100*p,v:100*f});return i?u.toHex():u.toNumber()}function _interpolateV10(e,t,i=!1){const a=t.prc;e=PIXI.utils.hex2rgb((0,_utils_js__WEBPACK_IMPORTED_MODULE_2__.pP)(e));const n=PIXI.utils.hex2rgb((0,_utils_js__WEBPACK_IMPORTED_MODULE_2__.pP)(t.color2));let o=rgb2hsv(e[0],e[1],e[2]),r=rgb2hsv(n[0],n[1],n[2]),s=r[0]-o[0],l=s+(Math.abs(s)>180?s<0?360:-360:0),c=o[0]+l*a,p=(1-a)*o[1]+a*r[1],f=(1-a)*o[2]+a*r[2],u=Color.fromHSV([c/360,p,f]);return i?u.toString():Number(u)}function rgb2hsv(e,t,i){let a=Math.max(e,t,i),n=a-Math.min(e,t,i),o=n&&(a==e?(t-i)/n:a==t?2+(i-e)/n:4+(e-t)/n);return[60*(o<0?o+6:o),a&&n/a,a]}const CORE_VARIABLES={"@hp":e=>(0,_hooks_effectMappingHooks_js__WEBPACK_IMPORTED_MODULE_3__.U9)(e)?.[0],"@hpMax":e=>(0,_hooks_effectMappingHooks_js__WEBPACK_IMPORTED_MODULE_3__.U9)(e)?.[1],"@gridSize":()=>canvas.grid?.size,"@label":(e,t)=>t.label};function _evaluateString(e,t,i){let a=i.overlayConfig?.variables;const n=new RegExp("@\\w+","gi");e=e.replace(n,(function(e){let n=e.substr(1,e.length),o=a?.find((e=>e.name===n));return o?o.value:e in CORE_VARIABLES?CORE_VARIABLES[e](t,i):e}));const o=new RegExp("{{.*?}}","gi");return e=e.replace(o,(function(e){const a=e.substring(2,e.length-2);if(i&&"effect"===a)return i.expression;if(t&&"hp"===a)return(0,_hooks_effectMappingHooks_js__WEBPACK_IMPORTED_MODULE_3__.U9)(t)?.[0];if(t&&"hpMax"===a)return(0,_hooks_effectMappingHooks_js__WEBPACK_IMPORTED_MODULE_3__.U9)(t)?.[1];return foundry.utils.getProperty(t.document??t,a)??0})).replace("\\n","\n")}function _executeString(evalString,token){try{const actor=token.actor,result=eval(evalString);return foundry.utils.getType(result),result}catch(e){}return evalString}function evaluateOverlayExpressions(e,t,i){for(const[a,n]of Object.entries(e))["label","interactivity","variables","id","parentID","limitedUsers","filter","limitOnProperty","html"].includes(a)||(e[a]=_evaluateObjExpressions(n,t,i));return e}function _evaluateObjExpressions(e,t,i){const a=foundry.utils.getType(e);if("string"===a){return _executeString(_evaluateString(e,t,i),t)}if("Array"===a)for(let a=0;a<e.length;a++)e[a]=_evaluateObjExpressions(e[a],t,i);else if("Object"===a)for(const[a,n]of Object.entries(e))if("text"===a&&"string"===foundry.utils.getType(n)&&n){const o=_evaluateString(n,t,i),r=_executeString(o,t);"string"!==foundry.utils.getType(r)?e[a]=o:e[a]=r}else e[a]=_evaluateObjExpressions(n,t,i);return e}async function generateTextTexture(e,t){await FONT_LOADING.loading;let i=t.text.text;if(t.text.repeating&&t.text.repeat){let e="";const a=t.text.repeat;let n;n=a.isPercentage?Math.ceil(a.value/a.maxValue/(a.increment/100)):Math.ceil(a.value/a.increment);let o=0,r=0,s=a.maxRows??1/0;for(;n>0;)if(e+=i,n--,o++,0!=n&&o>=a.perRow){if(r+=1,r>=s)break;e+="\n",o=0}i=e}let a=PreciseText.getTextStyle({...t.text,fontFamily:[t.text.fontFamily,"fontAwesome"].join(","),fill:interpolateColor(t.text.fill,t.text.interpolateColor,!0)});const n=new PreciseText(i,a);n.updateText(!1);const o=n.texture,r=t.text.maxHeight?Math.min(o.height,t.text.maxHeight):null,s=t.text.curve;if(!r&&!s?.radius&&!s?.angle)return o.textLabel=i,{texture:o};const l=new PIXI.Container;if(s?.radius||s?.angle){const e=t.text.letterSpacing??0,i=s.angle?(o.width+e)/(2*Math.PI)/(s.angle/360):s.radius,a=100,n=Math.PI/a;let r=a-Math.round(o.width/(i*Math.PI)*a);r/=2;const c=[];for(let e=a-r;e>r;e--){const t=i*Math.cos(n*e),a=i*Math.sin(n*e);c.push(new PIXI.Point(t,s.invert?a:-a))}const p=new PIXI.SimpleRope(o,c);l.addChild(p)}else l.addChild(new PIXI.Sprite(o));const c=_renderContainer(l,2,{height:r});return n.destroy(),c.textLabel=i,{texture:c}}function _markAllOverlaysForRemoval(e){for(const t of e.tvaOverlays)t instanceof _sprite_TVAOverlay_js__WEBPACK_IMPORTED_MODULE_1__.I&&(t.tvaRemove=!0)}function removeMarkedOverlays(e){const t=[];for(const i of e.tvaOverlays)i.tvaRemove?i.parent?.removeChild(i)?.destroy():t.push(i);e.tvaOverlays=t}function _findTVAOverlay(e,t){for(const i of t.tvaOverlays)if(i.overlayConfig?.id===e)return i;return null}function _removeAllOverlays(e){if(e.tvaOverlays)for(const t of e.tvaOverlays)t.parent?.removeChild(t)?.destroy();e.tvaOverlays=null}function broadcastDrawOverlays(e){e&&drawOverlays(e);const t=e.document?.actorLink?e.actor?.id:null,i={handlerName:"drawOverlays",args:{tokenId:e.id,actorId:t},type:"UPDATE"};game.socket?.emit("module.token-variants",i)}},634:(e,t,i)=>{i.d(t,{$l:()=>S,Bv:()=>A,Cp:()=>p,F8:()=>c,Gj:()=>y,KW:()=>U,LM:()=>Z,M7:()=>K,OE:()=>z,OJ:()=>M,PO:()=>f,Qx:()=>E,Rz:()=>B,SQ:()=>Q,Tz:()=>C,Uh:()=>H,VC:()=>X,WP:()=>w,YO:()=>h,_l:()=>k,b3:()=>G,cZ:()=>I,e6:()=>J,ez:()=>Y,gA:()=>D,iB:()=>O,mR:()=>_,mX:()=>m,nd:()=>R,nv:()=>q,oK:()=>T,pP:()=>$,qp:()=>V,rc:()=>F,vn:()=>b,w4:()=>W,wu:()=>P,zl:()=>x});var a=i(924),n=i(652),o=i(15),r=i(708),s=i(111);const l=new RegExp(/[^A-Za-z0-9/\\]/g),c=["\\(","\\)","&&","||","\\!"],p={PORTRAIT:"Portrait",TOKEN:"Token",PORTRAIT_AND_TOKEN:"PortraitAndToken",TILE:"Tile",ITEM:"Item",JOURNAL:"JournalEntry",MACRO:"Macro"},f=["Portrait","Token","PortraitAndToken","Tile","Item","JournalEntry","Macro","RollTable"],u={popupOverride:!1,config:!1},d={TOKEN:[],TOKEN_CALLBACKS:[],TOKEN_CONTEXT:{animate:!0},ACTOR:[],ACTOR_CONTEXT:null};function h(){canvas.app.ticker.add((()=>{d.TOKEN.length&&(canvas.scene.updateEmbeddedDocuments("Token",d.TOKEN,d.TOKEN_CONTEXT).then((()=>{for(const e of d.TOKEN_CALLBACKS)e();d.TOKEN_CALLBACKS=[]})),d.TOKEN=[]),0!==d.ACTOR.length&&(d.ACTOR_CONTEXT?Actor.updateDocuments(d.ACTOR,d.ACTOR_CONTEXT):Actor.updateDocuments(d.ACTOR),d.ACTOR=[],d.ACTOR_CONTEXT=null)}))}function g(e,t,i=null){t._id=e,d.ACTOR.push(t),d.ACTOR_CONTEXT=i}async function m(e,{token:t=null,actor:i=null,imgName:n=null,tokenUpdate:o={},actorUpdate:r={},pack:s="",callback:l=null,config:c,animate:p=!0,update:f=null,applyDefaultConfig:u=!0}={}){if(!t&&!i)return void console.warn(game.i18n.localize("token-variants.notifications.warn.update-image-no-token-actor"));if(t=t?.document??t,e&&e.includes("*")||e.includes("{")&&e.includes("}")){const t=await async function(e){let t="data";const i={wildcard:!0};if(/\.s3\./.test(e)){t="s3";const{bucket:a,keyPrefix:n}=FilePicker.parseS3URL(e);a&&(i.bucket=a,e=n)}else e.startsWith("icons/")&&(t="public");try{return(await FilePicker.browse(t,e,i)).files}catch(e){}return[]}(e);t.length&&(e=t[Math.floor(Math.random()*t.length)])}!i&&t.actor&&(i=game.actors.get(t.actor.id));const h=(e,t)=>{const i=foundry.utils.flattenObject(e);TokenDataAdapter.dataToForm(i);const a=foundry.utils.flattenObject(t);let n=foundry.utils.filterObject(i,a);for(let[e,t]of Object.entries(a))if(e.startsWith("flags.")&&!(e in i)){let t=e.split(".");t[t.length-1]="-="+t[t.length-1],n[t.join(".")]=null}return Object.entries(n)};let m=o;e&&(foundry.utils.setProperty(m,"texture.src",e),n&&w(e)===n?foundry.utils.setProperty(m,"flags.token-variants.-=name",null):foundry.utils.setProperty(m,"flags.token-variants.name",n));const y=foundry.utils.mergeObject(function(e,t,i){if(!e)return{};let n={};for(const t of a.Ll.searchPaths)t.config&&e.startsWith(t.text)&&foundry.utils.mergeObject(n,t.config);let o=_(e,t??w(e));if(!foundry.utils.isEmpty(o))for(var r in o=foundry.utils.deepClone(o),delete o.tvImgSrc,delete o.tvImgName,i&&TokenDataAdapter.formToData(i,o),o)r.startsWith("tvTab_")||(n[r]=o[r]);(a.Ll.imgNameContainsDimensions||a.Ll.imgNameContainsFADimensions)&&function(e,t={}){const i=w(e);let n;if(a.Ll.imgNameContainsDimensions){const e=i.match(/_height(.*)_/)?.[1];e&&(t.height=parseFloat(e));const a=i.match(/_width(.*)_/)?.[1];a&&(t.width=parseFloat(a)),n=i.match(/_scale(.*)_/)?.[1],n&&(n=Math.max(parseFloat(n),.2))}a.Ll.imgNameContainsFADimensions&&(n=i.match(/_Scale(\d+)_/)?.[1],n&&(n=Math.max(parseInt(n)/100,.2)));n&&(t["texture.scaleX"]=n,t["texture.scaleY"]=n)}(e,n);return n}(e||t?.texture.src,n,t),c??{}),v=t?.getFlag("token-variants","usingCustomConfig"),k=((e,t)=>{let i=[];if(e)i=e.getFlag("token-variants","defaultConfig")||[];else if(t){const e=t.prototypeToken;"token-variants"in e.flags&&"defaultConfig"in e["token-variants"]&&(i=e["token-variants"].defaultConfig)}return foundry.utils.expandObject(Object.fromEntries(i))})(t);if(foundry.utils.isEmpty(y)&&!v||(m=j(m,k)),foundry.utils.isEmpty(y))v&&(foundry.utils.setProperty(m,"flags.token-variants.-=usingCustomConfig",null),delete m?.flags?.["token-variants"]?.defaultConfig,foundry.utils.setProperty(m,"flags.token-variants.-=defaultConfig",null));else{if(t){foundry.utils.setProperty(m,"flags.token-variants.usingCustomConfig",!0);let e=t.document??t;const i=e.toObject?e.toObject():foundry.utils.deepClone(e),a=h(foundry.utils.mergeObject(i,k),y);foundry.utils.setProperty(m,"flags.token-variants.defaultConfig",a)}else if(i&&!t){foundry.utils.setProperty(m,"flags.token-variants.usingCustomConfig",!0);const e=h(i.prototypeToken instanceof Object?i.prototypeToken:i.prototypeToken.toObject(),y);foundry.utils.setProperty(m,"flags.token-variants.defaultConfig",e)}y.flags||delete y.flags,m=j(m,y)}u||(foundry.utils.setProperty(m,"flags.token-variants.-=usingCustomConfig",null),delete m?.flags?.["token-variants"]?.defaultConfig,foundry.utils.setProperty(m,"flags.token-variants.-=defaultConfig",null)),foundry.utils.isEmpty(m)||(i&&!t&&(TokenDataAdapter.formToData(i.prototypeToken,m),r.prototypeToken=m,s?g(i.id,r,{pack:s}):await(i.document??i).update(r)),t&&(TokenDataAdapter.formToData(t,m),a.Ll.updateTokenProto&&t.actor&&(f?foundry.utils.mergeObject(f,{prototypeToken:m}):t.actorLink?setTimeout((()=>g(t.actor.id,{prototypeToken:m})),500):t.baseActor&&setTimeout((()=>t.baseActor.update({prototypeToken:m})),500)),f?foundry.utils.mergeObject(f,m):t.object?function(e,t,i=null,a=!0){t._id=e,d.TOKEN.push(t),d.TOKEN_CONTEXT={animate:a},i&&d.TOKEN_CALLBACKS.push(i)}(t.id,m,l,p):(await t.update(m,{animate:p}),l())))}async function y(e,t,i=!0,a=""){e&&(i?await(e.document??e).update({img:t}):g(e.id,{img:t},a?{pack:a}:null))}async function v(){for(const e of canvas.tiles.controlled){const t=e.document.getFlag("token-variants","tileName")||e.id;(0,n.n)(t,{callback:async function(t,i){e.document.update({img:t})},searchType:p.TILE})}}function k(e){return"v"===e?game.keyboard.downKeys.has("KeyV"):u[e]}function b(){game.keybindings.register("token-variants","popupOverride",{name:"Popup Override",hint:"When held will trigger popups even when they are disabled.",editable:[{key:"ShiftLeft"}],onDown:()=>{u.popupOverride=!0},onUp:()=>{u.popupOverride=!1},restricted:!1,precedence:CONST.KEYBINDING_PRECEDENCE.NORMAL}),game.keybindings.register("token-variants","config",{name:"Config",hint:"When held during a mouse Left-Click of an Image or an Active Affect will display a configuration window.",editable:[{key:"ShiftLeft"}],onDown:()=>{u.config=!0},onUp:()=>{u.config=!1},restricted:!1,precedence:CONST.KEYBINDING_PRECEDENCE.NORMAL}),game.keybindings.register("token-variants","showArtSelectPortrait",{name:"Show Art Select: Portrait",hint:"Brings up an Art Select pop-up to change the portrait images of the selected tokens.",editable:[{key:"Digit1",modifiers:["Shift"]}],onDown:()=>{for(const e of canvas.tokens.controlled){const t=e.actor;t&&(0,n.n)(t.name,{callback:async function(e,i){await y(t,e)},searchType:p.PORTRAIT,object:t})}a.Ll.tilesEnabled&&0===canvas.tokens.controlled.length&&v()},restricted:!0,precedence:CONST.KEYBINDING_PRECEDENCE.NORMAL}),game.keybindings.register("token-variants","showArtSelectToken",{name:"Show Art Select: Token",hint:"Brings up an Art Select pop-up to change the token images of the selected tokens.",editable:[{key:"Digit2",modifiers:["Shift"]}],onDown:()=>{for(const e of canvas.tokens.controlled)(0,n.n)(e.name,{callback:async function(t,i){m(t,{actor:e.actor,imgName:i,token:e})},searchType:p.TOKEN,object:e});a.Ll.tilesEnabled&&0===canvas.tokens.controlled.length&&v()},restricted:!0,precedence:CONST.KEYBINDING_PRECEDENCE.NORMAL}),game.keybindings.register("token-variants","showArtSelectGeneral",{name:"Show Art Select: Portrait+Token",hint:"Brings up an Art Select pop-up to change both Portrait and Token images of the selected tokens.",editable:[{key:"Digit3",modifiers:["Shift"]}],onDown:()=>{for(const e of canvas.tokens.controlled){const t=e.actor;(0,n.n)(e.name,{callback:async function(i,a){t&&await y(t,i),m(i,{actor:e.actor,imgName:a,token:e})},searchType:p.PORTRAIT_AND_TOKEN,object:e})}a.Ll.tilesEnabled&&0===canvas.tokens.controlled.length&&v()},restricted:!0,precedence:CONST.KEYBINDING_PRECEDENCE.NORMAL}),game.keybindings.register("token-variants","openGlobalMappings",{name:"Open Global Effect Configurations",hint:"Brings up the settings window for Global Effect Configurations",editable:[{key:"KeyG",modifiers:["Shift"]}],onDown:()=>{const e=game.settings.get("core",DefaultTokenConfig.SETTING),t=new foundry.data.PrototypeToken(e),i=new TokenDocument(t,{actor:null});new o.A(i,{globalMappings:!0}).render(!0)},restricted:!0,precedence:CONST.KEYBINDING_PRECEDENCE.NORMAL}),game.keybindings.register("token-variants","compendiumMapper",{name:"Compendium Mapper",hint:"Opens Compendium Mapper",editable:[{key:"KeyM",modifiers:["Shift"]}],onDown:()=>{(new r.A).render(!0)},restricted:!0,precedence:CONST.KEYBINDING_PRECEDENCE.NORMAL}),game.keybindings.register("token-variants","toggleTemplate",{name:"Toggle Template Dialog",hint:"Brings up a dialog from which you can toggle templates on currently selected tokens.",editable:[],onDown:s.hf,restricted:!0,precedence:CONST.KEYBINDING_PRECEDENCE.NORMAL})}function _(e,t){e=G(e),t||(t=w(e));return(a.Ll.tokenConfigs||[]).flat().find((i=>i.tvImgSrc==e&&i.tvImgName==t))??{}}function O(e,t,i){const n=(a.Ll.tokenConfigs||[]).flat(),o=n.findIndex((i=>i.tvImgSrc==e&&i.tvImgName==t));let r=!i||0===Object.keys(i).length;return r||(i.tvImgSrc=e,i.tvImgName=t),-1==o||r?-1!=o&&r?n.splice(o,1):r||n.push(i):n[o]=i,(0,a.Xx)({tokenConfigs:n}),!r}function w(e){return e?G(e).split("\\").pop().split("/").pop().split(".").slice(0,-1).join("."):""}function S(e){return e?G(e).split("\\").pop().split("/").pop():""}function T(e){return G(e).match(/(.*)[\/\\]/)[1]||""}function C(e){return e.replace(l,"").toLowerCase()}function x(e){return J(e).replace(l,"").toLowerCase()}function E(e){return e.split(/\W/).map((e=>C(e))).filter((e=>""!=e))}function P(e){var t=e.split(".");return t=t[t.length-1].toLowerCase(),["jpg","jpeg","png","svg","webp","gif"].includes(t)}function I(e){var t=e.split(".");return t=t[t.length-1].toLowerCase(),["mp4","ogg","webm","m4v"].includes(t)}async function M(e,t){return new Promise((async(i,a)=>{if("undefined"==typeof ForgeVTT||!ForgeVTT.usingTheForge)return i({});const n=`${ForgeVTT.FORGE_URL}/api/assets/browse`,o=new XMLHttpRequest;o.withCredentials=!0,o.open("POST",n),o.setRequestHeader("Access-Key",t),o.setRequestHeader("X-XSRF-TOKEN",await ForgeAPI.getXSRFToken()),o.responseType="json",o.onreadystatechange=()=>{4===o.readyState&&i(o.response)},o.onerror=e=>{i({code:500,error:e.message})};let r={path:e,options:{recursive:!0}};r=JSON.stringify(r),o.setRequestHeader("Content-type","application/json; charset=utf-8"),o.send(r)}))}function D(e,t){return(t=(t=t||a.Ll.searchFilters)[e]?t[e]:{include:"",exclude:"",regex:""}).regex&&(t.regex=new RegExp(t.regex)),t}function A(e){const t=e||a.Ll.permissions,i=game.user.role;return t.popups[i]||t.portrait_right_click[i]||t.image_path_button[i]||t.hudFullAccess[i]}async function F(e,t,i=40){e.mesh&&e.mesh.texture?t(e):--i>1&&new Promise((e=>setTimeout(e,1))).then((()=>F(e,t,i)))}function R(e){let t=[];return e?(e.forEach((e=>{t=t.concat(e)})),t):t}function j(e,t={},{insertKeys:i=!0,insertValues:a=!0,overwrite:n=!0,recursive:o=!0,inplace:r=!0,enforceTypes:s=!1}={},l=0){if(t=t||{},!(e instanceof Object&&t instanceof Object))throw new Error("One of original or other are not Objects!");const c={insertKeys:i,insertValues:a,overwrite:n,recursive:o,inplace:r,enforceTypes:s};0===l&&(r||(e=foundry.utils.deepClone(e)),Object.keys(e).some((e=>/\./.test(e)))&&(e=foundry.utils.expandObject(e)),Object.keys(t).some((e=>/\./.test(e)))&&(t=foundry.utils.expandObject(t)));for(let i of Object.keys(t)){const a=t[i];e.hasOwnProperty("-="+i)&&(e[i]=e["-="+i],delete e["-="+i]),e.hasOwnProperty(i)?L(e,i,a,c,l+1):N(e,i,a,c,l+1)}return e}function N(e,t,i,{insertKeys:a,insertValues:n}={},o){if(i?.constructor===Object)return void(e[t]=j({},i,{insertKeys:!0,inplace:!0}));(o<=1&&a||o>1&&n)&&(e[t]=i)}function L(e,t,i,{insertKeys:a,insertValues:n,enforceTypes:o,overwrite:r,recursive:s}={},l){const c=e[t],p=foundry.utils.getType(i),f=foundry.utils.getType(c);if("Object"===p&&"Object"===f&&s)return j(c,i,{insertKeys:a,insertValues:n,overwrite:r,inplace:!0,enforceTypes:o},l);if(r){if("undefined"!==f&&p!==f&&o)throw new Error("Mismatched data types encountered during object merge.");e[t]=i}}async function H(e,{actor:t,token:i,tvaUpdate:a}={}){const n=ChatMessage.getSpeaker(),o=game.user.character;i=i?.object||i||(canvas.ready?canvas.tokens.get(n.token):null),t=t||i?.actor||game.actors.get(n.actor);const r=async function(){}.constructor;try{const s=r("speaker","actor","token","character","tvaUpdate",`${e}`);await s.call(null,n,t,i,o,a)}catch(e){ui.notifications.error("There was an error in your script syntax. See the console (F12) for details"),console.error(e)}}async function U(e,t){t=t?.object||t,game.macros.find((t=>t.name===e))?.execute({token:t})}async function X(e,t,i="apply"){if(e=e.object??e,game.modules.get("tokenmagic")?.active&&e.document){const a=TokenMagic.getPreset(t);a&&("apply"===i?await TokenMagic.addUpdateFilters(e,a):"remove"===i&&await TokenMagic.deleteFilters(e,t))}}async function B(e,t){e=e.object??e,game.modules.get("tokenmagic")?.active&&e.document&&(TokenMagic.hasFilterId(e,t)?X(e,t,"remove"):X(e,t,"apply"))}async function W(e,t,i="apply"){if(game.modules.get("dfreds-convenient-effects")?.active){if(!t.apply&&!t.remove)return;if(!t.apply||!t.remove){if("apply"!==i)return;t.remove&&(i="remove")}let a=e.actor?.uuid;a&&("apply"===i?await game.dfreds.effectInterface.addEffect({effectName:t.name,uuid:a,origin:"token-variants",overlay:!1}):await game.dfreds.effectInterface.removeEffect({effectName:t.name,uuid:a}))}}async function z(e,t){if(game.modules.get("dfreds-convenient-effects")?.active){let i=(e.document??e).actor?.uuid;await game.dfreds.effectInterface.toggleEffect(t,{uuids:[i],overlay:!1})}}class TokenDataAdapter{static dataToForm(e){"texture.scaleX"in e&&(e.scale=Math.abs(e["texture.scaleX"]),e.mirrorX=e["texture.scaleX"]<0),"texture.scaleY"in e&&(e.scale=Math.abs(e["texture.scaleY"]),e.mirrorY=e["texture.scaleY"]<0)}static formToData(e,t){if("scale"in t||"mirrorX"in t||"mirrorY"in t){const i=e.document?e.document:e;"scale"in t||(t.scale=Math.abs(i.texture.scaleX)),"mirrorX"in t||(t.mirrorX=i.texture.scaleX<0),"mirrorY"in t||(t.mirrorY=i.texture.scaleY<0),foundry.utils.setProperty(t,"texture.scaleX",t.scale*(t.mirrorX?-1:1)),foundry.utils.setProperty(t,"texture.scaleY",t.scale*(t.mirrorY?-1:1)),["scale","mirrorX","mirrorY"].forEach((e=>delete t[e]))}}}function V(e,t,i,a){for(const t of i)a.includes(t)||e.add(t);for(const e of a)i.includes(e)||t.add(e)}async function K(e){const t=e.nameForge;if(t?.randomize&&t?.models){const e=game.modules.get("nameforge");if(e?.active){const i=[];for(const a of t.models){const t=foundry.utils.getProperty(e.models,a);if(t){const a=await e.api.createModel(t);a&&i.push(e.api.generateName(a)[0])}}return i[Math.floor(Math.random()*i.length)]}}return null}async function Y(e,t){let i=function(e,{scale:t=3,width:i=null,height:a=null}={}){if(!canvas.ready||!e)return;i=i??e.texture.width,a=a??e.texture.height,t*=Math.min(i/e.texture.width,a/e.texture.height);const n=canvas.app.renderer,o={...canvas.scene._viewPosition};n.resize(i??n.screen.width,a??n.screen.height),i=canvas.screenDimensions[0]=n.screen.width,a=canvas.screenDimensions[1]=n.screen.height,canvas.stage.position.set(i/2,a/2),canvas.pan({x:e.center.x,y:e.center.y,scale:t});const r=PIXI.RenderTexture.create({width:i,height:a,resolution:e.texture.resolution}),s=canvas.stage.enableTempParent();canvas.stage.updateTransform(),canvas.stage.disableTempParent(s);let l=[e.mesh];e.tvaOverlays&&(l=l.concat(e.tvaOverlays));l.sort((e=>e.sort));for(const e of l)n.render(e,{renderTexture:r,skipUpdateTransform:!0,clear:!1});return canvas._onResize(),canvas.pan(o),r}(e,t);if(i){const e=canvas.app.renderer.extract.base64(i,"image/webp",1);let a=await fetch(e),n=await a.blob();const o=t.name+".webp";let r=new File([n],o,{type:"image/webp"});await FilePicker.upload("data",t.path,r,{})}}function q(e,t=!1,i=!1){if(e.isToken)return i?[e.token]:e.token.object?[e.token.object]:[];const a=[];return game.scenes.forEach((i=>i.tokens.forEach((i=>{i.actorId===e.id&&(t&&i.actorLink?a.push(i):t||a.push(i))})))),i?a:a.map((e=>e.object)).filter((e=>e))}function $(e){return PIXI.utils.string2hex(e)}function G(e){try{return decodeURI(e)}catch(t){return console.warn("URI Component not decodable: "+e),e}}function J(e){try{return decodeURIComponent(e)}catch(t){return console.warn("URI Component not decodable: "+e),e}}function Q(e,t){const i={};for(const a of e){const e=t.findIndex((e=>e.label===a.label&&e.group===a.group));-1===e?t.push(a):(i[t.id]=a.id,t[e].tokens?.length&&(a.tokens||(a.tokens=[]),t[e].tokens.forEach((e=>{a.tokens.includes(e)||a.tokens.push(e)}))),t[e]=a)}return t.forEach((e=>{let t=e.overlayConfig?.parentID;t&&t in i&&(e.overlayConfig.parentID=i[t])})),t}function Z(){return!game.users.filter((e=>e.isGM&&(e.active||e.isActive))).some((e=>e.id<game.user.id))}},652:(e,t,i)=>{i.d(t,{D:()=>h,n:()=>m});var a=i(924),n=i(771),o=i(634),r=i(605),s=i(309),l=i(853),c=i(21),p=i(654),f=i(471),u=i(111);let d=!1;function h(){return d}let g=[];async function m(e,{callback:t=null,searchType:i=o.Cp.PORTRAIT_AND_TOKEN,object:a=null,force:r=!1,preventClose:s=!1,image1:c="",image2:p="",displayMode:f=n.CV.IMAGE_DISPLAY.NONE,multipleSelection:u=!1,searchOptions:d={},allImages:h=null}={}){if((0,l.Ie)())return;const g=Object.values(ui.windows).filter((e=>e instanceof n.CV));n.CV.executing||!r&&0!==g.length?(0,n.Tp)(e,{callback:t,searchType:i,object:a,preventClose:s,searchOptions:d,allImages:h}):(n.CV.executing=!0,h||(h=await(0,l.RY)(e,{searchType:i,searchOptions:d})),new n.CV(e,{allImages:h,searchType:i,callback:t,object:a,preventClose:s,image1:c,image2:p,displayMode:f,multipleSelection:u,searchOptions:d}).render(!0))}(0,c.R7)("main","ready",(async function(){if(!d){r.tp.loading=FontConfig.loadFont("fontAwesome",{editor:!1,fonts:[{urls:["fonts/fontawesome/webfonts/fa-solid-900.ttf"]}]}),g.push((()=>{new Promise((e=>setTimeout(e,500))).then((()=>{for(const e of canvas.tokens.placeables)(0,r.uv)(e),a.Ll.disableEffectIcons?(0,o.rc)(e,(e=>{e.effects.removeChildren().forEach((e=>e.destroy())),e.effects.bg=e.effects.addChild(new PIXI.Graphics),e.effects.overlay=null})):a.Ll.filterEffectIcons&&(0,o.rc)(e,(e=>{e.drawEffects()}))}))})),(0,o.Bv)()&&(0,l.Vl)(),(0,c.Hr)(),(0,o.YO)(),(0,c.R7)("Search","renderArtSelect",(()=>{n.CV.executing=!1})),game.socket?.on("module.token-variants",(e=>{if("forgeSearchPaths"===e.handlerName&&"UPDATE"===e.type){if(!game.user.isGM)return;if(!(0,o.LM)())return;(0,a.Xx)({forgeSearchPaths:e.args})}else if("drawOverlays"===e.handlerName&&"UPDATE"===e.type){if(e.args.all){if(canvas.scene.id!==e.args.sceneId)for(const e of canvas.tokens.placeables)(0,r.uv)(e)}else if(e.args.actorId){const t=game.actors.get(e.args.actorId);t&&t.getActiveTokens(!0)?.forEach((e=>(0,r.uv)(e)))}else if(e.args.tokenId){const t=canvas.tokens.get(e.args.tokenId);t&&(0,r.uv)(t)}}else if("effectMappings"===e.handlerName){if(!game.user.isGM)return;if(!(0,o.LM)())return;const t=e.args,i=game.scenes.get(t.sceneId)?.tokens.get(t.tokenId);i&&(0,s.he)(i,{added:t.added,removed:t.removed})}})),d=!0;for(const e of g)e();g=[]}}),{once:!0}),(0,c.R7)("main","init",(function(){(0,a.Nq)(),(0,p.tr)(),(0,o.vn)();const e={cacheImages:l.Vl,doImageSearch:l.RY,doRandomSearch:l.v_,getTokenEffects:s.AI,showArtSelect:m,updateTokenImage:o.mX,exportSettingsToJSON:a.XJ,assignUserSpecificImage:f.kT,assignUserSpecificImageToSelected:f.ol,unassignUserSpecificImage:f.Nu,unassignUserSpecificImageFromSelected:f.kt,setOverlayVisibility:s.ps,toggleTemplateDialog:u.hf,toggleTemplate:s.ju,toggleTemplateOnSelected:s.l7,drawOverlays:r.uv,broadcastDrawOverlays:r.R3,TVA_CONFIG:a.Ll};Object.defineProperty(e,"hooks",{get:()=>foundry.utils.deepClone(c.in),configurable:!0}),Object.defineProperty(e,"wrappers",{get:()=>foundry.utils.deepClone(p._3),configurable:!0}),game.modules.get("token-variants").api=e}))},654:(e,t,i)=>{i.d(t,{_3:()=>k,tr:()=>O,dv:()=>b,Ig:()=>_});var a=i(309),n=i(924);const o="EffectIcons";async function r(e,...t){let i=await e(...t);return this.effects.visible=this.hover,i}async function s(...e){this.effects.removeChildren().forEach((e=>e.destroy())),this.effects.bg=this.effects.addChild(new PIXI.Graphics),this.effects.overlay=null}async function l(e,...t){let i=await e(...t);if(i&&i.combat&&i.turns){const e=i.combat;for(const t of i.turns){const i=e.combatants.find((e=>e.id===t.id));if(i)if(n.Ll.disableEffectIcons)t.effects=new Set;else if(n.Ll.filterEffectIcons){const e=p(i.token);if(t.effects=new Set,i.token&&(i.token.effects.forEach((e=>t.effects.add(e))),i.token.overlayEffect&&t.effects.add(i.token.overlayEffect)),i.actor)for(const a of i.actor.temporaryEffects)a.statuses.has(CONFIG.specialStatusEffects.DEFEATED)||a.icon&&!e.includes(a.name??a.label)&&t.effects.add(a.icon)}}}return i}async function c(...e){this.effects.renderable=!1,this.effects.removeChildren().forEach((e=>e.destroy())),this.effects.bg=this.effects.addChild(new PIXI.Graphics),this.effects.bg.zIndex=-1,this.effects.overlay=null;let t=this.actor?.temporaryEffects||[],i=t.findLast((e=>e.img&&e.getFlag("core","overlay")));if(n.Ll.displayEffectIconsOnHover&&(this.effects.visible=this.hover),t.length){const e=p(this.document);t=t.filter((t=>!e.includes(t.name)))}const a=[];for(const[e,n]of t.entries()){if(!n.img)continue;const t=n===i?this._drawOverlay(n.img,n.tint):this._drawEffect(n.img,n.tint);a.push(t.then((t=>{t&&(t.zIndex=e)})))}await Promise.allSettled(a),this.effects.sortChildren(),this.effects.renderable=!0,this.renderFlags.set({refreshEffects:!0})}function p(e){let t=n.Ll.filterIconList;if(n.Ll.filterCustomEffectIcons){const i=(0,a.mU)(e);i&&(t=t.concat(i.map((e=>e.expression))))}return t}const f="HideElement";function u(e,...t){return e(...t),""}function d(...e){}var h=i(683),g=i(715);const m="HUD";function y(e,...t){if(async function(){const{actor:e,variants:t}=h.d;e&&(t?.length?e.setFlag("token-variants","variants",t):e.unsetFlag("token-variants","variants"));h.d.actor=null,h.d.variants=null}(),!g.l.active||"hud"!==g.l.mode)return e(...t)}var v=i(471);const k={};function b(e,t,i,a="WRAPPER"){"function"==typeof libWrapper&&(e in k||(k[e]={}),t in k[e]||(k[e][t]=libWrapper.register("token-variants",t,i,a)))}function _(e,t){"function"==typeof libWrapper&&e in k&&t in k[e]&&(libWrapper.unregister("token-variants",k[e][t]),delete k[e][t])}function O(){(0,v.dd)(),_(o,"Token.prototype.drawEffects"),_(o,"CombatTracker.prototype.getData"),n.Xi[o]&&(n.Ll.disableEffectIcons||!n.Ll.filterEffectIcons||["pf1e","pf2e"].includes(game.system.id)?n.Ll.disableEffectIcons?b(o,"Token.prototype._drawEffects",s,"OVERRIDE"):n.Ll.displayEffectIconsOnHover&&b(o,"Token.prototype.drawEffects",r,"WRAPPER"):b(o,"Token.prototype.drawEffects",c,"OVERRIDE"),(n.Ll.disableEffectIcons||n.Ll.filterCustomEffectIcons)&&b(o,"CombatTracker.prototype.getData",l,"WRAPPER")),_(m,"TokenHUD.prototype.clear"),n.Xi[m]&&b(m,"TokenHUD.prototype.clear",y,"MIXED"),_(f,"Token.prototype._getTooltipText"),n.Xi[f]&&n.Ll.hideElevationTooltip&&b(f,"Token.prototype._getTooltipText",u,"WRAPPER"),_(f,"Token.prototype._refreshBorder"),n.Xi[f]&&n.Ll.hideTokenBorder&&b(f,"Token.prototype._refreshBorder",d,"OVERRIDE")}},683:(e,t,i)=>{i.d(t,{d:()=>u,R:()=>d});var a=i(634),n=i(126),o=i(15),r=i(924),s=i(179),l=i(207);class RandomizerConfig extends FormApplication{constructor(e){super({},{}),this.actor=game.actors.get(e.actorId)}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-token-flags",classes:["sheet"],template:"modules/token-variants/token-variants/templates/randomizerConfig.html",resizable:!0,minimizable:!1,title:"Randomizer",width:500})}async getData(e){const t=super.getData(e),i=this.actor.getFlag("token-variants","randomizerSettings")||{};return t.randomizer=i,t.hasSettings=!foundry.utils.isEmpty(i),t.nameForgeActive=game.modules.get("nameforge")?.active,t.randomizer.nameForge?.models&&Array.isArray(t.randomizer.nameForge.models)&&(t.randomizer.nameForge.models=t.randomizer.nameForge.models.join(",")),t}activateListeners(e){super.activateListeners(e),e.querySelector(".selectNameForgeModels").click(this._selectNameForgeModels.bind(this));const t=e.querySelector('input[name="randomizer.tokenName"]'),i=e.querySelector('input[name="randomizer.actorName"]');t.change((()=>{t.is(":checked")&&i.prop("checked",!1)})),i.change((()=>{i.is(":checked")&&t.prop("checked",!1)}))}_selectNameForgeModels(e){const t=e.target.siblings("input"),i=t.val().split(","),a=function(e,t){return`\n      <div class="form-group">\n        <label>${e}</label>\n        <div class="form-fields">\n            <input type="checkbox" name="model" value="${t}" data-dtype="Boolean" ${i?.find((e=>e===t))?"checked":""}>\n        </div>\n      </div>\n      `};let n='<form style="overflow-y: scroll; height:400px;">';const o=game.modules.get("nameforge").models;for(const[e,t]of Object.entries(o.defaultModels))n+=a(t.name,"defaultModels."+e);for(const[e,t]of Object.entries(o.userModels))n+=a(t.name,"userModels."+e);n+="</form>",new Dialog({title:"Name Forge Models",content:n,buttons:{Ok:{label:"Select",callback:async e=>{const i=[];e.querySelector('input[type="checkbox"]').each((function(){this.checked&&i.push(this.value)})),t.val(i.join(","))}}}}).render(!0)}async _updateObject(e,t){if("remove"===e.submitter.value)await this.actor.unsetFlag("token-variants","randomizerSettings");else{const e=foundry.utils.expandObject(t);e.randomizer.nameForge?.models&&(e.randomizer.nameForge.models=e.randomizer.nameForge.models.split(",")),this.actor.setFlag("token-variants","randomizerSettings",e.randomizer)}}}var c=i(853);function p({className:e,iconClass:t,labelText:i,onClick:a}){const n=new ElementBuilder("i").className(t).build(),o=new ElementBuilder("label").textContent(i).build(),r=new ElementBuilder("button").className(e).type("button").children([n,o]);return a&&r.on("click",a),r.build()}function f({className:e="token-variants-side-search",placeholder:t=""}){return new ElementBuilder("input").className(e).type("text").attr("placeholder",t).build()}const u={variants:null,actor:null};async function d(e,t,i,n="",s=null){!function(e){if(r.Ll.permissions.statusConfig[game.user.role]&&e.actorId&&game.actors.get(e.actorId)){const t=document.querySelector('.control-icon[data-action="effects"]');t&&t.find("img:first").click((t=>{t.preventDefault(),(0,a._l)("config")&&(t.stopPropagation(),new o.A(e).render(!0))}));const i=document.querySelector('.control-icon[data-action="visibility"]');i&&i.find("img").click((t=>{t.preventDefault(),(0,a._l)("config")&&(t.stopPropagation(),new o.A(e,{createMapping:{label:"In Combat",expression:"token-variants-visibility"}}).render(!0))}));const n=document.querySelector('.control-icon[data-action="combat"]');n&&n.find("img").click((t=>{t.preventDefault(),(0,a._l)("config")&&(t.stopPropagation(),new o.A(e,{createMapping:{label:"In Combat",expression:"token-variants-combat"}}).render(!0))}));const r=document.querySelector(".status-effects");r&&r.find("img").click((t=>{if(t.preventDefault(),(0,a._l)("config")){t.stopPropagation();let i=t.target.data("tooltip");"pf2e"===game.system.id&&(i=t.target.closest("picture").attr("title")),new o.A(e,{createMapping:{label:i,expression:i}}).render(!0)}}))}}(i);const c=r.Ll.hud,u=r.Ll.permissions.hudFullAccess[game.user.role],d=r.Ll.permissions.hud[game.user.role];if(!c.enableSideMenu||!d&&!u||i.flags["token-variants"]?.disableHUDButton)return;const m=game.actors.get(i.actorId);if(r.Ll.worldHud.disableIfTHWEnabled&&game.modules.get("token-hud-wildcard")?.active&&m&&m.prototypeToken.randomImg)return;const y=new ElementBuilder("button").type("button").className("control-icon").dataset("action","token-variants-side-selector").appendChild(new ElementBuilder("div").className("control-icon").dataset("action","token-variants-side-selector").appendChild(new ElementBuilder("img").attr("id","token-variants-side-button").attr("src","modules/token-variants/token-variants/img/token-images.svg").attr("width","36").attr("height","36").attr("title","Left-click: Image Menu&#013;Right-click: Search & Additional settings").build()).build()).on("click",(e=>async function(e,t){const i=e.target.closest(".control-icon");i.closest("div.right").find("div.control-icon.effects").removeClass("active"),i.closest("div.right").find(".status-effects").removeClass("active"),i.querySelector(".contextmenu").remove(),i.toggleClass("active");let a=i.querySelector(".token-variants-wrap");if(i.hasClass("active")){if(!a.length){if(a=await g(t),!a)return;i.querySelector("img").after(a)}a.addClass("active")}else a.removeClass("active")}(e,i))).when(u,(e=>e.on("contextmenu",(e=>function(e,t,i,n){const r=e.target.closest(".control-icon");r.hasClass("active")||r.addClass("active");if(r.querySelector(".contextmenu").length)r.querySelector(".contextmenu").remove(),r.removeClass("active").trigger("click");else{r.querySelector(".token-variants-wrap.images").removeClass("active");const e=function(){const e=new ElementBuilder("div").className("token-variants-context-menu active").children([f({}),p({className:"flags",iconClass:"fab fa-font-awesome-flag",labelText:"Flags"}),p({className:"file-picker",iconClass:"fas fa-file-import fa-fw",labelText:"Browse Folders"}),p({className:"effectConfig",iconClass:"fas fa-sun",labelText:"Mappings"}),p({className:"randomizerConfig",iconClass:"fas fa-dice",labelText:"Randomizer"})]).build();return new ElementBuilder("div").className("token-variants-wrap contextmenu active").child(e).build()}();r.append(e),e.find(".token-variants-side-search").on("keyup",(e=>async function(e,t){if(e.preventDefault(),e.stopPropagation(),("Enter"===e.key||13===e.keyCode)&&e.target.value.length>=3){const i=e.target.closest(".control-icon");i.querySelector(".token-variants-wrap").remove();const a=await g(t,e.target.value);a&&(a.addClass("active"),i.append(a))}}(e,n))).on("click",(e=>{e.preventDefault(),e.stopPropagation()})),e.find(".flags").click((e=>{const t=canvas.tokens.get(n._id);t&&(e.preventDefault(),e.stopPropagation(),new l.A(t).render(!0))})),e.find(".file-picker").click((async e=>{e.preventDefault(),e.stopPropagation(),new FilePicker({type:"imagevideo",callback:async(e,t)=>{let i=(await FilePicker.browse(t.activeSource,t.result.target)).files.filter((e=>(0,a.wu)(e)||(0,a.cZ)(e)));if(i.length){r.querySelector(".token-variants-wrap").remove();const e=await g(n,"",i);e&&(e.addClass("active"),r.append(e))}}}).render(!0)})),e.find(".effectConfig").click((e=>{new o.A(n).render(!0)})),e.find(".randomizerConfig").click((e=>{new RandomizerConfig(n).render(!0)}))}}(e,0,0,i))))).build(),v=t.querySelector(".col.right");v.appendChild(y),v.click(h)}function h(e){switch(e.target.closest(".control-icon").attr("data-action")){case"effects":case"thwildcard-selector":break;default:return}e.target.closest("div.right").find('.control-icon[data-action="token-variants-side-selector"]').removeClass("active"),e.target.closest("div.right").find(".token-variants-wrap").removeClass("active")}async function g(e,t="",i=null){const o=r.Ll.hud,l=r.Ll.worldHud,p=r.Ll.permissions.hudFullAccess[game.user.role],f=r.Ll.permissions.hud[game.user.role],d=game.actors.get(e.actorId);let h=[],g=[],k=new Set;const b=e=>{k.has(e.path)?h.find((t=>t.path===e.path&&t.name===e.name))||h.push(e):(h.push(e),k.add(e.path))};if(g=v(d),i)h=i.map((e=>({path:(0,a.b3)(e),name:(0,a.WP)(e)})));else{if(!t&&(e.texture?.src&&e.texture?.src!==CONST.DEFAULT_TOKEN&&b({path:(0,a.b3)(e.texture.src),name:e.flags?.["token-variants"]?.name??(0,a.WP)(e.texture.src)}),d)){const e=d.prototypeToken?.flags["token-variants"]?.randomImgDefault||d.prototypeToken?.flags["token-hud-wildcard"]?.default||"";if(e&&b({path:(0,a.b3)(e),name:(0,a.WP)(e)}),(p||f)&&g.forEach((e=>{for(const t of e.names)b({path:(0,a.b3)(e.imgSrc),name:t})})),p||f){const e=d.getFlag("token-variants","directory");if(e){let t;try{let i=e.path,a=e.source,n="";a.startsWith("s3:")&&(n=a.substring(3,a.length),a="s3");t=(await FilePicker.browse(a,i,{type:"imagevideo",bucket:n})).files}catch(e){t=[]}t=t.forEach((e=>{((0,a.wu)(e)||(0,a.cZ)(e))&&b({path:(0,a.b3)(e),name:(0,a.WP)(e)})}))}}if((p||f)&&l.includeWildcard&&!l.displayOnlySharedImages){const e=d.prototypeToken.texture.src;if(d.prototypeToken.randomImg)(await d.getTokenImages()).filter((e=>!e.includes("*"))).forEach((e=>{b({path:(0,a.b3)(e),name:(0,a.WP)(e)})}));else if(e.includes("*")||e.includes("{")||e.includes("}")){const e=async()=>{if(d._tokenImages)return d._tokenImages;let e="data",t=d.prototypeToken.texture.src;const i={wildcard:!0};if(/\.s3\./.test(t)){e="s3";const{bucket:a,keyPrefix:n}=FilePicker.parseS3URL(t);a&&(i.bucket=a,t=n)}else t.startsWith("icons/")&&(e="public");try{const a=await FilePicker.browse(e,t,i);d._tokenImages=a.files}catch(e){d._tokenImages=[]}return d._tokenImages};(await e()).filter((e=>!e.includes("*")&&((0,a.wu)(e)||(0,a.cZ)(e)))).forEach((e=>{b({path:(0,a.b3)(e),name:(0,a.WP)(e)})}))}}}if(p){let i;if(t?i=t.length>2?t:null:l.displayOnlySharedImages||d?.getFlag("token-variants","disableNameSearch")||e.name.length>2&&(i=e.name),i){let e=await(0,c.RY)(i,{searchType:a.Cp.TOKEN,searchOptions:{keywordSearch:l.includeKeywords}});e&&e.forEach((e=>{e.forEach((e=>b(e)))}))}}}let _="";_=e.flags["token-variants"]&&e.flags["token-variants"].name?e.flags["token-variants"].name:(0,a.WP)(e.texture.src);let O=[];const w=(r.Ll.tokenConfigs||[]).flat(),S=canvas.tokens.get(e._id).document.getFlag("token-variants","userMappings")||{};for(const t of h){const i=(0,a.wu)(t.path),n=(0,a.cZ)(t.path),o=Boolean(w.find((e=>e.tvImgSrc===t.path&&e.tvImgName===t.name)));let s=!1;r.Ll.permissions.hudFullAccess[game.user.role]&&g.forEach((e=>{e.imgSrc===t.path&&e.names.includes(t.name)&&(s=!0)}));const[l,c]=m(S,t.path,t.name);O.push({route:t.path,name:t.name,used:t.path===e.texture.src&&t.name===_,img:i,vid:n,unknownType:!i&&!n,shared:s,hasConfig:o,title:l,style:game.user.isGM&&c?"box-shadow: "+c+";":null})}const T=o.displayAsImage,C=o.imageOpacity/100,x=$(await renderTemplate("modules/token-variants/token-variants/templates/sideSelect.html",{imagesParsed:O,imageDisplay:T,imageOpacity:C,tokenHud:!0}));return x.find("video").hover((function(){r.Ll.playVideoOnHover&&(this.play(),this.siblings(".fa-play").hide())}),(function(){r.Ll.pauseVideoOnHoverOut&&(this.pause(),this.currentTime=0,this.siblings(".fa-play").show())})),x.find(".token-variants-button-select").click((t=>async function(e,t){e.preventDefault(),e.stopPropagation();const i=canvas.tokens.controlled.find((e=>e.document.id===t));if(!i)return;const o=r.Ll.worldHud,s=e.target.closest(".token-variants-button-select"),l=s.attr("data-name"),c=s.attr("data-filename");if(!l||!c)return;if((0,a._l)("config")&&game.user.isGM){const e=e=>{const t=imgbutton.querySelector(".fa-cog");e?t.addClass("active"):t.removeClass("active")};new n.A(i,{},l,c,e).render(!0)}else if(i.document.texture.src===l){let e=i.document.getFlag("token-variants","name");e||(e=(0,a.WP)(i.document.texture.src)),e!==c&&(await(0,a.mX)(l,{token:i,imgName:c,animate:o.animate}),i.actor&&o.updateActorImage&&(o.useNameSimilarity?y(l,c,i.actor):(0,a.Gj)(i.actor,l,{imgName:c})))}else await(0,a.mX)(l,{token:i,imgName:c,animate:o.animate}),i.actor&&o.updateActorImage&&(o.useNameSimilarity?y(l,c,i.actor):(0,a.Gj)(i.actor,l,{imgName:c}))}(t,e._id))),p&&x.find(".token-variants-button-select").on("contextmenu",(t=>async function(e,t){e.preventDefault(),e.stopPropagation();let i=canvas.tokens.controlled.find((e=>e.document.id===t));if(!i)return;const n=e.target.closest(".token-variants-button-select"),o=n.attr("data-name"),r=n.attr("data-filename");if(!o||!r)return;if((0,a._l)("config")&&game.user.isGM){const e=(e,t)=>{const i=e.document.getFlag("token-variants","userMappings")||{},a=n.attr("data-filename"),[o,r]=m(i,t,a);n.closest(".token-variants-wrap").find(`.token-variants-button-select[data-name='${t}']`).css("box-shadow",r).prop("title",o)};new s.A(i,o,e).render(!0)}else if(i.actor){let e=game.actors.get(i.actor.id),t=v(e),a=!1,n=!1;for(let e of t)if(e.imgSrc===o){let t=e.names.filter((e=>e!=e));0===t.length?a=!0:t.length===e.names.length&&t.push(r),e.names=t,n=!0;break}a?t=t.filter((e=>e.imgSrc!==o)):n||t.push({imgSrc:o,names:[r]}),function(e,t){u.variants=t,u.actor=e}(e,t),imgbutton.querySelector(".fa-share").toggleClass("active")}}(t,e._id))),x}function m(e,t,i){let a=r.Ll.worldHud.showFullPath?t:i,n="",o=2;for(const[i,r]of Object.entries(e))if(r===t){const e=game.users.get(i);if(!e)continue;0===n.length?n=`inset 0 0 0 ${o}px ${e.color}`:n+=`, inset 0 0 0 ${o}px ${e.color}`,o+=2,a+=`\nDisplayed to: ${e.name}`}return[a,n]}async function y(e,t,i){const n=await(0,c.Om)(t,a.Cp.PORTRAIT,{algorithm:{fuzzyThreshold:.4,fuzzyLimit:50}},!0);n&&0!==n.length?(0,a.Gj)(i,n[0].path,{imgName:n[0].name}):(0,a.Gj)(i,e,{imgName:t})}function v(e){return u.variants?u.variants:e?.getFlag("token-variants","variants")||[]}},708:(e,t,i)=>{i.d(t,{A:()=>CompendiumMapConfig});var a=i(652),n=i(634),o=i(771),r=i(924),s=i(163);class MissingImageConfig extends FormApplication{constructor(){super({},{})}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-missing-images",classes:["sheet"],template:"modules/token-variants/token-variants/templates/missingImageConfig.html",resizable:!0,minimizable:!1,title:"Define Missing Images",width:560,height:"auto"})}async getData(e){const t=super.getData(e);return this.missingImages||(this.missingImages=foundry.utils.deepClone(r.Ll.compendiumMapper.missingImages)),t.missingImages=this.missingImages,t.documents=["all","Actor","Cards","Item","Macro","RollTable"],t}_processFormData(e){Array.isArray(e.document)||(e.document=[e.document],e.image=[e.image]);const t=[];for(let i=0;i<e.document.length;i++)t.push({document:e.document[i],image:e.image[i]});return t}activateListeners(e){super.activateListeners(e),e.on("click",".add-row",(()=>{const e=this._getSubmitData();this.missingImages=this._processFormData(e),this.missingImages.push({document:"all",image:CONST.DEFAULT_TOKEN}),this.render()})),e.on("click",".delete-row",(e=>{const t=this._getSubmitData();this.missingImages=this._processFormData(t);const i=e.target.closest("li")[0].dataset.index;this.missingImages.splice(i,1),this.render()})),e.on("click",".file-picker",(e=>{new FilePicker({type:"imagevideo",callback:t=>{e.target.closest("li").find('[name="image"]').val(t),e.target.closest("li").find("img").attr("src",t)}}).render()})),e.on("click",".duplicate-picker",(e=>{let t='<select style="width: 100%;" name="compendium">';game.packs.forEach((e=>{t+=`<option value='${e.collection}'>${e.title}</option>`})),t+="</select>",new Dialog({title:"Compendiums",content:t,buttons:{yes:{icon:"<i class='far fa-search'></i>",label:"Search for Duplicates",callback:t=>{const i=new Set,o=new Set,r=game.packs.get(t.querySelector("[name='compendium']").val());r.index.forEach((e=>{i.has(e.img)&&o.add(e.img),i.add(e.img)})),o.size||ui.notifications.info("No duplicates found in: "+r.title);const s=Array.from(o).map((e=>({path:e,name:(0,n.WP)(e)}))),l=new Map;l.set("Duplicates",s),(0,a.n)("Duplicates",{allImages:l,callback:t=>{e.target.closest("li").find('[name="image"]').val(t),e.target.closest("li").find("img").attr("src",t)}})}}},default:"yes"}).render(!0)}))}async _updateObject(e,t){(0,r.Xx)({compendiumMapper:{missingImages:this._processFormData(t)}})}}var l=i(853);function c(e,t,i,r,s){r.diffImages?r.ignorePortrait||r.ignoreToken?r.ignorePortrait?(0,o.Ud)(e.name,{searchType:s??n.Cp.TOKEN,object:e,image1:t,image2:i,displayMode:o.CV.IMAGE_DISPLAY.TOKEN,searchOptions:r.searchOptions,callback:async function(t,i){(0,n.mX)(t,{actor:e,imgName:i,applyDefaultConfig:!1})}}):r.ignoreToken&&(0,o.Ud)(e.name,{searchType:s??n.Cp.PORTRAIT,object:e,image1:t,image2:i,displayMode:o.CV.IMAGE_DISPLAY.PORTRAIT,searchOptions:r.searchOptions,callback:async function(t,i){await(0,n.Gj)(e,t)}}):(0,o.Ud)(e.name,{searchType:s??n.Cp.PORTRAIT,object:e,preventClose:!0,image1:t,image2:i,displayMode:o.CV.IMAGE_DISPLAY.PORTRAIT,searchOptions:r.searchOptions,callback:async function(t,l){await(0,n.Gj)(e,t),(0,a.n)(e.prototypeToken.name,{searchType:s??n.Cp.TOKEN,object:e,force:!0,image1:t,image2:i,displayMode:o.CV.IMAGE_DISPLAY.TOKEN,searchOptions:r.searchOptions,callback:(t,i)=>(0,n.mX)(t,{actor:e,imgName:i,applyDefaultConfig:!1})})}}):(0,o.Ud)(e.name,{searchType:s??n.Cp.PORTRAIT_AND_TOKEN,object:e,image1:t,image2:i,displayMode:o.CV.IMAGE_DISPLAY.PORTRAIT_TOKEN,searchOptions:r.searchOptions,callback:async function(t,i){await(0,n.Gj)(e,t),(0,n.mX)(t,{actor:e,imgName:i,applyDefaultConfig:!1})}})}class CompendiumMapConfig extends FormApplication{constructor(){super({},{}),this.searchOptions=foundry.utils.deepClone((0,r.Ds)()),foundry.utils.mergeObject(this.searchOptions,foundry.utils.deepClone(r.Ll.compendiumMapper.searchOptions)),this._fixSearchPaths()}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-compendium-map-config",classes:["sheet"],template:"modules/token-variants/token-variants/templates/compendiumMap.html",resizable:!1,minimizable:!1,title:game.i18n.localize("token-variants.settings.compendium-mapper.Name"),width:500})}async getData(e){let t=super.getData(e);t=foundry.utils.mergeObject(t,r.Ll.compendiumMapper);const i=["Actor","Cards","Item","Macro","RollTable"];t.supportedPacks=i.join(", ");const a=[];return game.packs.forEach((e=>{!e.locked&&i.includes(e.documentName)&&a.push({title:e.title,id:e.collection,type:e.documentName})})),t.compendiums=a,t.compendium=r.Ll.compendiumMapper.compendium,t.categories=n.PO.concat(r.Ll.customImageCategories),t.category=r.Ll.compendiumMapper.category,t}activateListeners(e){super.activateListeners(e),e.querySelector(".token-variants-override-category").change(this._onCategoryOverride).trigger("change"),e.querySelector(".token-variants-auto-apply").change(this._onAutoApply),e.querySelector(".token-variants-diff-images").change(this._onDiffImages),e.querySelector(".token-variants-search-options").on("click",this._onSearchOptions.bind(this)),e.querySelector(".token-variants-missing-images").on("click",this._onMissingImages.bind(this)),e.find('[name="compendium"]').change(this._onCompendiumSelect.bind(this)).trigger("change")}async _onAutoApply(e){e.target.closest("form").find(".token-variants-auto-art-select").prop("disabled",!e.target.checked)}async _onCategoryOverride(e){e.target.closest("form").find(".token-variants-category").prop("disabled",!e.target.checked)}async _onDiffImages(e){e.target.closest("form").find(".token-variants-tp-ignore").prop("disabled",!e.target.checked)}async _onCompendiumSelect(e){const t=game.packs.get(e.target.val());t&&e.target.closest("form").find(".token-specific").css("visibility","Actor"===t.documentName?"visible":"hidden")}_fixSearchPaths(){this.searchOptions.searchPaths?.length||(this.searchOptions.searchPaths=foundry.utils.deepClone(r.Ll.searchPaths))}async _onSearchOptions(e){this._fixSearchPaths(),new s.A(this.searchOptions,{searchPaths:!0,searchFilters:!0,searchAlgorithm:!0,randomizer:!1,features:!1,popup:!1,permissions:!1,worldHud:!1,misc:!1,activeEffects:!1}).render(!0)}async _onMissingImages(e){(new MissingImageConfig).render(!0)}async startMapping(e){if(e.diffImages&&e.ignoreToken&&e.ignorePortrait)return;const t=r.Ll.searchPaths;e.searchOptions.searchPaths?.length&&(r.Ll.searchPaths=e.searchOptions.searchPaths),(e.cache||!(0,n.Bv)()||e.searchOptions.searchPaths?.length)&&(console.log("TVA-Mapper: Starting Image caching."),await(0,l.Vl)(),console.log("TVA-Mapper: Caching finished."));const i=function(){e.searchOptions.searchPaths?.length&&(r.Ll.searchPaths=t,(0,l.Vl)())},a=game.packs.get(e.compendium);let s=r.Ll.compendiumMapper.missingImages.filter((e=>"all"===e.document||e.document===a.documentName)).map((e=>e.image));const p=e.overrideCategory?e.category:null;let f,u=!1,d=0;f="Actor"===a.documentName?async function(t){const i=t;if("#[CF_tempEntity]"===i.name)return;let o=i.img!==CONST.DEFAULT_TOKEN&&!s.includes(i.img),r=i.prototypeToken.texture.src!==CONST.DEFAULT_TOKEN&&!s.includes(i.prototypeToken.texture.src);e.syncImages&&o!==r&&(o?await(0,n.mX)(i.img,{actor:i,applyDefaultConfig:!1}):await(0,n.Gj)(i,i.prototypeToken.texture.src),o=r=!0);let f=!(e.missingOnly&&o||e.ignorePortrait),h=!(e.missingOnly&&r||e.ignoreToken);const g=e.showImages?i.img:"",m=e.showImages?i.prototypeToken.texture.src:"";(f||h)&&(e.autoApply?await async function(e,t,i,a,o){let r=a.ignorePortrait,s=a.ignoreToken;if(a.diffImages){let t=[];a.ignorePortrait||(t=await(0,l.RY)(e.name,{searchType:o??n.Cp.PORTRAIT,simpleResults:!0,searchOptions:a.searchOptions}),0!=(t??[]).length&&(r=!0,await(0,n.Gj)(e,t[0],!1,a.compendium))),a.ignoreToken||(t=await(0,l.RY)(e.prototypeToken.name,{searchType:n.Cp.TOKEN,simpleResults:!0,searchOptions:a.searchOptions}),0!=(t??[]).length&&(s=!0,(0,n.mX)(t[0],{actor:e,pack:a.compendium,applyDefaultConfig:!1})))}else{let t=await(0,l.RY)(e.name,{searchType:o??n.Cp.PORTRAIT_AND_TOKEN,simpleResults:!0,searchOptions:a.searchOptions});0!=(t??[]).length&&(r=s=!0,(0,n.mX)(t[0],{actor:e,actorUpdate:{img:t[0]},pack:a.compendium,applyDefaultConfig:!1}))}s&&r||!a.autoDisplayArtSelect||c(e,t,i,a,o)}(i,g,m,e,p):(u=!0,c(i,g,m,e,p))),d++,d%100==0&&console.log(`TVA-Mapper: Processed ${d} ${a.documentName}s`)}:async function(t){const i=t;if("#[CF_tempEntity]"===i.name)return;let r="";(i.schema.fields.img||i.schema.fields.texture)&&(r=(i.schema.fields.img??i.schema.fields.texture).initial(i));const c=null!=i.img&&i.img!==r&&!s.includes(i.img);let f=!1;if(!e.missingOnly||!c){if(e.autoApply){let t=await(0,l.RY)(i.name,{searchType:p??a.documentName,simpleResults:!0,searchOptions:e.searchOptions});0!=(t??[]).length&&(f=!0,await(0,n.Gj)(i,t[0],!1,e.compendium))}(!e.autoApply||e.autoDisplayArtSelect&&!f)&&(u=!0,(0,o.Ud)(i.name,{searchType:p??a.documentName,object:i,image1:e.showImages?i.img:"",displayMode:o.CV.IMAGE_DISPLAY.IMAGE,searchOptions:e.searchOptions,callback:async function(e,t){await(0,n.Gj)(i,e)}})),d++,d%100==0&&console.log(`TVA-Mapper: Processed ${d} ${a.documentName}s`)}},console.log(`TVA-Mapper: Starting Batch ${a.documentName} load.`);const h=await a.getDocuments();if(console.log("TVA-Mapper: Load finished. Beginning processing."),e.autoApply){let e,t=!0,n=!1,r=0,s=`<p>CACHING 0/${h.length}</p>`;const l=async function(){for(;t&&r<h.length;)await new Promise(((e,t)=>{setTimeout((async()=>{await f(h[r]),e()}),10)})),r++,s.html(`${r}/${h.length}`);(n||r===h.length)&&(e?.close(!0),(0,o.Ud)("DUMMY",{execute:i}),(0,o.yK)())};e=new Dialog({title:`Mapping: ${a.title}`,content:'\n        <div style="text-align:center;" class="fa-3x"><i class="fas fa-spinner fa-pulse"></i></div>\n        <div style="text-align:center;" class="counter"></div>\n        <button style="width:100%;" class="pause"><i class="fas fa-play-circle"></i> Pause/Start</button>',buttons:{cancel:{icon:'<i class="fas fa-stop-circle"></i>',label:"Cancel"}},default:"cancel",render:e=>{e.querySelector(".counter").append(s);const i=e.querySelector(".fa-spinner");e.querySelector(".pause").on("click",(()=>{t?(t=!1,i.removeClass("fa-pulse")):(t=!0,l(),i.addClass("fa-pulse"))})),setTimeout((async()=>l()),1e3)},close:()=>{n||(n=!0,t?t=!1:l())}}),e.render(!0)}else{const t=h.map(f);Promise.all(t).then((()=>{(0,o.Ud)("DUMMY",{execute:i}),(0,o.yK)(),e.missingOnly&&!u&&ui.notifications.warn("Token Variant Art: No documents found containing missing images.")}))}}async _updateObject(e,t){this.searchOptions.searchPaths?.length&&!foundry.utils.isEmpty(foundry.utils.diffObject(this.searchOptions.searchPaths,r.Ll.searchPaths))||(this.searchOptions.searchPaths=[]),t.searchOptions=this.searchOptions,await(0,r.Xx)({compendiumMapper:t}),t.compendium&&this.startMapping(t)}}},715:(e,t,i)=>{i.d(t,{l:()=>Reticle});var a=i(15),n=i(548),o=i(170),r=i(605);class Reticle{static app;static fields;static reticleOverlay;static active=!1;static hitTest;static token=null;static dialog=null;static mode="tooltip";static increment=1;static _onReticleMove(e){if(this.reticleOverlay.isMouseDown){let t=e.data.getLocalPosition(this.reticleOverlay);this.config.pOffsetX=0,this.config.pOffsetY=0,this.config.offsetX=0,this.config.offsetY=0,"token"===this.mode&&(this.config.linkRotation=!0,this.config.linkMirror=!0),this.tvaOverlay.refresh(this.config,{preview:!0});const i={x:this.tvaOverlay.x,y:this.tvaOverlay.y};if(this.tvaOverlay.overlayConfig.parentID){let e=this.tvaOverlay;do{e=e.parent,i.x+=e.x,i.y+=e.y}while(!(e instanceof o.I))}let a=t.x-i.x,n=t.y-i.y,r=0;if(this.config.animation.relative||(r=this.config.angle,this.config.linkRotation&&(r+=this.tvaOverlay.object.document.rotation)),[a,n]=function(e,t,i,a,n){var o=Math.PI/180*n,r=Math.cos(o),s=Math.sin(o);return[r*(i-e)+s*(a-t)+e,r*(a-t)-s*(i-e)+t]}(0,0,a,n,r),a=s(a,this.increment),n=s(n,this.increment),"static"===this.mode)this.config.pOffsetX=a,this.config.pOffsetY=n;else if("token"===this.mode)this.config.offsetX=-a/this.tvaOverlay.object.w,this.config.offsetY=-n/this.tvaOverlay.object.h;else{let e,t,i=this.tvaOverlay.object;this.tvaOverlay.overlayConfig.parentID?(e=(this.tvaOverlay.parent.shapesWidth??this.tvaOverlay.parent.width)/this.tvaOverlay.parent.scale.x,t=(this.tvaOverlay.parent.shapesHeight??this.tvaOverlay.parent.height)/this.tvaOverlay.parent.scale.y):(e=i.w,t=i.h),"tooltip"===this.mode?(Math.abs(a)>=e/2?(this.config.offsetX=.5*(a<0?1:-1),a+=e/2*(a<0?1:-1)):(this.config.offsetX=-a/this.tvaOverlay.object.w,a=0),Math.abs(n)>=t/2?(this.config.offsetY=.5*(n<0?1:-1),n+=t/2*(n<0?1:-1)):(this.config.offsetY=-n/this.tvaOverlay.object.h,n=0)):Math.abs(a)>=e/2?(this.config.offsetX=.5*(a<0?1:-1),a+=e/2*(a<0?1:-1)):Math.abs(n)>=t/2?(this.config.offsetY=.5*(n<0?1:-1),n+=t/2*(n<0?1:-1)):(this.config.offsetX=-a/this.tvaOverlay.object.w,a=0,this.config.offsetY=-n/this.tvaOverlay.object.h,n=0),this.config.pOffsetX=a,this.config.pOffsetY=n}this.tvaOverlay.refresh(this.config,{preview:!0})}}static minimizeApps(){Object.values(ui.windows).forEach((e=>{(e instanceof n.r||e instanceof a.A)&&e.minimize()}))}static maximizeApps(){Object.values(ui.windows).forEach((e=>{(e instanceof n.r||e instanceof a.A)&&e.maximize()}))}static activate({tvaOverlay:e=null,config:t={}}={}){if(this.deactivate()||!canvas.ready)return!1;if(!e||!t)return!1;this.reticleOverlay&&this.reticleOverlay.destroy(!0);const i=canvas.app.renderer.events;i.cursorStyles.reticle||(i.cursorStyles.reticle="url('modules/token-variants/token-variants/img/reticle.webp'), auto"),this.tvaOverlay=e,this.minimizeApps(),this.config=(0,r.DH)(foundry.utils.deepClone(t),this.tvaOverlay.object,{overlayConfig:t}),this.config.alwaysVisible=!0,this.active=!0,this.reticleOverlay=new PIXI.Container,this.reticleOverlay.hitArea=canvas.dimensions.rect,this.reticleOverlay.cursor="reticle",this.reticleOverlay.interactive=!0,this.reticleOverlay.zIndex=1/0;return this.reticleOverlay.on("mousedown",(e=>{e.preventDefault(),2!=e.data.originalEvent.which&&2!=e.data.originalEvent.nativeEvent.which&&(this.reticleOverlay.isMouseDown=!0,this._onReticleMove(e))})),this.reticleOverlay.on("pointermove",(e=>{e.preventDefault(),this._onReticleMove(e)})),this.reticleOverlay.on("mouseup",(e=>{e.preventDefault(),this.reticleOverlay.isMouseDown=!1})),this.reticleOverlay.on("click",(e=>{e.preventDefault(),2!=e.data.originalEvent.which&&2!=e.data.originalEvent.nativeEvent.which||this.deactivate()})),canvas.stage.addChild(this.reticleOverlay),this.dialog=function(){const e=new Dialog({title:"Set Overlay Position",content:`\n      <style>\n        .images { display: flex; }\n        .images a { flex: 20%; width: 50px; margin: 2px; }\n        .images a.active img { border-color: orange; border-width: 2px; }\n        .anchorlbl {margin: auto; display: table; }\n      </style>\n      <div class="images">\n        <a data-id="token"><img src="modules/token-variants/token-variants/img/token_mode.png"></img></a>\n        <a data-id="tooltip"><img src="modules/token-variants/token-variants/img/tooltip_mode.png"></img></a>\n        <a data-id="hud"><img src="modules/token-variants/token-variants/img/hud_mode.png"></img></a>\n        <a data-id="static"><img src="modules/token-variants/token-variants/img/static_mode.png"></img></a>\n      </div>\n     <br>\n      <label class="anchorlbl">Anchor</label>\n      <div class="tva-anchor">\n        <input type="radio" class="top left" name="anchor">\n        <input type="radio" class="top center" name="anchor">\n        <input type="radio" class="top right" name="anchor">\n        <input type="radio" class="mid left" name="anchor">\n        <input type="radio" class="mid center" name="anchor">\n        <input type="radio" class="mid right" name="anchor">\n        <input type="radio" class="bot left" name="anchor">\n        <input type="radio" class="bot center" name="anchor">\n        <input type="radio" class="bot right" name="anchor">\n      </div>\n      <div class="form-group">\n        <label>Step Size</label>\n        <div class="form-fields">\n          <input type="number" name="step" min="0" step="1" value="${Reticle.increment}">\n        </div>\n      </div>\n      <p class="notes"><b>Left-Click</b> to move the overlay</p>\n      <p class="notes"><b>Middle-Click</b> or <b>Close Dialog</b> to exit overlay positioning</p>\n     `,buttons:{},render:e=>{const t=e.querySelector(".images a");e.querySelector(".images a").on("click",(e=>{t.removeClass("active");const i=e.target.closest("a");i.addClass("active"),Reticle.mode=i.data("id")})),e.querySelector(`[data-id="${Reticle.mode}"]`).addClass("active");let i=Reticle.config?.anchor?.x||0,a=Reticle.config?.anchor?.y||0,n="";n+=i<.5?".left":i>.5?".right":".center",n+=a<.5?".top":a>.5?".bot":".mid",e.querySelector(".tva-anchor").find(n).prop("checked",!0),e.querySelector('input[name="anchor"]').on("change",(e=>{const t=e.target;let i,a;i=t.hasClass("left")?0:t.hasClass("center")?.5:1,a=t.hasClass("top")?0:t.hasClass("mid")?.5:1,Reticle.config.anchor.x=i,Reticle.config.anchor.y=a})),e.querySelector('[name="step"]').on("input",(e=>{Reticle.increment=e.target.val()||1}))},close:()=>Reticle.deactivate()});return e.render(!0),setTimeout((()=>e.setPosition({left:200,top:window.innerHeight/2,height:"auto"})),100),e}(),!0}static deactivate(){if(this.active){this.reticleOverlay&&this.reticleOverlay.parent?.removeChild(this.reticleOverlay),this.active=!1,this.tvaOverlay=null,this.dialog&&this.dialog._state!==Application.RENDER_STATES.CLOSED&&this.dialog.close(!0),this.dialog=null,this.maximizeApps();const e=Object.values(ui.windows).find((e=>e instanceof n.r));if(!e)return void(this.config=null);const t=e.form;return["pOffsetX","pOffsetY","offsetX","offsetY"].forEach((e=>{e in this.config&&t.find(`[name="${e}"]`).val(this.config[e])})),"token"===this.mode?(["linkRotation","linkMirror"].forEach((e=>{t.find(`[name="${e}"]`).prop("checked",!0)})),["linkDimensionsX","linkDimensionsY"].forEach((e=>{t.find(`[name="${e}"]`).prop("checked",!1)}))):["linkRotation","linkMirror"].forEach((e=>{t.find(`[name="${e}"]`).prop("checked",!1)})),"hud"===this.mode&&t.find('[name="ui"]').prop("checked",!0).trigger("change"),t.find('[name="anchor.x"]').val(this.config.anchor.x),t.find('[name="anchor.y"]').val(this.config.anchor.y).trigger("change"),this.config=null,!0}}}function s(e,t,i=0){return Math.ceil((e-i)/t)*t+i}},722:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{E:()=>HTMLOverlay});class HTMLOverlay{static container=null;static renderQueue=[];static hudReady=!1;static hudRendered(){HTMLOverlay.hudReady=!0,HTMLOverlay.renderQueue.forEach((e=>e.render())),HTMLOverlay.renderQueue=[]}constructor(e,t){this.overlayConfig=e,this.token=t,this.render()}render(e=null,t=!1){HTMLOverlay.hudReady?(HTMLOverlay.container||(HTMLOverlay.container='<div id="tva-html-overlays"></div>',"#hud".append(HTMLOverlay.container)),this.element&&this.remove(),e&&(this.overlayConfig=e),this.element=renderTemplate(this.overlayConfig,this.getData(),t),HTMLOverlay.container.append(this.element),this.activateListeners(this.element),this.setPosition()):HTMLOverlay.renderQueue.push(this)}remove(){this.element&&this.element.remove(),this.element=null}getData(e={}){const t=this.token.document.toObject();return foundry.utils.mergeObject(t,{isGM:game.user.isGM})}setPosition({left:e,top:t,width:i,height:a,scale:n,angle:o,origin:r}={}){if(!HTMLOverlay.hudReady)return;const s=canvas.dimensions.size/100,l={width:i||100*this.token.document.width,height:a||100*this.token.document.height,left:e??this.token.document.x,top:t??this.token.document.y};1!==s&&(l.transform=`scale(${s})`),this.element.css(l),null!=o&&this.element.css({transform:"rotate("+o+"deg)"}),null!=r&&this.element.css({"transform-origin":r.x+"px "+r.y+"px"})}activateListeners(html){try{eval(this.overlayConfig.html.listeners)}catch(e){}}}const _templateCache={};function _compile(e,t){return Handlebars.compile(`<div class="tva-html-overlay overlay-${t}">\n      <section class="window-content">\n        <form>${e.template}</form>\n      </section>\n    </div>`)}function constructTemplate(e,t=!1){if(_templateCache.hasOwnProperty(e.id)){if(t)return _compile(e.html,e.id)}else{const t=_compile(e.html,e.id);Handlebars.registerPartial(e.id,t),_templateCache[e.id]=t}return _templateCache[e.id]}function renderTemplate(e,t,i=!1){return constructTemplate(e,i)(t||{},{allowProtoMethodsByDefault:!0,allowProtoPropertiesByDefault:!0})}},771:(e,t,i)=>{i.d(t,{$L:()=>d,CV:()=>ArtSelect,Tp:()=>c,Ud:()=>p,yK:()=>f});var a=i(126),n=i(634),o=i(652),r=i(924),s=i(853);function l(e,t){const i=document.getElementById(e);i&&(i.innerHTML=t,i.style.display="")}function c(e,t){ArtSelect.queue.push({search:e,options:t}),l("button#token-variant-art-clear-queue",`Clear Queue (${ArtSelect.queue.length})`)}function p(e,t){ArtSelect.queue.push({search:e,options:t})}function f(e=!1){if(!e){if(0!==Object.values(ui.windows).filter((e=>e instanceof ArtSelect)).length)return void(0!==ArtSelect.queue.length&&l("button#token-variant-art-clear-queue",`Clear Queue (${ArtSelect.queue.length})`))}let t=ArtSelect.queue.shift();t?.options.execute&&(t.options.execute(),t=ArtSelect.queue.shift()),t&&(0,o.n)(t.search,t.options)}function u(e,t){let i=0;return function(...a){clearTimeout(i),i=setTimeout(e.bind(this,...a),t||0)}}class ArtSelect extends FormApplication{static queue=[];static instance=null;static executing=!1;static IMAGE_DISPLAY={NONE:0,PORTRAIT:1,TOKEN:2,PORTRAIT_TOKEN:3,IMAGE:4};constructor(e,{preventClose:t=!1,object:i=null,callback:a=null,searchType:o=null,allImages:s=null,image1:l="",image2:c="",displayMode:p=ArtSelect.IMAGE_DISPLAY.NONE,multipleSelection:f=!1,searchOptions:u={}}={}){let d=game.i18n.localize("token-variants.windows.art-select.select-variant");o===n.Cp.TOKEN?d=game.i18n.localize("token-variants.windows.art-select.select-token-art"):o===n.Cp.PORTRAIT&&(d=game.i18n.localize("token-variants.windows.art-select.select-portrait-art")),super({},{closeOnSubmit:!1,width:ArtSelect.WIDTH||500,height:ArtSelect.HEIGHT||500,left:ArtSelect.LEFT,top:ArtSelect.TOP,title:d}),this.search=e,this.allImages=s,this.callback=a,this.doc=i,this.preventClose=t,this.image1=l,this.image2=c,this.displayMode=p,this.multipleSelection=f,this.searchType=o,this.searchOptions=foundry.utils.mergeObject(u,(0,r.Ds)(),{overwrite:!1}),ArtSelect.instance=this;Object.defineProperty(ArtSelect.prototype.constructor,"name",{value:"ArtSelect"})}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-art-select",classes:["sheet"],template:"modules/token-variants/token-variants/templates/artSelect.html",resizable:!0,minimizable:!1})}_getHeaderButtons(){const e=super._getHeaderButtons();return e.unshift({label:"Rebuild Cache",class:"cache-rebuild",icon:"fas fa-sync-alt",onclick:async()=>{await(0,s.Vl)(),this._performSearch(this.search,!0)}}),e.unshift({label:"FilePicker",class:"file-picker",icon:"fas fa-file-import fa-fw",onclick:()=>{new FilePicker({type:"imagevideo",callback:e=>{this.preventClose||this.close(),this.callback&&this.callback(e,(0,n.WP)(e))}}).render()}}),e.unshift({label:"Image Category",class:"type",icon:"fas fa-swatchbook",onclick:()=>{ArtSelect.instance&&ArtSelect.instance._typeSelect()}}),e}_typeSelect(){const e=n.PO.concat(r.Ll.customImageCategories),t={};for(const i of e){let e=i;i===this.searchType&&(e="<b>>>> "+e+" <<<</b>"),t[i]={label:e,callback:()=>{this.searchType!==i&&(this.searchType=i,this._performSearch(this.search,!0))}}}new Dialog({title:"Select Image Category and Filter",content:"<style>.dialog .dialog-button {flex: 0 0 auto;}</style>",buttons:t}).render(!0)}async getData(e){const t=super.getData(e);this.doc instanceof Item&&(t.item=!0,t.description=this.doc.system?.description?.value??"");const i=this.searchOptions,a=i.algorithm,o=(r.Ll.tokenConfigs||[]).flat(),s=a.fuzzy;let l=new Map,c=!1;const p=function(e,t,i="<mark>",a="</mark>",n=null){if(!t)return e;let o=n?n.repeat(e.length):e,r="",s=0;for(const n of t)r+=o.slice(s,n[0]),r+=i+e.slice(n[0],n[1]+1)+a,s=n[1]+1;return r+=o.slice(s,o.length),r},f=function(e){if(!s)return e.path;let t=Math.ceil(100*(1-e.score))+"%";return i.runSearchOnPath?t+"\n"+p(e.path,e.indices,"","","-")+"\n"+e.path:t};return this.allImages.forEach(((e,t)=>{const a=[];e.forEach((e=>{c=!0;const t=(0,n.cZ)(e.path),r=(0,n.wu)(e.path);a.push({path:e.path,img:r,vid:t,type:t||r,name:e.name,label:s&&!i.runSearchOnPath?p(e.name,e.indices):e.name,title:f(e),hasConfig:(this.searchType===n.Cp.TOKEN||this.searchType===n.Cp.PORTRAIT_AND_TOKEN)&&Boolean(o.find((t=>t.tvImgSrc==e.path&&t.tvImgName==e.name)))})})),l.set(t,a)})),c&&(t.allImages=l),t.search=this.search,t.queue=ArtSelect.queue.length,t.image1=this.image1,t.image2=this.image2,t.displayMode=this.displayMode,t.multipleSelection=this.multipleSelection,t.displaySlider=a.fuzzy&&a.fuzzyArtSelectPercentSlider,t.fuzzyThreshold=a.fuzzyThreshold,t.displaySlider&&(t.fuzzyThreshold=100-100*t.fuzzyThreshold,t.fuzzyThreshold=t.fuzzyThreshold.toFixed(0)),t.autoplay=!r.Ll.playVideoOnHover,t}activateListeners(e){super.activateListeners(e);const t=this.callback,i=()=>this.close(),o=this.doc,s=this.preventClose,l=this.multipleSelection,c=e.querySelector(".token-variants-grid-box");c.hover((function(){if(r.Ll.playVideoOnHover){const e=this.siblings("video");e.length&&(e[0].play(),this.siblings(".fa-play").hide())}}),(function(){if(r.Ll.pauseVideoOnHoverOut){const e=this.siblings("video");e.length&&(e[0].pause(),e[0].currentTime=0,this.siblings(".fa-play").show())}})),c.map((e=>{c[e].addEventListener("click",(async function(e){(0,n._l)("config")?o&&new a.A(o,{},e.target.dataset.name,e.target.dataset.filename).render(!0):(s||i(),t&&t(e.target.dataset.name,e.target.dataset.filename))})),l&&c[e].addEventListener("contextmenu",(async function(e){e.target.classList.classList.toggle("selected")}))}));let p=e.querySelector("#custom-art-search");p.focus(),p[0].selectionStart=p[0].selectionEnd=1e4,p.on("input",u((e=>{this._performSearch(e.target.value)}),350)),e.querySelector("button#token-variant-art-clear-queue").on("click",(e=>{ArtSelect.queue=ArtSelect.queue.filter((e=>e.options.execute)),e.target.hide()})),e.find('[name="fuzzyThreshold"]').change((e=>{e.target.siblings(".token-variants-range-value").html(`${parseFloat(e.target.value).toFixed(0)}%`),this.searchOptions.algorithm.fuzzyThreshold=(100-e.target.value)/100})).change(u((e=>{this._performSearch(this.search,!0)}),350)),l&&(e.querySelector("button#token-variant-art-return-selected").on("click",(()=>{if(t){const i=[];e.find(".token-variants-grid-box.selected").siblings(".token-variants-grid-image").each((function(){i.push(this.getAttribute("src"))})),t(i)}i()})),e.querySelector("button#token-variant-art-return-all").on("click",(()=>{if(t){const i=[];e.querySelector(".token-variants-grid-image").each((function(){i.push(this.getAttribute("src"))})),t(i)}i()})))}_performSearch(e,t=!1){(t||this.search.trim()!==e.trim())&&(0,o.n)(e,{callback:this.callback,searchType:this.searchType,object:this.doc,force:!0,image1:this.image1,image2:this.image2,displayMode:this.displayMode,multipleSelection:this.multipleSelection,searchOptions:this.searchOptions,preventClose:this.preventClose})}async _updateObject(e,t){t&&t.search!=this.search?this._performSearch(t.search):this.close()}setPosition(e={}){e.width&&(ArtSelect.WIDTH=e.width),e.height&&(ArtSelect.HEIGHT=e.height),e.top&&(ArtSelect.TOP=e.top),e.left&&(ArtSelect.LEFT=e.left),super.setPosition(e)}async close(e={}){let t=ArtSelect.queue.shift();if(t?.options.execute&&(t.options.execute(),t=ArtSelect.queue.shift()),!t){const t=Object.values(ui.windows).filter((e=>e instanceof ArtSelect)).filter((e=>e.appId!==this.appId));for(const e of t)e.close();return super.close(e)}t.options.force=!0,(0,o.n)(t.search,t.options)}}function d(e,t,{search:i="",searchType:a=n.Cp.TOKEN}={}){const r=new ElementBuilder("i").className("fas fa-images").build(),s=new ElementBuilder("button").className("token-variants-image-select-button").type("button").dataset("type","imagevideo").dataset("target",t).title("token-variants.windows.art-select.select-variant").on("click",(()=>{(0,o.n)(i,{callback:(e,i)=>{s.siblings(`[name="${t}"]`).val(e)},searchType:a})})).child(r).build(),l=e.querySelector(`[name="${t}"]`);return l.after(s),Boolean(l.length)}},853:(e,t,i)=>{i.d(t,{Vl:()=>De,RY:()=>be,v_:()=>_e,jk:()=>Oe,Om:()=>xe,Ie:()=>ve,Io:()=>Me});var a=i(652);function n(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,a)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?n(Object(i),!0).forEach((function(t){p(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function c(e,t,i){return t&&l(e.prototype,t),i&&l(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function p(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");Object.defineProperty(e,"prototype",{value:Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),writable:!1}),t&&d(e,t)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function h(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,a=u(e);if(t){var n=u(this).constructor;i=Reflect.construct(a,arguments,n)}else i=a.apply(this,arguments);return h(this,i)}}function m(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return y(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,a=new Array(t);i<t;i++)a[i]=e[i];return a}function v(e){return Array.isArray?Array.isArray(e):"[object Array]"===T(e)}function k(e){return"string"==typeof e}function b(e){return"number"==typeof e}function _(e){return!0===e||!1===e||function(e){return O(e)&&null!==e}(e)&&"[object Boolean]"==T(e)}function O(e){return"object"===r(e)}function w(e){return null!=e}function S(e){return!e.trim().length}function T(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}var C=Object.prototype.hasOwnProperty,x=function(){function e(t){var i=this;s(this,e),this._keys=[],this._keyMap={};var a=0;t.forEach((function(e){var t=E(e);a+=t.weight,i._keys.push(t),i._keyMap[t.id]=t,a+=t.weight})),this._keys.forEach((function(e){e.weight/=a}))}return c(e,[{key:"get",value:function(e){return this._keyMap[e]}},{key:"keys",value:function(){return this._keys}},{key:"toJSON",value:function(){return JSON.stringify(this._keys)}}]),e}();function E(e){var t=null,i=null,a=null,n=1;if(k(e)||v(e))a=e,t=P(e),i=I(e);else{if(!C.call(e,"name"))throw new Error(function(e){return"Missing ".concat(e," property in key")}("name"));var o=e.name;if(a=o,C.call(e,"weight")&&(n=e.weight)<=0)throw new Error(function(e){return"Property 'weight' in key '".concat(e,"' must be a positive integer")}(o));t=P(o),i=I(o)}return{path:t,id:i,weight:n,src:a}}function P(e){return v(e)?e:e.split(".")}function I(e){return v(e)?e.join("."):e}var M={useExtendedSearch:!1,getFn:function(e,t){var i=[],a=!1;return function e(t,n,o){if(w(t))if(n[o]){var r=t[n[o]];if(!w(r))return;if(o===n.length-1&&(k(r)||b(r)||_(r)))i.push(function(e){return null==e?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)}(r));else if(v(r)){a=!0;for(var s=0,l=r.length;s<l;s+=1)e(r[s],n,o+1)}else n.length&&e(r,n,o+1)}else i.push(t)}(e,k(t)?t.split("."):t,0),a?i:i[0]},ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1},D=o(o(o(o({},{isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:function(e,t){return e.score===t.score?e.idx<t.idx?-1:1:e.score<t.score?-1:1}}),{includeMatches:!1,findAllMatches:!1,minMatchCharLength:1}),{location:0,threshold:.6,distance:100}),M),A=/[^ ]+/g;var F=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.getFn,a=void 0===i?D.getFn:i,n=t.fieldNormWeight,o=void 0===n?D.fieldNormWeight:n;s(this,e),this.norm=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=new Map,a=Math.pow(10,t);return{get:function(t){var n=t.match(A).length;if(i.has(n))return i.get(n);var o=1/Math.pow(n,.5*e),r=parseFloat(Math.round(o*a)/a);return i.set(n,r),r},clear:function(){i.clear()}}}(o,3),this.getFn=a,this.isCreated=!1,this.setIndexRecords()}return c(e,[{key:"setSources",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.docs=e}},{key:"setIndexRecords",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.records=e}},{key:"setKeys",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.keys=t,this._keysMap={},t.forEach((function(t,i){e._keysMap[t.id]=i}))}},{key:"create",value:function(){var e=this;!this.isCreated&&this.docs.length&&(this.isCreated=!0,k(this.docs[0])?this.docs.forEach((function(t,i){e._addString(t,i)})):this.docs.forEach((function(t,i){e._addObject(t,i)})),this.norm.clear())}},{key:"add",value:function(e){var t=this.size();k(e)?this._addString(e,t):this._addObject(e,t)}},{key:"removeAt",value:function(e){this.records.splice(e,1);for(var t=e,i=this.size();t<i;t+=1)this.records[t].i-=1}},{key:"getValueForItemAtKeyId",value:function(e,t){return e[this._keysMap[t]]}},{key:"size",value:function(){return this.records.length}},{key:"_addString",value:function(e,t){if(w(e)&&!S(e)){var i={v:e,i:t,n:this.norm.get(e)};this.records.push(i)}}},{key:"_addObject",value:function(e,t){var i=this,a={i:t,$:{}};this.keys.forEach((function(t,n){var o=i.getFn(e,t.path);if(w(o))if(v(o))!function(){for(var e=[],t=[{nestedArrIndex:-1,value:o}];t.length;){var r=t.pop(),s=r.nestedArrIndex,l=r.value;if(w(l))if(k(l)&&!S(l)){var c={v:l,i:s,n:i.norm.get(l)};e.push(c)}else v(l)&&l.forEach((function(e,i){t.push({nestedArrIndex:i,value:e})}))}a.$[n]=e}();else if(!S(o)){var r={v:o,n:i.norm.get(o)};a.$[n]=r}})),this.records.push(a)}},{key:"toJSON",value:function(){return{keys:this.keys,records:this.records}}}]),e}();function R(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=i.getFn,n=void 0===a?D.getFn:a,o=i.fieldNormWeight,r=void 0===o?D.fieldNormWeight:o,s=new F({getFn:n,fieldNormWeight:r});return s.setKeys(e.map(E)),s.setSources(t),s.create(),s}function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.errors,a=void 0===i?0:i,n=t.currentLocation,o=void 0===n?0:n,r=t.expectedLocation,s=void 0===r?0:r,l=t.distance,c=void 0===l?D.distance:l,p=t.ignoreLocation,f=void 0===p?D.ignoreLocation:p,u=a/e.length;if(f)return u;var d=Math.abs(s-o);return c?u+d/c:d?1:u}var N=32;function L(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},n=a.location,o=void 0===n?D.location:n,r=a.distance,s=void 0===r?D.distance:r,l=a.threshold,c=void 0===l?D.threshold:l,p=a.findAllMatches,f=void 0===p?D.findAllMatches:p,u=a.minMatchCharLength,d=void 0===u?D.minMatchCharLength:u,h=a.includeMatches,g=void 0===h?D.includeMatches:h,m=a.ignoreLocation,y=void 0===m?D.ignoreLocation:m;if(t.length>N)throw new Error("Pattern length exceeds max of ".concat(N,"."));for(var v,k=t.length,b=e.length,_=Math.max(0,Math.min(o,b)),O=c,w=_,S=d>1||g,T=S?Array(b):[];(v=e.indexOf(t,w))>-1;){var C=j(t,{currentLocation:v,expectedLocation:_,distance:s,ignoreLocation:y});if(O=Math.min(C,O),w=v+k,S)for(var x=0;x<k;)T[v+x]=1,x+=1}w=-1;for(var E=[],P=1,I=k+b,M=1<<k-1,A=0;A<k;A+=1){for(var F=0,R=I;F<R;){j(t,{errors:A,currentLocation:_+R,expectedLocation:_,distance:s,ignoreLocation:y})<=O?F=R:I=R,R=Math.floor((I-F)/2+F)}I=R;var L=Math.max(1,_-R+1),H=f?b:Math.min(_+R,b)+k,U=Array(H+2);U[H+1]=(1<<A)-1;for(var X=H;X>=L;X-=1){var B=X-1,W=i[e.charAt(B)];if(S&&(T[B]=+!!W),U[X]=(U[X+1]<<1|1)&W,A&&(U[X]|=(E[X+1]|E[X])<<1|1|E[X+1]),U[X]&M&&(P=j(t,{errors:A,currentLocation:B,expectedLocation:_,distance:s,ignoreLocation:y}))<=O){if(O=P,(w=B)<=_)break;L=Math.max(1,2*_-w)}}if(j(t,{errors:A+1,currentLocation:_,expectedLocation:_,distance:s,ignoreLocation:y})>O)break;E=U}var z={isMatch:w>=0,score:Math.max(.001,P)};if(S){var V=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:D.minMatchCharLength,i=[],a=-1,n=-1,o=0,r=e.length;o<r;o+=1){var s=e[o];s&&-1===a?a=o:s||-1===a||((n=o-1)-a+1>=t&&i.push([a,n]),a=-1)}return e[o-1]&&o-a>=t&&i.push([a,o-1]),i}(T,d);V.length?g&&(z.indices=V):z.isMatch=!1}return z}function H(e){for(var t={},i=0,a=e.length;i<a;i+=1){var n=e.charAt(i);t[n]=(t[n]||0)|1<<a-i-1}return t}var U=function(){function e(t){var i=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.location,o=void 0===n?D.location:n,r=a.threshold,l=void 0===r?D.threshold:r,c=a.distance,p=void 0===c?D.distance:c,f=a.includeMatches,u=void 0===f?D.includeMatches:f,d=a.findAllMatches,h=void 0===d?D.findAllMatches:d,g=a.minMatchCharLength,m=void 0===g?D.minMatchCharLength:g,y=a.isCaseSensitive,v=void 0===y?D.isCaseSensitive:y,k=a.ignoreLocation,b=void 0===k?D.ignoreLocation:k;if(s(this,e),this.options={location:o,threshold:l,distance:p,includeMatches:u,findAllMatches:h,minMatchCharLength:m,isCaseSensitive:v,ignoreLocation:b},this.pattern=v?t:t.toLowerCase(),this.chunks=[],this.pattern.length){var _=function(e,t){i.chunks.push({pattern:e,alphabet:H(e),startIndex:t})},O=this.pattern.length;if(O>N){for(var w=0,S=O%N,T=O-S;w<T;)_(this.pattern.substr(w,N),w),w+=N;if(S){var C=O-N;_(this.pattern.substr(C),C)}}else _(this.pattern,0)}}return c(e,[{key:"searchIn",value:function(e){var t=this.options,i=t.isCaseSensitive,a=t.includeMatches;if(i||(e=e.toLowerCase()),this.pattern===e){var n={isMatch:!0,score:0};return a&&(n.indices=[[0,e.length-1]]),n}var o=this.options,r=o.location,s=o.distance,l=o.threshold,c=o.findAllMatches,p=o.minMatchCharLength,f=o.ignoreLocation,u=[],d=0,h=!1;this.chunks.forEach((function(t){var i=t.pattern,n=t.alphabet,o=t.startIndex,g=L(e,i,n,{location:r+o,distance:s,threshold:l,findAllMatches:c,minMatchCharLength:p,includeMatches:a,ignoreLocation:f}),y=g.isMatch,v=g.score,k=g.indices;y&&(h=!0),d+=v,y&&k&&(u=[].concat(m(u),m(k)))}));var g={isMatch:h,score:h?d/this.chunks.length:1};return h&&a&&(g.indices=u),g}}]),e}(),X=function(){function e(t){s(this,e),this.pattern=t}return c(e,[{key:"search",value:function(){}}],[{key:"isMultiMatch",value:function(e){return B(e,this.multiRegex)}},{key:"isSingleMatch",value:function(e){return B(e,this.singleRegex)}}]),e}();function B(e,t){var i=e.match(t);return i?i[1]:null}var W=function(e){f(i,e);var t=g(i);function i(e){return s(this,i),t.call(this,e)}return c(i,[{key:"search",value:function(e){var t=e===this.pattern;return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}],[{key:"type",get:function(){return"exact"}},{key:"multiRegex",get:function(){return/^="(.*)"$/}},{key:"singleRegex",get:function(){return/^=(.*)$/}}]),i}(X),z=function(e){f(i,e);var t=g(i);function i(e){return s(this,i),t.call(this,e)}return c(i,[{key:"search",value:function(e){var t=-1===e.indexOf(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}],[{key:"type",get:function(){return"inverse-exact"}},{key:"multiRegex",get:function(){return/^!"(.*)"$/}},{key:"singleRegex",get:function(){return/^!(.*)$/}}]),i}(X),V=function(e){f(i,e);var t=g(i);function i(e){return s(this,i),t.call(this,e)}return c(i,[{key:"search",value:function(e){var t=e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,this.pattern.length-1]}}}],[{key:"type",get:function(){return"prefix-exact"}},{key:"multiRegex",get:function(){return/^\^"(.*)"$/}},{key:"singleRegex",get:function(){return/^\^(.*)$/}}]),i}(X),K=function(e){f(i,e);var t=g(i);function i(e){return s(this,i),t.call(this,e)}return c(i,[{key:"search",value:function(e){var t=!e.startsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}],[{key:"type",get:function(){return"inverse-prefix-exact"}},{key:"multiRegex",get:function(){return/^!\^"(.*)"$/}},{key:"singleRegex",get:function(){return/^!\^(.*)$/}}]),i}(X),Y=function(e){f(i,e);var t=g(i);function i(e){return s(this,i),t.call(this,e)}return c(i,[{key:"search",value:function(e){var t=e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}],[{key:"type",get:function(){return"suffix-exact"}},{key:"multiRegex",get:function(){return/^"(.*)"\$$/}},{key:"singleRegex",get:function(){return/^(.*)\$$/}}]),i}(X),q=function(e){f(i,e);var t=g(i);function i(e){return s(this,i),t.call(this,e)}return c(i,[{key:"search",value:function(e){var t=!e.endsWith(this.pattern);return{isMatch:t,score:t?0:1,indices:[0,e.length-1]}}}],[{key:"type",get:function(){return"inverse-suffix-exact"}},{key:"multiRegex",get:function(){return/^!"(.*)"\$$/}},{key:"singleRegex",get:function(){return/^!(.*)\$$/}}]),i}(X),$=function(e){f(i,e);var t=g(i);function i(e){var a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.location,r=void 0===o?D.location:o,l=n.threshold,c=void 0===l?D.threshold:l,p=n.distance,f=void 0===p?D.distance:p,u=n.includeMatches,d=void 0===u?D.includeMatches:u,h=n.findAllMatches,g=void 0===h?D.findAllMatches:h,m=n.minMatchCharLength,y=void 0===m?D.minMatchCharLength:m,v=n.isCaseSensitive,k=void 0===v?D.isCaseSensitive:v,b=n.ignoreLocation,_=void 0===b?D.ignoreLocation:b;return s(this,i),(a=t.call(this,e))._bitapSearch=new U(e,{location:r,threshold:c,distance:f,includeMatches:d,findAllMatches:g,minMatchCharLength:y,isCaseSensitive:k,ignoreLocation:_}),a}return c(i,[{key:"search",value:function(e){return this._bitapSearch.searchIn(e)}}],[{key:"type",get:function(){return"fuzzy"}},{key:"multiRegex",get:function(){return/^"(.*)"$/}},{key:"singleRegex",get:function(){return/^(.*)$/}}]),i}(X),G=function(e){f(i,e);var t=g(i);function i(e){return s(this,i),t.call(this,e)}return c(i,[{key:"search",value:function(e){for(var t,i=0,a=[],n=this.pattern.length;(t=e.indexOf(this.pattern,i))>-1;)i=t+n,a.push([t,i-1]);var o=!!a.length;return{isMatch:o,score:o?0:1,indices:a}}}],[{key:"type",get:function(){return"include"}},{key:"multiRegex",get:function(){return/^'"(.*)"$/}},{key:"singleRegex",get:function(){return/^'(.*)$/}}]),i}(X),J=[W,G,V,K,q,Y,z,$],Q=J.length,Z=/ +(?=([^\"]*\"[^\"]*\")*[^\"]*$)/;var ee=new Set([$.type,G.type]),te=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.isCaseSensitive,n=void 0===a?D.isCaseSensitive:a,o=i.includeMatches,r=void 0===o?D.includeMatches:o,l=i.minMatchCharLength,c=void 0===l?D.minMatchCharLength:l,p=i.ignoreLocation,f=void 0===p?D.ignoreLocation:p,u=i.findAllMatches,d=void 0===u?D.findAllMatches:u,h=i.location,g=void 0===h?D.location:h,m=i.threshold,y=void 0===m?D.threshold:m,v=i.distance,k=void 0===v?D.distance:v;s(this,e),this.query=null,this.options={isCaseSensitive:n,includeMatches:r,minMatchCharLength:c,findAllMatches:d,ignoreLocation:f,location:g,threshold:y,distance:k},this.pattern=n?t:t.toLowerCase(),this.query=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.split("|").map((function(e){for(var i=e.trim().split(Z).filter((function(e){return e&&!!e.trim()})),a=[],n=0,o=i.length;n<o;n+=1){for(var r=i[n],s=!1,l=-1;!s&&++l<Q;){var c=J[l],p=c.isMultiMatch(r);p&&(a.push(new c(p,t)),s=!0)}if(!s)for(l=-1;++l<Q;){var f=J[l],u=f.isSingleMatch(r);if(u){a.push(new f(u,t));break}}}return a}))}(this.pattern,this.options)}return c(e,[{key:"searchIn",value:function(e){var t=this.query;if(!t)return{isMatch:!1,score:1};var i=this.options,a=i.includeMatches;e=i.isCaseSensitive?e:e.toLowerCase();for(var n=0,o=[],r=0,s=0,l=t.length;s<l;s+=1){var c=t[s];o.length=0,n=0;for(var p=0,f=c.length;p<f;p+=1){var u=c[p],d=u.search(e),h=d.isMatch,g=d.indices,y=d.score;if(!h){r=0,n=0,o.length=0;break}if(n+=1,r+=y,a){var v=u.constructor.type;ee.has(v)?o=[].concat(m(o),m(g)):o.push(g)}}if(n){var k={isMatch:!0,score:r/n};return a&&(k.indices=o),k}}return{isMatch:!1,score:1}}}],[{key:"condition",value:function(e,t){return t.useExtendedSearch}}]),e}(),ie=[];function ae(e,t){for(var i=0,a=ie.length;i<a;i+=1){var n=ie[i];if(n.condition(e,t))return new n(e,t)}return new U(e,t)}var ne="$and",oe="$or",re="$path",se="$val",le=function(e){return!(!e[ne]&&!e[oe])},ce=function(e){return p({},ne,Object.keys(e).map((function(t){return p({},t,e[t])})))};function pe(e,t){var i=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).auto,a=void 0===i||i;return le(e)||(e=ce(e)),function e(i){var n=Object.keys(i),o=function(e){return!!e[re]}(i);if(!o&&n.length>1&&!le(i))return e(ce(i));if(function(e){return!v(e)&&O(e)&&!le(e)}(i)){var r=o?i[re]:n[0],s=o?i[se]:i[r];if(!k(s))throw new Error(function(e){return"Invalid value for key ".concat(e)}(r));var l={keyId:I(r),pattern:s};return a&&(l.searcher=ae(s,t)),l}var c={children:[],operator:n[0]};return n.forEach((function(t){var a=i[t];v(a)&&a.forEach((function(t){c.children.push(e(t))}))})),c}(e)}function fe(e,t){var i=e.matches;t.matches=[],w(i)&&i.forEach((function(e){if(w(e.indices)&&e.indices.length){var i={indices:e.indices,value:e.value};e.key&&(i.key=e.key.src),e.idx>-1&&(i.refIndex=e.idx),t.matches.push(i)}}))}function ue(e,t){t.score=e.score}var de=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;s(this,e),this.options=o(o({},D),i),this.options.useExtendedSearch,this._keyStore=new x(this.options.keys),this.setCollection(t,a)}return c(e,[{key:"setCollection",value:function(e,t){if(this._docs=e,t&&!(t instanceof F))throw new Error("Incorrect 'index' type");this._myIndex=t||R(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}},{key:"add",value:function(e){w(e)&&(this._docs.push(e),this._myIndex.add(e))}},{key:"remove",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){return!1},t=[],i=0,a=this._docs.length;i<a;i+=1){var n=this._docs[i];e(n,i)&&(this.removeAt(i),i-=1,a-=1,t.push(n))}return t}},{key:"removeAt",value:function(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}},{key:"getIndex",value:function(){return this._myIndex}},{key:"search",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).limit,i=void 0===t?-1:t,a=this.options,n=a.includeMatches,o=a.includeScore,r=a.shouldSort,s=a.sortFn,l=a.ignoreFieldNorm,c=k(e)?k(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return function(e,t){var i=t.ignoreFieldNorm,a=void 0===i?D.ignoreFieldNorm:i;e.forEach((function(e){var t=1;e.matches.forEach((function(e){var i=e.key,n=e.norm,o=e.score,r=i?i.weight:null;t*=Math.pow(0===o&&r?Number.EPSILON:o,(r||1)*(a?1:n))})),e.score=t}))}(c,{ignoreFieldNorm:l}),r&&c.sort(s),b(i)&&i>-1&&(c=c.slice(0,i)),function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=i.includeMatches,n=void 0===a?D.includeMatches:a,o=i.includeScore,r=void 0===o?D.includeScore:o,s=[];return n&&s.push(fe),r&&s.push(ue),e.map((function(e){var i=e.idx,a={item:t[i],refIndex:i};return s.length&&s.forEach((function(t){t(e,a)})),a}))}(c,this._docs,{includeMatches:n,includeScore:o})}},{key:"_searchStringList",value:function(e){var t=ae(e,this.options),i=this._myIndex.records,a=[];return i.forEach((function(e){var i=e.v,n=e.i,o=e.n;if(w(i)){var r=t.searchIn(i),s=r.isMatch,l=r.score,c=r.indices;s&&a.push({item:i,idx:n,matches:[{score:l,value:i,norm:o,indices:c}]})}})),a}},{key:"_searchLogical",value:function(e){var t=this,i=pe(e,this.options),a=function e(i,a,n){if(!i.children){var o=i.keyId,r=i.searcher,s=t._findMatches({key:t._keyStore.get(o),value:t._myIndex.getValueForItemAtKeyId(a,o),searcher:r});return s&&s.length?[{idx:n,item:a,matches:s}]:[]}for(var l=[],c=0,p=i.children.length;c<p;c+=1){var f=e(i.children[c],a,n);if(f.length)l.push.apply(l,m(f));else if(i.operator===ne)return[]}return l},n=this._myIndex.records,o={},r=[];return n.forEach((function(e){var t=e.$,n=e.i;if(w(t)){var s=a(i,t,n);s.length&&(o[n]||(o[n]={idx:n,item:t,matches:[]},r.push(o[n])),s.forEach((function(e){var t,i=e.matches;(t=o[n].matches).push.apply(t,m(i))})))}})),r}},{key:"_searchObjectList",value:function(e){var t=this,i=ae(e,this.options),a=this._myIndex,n=a.keys,o=a.records,r=[];return o.forEach((function(e){var a=e.$,o=e.i;if(w(a)){var s=[];n.forEach((function(e,n){s.push.apply(s,m(t._findMatches({key:e,value:a[n],searcher:i})))})),s.length&&r.push({idx:o,item:a,matches:s})}})),r}},{key:"_findMatches",value:function(e){var t=e.key,i=e.value,a=e.searcher;if(!w(i))return[];var n=[];if(v(i))i.forEach((function(e){var i=e.v,o=e.i,r=e.n;if(w(i)){var s=a.searchIn(i),l=s.isMatch,c=s.score,p=s.indices;l&&n.push({score:c,key:t,value:i,idx:o,norm:r,indices:p})}}));else{var o=i.v,r=i.n,s=a.searchIn(o),l=s.isMatch,c=s.score,p=s.indices;l&&n.push({score:c,key:t,value:o,norm:r,indices:p})}return n}}]),e}();de.version="6.5.3",de.createIndex=R,de.parseIndex=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.getFn,a=void 0===i?D.getFn:i,n=t.fieldNormWeight,o=void 0===n?D.fieldNormWeight:n,r=e.keys,s=e.records,l=new F({getFn:a,fieldNormWeight:o});return l.setKeys(r),l.setIndexRecords(s),l},de.config=D,de.parseQuery=pe,function(){ie.push.apply(ie,arguments)}(te);var he=de,ge=i(924),me=i(634);let ye=!1;function ve(){return ye}let ke={};async function be(e,{searchType:t=me.Cp.PORTRAIT_AND_TOKEN,simpleResults:i=!1,callback:a=null,searchOptions:n={}}={}){if(ye)return;n=foundry.utils.mergeObject(n,(0,ge.Ds)(),{overwrite:!1}),e=e.trim(),ge.Ll.debug&&console.info("TVA | STARTING: Art Search",e,t,n);let o=[e],r=new Map;const s=(0,me.Qx)(n.excludedKeywords);n.keywordSearch&&(o=o.concat(e.split(/[_\- :,\|\(\)\[\]]/).filter((e=>e.length>2&&!s.includes(e.toLowerCase()))).reverse()));let l=new Set;for(const e of o){if(void 0!==r.get(e))continue;let i=await Ee(e,t,n);i=i.filter((e=>!l.has(e))),r.set(e,i),i.forEach(l.add,l)}return ge.Ll.debug&&console.info("TVA | ENDING: Art Search"),i&&(r=Array.from(l).map((e=>e.path))),a&&a(r),r}async function _e(e,{searchType:t=me.Cp.PORTRAIT_AND_TOKEN,actor:i=null,callback:a=null,randomizerOptions:n={},searchOptions:o={}}={}){if(ye)return null;let r,s=(0,me.nd)(await async function(e,{searchType:t=me.Cp.PORTRAIT_AND_TOKEN,actor:i=null,randomizerOptions:a={},searchOptions:n={}}={}){const o=foundry.utils.mergeObject(a,ge.Ll.randomizer,{overwrite:!1});if(!(o.tokenName||o.actorName||o.keywords||o.shared||o.wildcard))return null;n.keywordSearch=o.keywords,o.actorName&&i&&(e=i.name);let r=o.actorName||o.tokenName||o.keywords?await be(e,{searchType:t,searchOptions:n}):new Map;o.tokenName||o.actorName||r.delete(e);if(o.shared&&i){let e=i.getFlag("token-variants","variants")||[];if(0!=e.length){const t=[];e.forEach((e=>{e.names.forEach((i=>{t.push({path:e.imgSrc,name:i})}))})),r.set("variants95436723",t)}}if(o.wildcard&&i){let e=i.prototypeToken.texture.src;if(e.includes("*")||e.includes("{")&&e.includes("}")){const t=async t=>{if(t._tokenImages)return t._tokenImages;let i="data";const a={wildcard:!0};if(/\.s3\./.test(e)){i="s3";const{bucket:t,keyPrefix:n}=FilePicker.parseS3URL(e);t&&(a.bucket=t,e=n)}else e.startsWith("icons/")&&(i="public");try{return(await FilePicker.browse(i,e,a)).files}catch(e){return[]}},a=(await t(i)).filter((e=>!e.includes("*")&&((0,me.wu)(e)||(0,me.cZ)(e)))).map((e=>({path:e,name:(0,me.WP)(e)})));r.set("variants95436623",a)}}return r}(e,{searchType:t,actor:i,randomizerOptions:n,searchOptions:o}));if(0===s.length)return null;if(1!==s.length&&n.nonRepeat&&t===me.Cp.TOKEN){const e=canvas.tokens?.placeables||[],t=new Set(e.map((e=>e.document.texture.src)));let i=[],a=s[Math.floor(Math.random()*s.length)];for(;s.length&&!r;)t.has(a.path)?(i.push(a),s.splice(s.indexOf(a),1),a=s[Math.floor(Math.random()*s.length)]):r=a;r||(s=i)}return r||(r=s[Math.floor(Math.random()*s.length)]),a&&a([r.path,r.name]),[r.path,r.name]}async function Oe(e,{searchType:t=me.Cp.TOKEN}={}){if(ye)return null;const i=await Ee(e,t,{algorithm:{fuzzy:!0}});return i&&0!==i.length?[i[0].path,i[0].name]:null}async function we(e,{apiKey:t=""}={},i){let a={};e.source||(e.source="data");const n=e.types.sort().join(",");try{if(e.source.startsWith("s3:"))a=await FilePicker.browse("s3",e.text,{bucket:e.source.replace("s3:","")});else if(e.source.startsWith("forgevtt"))if(t){const i=await(0,me.OJ)(e.text,t);a.files=i.files.map((e=>e.url))}else a=await FilePicker.browse("forgevtt",e.text,{recursive:!0});else if(e.source.startsWith("forge-bazaar"))a=await FilePicker.browse("forge-bazaar",e.text,{recursive:!0});else{if(e.source.startsWith("imgur"))return void await fetch("https://api.imgur.com/3/gallery/album/"+e.text,{headers:{Authorization:"Client-ID "+(ge.Ll.imgurClientId?ge.Ll.imgurClientId:"df9d991443bb222"),Accept:"application/json"}}).then((e=>e.json())).then((async function(e){e.success&&e.data.images.forEach((e=>{const t=e.title??e.description??(0,me.WP)(e.link);Se({path:(0,me.b3)(e.link),name:t},n,i)}))})).catch((e=>console.warn("TVA |",e)));if(e.source.startsWith("rolltable")){const t=game.tables.contents.find((t=>t.name===e.text));if(t)for(let e of t.results){const t=e.img,a=e.text||(0,me.WP)(t);Se({path:(0,me.b3)(t),name:a},n,i)}else{const t=e.text;ui.notifications.warn(game.i18n.format("token-variants.notifications.warn.invalid-table",{rollTableName:t}))}return}if(e.source.startsWith("json"))return void await fetch(e.text,{headers:{Accept:"application/json"}}).then((e=>e.json())).then((async function(e){!e.length>0||e.forEach((e=>{const t=e.name??(0,me.WP)(e.path);Se({path:(0,me.b3)(e.path),name:t,tags:e.tags},n,i)}))})).catch((e=>console.warn("TVA |",e)));a=await FilePicker.browse(e.source,e.text)}}catch(t){return void console.warn(`TVA | ${game.i18n.localize("token-variants.notifications.warn.path-not-found")} ${e.source}:${e.text}`)}if("."!=a.target&&(a.files&&a.files.forEach((e=>{Se({path:(0,me.b3)(e),name:(0,me.WP)(e)},n,i)})),!e.source.startsWith("forgevtt")&&(!e.source.startsWith("forge-bazaar")||["modules","systems","worlds","assets"].includes(e.text.replaceAll(/[\/\\]/g,"")))))for(let n of a.dirs)await we({text:n,source:e.source,types:e.types},{apiKey:t},i)}function Se(e,t,i){((0,me.wu)(e.path)||(0,me.cZ)(e.path))&&(null==i[t]?i[t]=[e]:i[t].push(e))}async function Te(e){const t={},i=Ce(ge.Ll.searchPaths,e);for(const e of i)(e.cache&&ye||!e.cache&&!ye)&&await we(e,{},t);const a="undefined"!=typeof ForgeAPI?await ForgeAPI.getUserId():"";for(const i in ge.Ll.forgeSearchPaths){const n=ge.Ll.forgeSearchPaths[i].apiKey,o=Ce(ge.Ll.forgeSearchPaths[i].paths,e);if(i===a)for(const e of o)(e.cache&&ye||!e.cache&&!ye)&&await we(e,{},t);else if(n)for(const e of o)(e.cache&&ye||!e.cache&&!ye)&&e.share&&await we(e,{apiKey:n},t)}return t}function Ce(e,t){return t?e.filter((e=>e.types.includes(t))):e}async function xe(e,t,i,a=!1){ge.Ll.debug&&console.info("TVA | STARTING: Fuzzy Image Search",e,t,i,a);const n=(0,me.gA)(t,i.searchFilters),o=new he([],{keys:[!a&&i.runSearchOnPath?"path":"name","tags"],includeScore:!0,includeMatches:!0,minMatchCharLength:1,ignoreLocation:!0,threshold:i.algorithm.fuzzyThreshold}),r=await Te(t);for(const e of[ke,r])for(const a in e){if(a.split(",").includes(t))for(const t of e[a])Ie(t.name,t.path,n,i.runSearchOnPath)&&o.add(t)}let s;return""===e?s=o.getIndex().docs.slice(0,i.algorithm.fuzzyLimit):(s=o.search(e).slice(0,i.algorithm.fuzzyLimit),s=s.map((e=>(e.item.indices=e.matches[0].indices,e.item.score=e.score,e.item)))),ge.Ll.debug&&console.info("TVA | ENDING: Fuzzy Image Search",s),s}async function Ee(e,t="",i={}){const a=foundry.utils.mergeObject(i,(0,ge.Ds)(),{overwrite:!1});return a.algorithm.exact?await async function(e,t,i){ge.Ll.debug&&console.info("TVA | STARTING: Exact Image Search",e,t,i);const a=await Te(t),n=(0,me.Tz)(e),o=(0,me.gA)(t,i.searchFilters),r=[];for(const e of[ke,a])for(const a in e)if(a.split(",").includes(t))for(const t of e[a])Pe(n,t.path,t.name,o,i.runSearchOnPath)&&r.push(t);return ge.Ll.debug&&console.info("TVA | ENDING: Exact Image Search",r),r}(e,t,a):await xe(e,t,a)}function Pe(e,t,i,a,n){return!!(n?(0,me.zl)(t):(0,me.Tz)(i)).includes(e)&&(!a||Ie(i,t,a,n))}function Ie(e,t,i,a){let n;return n=a?(0,me.e6)(t):(0,me.WP)(t)===e?(0,me.$l)(t):e,i.regex?i.regex.test(n):!(i.include&&!n.includes(i.include))&&(!i.exclude||!n.includes(i.exclude))}async function Me(e){const t={},i=Object.keys(ke);for(const e of i){e in t||(t[e]=[]);for(const i of ke[e])i.tags?t[e].push([i.path,i.name,i.tags]):(0,me.WP)(i.path)===i.name?t[e].push(i.path):t[e].push([i.path,i.name])}let a=new File([JSON.stringify(t)],(0,me.$l)(e),{type:"text/plain"});FilePicker.upload("data",(0,me.oK)(e),a)}async function De({staticCache:e=ge.Ll.staticCache,staticCacheFile:t=ge.Ll.staticCacheFile}={}){if(ye)return;if(ye=!0,!(0,a.D)()&&e&&await async function(e){ke={};try{await jQuery.getJSON(e,(e=>{for(let t in e){ke[t]=[];for(const i of e[t])Array.isArray(i)?3===i.length?ke[t].push({path:i[0],name:i[1],tags:i[2]}):ke[t].push({path:i[0],name:i[1]}):ke[t].push({path:i,name:(0,me.WP)(i)})}ge.Ll.disableNotifs||ui.notifications.info(`Token Variant Art: Using Static Cache (${Object.keys(ke).reduce(((e,t)=>e+ke[t].length),0)} images)`)}))}catch(e){return ui.notifications.warn("Token Variant Art: Static Cache not found"),ke={},!1}return!0}(t))return void(ye=!1);ge.Ll.disableNotifs||ui.notifications.info(game.i18n.format("token-variants.notifications.info.caching-started")),ge.Ll.debug&&console.info("TVA | STARTING: Token Caching");const i=await Te();ke=i,ge.Ll.debug&&console.info("TVA | ENDING: Token Caching"),ye=!1,ge.Ll.disableNotifs||ui.notifications.info(game.i18n.format("token-variants.notifications.info.caching-finished",{imageCount:Object.keys(ke).reduce(((e,t)=>e+ke[t].length),0)})),e&&game.user.isGM&&Me(t)}},869:(e,t,i)=>{i.d(t,{I:()=>Templates});var a=i(262),n=i(924),o=i(111);class Templates extends FormApplication{constructor({mappings:e=null,callback:t=null}={}){super({},{}),this.mappings=e,this.callback=t}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-templates",classes:["sheet"],template:"modules/token-variants/token-variants/templates/templates.html",resizable:!1,minimizable:!1,title:"Mapping Templates",width:500,height:"auto"})}async getData(e){const t=super.getData(e);this.category||(this.category=n.Ll.templateMappings?.length?"user":"core"),"user"===this.category?this.templates=n.Ll.templateMappings:"core"===this.category?this.templates=a.g:this.templates=await async function(){const e=await fetch(`https://firestore.googleapis.com/v1/projects/tva---templates/databases/(default)/documents:runQuery?key=${TemplateSubmissionForm.pk}`,{method:"POST",body:JSON.stringify(r),headers:{Accept:"application/json","Content-Type":"application/json"}}),t=[];if(e.ok&&200===e.status){const i=await e.json();for(let e of i)"document"in e&&t.push(s(e.document))}else ui.notifications.warn("Failed to retrieve Community templates.");return t}();for(const e of this.templates)e.hint=e.hint?.replace(/(\r\n|\n|\r)/gm,"<br>");return t.category=this.category,t.templates=this.templates,t.allowDelete="user"===this.category,t.allowCreate="user"===this.category,t.allowCopy="community"===this.category||"core"===this.category,t}activateListeners(e){super.activateListeners(e);const t=e.closest("#token-variants-templates");e.querySelector(".template").on("mouseover",(e=>{const i=e.target.closest(".template"),a=i.position(),n=i.find(".tooltiptext"),o=t.position();n.css("top",o.top+a.top).css("left",o.left+a.left);const r=i.find("img");r.attr("src")||r.attr("src",r.data("src"))})),this.callback&&e.querySelector(".template").on("click",(async e=>{const t=e.target.closest(".template"),i=t.data("id"),a=t.data("url");let n,o;if(a){const e=await l(a);e&&(n=e.mappings)}else if(i){const e=this.templates.find((e=>e.id===i));e&&(o=e.name,n=e.mappings)}n&&this.callback(o,n)})),e.querySelector(".search").on("input",(()=>{const t=e.querySelector(".search").val().trim().toLowerCase();e.querySelector(".template-list li").each((function(){const e=this,i=e.find(".description").text().trim().toLowerCase(),a=e.data("name").trim().toLowerCase(),n=e.data("creator").trim().toLowerCase();a.includes(t)||i.includes(t)||n.includes(t)?e.show():e.hide()}))})),e.querySelector('[name="category"]').on("change",(e=>{this.category=e.target.value,this.render(!0)})),e.querySelector(".delete").on("click",(async e=>{e.preventDefault(),e.stopPropagation();const t=e.target.closest(".template").data("id");t&&(await(0,n.Xx)({templateMappings:n.Ll.templateMappings.filter((e=>e.id!==t))}),this.render(!0))})),e.querySelector(".copy").on("click",(async e=>{e.preventDefault(),e.stopPropagation();const t=e.target.closest(".template").data("id");if(t){let i;if("core"===this.category)i=foundry.utils.deepClone(a.g.find((e=>e.id===t)));else{const t=e.target.closest(".template").data("url");t&&(i=await l(t))}i&&(n.Ll.templateMappings.push(i),await(0,n.Xx)({templateMappings:n.Ll.templateMappings}),ui.notifications.info(`Template {${i.name}} copied to User templates.`),this.render(!0))}})),e.querySelector(".create").on("click",(()=>{(0,o.Ov)(this.mappings,{title1:"Create Template",callback:e=>{e?.length&&(0,o.BG)(e)}})}))}_getHeaderButtons(){const e=super._getHeaderButtons();return e.unshift({label:"Upload Template",class:".token-variants-submit-template",icon:"fa-solid fa-cloud-arrow-up",onclick:()=>{(new TemplateSubmissionForm).render(!0)}}),e}async _updateObject(e,t){}}class TemplateSubmissionForm extends FormApplication{constructor(){super({},{})}static apiKey="AIzaSyCJpwIkpjrG10jaHwcpllvSChxRPawcMXE";static get pk(){return"AIzaSyCJpwIkpjrG10jaHwcpllvSChxRPawcMXE"}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-template-submission",classes:["sheet"],template:"modules/token-variants/token-variants/templates/templateSubmission.html",resizable:!0,minimizable:!1,closeOnSubmit:!1,title:"Upload Template",width:500,height:"auto"})}async getData(e){const t=super.getData(e);return t.systemID=game.system.id,t.systemTitle=game.system.title,t.templates=n.Ll.templateMappings,t.modules=game.modules.filter((e=>e.active)).map((e=>({id:e.name,name:e.title}))),t}async _updateObject(e,t){if(!t.template)return;let i=n.Ll.templateMappings.find((e=>e.id===t.template));if(!i)return;const a=t.name.trim()||i.name,o=t.hint.trim()||i.hint?.trim(),r=t.createdBy.trim(),s=t.system;t.modules instanceof Array||(t.modules=[t.modules]);const l=t.modules.filter(Boolean).map((e=>({id:e,name:game.modules.get(e).title}))),c=foundry.utils.randomID(),p=t.img.trim(),f=await async function(e){const t={};["name","hint","img","id","createdBy","system"].forEach((i=>function(e,t,i){e[i]&&""!==e[i]&&(t[i]={stringValue:e[i]})}(e,t,i))),t.modules={stringValue:e.modules.length?JSON.stringify(e.modules):""},t.mappings={stringValue:JSON.stringify(e.mappings)},t.createTime={integerValue:(new Date).getTime()},t.approved={booleanValue:!1};const i=await fetch(`https://firestore.googleapis.com/v1/projects/tva---templates/databases/(default)/documents/templates?key=${TemplateSubmissionForm.pk}`,{method:"POST",body:JSON.stringify({fields:t}),headers:{Accept:"application/json","Content-Type":"application/json"}});return i.ok&&200===i.status?(ui.notifications.info("Template submission completed."),!0):(ui.notifications.warn("Template submission failed."),!1)}({id:c,name:a,hint:o,img:p,createdBy:r,system:s,modules:l,mappings:i.mappings});f&&this.close()}}const r={structuredQuery:{select:{fields:[{fieldPath:"id"},{fieldPath:"name"},{fieldPath:"hint"},{fieldPath:"createdBy"},{fieldPath:"img"},{fieldPath:"system"},{fieldPath:"modules"}]},where:{fieldFilter:{field:{fieldPath:"approved"},op:"EQUAL",value:{booleanValue:!0}}},from:[{collectionId:"templates"}],orderBy:[{field:{fieldPath:"createTime"}}],offset:0,limit:50}};function s(e){const t={};return["id","name","mappings","createdBy","img","hint","system","modules"].forEach((i=>{t[i]=e.fields[i]?.stringValue||""})),t.mappings?t.mappings=JSON.parse(t.mappings):t.fileURL=e.name,t.modules&&(t.modules=JSON.parse(t.modules)),t.createdBy||(t.createdBy="Anonymous"),t}async function l(e){const t=await fetch(`https://firestore.googleapis.com/v1/${e}?key=${TemplateSubmissionForm.pk}`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(t.ok&&200===t.status){return s(await t.json())}return null}},924:(e,t,i)=>{i.d(t,{Xi:()=>f,Ll:()=>p,XJ:()=>g,SL:()=>h,Ds:()=>_,zo:()=>m,dm:()=>d,Nq:()=>u,Xx:()=>v});var a=i(634),n=i(111);class ForgeSearchPaths extends FormApplication{constructor(){super({},{})}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-search-paths",classes:["sheet"],template:"modules/token-variants/token-variants/templates/forgeSearchPaths.html",resizable:!0,minimizable:!1,closeOnSubmit:!1,title:game.i18n.localize("token-variants.settings.search-paths.Name"),width:592,height:"auto",scrollY:["ol.token-variant-table"],dragDrop:[{dragSelector:null,dropSelector:null}]})}async getData(e){this.object.paths||(this.object.paths=await this._getPaths());const t=this.object.paths.map((e=>{const t={};return t.text=e.text,t.cache=e.cache,t.share=e.share,t.types=e.types.join(","),t.config=JSON.stringify(e.config??{}),t})),i=super.getData(e);return i.paths=t,i.apiKey=this.apiKey,i}async _getPaths(){const e=foundry.utils.deepClone(p.forgeSearchPaths)||{};return this.userId="undefined"!=typeof ForgeAPI?await ForgeAPI.getUserId():"tempUser",this.apiKey=e[this.userId]?.apiKey,e[this.userId]?.paths||[]}activateListeners(e){super.activateListeners(e),e.querySelector("a.create-path").click(this._onCreatePath.bind(this)),e.on("click","a.select-category",n.VB.bind(this)),e.on("click","a.select-config",n.Vp.bind(this)),e.querySelector("a.delete-path").click(this._onDeletePath.bind(this)),e.querySelector("button.reset").click(this._onReset.bind(this)),e.querySelector("button.update").click(this._onUpdate.bind(this)),e.on("click",".path-image.source-icon a",this._onBrowseFolder.bind(this))}async _onBrowseFolder(e){const t=e.target.closest(".table-row").find(".path-text input");new FilePicker({type:"folder",activeSource:"forgevtt",current:t.val(),callback:(e,i)=>{"forgevtt"!==i.activeSource?ui.notifications.warn("Token Variant Art: Only 'Assets Library' paths are supported"):t.val(i.result.target)}}).render(!0)}async _onCreatePath(e){e.preventDefault(),await this._onSubmit(e),this.object.paths.push({text:"",cache:!0,share:!0,types:["Portrait","Token","PortraitAndToken"]}),this.render()}async _onDeletePath(e){e.preventDefault(),await this._onSubmit(e);const t=e.currentTarget.closest(".table-row");this.object.paths.splice(t.dataset.index,1),this.render()}_onReset(e){e.preventDefault(),this.object.paths=this._getPaths(),this.render()}async _onUpdate(e){e.preventDefault(),await this._onSubmit(e),this._updatePaths()}async _updateObject(e,t){const i=foundry.utils.expandObject(t);i.paths=i.hasOwnProperty("paths")?Object.values(i.paths):[],i.paths.forEach(((e,t)=>{if(this.object.paths[t]={text:e.text,cache:e.cache,share:e.share,source:e.source,types:e.types.split(",")},e.config)try{e.config=JSON.parse(e.config),foundry.utils.isEmpty(e.config)||(this.object.paths[t].config=e.config)}catch(e){}})),this.apiKey=i.apiKey}_cleanPaths(){let e=new Set;return this.object.paths.filter((t=>!(!t.text||e.has(t.text))&&(e.add(t.text),!0)))}_updatePaths(){if(this.userId){const e=foundry.utils.deepClone(p.forgeSearchPaths)||{};if(e[this.userId]={paths:this._cleanPaths(),apiKey:this.apiKey},game.user.isGM)v({forgeSearchPaths:e});else{const t={handlerName:"forgeSearchPaths",args:e,type:"UPDATE"};game.socket?.emit("module.token-variants",t)}}}async close(e={}){return await this._onSubmit(event),this._updatePaths(),super.close(e)}}class TokenHUDClientSettings extends FormApplication{constructor(){super({},{title:"Token HUD Settings"})}static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-hud-settings",classes:["sheet"],template:"modules/token-variants/token-variants/templates/tokenHUDClientSettings.html",resizable:!1,minimizable:!1,title:"",width:500})}async getData(e){const t=super.getData(e);return foundry.utils.mergeObject(t,p.hud)}async _updateObject(e,t){game.settings.set("token-variants","hudSettings",foundry.utils.mergeObject(p.hud,t))}}var o=i(708);class ImportExport extends FormApplication{static get defaultOptions(){return foundry.utils.mergeObject(super.defaultOptions,{id:"token-variants-import-export",classes:["sheet"],template:"modules/token-variants/token-variants/templates/importExport.html",resizable:!1,minimizable:!1,title:"Import/Export",width:250})}activateListeners(e){super.activateListeners(e),e.querySelector(".import").click(this._importFromJSONDialog.bind(this)),e.querySelector(".export").click((()=>{g(),this.close()}))}async _importFromJSONDialog(){const e=await renderTemplate("templates/apps/import-data.html",{entity:"token-variants",name:"settings"});let t=new Promise(((t,i)=>{new Dialog({title:game.i18n.localize("token-variants.settings.import-export.window.import-dialog"),content:e,buttons:{import:{icon:'<i class="fas fa-file-import"></i>',label:game.i18n.localize("token-variants.common.import"),callback:e=>{const i=e.querySelector("form")[0];if(!i.data.files.length)return ui.notifications?.error("You did not upload a data file!");readTextFromFile(i.data.files[0]).then((e=>{m(e),t(!0)}))}},no:{icon:'<i class="fas fa-times"></i>',label:"Cancel",callback:e=>t(!1)}},default:"import"},{width:400}).render(!0)}));return this.close(),await t}}var r=i(163),s=i(853),l=i(21),c=i(654);const p={debug:!1,disableNotifs:!1,searchPaths:[{text:"modules/caeora-maps-tokens-assets/assets/tokens",cache:!0,source:"undefined"==typeof ForgeAPI?"data":"forge-bazaar",types:["Portrait","Token","PortraitAndToken"]}],forgeSearchPaths:{},worldHud:{displayOnlySharedImages:!1,disableIfTHWEnabled:!1,includeKeywords:!1,updateActorImage:!1,useNameSimilarity:!1,includeWildcard:!0,showFullPath:!1,animate:!0},hud:{enableSideMenu:!0,displayAsImage:!0,imageOpacity:50},keywordSearch:!0,excludedKeywords:"and,for",runSearchOnPath:!1,searchFilters:{},algorithm:{exact:!1,fuzzy:!0,fuzzyLimit:100,fuzzyThreshold:.3,fuzzyArtSelectPercentSlider:!0},tokenConfigs:[],randomizer:{actorCreate:!1,tokenCreate:!1,tokenCopyPaste:!1,tokenName:!0,keywords:!1,shared:!1,wildcard:!1,representedActorDisable:!1,linkedActorDisable:!0,popupOnDisable:!1,diffImages:!1,syncImages:!1,nonRepeat:!1},popup:{disableAutoPopupOnActorCreate:!0,disableAutoPopupOnTokenCreate:!0,disableAutoPopupOnTokenCopyPaste:!0,twoPopups:!1,twoPopupsNoDialog:!1},imgurClientId:"",stackStatusConfig:!0,mergeGroup:!1,staticCache:!1,staticCacheFile:"modules/token-variants/token-variants-cache.json",tilesEnabled:!0,compendiumMapper:{missingOnly:!1,diffImages:!1,showImages:!0,cache:!1,autoDisplayArtSelect:!0,syncImages:!1,overrideCategory:!1,category:"Token",missingImages:[{document:"all",image:CONST.DEFAULT_TOKEN}],searchOptions:{}},permissions:{popups:{1:!1,2:!1,3:!0,4:!0},portrait_right_click:{1:!1,2:!1,3:!0,4:!0},image_path_button:{1:!1,2:!1,3:!0,4:!0},hud:{1:!0,2:!0,3:!0,4:!0},hudFullAccess:{1:!1,2:!1,3:!0,4:!0},statusConfig:{1:!1,2:!1,3:!0,4:!0}},globalMappings:[],templateMappings:[],customImageCategories:[],displayEffectIconsOnHover:!1,disableEffectIcons:!1,filterEffectIcons:!1,filterCustomEffectIcons:!0,filterIconList:[],updateTokenProto:!1,imgNameContainsDimensions:!1,imgNameContainsFADimensions:!1,playVideoOnHover:!0,pauseVideoOnHoverOut:!1,disableImageChangeOnPolymorphed:!1,disableImageUpdateOnNonPrototype:!1,disableTokenUpdateAnimation:!1,evaluateOverlayOnHover:!0,invisibleImage:"",systemHpPath:"",internalEffects:{hpChange:{enabled:!1,duration:null}},hideElevationTooltip:!1,hideTokenBorder:!1},f={EffectMappings:!0,EffectIcons:!0,Overlays:!0,UserMappings:!0,Wildcards:!0,PopUpAndRandomize:!0,HUD:!0,HideElement:!0};function u(){game.settings.register("token-variants","featureControl",{scope:"world",config:!1,type:Object,default:f,onChange:async e=>{foundry.utils.mergeObject(f,e),(0,l.Hr)(),(0,c.tr)()}}),foundry.utils.mergeObject(f,game.settings.get("token-variants","featureControl")),game.settings.registerMenu("token-variants","settings",{name:"Configure Settings",hint:"Configure Token Variant Art settings",label:"Settings",scope:"world",icon:"fas fa-cog",type:r.A,restricted:!0});p.systemHpPath={"cyberpunk-red-core":"derivedStats.hp",lfg:"health",worldbuilding:"health",twodsix:"hits"}[game.system.id]??"attributes.hp",game.settings.register("token-variants","effectMappingToggleGroups",{scope:"world",config:!1,type:Object,default:{Default:!0}}),game.settings.register("token-variants","settings",{scope:"world",config:!1,type:Object,default:p,onChange:async e=>{const t=k(p,e);let i=!1;if("permissions"in t&&!(0,a.Bv)(p.permissions)&&(0,a.Bv)(e.permissions)&&(i=!0),foundry.utils.mergeObject(p,e),p.filterEffectIcons&&("filterCustomEffectIcons"in t||"filterIconList"in t))for(const e of canvas.tokens.placeables)(0,a.rc)(e,(e=>{e.drawEffects()}));if(("searchPaths"in t||"forgeSearchPaths"in t)&&(0,a.Bv)(p.permissions)&&(i=!0),i&&await(0,s.Vl)(),t.staticCache){const e=t.staticCacheFile?t.staticCacheFile:p.staticCacheFile;(0,s.Io)(e)}if(p.hud=game.settings.get("token-variants","hudSettings"),(0,l.Hr)(),(0,c.tr)(),"displayEffectIconsOnHover"in t)for(const e of canvas.tokens.placeables)e.effects&&(e.effects.visible=!t.displayEffectIconsOnHover);if("hideElevationTooltip"in t)for(const e of canvas.tokens.placeables)e.tooltip&&(e.tooltip.text=e._getTooltipText());if("hideTokenBorder"in t)for(const e of canvas.tokens.placeables)e.border&&(e.border.visible=!t.hideTokenBorder);if("filterEffectIcons"in t||"disableEffectIcons"in t)for(const e of canvas.tokens.placeables)e.drawEffects()}}),game.settings.register("token-variants","debug",{scope:"world",config:!1,type:Boolean,default:p.debug,onChange:e=>p.debug=e}),"undefined"!=typeof ForgeAPI&&game.settings.registerMenu("token-variants","forgeSearchPaths",{name:game.i18n.localize("token-variants.settings.forge-search-paths.Name"),hint:game.i18n.localize("token-variants.settings.forge-search-paths.Hint"),icon:"fas fa-search",type:ForgeSearchPaths,scope:"client",restricted:!1}),game.settings.register("token-variants","tokenConfigs",{scope:"world",config:!1,type:Array,default:p.tokenConfigs,onChange:e=>p.tokenConfigs=e}),game.settings.registerMenu("token-variants","tokenHUDSettings",{name:game.i18n.localize("token-variants.settings.token-hud.Name"),hint:game.i18n.localize("token-variants.settings.token-hud.Hint"),scope:"client",icon:"fas fa-images",type:TokenHUDClientSettings,restricted:!1}),game.settings.registerMenu("token-variants","compendiumMapper",{name:game.i18n.localize("token-variants.settings.compendium-mapper.Name"),hint:game.i18n.localize("token-variants.settings.compendium-mapper.Hint"),scope:"world",icon:"fas fa-cogs",type:o.A,restricted:!0}),game.settings.register("token-variants","compendiumMapper",{scope:"world",config:!1,type:Object,default:p.compendiumMapper,onChange:e=>p.compendiumMapper=e}),game.settings.register("token-variants","hudSettings",{scope:"client",config:!1,type:Object,default:p.hud,onChange:e=>p.hud=e}),game.settings.registerMenu("token-variants","importExport",{name:"Import/Export",hint:game.i18n.localize("token-variants.settings.import-export.Hint"),scope:"world",icon:"fas fa-toolbox",type:ImportExport,restricted:!0});const e=game.settings.get("token-variants","settings");foundry.utils.mergeObject(p,e),foundry.utils.isEmpty(p.searchFilters)&&a.PO.forEach((e=>{p.searchFilters[e]={include:"",exclude:"",regex:""}}));for(let e in p.forgeSearchPaths)p.forgeSearchPaths[e].paths=p.forgeSearchPaths[e].paths.map((e=>(e.source||(e.source="forgevtt"),e.types||(e.tiles?e.types=["Tile"]:e.types=["Portrait","Token","PortraitAndToken"]),e)));"Object"===foundry.utils.getType(e.globalMappings)&&Hooks.once("ready",(()=>{p.globalMappings=d(e.globalMappings),setTimeout((()=>v({globalMappings:p.globalMappings})),1e4)})),p.hud=game.settings.get("token-variants","hudSettings")}function d(e,t=[]){if(!e)return[];if("Object"===foundry.utils.getType(e)){let i=[];for(const[t,a]of Object.entries(e))a.label||(a.label=t.replaceAll("¶",".")),a.expression||(a.expression=t.replaceAll("¶",".")),a.id||(a.id=foundry.utils.randomID(8)),delete a.effect,a.overlayConfig&&(a.overlayConfig.id=a.id),delete a.overlayConfig?.effect,i.push(a);let a=i.concat(t);for(const e of i)if(e.overlayConfig?.parent){if("Token (Placeable)"===e.overlayConfig.parent)e.overlayConfig.parentID="TOKEN";else{const t=a.find((t=>t.label===e.overlayConfig.parent));e.overlayConfig.parentID=t?t.id:""}delete e.overlayConfig.parent}e=i}for(const t of e)t.overlay&&t.overlayConfig&&(!t.imgSrc||t.overlayConfig.img||t.overlayConfig.text?.text||t.overlayConfig.shapes?.length||(t.overlayConfig.img=t.imgSrc,t.imgSrc="",t.imgName=""));return e}function h(e){if(!e)return[];let t=e.document??e;const i=t.actor?.id;if(i&&(t=game.actors.get(i),!t))return[];let a=t.getFlag("token-variants","effectMappings")??[];return"Object"===foundry.utils.getType(a)&&(a=d(a,p.globalMappings),t.setFlag("token-variants","effectMappings",a)),a}function g(){const e=foundry.utils.deepClone(p);saveDataToFile(JSON.stringify(e,null,2),"text/json","token-variants-settings.json")}async function m(e){if("string"==typeof e&&(e=JSON.parse(e)),e.forgeSearchPaths)for(let t in e.forgeSearchPaths)e.forgeSearchPaths[t].paths=e.forgeSearchPaths[t].paths.map((e=>(e.source||(e.source="forgevtt"),e.types||(e.tiles?e.types=["Tile"]:e.types=["Portrait","Token","PortraitAndToken"]),e)));if(e.searchFilters&&null!=e.searchFilters.portraitFilterInclude){const t=e.searchFilters;e.searchFilters={Portrait:{include:t.portraitFilterInclude??"",exclude:t.portraitFilterExclude??"",regex:t.portraitFilterRegex??""},Token:{include:t.tokenFilterInclude??"",exclude:t.tokenFilterExclude??"",regex:t.tokenFilterRegex??""},PortraitAndToken:{include:t.generalFilterInclude??"",exclude:t.generalFilterExclude??"",regex:t.generalFilterRegex??""}},e.compendiumMapper&&delete e.compendiumMapper.searchFilters}if(e.globalMappings){const t=d(e.globalMappings);for(const e of t){const t=p.globalMappings.findIndex((t=>e.label===t.label));-1===t?p.globalMappings.push(e):p.globalMappings[t]=e}e.globalMappings=p.globalMappings}v(e)}function y(e,t,i=!1){const n=a.PO.concat(t??p.customImageCategories);for(const t in e)n.includes(t)||(delete e[t],i&&delete p.searchFilters[t]);for(const i of t)null==e[i]&&(e[i]={include:"",exclude:"",regex:""})}async function v(e){const t=foundry.utils.mergeObject(foundry.utils.deepClone(p),e,{insertKeys:!1});"customImageCategories"in e&&(y(t.searchFilters,e.customImageCategories,!0),null!=t.compendiumMapper?.searchOptions?.searchFilters&&(y(t.compendiumMapper.searchOptions.searchFilters,e.customImageCategories),p.compendiumMapper.searchOptions.searchFilters=t.compendiumMapper.searchOptions.searchFilters)),await game.settings.set("token-variants","settings",t)}function k(e,t,{inner:i=!1}={}){return Object.keys(t).reduce(((a,n)=>{if(i&&!(n in e))return a;let[o,r]=function(e,t){let a=foundry.utils.getType(e);if(a!==foundry.utils.getType(t))return[!0,t];if("Array"===a)return[!b(e,t),t];if("Object"===a){if(foundry.utils.isEmpty(e)!==foundry.utils.isEmpty(t))return[!0,t];let a=k(e,t,{inner:i});return[!foundry.utils.isEmpty(a),a]}return[e!==t,t]}(e[n],t[n]);return o&&(a[n]=r),a}),{})}function b(e,t){return t instanceof Array&&t.length===e.length&&e.every(((e,i)=>"Object"===foundry.utils.getType(e)?0===Object.keys(k(e,t[i])).length:t[i]===e))}function _(){return{keywordSearch:p.keywordSearch,excludedKeywords:p.excludedKeywords,runSearchOnPath:p.runSearchOnPath,algorithm:p.algorithm,searchFilters:p.searchFilters}}}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var i=__webpack_module_cache__[e]={exports:{}};return __webpack_modules__[e](i,i.exports,__webpack_require__),i.exports}__webpack_require__.d=(e,t)=>{for(var i in t)__webpack_require__.o(t,i)&&!__webpack_require__.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},__webpack_require__.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var __webpack_exports__=__webpack_require__(652)})();
//# sourceMappingURL=bundle.js.map