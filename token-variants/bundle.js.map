{"version":3,"file":"bundle.js","mappings":"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","sources":["webpack:///./token-variants/applications/configJsonEdit.js","webpack:///./token-variants/applications/configScriptEdit.js","webpack:///./token-variants/applications/effectMappingForm.js","webpack:///./token-variants/scripts/hooks/effectIconHooks.js","webpack:///./token-variants/scripts/hooks/artSelectButtonHooks.js","webpack:///./token-variants/applications/tileHUD.js","webpack:///./token-variants/scripts/hooks/hudHooks.js","webpack:///./token-variants/scripts/hooks/userMappingHooks.js","webpack:///./token-variants/scripts/hooks/wildcardHooks.js","webpack:///./token-variants/scripts/hooks/popUpRandomizeHooks.js","webpack:///./token-variants/scripts/hooks/hooks.js","webpack:///./token-variants/applications/dialogs.js","webpack:///./token-variants/scripts/models.js","webpack:///./token-variants/applications/tokenCustomConfig.js","webpack:///./token-variants/applications/configureSettings.js","webpack:///./token-variants/scripts/sprite/TVAOverlay.js","webpack:///./token-variants/applications/userList.js","webpack:///./token-variants/applications/flagsConfig.js","webpack:///./token-variants/scripts/mappingTemplates.js","webpack:///./token-variants/scripts/hooks/effectMappingHooks.js","webpack:///./token-variants/scripts/wrappers/userMappingWrappers.js","webpack:///./token-variants/scripts/hooks/overlayHooks.js","webpack:///./token-variants/applications/overlayConfig.js","webpack:///./token-variants/scripts/token/overlay.js","webpack:///./token-variants/scripts/utils.js","webpack:///./token-variants/token-variants.mjs","webpack:///./token-variants/scripts/wrappers/effectIconWrappers.js","webpack:///./token-variants/scripts/wrappers/hideElementWrappers.js","webpack:///./token-variants/scripts/wrappers/hudWrappers.js","webpack:///./token-variants/scripts/wrappers/wrappers.js","webpack:///./token-variants/applications/randomizerConfig.js","webpack:///./token-variants/scripts/helpers/domPresets.js","webpack:///./token-variants/applications/tokenHUD.js","webpack:///./token-variants/applications/missingImageConfig.js","webpack:///./token-variants/applications/compendiumMap.js","webpack:///./token-variants/scripts/reticle.js","webpack:///./token-variants/scripts/sprite/HTMLOverlay.js","webpack:///./token-variants/applications/artSelect.js","webpack:///./token-variants/scripts/fuse/fuse.js","webpack:///./token-variants/scripts/search.js","webpack:///./token-variants/applications/templates.js","webpack:///./token-variants/applications/forgeSearchPaths.js","webpack:///./token-variants/applications/tokenHUDClientSettings.js","webpack:///./token-variants/applications/importExport.js","webpack:///./token-variants/scripts/settings.js","webpack:///webpack/bootstrap","webpack:///webpack/runtime/define property getters","webpack:///webpack/runtime/hasOwnProperty shorthand","webpack:///webpack/startup"],"sourcesContent":["export default class EditJsonConfig extends FormApplication {\n  constructor(config, callback) {\n    super({}, {});\n    this.config = config;\n    this.callback = callback;\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: 'token-variants-config-json-edit',\n      classes: ['sheet'],\n      template: 'modules/token-variants/token-variants/templates/configJsonEdit.html',\n      resizable: true,\n      minimizable: false,\n      title: 'Edit Token Configuration',\n      width: 400,\n      height: 380,\n    });\n  }\n\n  async getData(options) {\n    const data = super.getData(options);\n\n    data.hasConfig = this.config != null && Object.keys(this.config).length !== 0;\n    data.config = JSON.stringify(data.hasConfig ? this.config : {}, null, 2);\n\n    return data;\n  }\n\n  /**\n   * @param {JQuery} html\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.on('input', '.command textarea', this._validateJSON.bind(this));\n    // Override 'Tab' key to insert spaces\n    html.on('keydown', '.command textarea', function (e) {\n      if (e.key === 'Tab' && !e.shiftKey) {\n        e.preventDefault();\n        var start = this.selectionStart;\n        var end = this.selectionEnd;\n        this.value = this.value.substring(0, start) + '  ' + this.value.substring(end);\n        this.selectionStart = this.selectionEnd = start + 2;\n        return false;\n      }\n    });\n\n    html.querySelector('.remove').click(this._onRemove.bind(this));\n    html.querySelector('.format').click(this._onFormat.bind(this));\n  }\n\n  async _validateJSON(event) {\n    const controls = event.target.closest('form').find('button[type=\"submit\"], button.format');\n    try {\n      this.config = JSON.parse(event.target.value);\n      this.config = foundry.utils.expandObject(this.config);\n      this.flag = this.config.flag;\n      controls.prop('disabled', false);\n    } catch (e) {\n      controls.prop('disabled', true);\n    }\n  }\n\n  async _onRemove(event) {\n    this.config = {};\n    this.submit();\n  }\n\n  async _onFormat(event) {\n    event.target.closest('form').find('textarea[name=\"config\"]').val(JSON.stringify(this.config, null, 2));\n  }\n\n  /**\n   * @param {Event} event\n   * @param {Object} formData\n   */\n  async _updateObject(event, formData) {\n    if (this.callback) this.callback(this.config);\n  }\n}\n","export default class EditScriptConfig extends FormApplication {\n  constructor(script, callback) {\n    super({}, {});\n    this.script = script;\n    this.callback = callback;\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: 'token-variants-config-script-edit',\n      classes: ['sheet'],\n      template: 'modules/token-variants/token-variants/templates/configScriptEdit.html',\n      resizable: true,\n      minimizable: false,\n      title: 'Scripts',\n      width: 640,\n      height: 640,\n    });\n  }\n\n  async getData(options) {\n    const data = super.getData(options);\n\n    const script = this.script ? this.script : {};\n    data.hasScript = !foundry.utils.isEmpty(script);\n    data.onApply = script.onApply;\n    data.onRemove = script.onRemove;\n    data.macroOnApply = script.macroOnApply;\n    data.macroOnRemove = script.macroOnRemove;\n\n    data.tmfxPreset = script.tmfxPreset;\n    data.tmfxActive = game.modules.get('tokenmagic')?.active;\n    if (data.tmfxActive) {\n      data.tmfxPresets = TokenMagic.getPresets().map((p) => p.name);\n    }\n\n    data.ceActive = game.modules.get('dfreds-convenient-effects')?.active;\n    if (data.ceActive) {\n      data.ceEffect = script.ceEffect ?? { apply: true, remove: true };\n      data.ceEffects = game.dfreds.effectInterface.findEffects().map((ef) => ef.name);\n    }\n\n    data.macros = game.macros.map((m) => m.name);\n\n    return data;\n  }\n\n  /**\n   * @param {JQuery} html\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n    // Override 'Tab' key to insert spaces\n    html.on('keydown', '.command textarea', function (e) {\n      if (e.key === 'Tab' && !e.shiftKey) {\n        e.preventDefault();\n        var start = this.selectionStart;\n        var end = this.selectionEnd;\n        this.value = this.value.substring(0, start) + '  ' + this.value.substring(end);\n        this.selectionStart = this.selectionEnd = start + 2;\n        return false;\n      }\n    });\n\n    html.querySelector('.remove').click(this._onRemove.bind(this));\n  }\n\n  async _onRemove(event) {\n    if (this.callback) this.callback(null);\n    this.close();\n  }\n\n  /**\n   * @param {Event} event\n   * @param {Object} formData\n   */\n  async _updateObject(event, formData) {\n    formData = foundry.utils.expandObject(formData);\n    ['onApply', 'onRemove', 'macroOnApply', 'macroOnRemove'].forEach((k) => {\n      formData[k] = formData[k].trim();\n    });\n    if (formData.ceEffect?.name) formData.ceEffect.name = formData.ceEffect.name.trim();\n\n    if (\n      !formData.onApply &&\n      !formData.onRemove &&\n      !formData.tmfxPreset &&\n      !formData.ceEffect.name &&\n      !formData.macroOnApply &&\n      !formData.macroOnRemove\n    ) {\n      if (this.callback) this.callback(null);\n    } else {\n      if (this.callback) this.callback(formData);\n    }\n  }\n}\n","import { showArtSelect } from \"../token-variants.mjs\";\nimport {\n  SEARCH_TYPE,\n  getFileName,\n  isVideo,\n  keyPressed,\n  mergeMappings,\n} from \"../scripts/utils.js\";\nimport TokenCustomConfig from \"./tokenCustomConfig.js\";\nimport {\n  TVA_CONFIG,\n  getFlagMappings,\n  migrateMappings,\n  updateSettings,\n} from \"../scripts/settings.js\";\nimport EditJsonConfig from \"./configJsonEdit.js\";\nimport EditScriptConfig from \"./configScriptEdit.js\";\nimport { OverlayConfig } from \"./overlayConfig.js\";\nimport {\n  showMappingSelectDialog,\n  showOverlayJsonConfigDialog,\n  showTokenCaptureDialog,\n} from \"./dialogs.js\";\nimport { DEFAULT_ACTIVE_EFFECT_CONFIG } from \"../scripts/models.js\";\nimport { updateWithEffectMapping } from \"../scripts/hooks/effectMappingHooks.js\";\nimport { drawOverlays } from \"../scripts/token/overlay.js\";\nimport { Templates } from \"./templates.js\";\n\n// Persist group toggles across forms\nlet TOGGLED_GROUPS;\nconst NO_IMAGE = \"modules\\\\token-variants\\\\img\\\\empty.webp\";\n\nexport default class EffectMappingForm extends FormApplication {\n  constructor(\n    token,\n    { globalMappings = false, callback = null, createMapping = null } = {},\n  ) {\n    super({}, {});\n\n    this.token = token;\n    if (globalMappings) {\n      this.globalMappings = foundry.utils\n        .deepClone(TVA_CONFIG.globalMappings)\n        .filter(Boolean);\n    }\n    if (!globalMappings) this.objectToFlag = game.actors.get(token.actorId);\n    this.callback = callback;\n    TOGGLED_GROUPS = game.settings.get(\n      \"token-variants\",\n      \"effectMappingToggleGroups\",\n    ) || {\n      Default: true,\n    };\n    this.createMapping = createMapping;\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: \"token-variants-active-effect-config\",\n      classes: [\"sheet\"],\n      template:\n        \"modules/token-variants/token-variants/templates/effectMappingForm.html\",\n      resizable: true,\n      minimizable: false,\n      closeOnSubmit: false,\n      width: 1020,\n      height: \"auto\",\n      scrollY: [\"ol.token-variant-table\"],\n    });\n  }\n\n  get title() {\n    let scope = \"GLOBAL\";\n    if (!this.globalMappings) scope = this.objectToFlag.name;\n    return `[${scope}] Mappings`;\n  }\n\n  _processConfig(mapping) {\n    if (!mapping.config) mapping.config = {};\n    let hasTokenConfig = Object.keys(mapping.config).filter(\n      (k) => mapping.config[k],\n    ).length;\n    if (mapping.config.flags) hasTokenConfig--;\n    if (mapping.config.tv_script) hasTokenConfig--;\n\n    return {\n      id: mapping.id || foundry.utils.randomID(8),\n      label: mapping.label,\n      expression: mapping.expression,\n      codeExp: mapping.codeExp,\n      hasCodeExp: Boolean(mapping.codeExp),\n      highlightedExpression: highlightOperators(mapping.expression),\n      imgName: mapping.imgName,\n      imgSrc: mapping.imgSrc,\n      isVideo: mapping.imgSrc ? isVideo(mapping.imgSrc) : false,\n      priority: mapping.priority,\n      hasConfig: mapping.config\n        ? !foundry.utils.isEmpty(mapping.config)\n        : false,\n      hasScript: mapping.config && mapping.config.tv_script,\n      hasTokenConfig: hasTokenConfig > 0,\n      config: mapping.config,\n      overlay: mapping.overlay,\n      alwaysOn: mapping.alwaysOn,\n      tokens: mapping.tokens,\n      tokensString: mapping.tokens?.join(\",\") ?? \"\",\n      tokenIDs: mapping.tokens?.length\n        ? \"Assigned Tokens\\n\" +\n          mapping.tokens.join(\"\\n\") +\n          \"\\n\\n[CLICK TO UNASSIGN]\"\n        : \"\",\n      disabled: mapping.disabled,\n      overlayConfig: mapping.overlayConfig,\n      targetActors: mapping.targetActors,\n      group: mapping.group,\n      parentID: mapping.overlayConfig?.parentID,\n    };\n  }\n\n  async getData(options) {\n    const data = super.getData(options);\n\n    data.NO_IMAGE = NO_IMAGE;\n\n    let mappings = [];\n    if (this.object.mappings) {\n      mappings = this.object.mappings.map(this._processConfig);\n    } else {\n      const effectMappings =\n        this.globalMappings ?? getFlagMappings(this.objectToFlag);\n      mappings = effectMappings.map(this._processConfig);\n\n      if (\n        this.createMapping &&\n        !effectMappings.find(\n          (m) => m.expression === this.createMapping.expression,\n        )\n      ) {\n        mappings.push(\n          this._processConfig(this._getNewEffectConfig(this.createMapping)),\n        );\n      }\n      this.createMapping = null;\n    }\n\n    mappings = mappings.sort((m1, m2) => {\n      if (!m1.label && m2.label) return -1;\n      else if (m1.label && !m2.label) return 1;\n\n      if (!m1.overlayConfig?.parentID && m2.overlayConfig?.parentID) return -1;\n      else if (m1.overlayConfig?.parentID && !m2.overlayConfig?.parentID)\n        return 1;\n\n      let priorityDiff = m1.priority - m2.priority;\n      if (priorityDiff === 0) return m1.label.localeCompare(m2.label);\n      return priorityDiff;\n    });\n\n    const [sMappings, groupedMappings] = sortMappingsToGroups(mappings);\n    data.groups = Object.keys(groupedMappings);\n\n    this.object.mappings = sMappings;\n    data.groupedMappings = groupedMappings;\n    data.global = Boolean(this.globalMappings);\n    return data;\n  }\n\n  /**\n   * @param {JQuery} html\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.querySelector(\".delete-mapping\").click(this._onRemove.bind(this));\n    html.querySelector(\".clone-mapping\").click(this._onClone.bind(this));\n    html.querySelector(\".create-mapping\").click(this._onCreate.bind(this));\n    html.querySelector(\".save-mappings\").click(this._onSaveMappings.bind(this));\n    html\n      .querySelector(\".save-mappings-close\")\n      .click(this._onSaveMappingsClose.bind(this));\n    if (TVA_CONFIG.permissions.image_path_button[game.user.role]) {\n      html\n        .querySelector(\".mapping-image img\")\n        .click(this._onImageClick.bind(this));\n      html\n        .querySelector(\".mapping-image img\")\n        .mousedown(this._onImageMouseDown.bind(this));\n      html\n        .querySelector(\".mapping-image video\")\n        .click(this._onImageClick.bind(this));\n      html\n        .querySelector(\".mapping-target.btn\")\n        .click(this._onConfigureApplicableActors.bind(this));\n    }\n    html\n      .querySelector(\".mapping-image img\")\n      .contextmenu(this._onImageRightClick.bind(this));\n    html\n      .querySelector(\".mapping-image video\")\n      .contextmenu(this._onImageRightClick.bind(this));\n    html\n      .querySelector(\".mapping-config i.config\")\n      .click(this._onConfigClick.bind(this));\n    html\n      .querySelector(\".mapping-config i.config-edit\")\n      .click(this._onConfigEditClick.bind(this));\n    html\n      .querySelector(\".mapping-config i.config-script\")\n      .click(this._onConfigScriptClick.bind(this));\n    html\n      .querySelector(\".mapping-overlay i.overlay-config\")\n      .click(this._onOverlayConfigClick.bind(this));\n    html.on(\n      \"contextmenu\",\n      \".mapping-overlay i.overlay-config\",\n      this._onOverlayConfigRightClick.bind(this),\n    );\n    html\n      .querySelector(\".mapping-overlay input\")\n      .on(\"change\", this._onOverlayChange)\n      .trigger(\"change\");\n    html\n      .querySelector(\".div-input\")\n      .on(\"input paste focus\", this._onExpressionChange);\n    const app = this;\n    html\n      .find(\".group-toggle > a\")\n      .on(\"click\", this._onGroupToggle.bind(this))\n      .each(function () {\n        const group = this.closest(\".group-toggle\");\n        const groupName = group.data(\"group\");\n        if (!TOGGLED_GROUPS[groupName]) {\n          this.trigger(\"click\");\n        }\n      });\n    this.setPosition({ width: 1020 });\n    html\n      .querySelector(\".mapping-disable > input\")\n      .on(\"change\", this._onDisable.bind(this));\n    html\n      .querySelector(\".group-disable > a\")\n      .on(\"click\", this._onGroupDisable.bind(this));\n    html\n      .querySelector(\".group-delete\")\n      .on(\"click\", this._onGroupDelete.bind(this));\n    html\n      .querySelector(\".mapping-group > input\")\n      .on(\"change\", this._onGroupChange.bind(this));\n    html\n      .querySelector(\".expression-switch\")\n      .on(\"click\", this._onExpressionSwitch.bind(this));\n    html\n      .find(\".expression-code textarea\")\n      .focus((event) =>\n        event.target.animate({ height: \"10em\" }, 500, () => this.setPosition()),\n      )\n      .focusout((event) =>\n        event.target.animate({ height: \"1em\" }, 500, () => {\n          if (this._state === Application.RENDER_STATES.RENDERED)\n            this.setPosition();\n        }),\n      );\n    html.querySelector(\".tokens\").on(\"click\", this._onTokensRemove.bind(this));\n  }\n\n  async _onTokensRemove(event) {\n    await this._onSubmit(event);\n\n    const li = event.currentTarget.closest(\".table-row\");\n    const mapping = this.object.mappings[li.dataset.index];\n    mapping.tokens = undefined;\n\n    this.render();\n  }\n\n  _onExpressionSwitch(event) {\n    const container = event.target.closest(\".expression-container\");\n    const divInput = container.find(\".div-input\");\n    const codeExp = container.find(\".expression-code\");\n\n    if (codeExp.hasClass(\"hidden\")) {\n      codeExp.removeClass(\"hidden\");\n      divInput.addClass(\"hidden\");\n    } else {\n      codeExp.addClass(\"hidden\");\n      divInput.removeClass(\"hidden\");\n    }\n  }\n\n  async _onDisable(event) {\n    const groupName = event.target.closest(\".table-row\").data(\"group\");\n    const disableGroupToggle = event.target\n      .closest(\".token-variant-table\")\n      .find(`.group-disable[data-group=\"${groupName}\"]`);\n\n    const checkboxes = event.target\n      .closest(\".token-variant-table\")\n      .find(`[data-group=\"${groupName}\"] > .mapping-disable`);\n    const numChecked = checkboxes.find(\"input:checked\").length;\n\n    if (checkboxes.length !== numChecked) {\n      disableGroupToggle.addClass(\"active\");\n    } else disableGroupToggle.removeClass(\"active\");\n  }\n\n  async _onGroupDisable(event) {\n    const group = event.target.closest(\".group-disable\");\n    const groupName = group.data(\"group\");\n    const chks = event.target\n      .closest(\"form\")\n      .find(`[data-group=\"${groupName}\"]`)\n      .find(\".mapping-disable > input\");\n\n    if (group.hasClass(\"active\")) {\n      group.removeClass(\"active\");\n      chks.prop(\"checked\", true);\n    } else {\n      group.addClass(\"active\");\n      chks.prop(\"checked\", false);\n    }\n  }\n\n  async _onGroupDelete(event) {\n    const group = event.target.closest(\".group-delete\");\n    const groupName = group.data(\"group\");\n    await this._onSubmit(event);\n    this.object.mappings = this.object.mappings.filter(\n      (m) => m.group !== groupName,\n    );\n    this.render();\n  }\n\n  async _onGroupChange(event) {\n    const input = event.target;\n    let group = input.val().trim();\n    if (!group) group = \"Default\";\n    input.val(group);\n\n    await this._onSubmit(event);\n    this.render();\n  }\n\n  _onGroupToggle(event) {\n    const group = event.target.closest(\".group-toggle\");\n    const groupName = group.data(\"group\");\n    const form = event.target.closest(\"form\");\n    form.find(`li[data-group=\"${groupName}\"]`).toggle();\n    if (group.hasClass(\"active\")) {\n      group.removeClass(\"active\");\n      group.find(\"i\").addClass(\"fa-rotate-180\");\n      TOGGLED_GROUPS[groupName] = false;\n    } else {\n      group.addClass(\"active\");\n      group.find(\"i\").removeClass(\"fa-rotate-180\");\n      TOGGLED_GROUPS[groupName] = true;\n    }\n    game.settings.set(\n      \"token-variants\",\n      \"effectMappingToggleGroups\",\n      TOGGLED_GROUPS,\n    );\n    this.setPosition({ height: \"auto\" });\n  }\n\n  async _onExpressionChange(event) {\n    var el = event.target;\n\n    // Update the hidden input field so that the text entered in the div will be submitted via the form\n    el.siblings(\"input\").val(event.target.innerText);\n\n    // The rest of the function is to handle operator highlighting and management of the caret position\n\n    if (!el.childNodes.length) return;\n\n    // Calculate the true/total caret offset within the div\n    const sel = window.getSelection();\n    const focusNode = sel.focusNode;\n    let offset = sel.focusOffset;\n\n    for (const ch of el.childNodes) {\n      if (ch === focusNode || ch.childNodes[0] === focusNode) break;\n      offset += ch.nodeName === \"SPAN\" ? ch.innerText.length : ch.length;\n    }\n\n    // Highlight the operators and update the div\n    let text = highlightOperators(event.target.innerText);\n    event.target.html(text);\n\n    // Set the new caret position with the div\n    setCaretPosition(el, offset);\n  }\n\n  async _onOverlayChange(event) {\n    if (event.target.checked) {\n      event.target.siblings(\"a\").show();\n    } else {\n      event.target.siblings(\"a\").hide();\n    }\n  }\n\n  async _onOverlayConfigClick(event) {\n    const li = event.currentTarget.closest(\".table-row\");\n    const mapping = this.object.mappings[li.dataset.index];\n\n    new OverlayConfig(\n      mapping.overlayConfig,\n      (config) => {\n        mapping.overlayConfig = config;\n        const gear = li.find(\".mapping-overlay > a\");\n        if (config?.parentID && config.parentID !== \"TOKEN\") {\n          gear.addClass(\"child\");\n          gear.attr(\"title\", \"Child Of: \" + config.parentID);\n        } else {\n          gear.removeClass(\"child\");\n          gear.attr(\"title\", \"\");\n        }\n      },\n      this.token,\n      {\n        mapping,\n        global: Boolean(this.globalMappings),\n        actor: this.objectToFlag,\n      },\n    ).render(true);\n  }\n\n  async _onOverlayConfigRightClick(event) {\n    const li = event.currentTarget.closest(\".table-row\");\n    const mapping = this.object.mappings[li.dataset.index];\n    showOverlayJsonConfigDialog(\n      mapping.overlayConfig,\n      (config) => (mapping.overlayConfig = config),\n    );\n  }\n\n  async _toggleActiveControls(event) {\n    const li = event.currentTarget.closest(\".table-row\");\n    const mapping = this.object.mappings[li.dataset.index];\n    const tokenConfig = event.target.closest(\".mapping-config\").find(\".config\");\n    const configEdit = event.target\n      .closest(\".mapping-config\")\n      .find(\".config-edit\");\n    const scriptEdit = event.target\n      .closest(\".mapping-config\")\n      .find(\".config-script\");\n\n    let hasTokenConfig = Object.keys(mapping.config).filter(\n      (k) => mapping.config[k],\n    ).length;\n    if (mapping.config.flags) hasTokenConfig--;\n    if (mapping.config.tv_script) hasTokenConfig--;\n\n    if (hasTokenConfig) tokenConfig.addClass(\"active\");\n    else tokenConfig.removeClass(\"active\");\n\n    if (Object.keys(mapping.config).filter((k) => mapping.config[k]).length)\n      configEdit.addClass(\"active\");\n    else configEdit.removeClass(\"active\");\n\n    if (mapping.config.tv_script) scriptEdit.addClass(\"active\");\n    else scriptEdit.removeClass(\"active\");\n  }\n\n  async _onConfigScriptClick(event) {\n    const li = event.currentTarget.closest(\".table-row\");\n    const mapping = this.object.mappings[li.dataset.index];\n\n    new EditScriptConfig(mapping.config?.tv_script, (script) => {\n      if (!mapping.config) mapping.config = {};\n      if (script) mapping.config.tv_script = script;\n      else delete mapping.config.tv_script;\n      this._toggleActiveControls(event);\n    }).render(true);\n  }\n\n  async _onConfigEditClick(event) {\n    const li = event.currentTarget.closest(\".table-row\");\n    const mapping = this.object.mappings[li.dataset.index];\n\n    new EditJsonConfig(mapping.config, (config) => {\n      mapping.config = config;\n      this._toggleActiveControls(event);\n    }).render(true);\n  }\n\n  async _onConfigClick(event) {\n    const li = event.currentTarget.closest(\".table-row\");\n    const mapping = this.object.mappings[li.dataset.index];\n    new TokenCustomConfig(\n      this.token,\n      {},\n      null,\n      null,\n      (config) => {\n        if (!config || foundry.utils.isEmpty(config)) {\n          config = {};\n          config.tv_script = mapping.config.tv_script;\n          config.flags = mapping.config.flags;\n        }\n        mapping.config = config;\n        this._toggleActiveControls(event);\n      },\n      mapping.config ? mapping.config : {},\n    ).render(true);\n  }\n\n  _removeImage(event) {\n    const vid = event.target.closest(\".mapping-image\").find(\"video\");\n    const img = event.target.closest(\".mapping-image\").find(\"img\");\n    vid.add(img).attr(\"src\", \"\").attr(\"title\", \"\");\n    vid.hide();\n    img.show();\n    img.attr(\"src\", NO_IMAGE);\n    event.target.siblings(\".imgSrc\").val(\"\");\n    event.target.siblings(\".imgName\").val(\"\");\n  }\n\n  async _onImageMouseDown(event) {\n    if (event.which === 2) {\n      this._removeImage(event);\n    }\n  }\n\n  async _onImageClick(event) {\n    if (keyPressed(\"config\")) {\n      this._removeImage(event);\n      return;\n    }\n\n    let search = this.token.name;\n    if (search === \"Unknown\") {\n      const li = event.currentTarget.closest(\".table-row\");\n      const mapping = this.object.mappings[li.dataset.index];\n      search = mapping.label;\n    }\n\n    showArtSelect(search, {\n      searchType: SEARCH_TYPE.TOKEN,\n      callback: (imgSrc, imgName) => {\n        const vid = event.target.closest(\".mapping-image\").find(\"video\");\n        const img = event.target.closest(\".mapping-image\").find(\"img\");\n        vid.add(img).attr(\"src\", imgSrc).attr(\"title\", imgName);\n        if (isVideo(imgSrc)) {\n          vid.show();\n          img.hide();\n        } else {\n          vid.hide();\n          img.show();\n        }\n        event.target.siblings(\".imgSrc\").val(imgSrc);\n        event.target.siblings(\".imgName\").val(imgName);\n      },\n    });\n  }\n\n  async _onImageRightClick(event) {\n    if (keyPressed(\"config\")) {\n      this._removeImage(event);\n      return;\n    }\n\n    const li = event.currentTarget.closest(\".table-row\");\n    const mapping = this.object.mappings[li.dataset.index];\n\n    new FilePicker({\n      type: \"imagevideo\",\n      current: mapping.imgSrc,\n      callback: (path) => {\n        const vid = event.target.closest(\".mapping-image\").find(\"video\");\n        const img = event.target.closest(\".mapping-image\").find(\"img\");\n        vid.add(img).attr(\"src\", path).attr(\"title\", getFileName(path));\n        if (isVideo(path)) {\n          vid.show();\n          img.hide();\n        } else {\n          vid.hide();\n          img.show();\n        }\n        event.target.siblings(\".imgSrc\").val(path);\n        event.target.siblings(\".imgName\").val(getFileName(path));\n      },\n    }).render();\n  }\n\n  async _onRemove(event) {\n    event.preventDefault();\n    await this._onSubmit(event);\n    const li = event.currentTarget.closest(\".table-row\");\n    this.object.mappings.splice(li.dataset.index, 1);\n    this.render();\n  }\n\n  async _onClone(event) {\n    event.preventDefault();\n    await this._onSubmit(event);\n    const li = event.currentTarget.closest(\".table-row\");\n    const clone = foundry.utils.deepClone(\n      this.object.mappings[li.dataset.index],\n    );\n    clone.label = clone.label + \" - Copy\";\n    clone.id = foundry.utils.randomID(8);\n    this.object.mappings.push(clone);\n    this.render();\n  }\n\n  async _onCreate(event) {\n    event.preventDefault();\n    await this._onSubmit(event);\n    this.object.mappings.push(this._getNewEffectConfig());\n    this.render();\n  }\n\n  _getNewEffectConfig({ label = \"\", expression = \"\" } = {}) {\n    // if (textOverlay) {\n    //   TOGGLED_GROUPS['Text Overlays'] = true;\n    //   return {\n    //     id: foundry.utils.randomID(8),\n    //     label: label,\n    //     expression: label,\n    //     highlightedExpression: highlightOperators(label),\n    //     imgName: '',\n    //     imgSrc: '',\n    //     priority: 50,\n    //     overlay: false,\n    //     alwaysOn: false,\n    //     disabled: false,\n    //     group: 'Text Overlays',\n    //     overlay: true,\n    //     overlayConfig: mergeObject(\n    //       DEFAULT_OVERLAY_CONFIG,\n    //       {\n    //         img: '',\n    //         linkScale: false,\n    //         linkRotation: false,\n    //         linkMirror: false,\n    //         offsetY: 0.5 + Math.round(Math.random() * 0.3 * 100) / 100,\n    //         offsetX: 0,\n    //         scaleX: 0.68,\n    //         scaleY: 0.68,\n    //         text: {\n    //           text: '{{effect}}',\n    //           fontFamily: CONFIG.defaultFontFamily,\n    //           fontSize: 36,\n    //           fill: new Color(Math.round(Math.random() * 16777215)).toString(),\n    //           stroke: '#000000',\n    //           strokeThickness: 2,\n    //           dropShadow: false,\n    //           curve: {\n    //             radius: 160,\n    //             invert: false,\n    //           },\n    //         },\n    //         animation: {\n    //           rotate: true,\n    //           duration: 10000 + Math.round(Math.random() * 14000) + 10000,\n    //           clockwise: true,\n    //         },\n    //       },\n    //       { inplace: false }\n    //     ),\n    //   };\n    // } else {\n    TOGGLED_GROUPS[\"Default\"] = true;\n    return foundry.utils.mergeObject(\n      foundry.utils.deepClone(DEFAULT_ACTIVE_EFFECT_CONFIG),\n      {\n        label,\n        expression,\n        id: foundry.utils.randomID(8),\n      },\n    );\n    // }\n  }\n\n  _getHeaderButtons() {\n    const buttons = super._getHeaderButtons();\n\n    buttons.unshift({\n      label: \"Export\",\n      class: \"token-variants-export\",\n      icon: \"fas fa-file-export\",\n      onclick: (ev) => this._exportConfigs(ev),\n    });\n    buttons.unshift({\n      label: \"Import\",\n      class: \"token-variants-import\",\n      icon: \"fas fa-file-import\",\n      onclick: (ev) => this._importConfigs(ev),\n    });\n\n    buttons.unshift({\n      label: \"Templates\",\n      class: \"token-variants-templates\",\n      icon: \"fa-solid fa-book\",\n      onclick: async (ev) => {\n        new Templates({\n          mappings: this.globalMappings ?? getFlagMappings(this.objectToFlag),\n          callback: (templateName, mappings) => {\n            this._insertMappings(ev, mappings);\n          },\n        }).render(true);\n      },\n    });\n\n    if (this.globalMappings) return buttons;\n\n    buttons.unshift({\n      label: \"Copy Global Config\",\n      class: \"token-variants-copy-global\",\n      icon: \"fas fa-globe\",\n      onclick: (ev) => this._copyGlobalConfig(ev),\n    });\n    buttons.unshift({\n      label: \"Open Global\",\n      class: \"token-variants-open-global\",\n      icon: \"fas fa-globe\",\n      onclick: async (ev) => {\n        await this.close();\n        new EffectMappingForm(this.token, { globalMappings: true }).render(\n          true,\n        );\n      },\n    });\n\n    buttons.unshift({\n      label: \"\",\n      class: \"token-variants-print-token\",\n      icon: \"fa fa-print\",\n      onclick: () => showTokenCaptureDialog(canvas.tokens.get(this.token._id)),\n    });\n    return buttons;\n  }\n\n  async _exportConfigs(event) {\n    let filename = \"\";\n\n    let mappings = await new Promise((resolve) => {\n      showMappingSelectDialog(\n        this.globalMappings ?? getFlagMappings(this.objectToFlag),\n        { callback: resolve },\n      );\n    });\n\n    if (mappings && !foundry.utils.isEmpty(mappings)) {\n      if (this.globalMappings) {\n        filename = \"token-variants-global-mappings.json\";\n      } else {\n        let actorName = this.objectToFlag.name ?? \"Actor\";\n        actorName = actorName.replace(/[/\\\\?%*:|\"<>]/g, \"-\");\n        filename = \"token-variants-\" + actorName + \".json\";\n      }\n      saveDataToFile(\n        JSON.stringify({ globalMappings: mappings }, null, 2),\n        \"text/json\",\n        filename,\n      );\n    }\n  }\n\n  async _importConfigs(event) {\n    const content = await renderTemplate(\"templates/apps/import-data.html\", {\n      entity: \"token-variants\",\n      name: \"settings\",\n    });\n    let dialog = new Promise((resolve, reject) => {\n      new Dialog(\n        {\n          title: \"Import Effect Configurations\",\n          content: content,\n          buttons: {\n            import: {\n              icon: '<i class=\"fas fa-file-import\"></i>',\n              label: game.i18n.localize(\"token-variants.common.import\"),\n              callback: (html) => {\n                const form = html.querySelector(\"form\")[0];\n                if (!form.data.files.length)\n                  return ui.notifications?.error(\n                    \"You did not upload a data file!\",\n                  );\n                readTextFromFile(form.data.files[0]).then((json) => {\n                  json = JSON.parse(json);\n                  if (!json || !(\"globalMappings\" in json)) {\n                    return ui.notifications?.error(\n                      \"No mappings found within the file!\",\n                    );\n                  }\n\n                  this._insertMappings(\n                    event,\n                    migrateMappings(json.globalMappings),\n                  );\n                  resolve(true);\n                });\n              },\n            },\n            no: {\n              icon: '<i class=\"fas fa-times\"></i>',\n              label: \"Cancel\",\n              callback: (html) => resolve(false),\n            },\n          },\n          default: \"import\",\n        },\n        {\n          width: 400,\n        },\n      ).render(true);\n    });\n    return await dialog;\n  }\n\n  _copyGlobalConfig(event) {\n    showMappingSelectDialog(TVA_CONFIG.globalMappings, {\n      title1: \"Global Mappings\",\n      title2: \"Select Mappings to Copy:\",\n      buttonTitle: \"Copy\",\n      callback: (mappings) => {\n        this._insertMappings(event, mappings);\n      },\n    });\n  }\n\n  async _insertMappings(event, mappings) {\n    const cMappings = foundry.utils\n      .deepClone(mappings)\n      .map(this._processConfig);\n    await this._onSubmit(event);\n    mergeMappings(cMappings, this.object.mappings);\n    this.render();\n  }\n\n  _onConfigureApplicableActors(event) {\n    const li = event.currentTarget.closest(\".table-row\");\n    const mapping = this.object.mappings[li.dataset.index];\n\n    let actorTypes = Object.keys(game.system.documentTypes.Actor);\n    let actors = [];\n    for (const t of actorTypes) {\n      const label = CONFIG[\"Actor\"]?.typeLabels?.[t] ?? t;\n      actors.push({\n        id: t,\n        label: game.i18n.has(label) ? game.i18n.localize(label) : t,\n        enabled: !mapping.targetActors || mapping.targetActors.includes(t),\n      });\n    }\n\n    let content = '<form style=\"overflow-y: scroll; height:250x;\">';\n    for (const act of actors) {\n      content += `\n      <div class=\"form-group\">\n        <label>${act.label}</label>\n        <div class=\"form-fields\">\n            <input type=\"checkbox\" name=\"${act.id}\" data-dtype=\"Boolean\" ${act.enabled ? \"checked\" : \"\"}>\n        </div>\n      </div>\n      `;\n    }\n    content += `</form><div class=\"form-group\"><button type=\"button\" class=\"select-all\">Select all</div>`;\n\n    new Dialog({\n      title: `Configure Applicable Actors`,\n      content: content,\n      buttons: {\n        Ok: {\n          label: `Save`,\n          callback: async (html) => {\n            let targetActors = [];\n            html.querySelector('input[type=\"checkbox\"]').each(function () {\n              if (this.checked) {\n                targetActors.push(this.name);\n              }\n            });\n            mapping.targetActors = targetActors;\n          },\n        },\n      },\n      render: (html) => {\n        html.querySelector(\".select-all\").click(() => {\n          html.querySelector('input[type=\"checkbox\"]').prop(\"checked\", true);\n        });\n      },\n    }).render(true);\n  }\n\n  async _onSaveMappingsClose(event) {\n    await this._onSaveMappings(event);\n    this.close();\n  }\n\n  // TODO fix this spaghetti code related to globalMappings...\n  async _onSaveMappings(event) {\n    await this._onSubmit(event);\n    if (this.objectToFlag || this.globalMappings) {\n      // First filter out empty mappings\n      let mappings = this.object.mappings;\n      mappings = mappings.filter(\n        (m) => Boolean(m.label?.trim()) || Boolean(m.expression?.trim()),\n      );\n\n      // Make sure a priority is assigned\n      for (const mapping of mappings) {\n        mapping.priority = mapping.priority ? mapping.priority : 50;\n        mapping.overlayConfig = mapping.overlayConfig ?? {};\n        mapping.overlayConfig.label = mapping.label;\n      }\n\n      if (mappings.length !== 0) {\n        const effectMappings = mappings.map((m) =>\n          foundry.utils.mergeObject(DEFAULT_ACTIVE_EFFECT_CONFIG, m, {\n            inplace: false,\n            insertKeys: false,\n            recursive: false,\n          }),\n        );\n        if (this.globalMappings) {\n          updateSettings({ globalMappings: effectMappings });\n        } else {\n          await this.objectToFlag.setFlag(\n            \"token-variants\",\n            \"effectMappings\",\n            effectMappings,\n          );\n        }\n      } else if (this.globalMappings) {\n        updateSettings({ globalMappings: [] });\n      } else {\n        await this.objectToFlag.unsetFlag(\"token-variants\", \"effectMappings\");\n      }\n\n      const tokens = this.globalMappings\n        ? canvas.tokens.placeables\n        : this.objectToFlag.getActiveTokens();\n      for (const tkn of tokens) {\n        if (TVA_CONFIG.filterEffectIcons) {\n          await tkn.drawEffects();\n        }\n        await updateWithEffectMapping(tkn);\n        drawOverlays(tkn);\n      }\n\n      // Instruct users on other scenes to refresh the overlays\n      const message = {\n        handlerName: \"drawOverlays\",\n        args: { all: true, sceneId: canvas.scene.id },\n        type: \"UPDATE\",\n      };\n      game.socket?.emit(\"module.token-variants\", message);\n    }\n    if (this.callback) this.callback();\n  }\n\n  /**\n   * @param {Event} event\n   * @param {Object} formData\n   */\n  async _updateObject(event, formData) {\n    const mappings = foundry.utils.expandObject(formData).mappings ?? {};\n\n    // Merge form data with internal mappings\n    for (let i = 0; i < this.object.mappings.length; i++) {\n      const m1 = mappings[i];\n      const m2 = this.object.mappings[i];\n      m2.id = m1.id;\n      m2.label = m1.label.replaceAll(String.fromCharCode(160), \" \");\n      m2.expression = m1.expression.replaceAll(String.fromCharCode(160), \" \");\n      m2.codeExp = m1.codeExp?.trim();\n      m2.imgSrc = m1.imgSrc;\n      m2.imgName = m1.imgName;\n      m2.priority = m1.priority;\n      m2.overlay = m1.overlay;\n      m2.alwaysOn = m1.alwaysOn;\n      m2.tokens = m1.tokens?.split(\",\");\n      m2.disabled = m1.disabled;\n      m2.group = m1.group;\n    }\n  }\n}\n\n// Insert <span/> around operators\nfunction highlightOperators(text) {\n  // text = text.replaceAll(' ', '&nbsp;');\n\n  const re = new RegExp(\n    '([a-zA-Z0-9\\\\.\\\\-\\\\|\\\\+]+)([><=]+)(\".*?\"|-?\\\\d+)(%{0,1})',\n    `gi`,\n  );\n  text = text.replace(re, function replace(match) {\n    return '<span class=\"hp-expression\">' + match + \"</span>\";\n  });\n\n  for (const op of [\"\\\\(\", \"\\\\)\", \"&&\", \"||\", \"\\\\!\", \"\\\\*\", \"\\\\{\", \"\\\\}\"]) {\n    text = text.replaceAll(op, `<span>${op}</span>`);\n  }\n  return text;\n}\n\n// Move caret to a specific point in a DOM element\nfunction setCaretPosition(el, pos) {\n  for (var node of el.childNodes) {\n    // Check if it's a text node\n    if (node.nodeType == 3) {\n      if (node.length >= pos) {\n        var range = document.createRange(),\n          sel = window.getSelection();\n        range.setStart(node, pos);\n        range.collapse(true);\n        sel.removeAllRanges();\n        sel.addRange(range);\n        return -1; // We are done\n      } else {\n        pos -= node.length;\n      }\n    } else {\n      pos = setCaretPosition(node, pos);\n      if (pos == -1) {\n        return -1; // No need to finish the for loop\n      }\n    }\n  }\n  return pos;\n}\n\nexport function sortMappingsToGroups(mappings) {\n  mappings.sort((m1, m2) => {\n    if (!m1.label && m2.label) return -1;\n    else if (m1.label && !m2.label) return 1;\n\n    if (!m1.overlayConfig?.parentID && m2.overlayConfig?.parentID) return -1;\n    else if (m1.overlayConfig?.parentID && !m2.overlayConfig?.parentID)\n      return 1;\n\n    let priorityDiff = m1.priority - m2.priority;\n    if (priorityDiff === 0) return m1.label.localeCompare(m2.label);\n    return priorityDiff;\n  });\n\n  let groupedMappings = { Default: { list: [], active: false } };\n  mappings.forEach((mapping, index) => {\n    mapping.i = index; // assign so that we can reference the mapping inside of an array\n    if (!mapping.group || !mapping.group.trim()) mapping.group = \"Default\";\n    if (!(mapping.group in groupedMappings))\n      groupedMappings[mapping.group] = { list: [], active: false };\n    if (!mapping.disabled) groupedMappings[mapping.group].active = true;\n    groupedMappings[mapping.group].list.push(mapping);\n  });\n  return [mappings, groupedMappings];\n}\n","import { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\nimport { registerHook, unregisterHook } from './hooks.js';\n\nconst feature_id = 'EffectIcons';\n\nexport function registerEffectIconHooks() {\n  // OnHover settings specific hooks\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.displayEffectIconsOnHover) {\n    registerHook(feature_id, 'hoverToken', (token, hoverIn) => {\n      if (token.effects) token.effects.meVisible = hoverIn;\n    });\n  } else {\n    unregisterHook(feature_id, 'hoverToken');\n  }\n\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.displayEffectIconsOnHover) {\n    registerHook(feature_id, 'highlightObjects', (active) => {\n      if (canvas.tokens.active) {\n        for (const tkn of canvas.tokens.placeables) {\n          if (tkn.effects) tkn.effects.meVisible = active || tkn.hover;\n        }\n      }\n    });\n  } else {\n    unregisterHook(feature_id, 'highlightObjects');\n  }\n\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.displayEffectIconsOnHover) {\n    registerHook(feature_id, 'refreshToken', (token) => {\n      if (token.visible && token.effects) token.effects.visible = Boolean(token.effects.meVisible);\n    });\n  } else {\n    unregisterHook(feature_id, 'refreshToken');\n  }\n}\n","import { insertArtSelectButton } from \"../../applications/artSelect.js\";\nimport { showArtSelect } from \"../../token-variants.mjs\";\nimport { TVA_CONFIG } from \"../settings.js\";\nimport { SEARCH_TYPE, updateActorImage } from \"../utils.js\";\nimport { registerHook, unregisterHook } from \"./hooks.js\";\n\nconst feature_id = \"ArtSelect\";\n\nexport function registerArtSelectButtonHooks() {\n  // Insert right-click listeners to open up ArtSelect forms from various contexts\n  if (TVA_CONFIG.permissions.portrait_right_click[game.user.role]) {\n    registerHook(feature_id, \"renderActorSheet\", _modActorSheet);\n    registerHook(feature_id, \"renderItemSheet\", _modItemSheet);\n    registerHook(feature_id, \"renderItemActionSheet\", _modItemSheet);\n    registerHook(feature_id, \"renderJournalSheet\", _modJournalSheet);\n    registerHook(feature_id, \"renderRollTableConfig\", _modRollTableSheet);\n  } else {\n    [\n      \"renderActorSheet\",\n      \"renderItemSheet\",\n      \"renderItemActionSheet\",\n      \"renderJournalSheet\",\n      \"renderRollTableConfig\",\n    ].forEach((name) => unregisterHook(feature_id, name));\n  }\n\n  // Insert buttons\n  if (TVA_CONFIG.permissions.image_path_button[game.user.role]) {\n    registerHook(feature_id, \"renderTileConfig\", _modTileConfig);\n    registerHook(\n      feature_id,\n      \"renderMeasuredTemplateConfig\",\n      _modTemplateConfig,\n    );\n    registerHook(feature_id, \"renderTokenConfig\", _modTokenConfig);\n    registerHook(feature_id, \"renderDrawingConfig\", _modDrawingConfig);\n    registerHook(feature_id, \"renderNoteConfig\", _modNoteConfig);\n    registerHook(feature_id, \"renderSceneConfig\", _modSceneConfig);\n    registerHook(feature_id, \"renderMacroConfig\", _modMacroConfig);\n    registerHook(\n      feature_id,\n      \"renderActiveEffectConfig\",\n      _modActiveEffectConfig,\n    );\n  } else {\n    [\n      \"renderTileConfig\",\n      \"renderMeasuredTemplateConfig\",\n      \"renderTokenConfig\",\n      \"renderDrawingConfig\",\n      \"renderNoteConfig\",\n      \"renderSceneConfig\",\n      `renderActiveEffectConfig`,\n    ].forEach((name) => unregisterHook(feature_id, name));\n  }\n}\n\nfunction _modTokenConfig(config, html) {\n  insertArtSelectButton(html, \"texture.src\", {\n    search: config.object.name,\n    searchType: SEARCH_TYPE.TOKEN,\n  });\n}\n\nfunction _modTemplateConfig(config, html) {\n  insertArtSelectButton(html, \"texture\", {\n    search: \"Template\",\n    searchType: SEARCH_TYPE.TILE,\n  });\n}\n\nfunction _modDrawingConfig(config, html) {\n  insertArtSelectButton(html, \"texture\", {\n    search: \"Drawing\",\n    searchType: TVA_CONFIG.customImageCategories.includes(\"Drawing\")\n      ? \"Drawing\"\n      : SEARCH_TYPE.TILE,\n  });\n}\n\nfunction _modNoteConfig(config, html) {\n  insertArtSelectButton(html, \"icon.custom\", {\n    search: \"Note\",\n    searchType: TVA_CONFIG.customImageCategories.includes(\"Note\")\n      ? \"Note\"\n      : SEARCH_TYPE.ITEM,\n  });\n}\n\nfunction _modSceneConfig(config, html) {\n  insertArtSelectButton(html, \"background.src\", {\n    search: config.object.name,\n    searchType: TVA_CONFIG.customImageCategories.includes(\"Scene\")\n      ? \"Scene\"\n      : SEARCH_TYPE.TILE,\n  });\n  insertArtSelectButton(html, \"foreground\", {\n    search: config.object.name,\n    searchType: TVA_CONFIG.customImageCategories.includes(\"Scene\")\n      ? \"Scene\"\n      : SEARCH_TYPE.TILE,\n  });\n  insertArtSelectButton(html, \"fogOverlay\", {\n    search: config.object.name,\n    searchType: TVA_CONFIG.customImageCategories.includes(\"Fog\")\n      ? \"Fog\"\n      : SEARCH_TYPE.TILE,\n  });\n}\n\nfunction _modTileConfig(tileConfig, html) {\n  insertArtSelectButton(html, \"texture.src\", {\n    search: tileConfig.object.getFlag(\"token-variants\", \"tileName\") || \"Tile\",\n    searchType: SEARCH_TYPE.TILE,\n  });\n}\n\nfunction _modActiveEffectConfig(effectConfig, html) {\n  const inserted = insertArtSelectButton(html, \"icon\", {\n    search: effectConfig.object.name || \"Active Effect\",\n    searchType: TVA_CONFIG.customImageCategories.includes(\"Active Effect\")\n      ? \"Active Effect\"\n      : SEARCH_TYPE.ITEM,\n  });\n  if (!inserted) {\n    const img = html.find(\".effect-icon\");\n    img.on(\"contextmenu\", () => {\n      showArtSelect(effectConfig.object?.name ?? \"Active Effect\", {\n        searchType: SEARCH_TYPE.ITEM,\n        callback: (imgSrc) => img.attr(\"src\", imgSrc),\n      });\n    });\n  }\n}\n\nfunction _modItemSheet(itemSheet, html, options) {\n  html\n    .find('img.profile, .profile-img, [data-edit=\"img\"]')\n    .on(\"contextmenu\", () => {\n      const item = itemSheet.object;\n      if (!item) return;\n      showArtSelect(item.name, {\n        searchType: SEARCH_TYPE.ITEM,\n        callback: (imgSrc) => item.update({ img: imgSrc }),\n      });\n    });\n}\n\nfunction _modMacroConfig(macroConfig, html, options) {\n  const img = html.find(\".sheet-header > img\");\n  img.on(\"contextmenu\", () => {\n    showArtSelect(macroConfig.object?.name ?? \"Macro\", {\n      searchType: SEARCH_TYPE.MACRO,\n      callback: (imgSrc) => img.attr(\"src\", imgSrc),\n    });\n  });\n}\n\nfunction _modJournalSheet(journalSheet, html, options) {\n  html.find(\".header-button.entry-image\").on(\"contextmenu\", () => {\n    const journal = journalSheet.object;\n    if (!journal) return;\n    showArtSelect(journal.name, {\n      searchType: SEARCH_TYPE.JOURNAL,\n      callback: (imgSrc) => journal.update({ img: imgSrc }),\n    });\n  });\n}\n\nfunction _modRollTableSheet(sheet, html) {\n  html.find(\".result-image\").on(\"contextmenu\", (event) => {\n    const table = sheet.object;\n    if (!table) return;\n    const img = event.target.closest(\".result-image\").find(\"img\");\n    showArtSelect(table.name, {\n      searchType: TVA_CONFIG.customImageCategories.includes(\"RollTable\")\n        ? \"RollTable\"\n        : SEARCH_TYPE.ITEM,\n      callback: (imgSrc) => {\n        img.attr(\"src\", imgSrc);\n        sheet._onSubmit(event);\n      },\n    });\n  });\n}\n\n/**\n * Adds right-click listener to Actor Sheet profile image to open up\n * the 'Art Select' screen.\n */\nfunction _modActorSheet(actorSheet, html, options) {\n  if (\n    options.editable &&\n    TVA_CONFIG.permissions.portrait_right_click[game.user.role]\n  ) {\n    let profile = null;\n    let profileQueries = {\n      all: [\".profile\", \".profile-img\", \".profile-image\", \".portrait\"],\n      pf2e: [\n        \".player-image\",\n        \".actor-icon\",\n        \".sheet-header img\",\n        \".actor-image\",\n      ],\n    };\n\n    for (let query of profileQueries.all) {\n      profile = html[0].querySelector(query);\n      if (profile) break;\n    }\n\n    if (!profile && game.system.id in profileQueries) {\n      for (let query of profileQueries[game.system.id]) {\n        profile = html[0].querySelector(query);\n        if (profile) break;\n      }\n    }\n\n    if (!profile) {\n      console.warn(\n        \"TVA |\",\n        game.i18n.localize(\n          \"token-variants.notifications.warn.profile-image-not-found\",\n        ),\n      );\n      return;\n    }\n\n    profile.addEventListener(\n      \"contextmenu\",\n      function (ev) {\n        showArtSelect(actorSheet.object.name, {\n          callback: (imgSrc, name) =>\n            updateActorImage(actorSheet.object, imgSrc),\n          searchType: SEARCH_TYPE.PORTRAIT,\n          object: actorSheet.object,\n        });\n      },\n      false,\n    );\n  }\n}\n","import {\n  getFileName,\n  isImage,\n  isVideo,\n  SEARCH_TYPE,\n  keyPressed,\n} from \"../scripts/utils.js\";\nimport { TVA_CONFIG } from \"../scripts/settings.js\";\nimport FlagsConfig from \"./flagsConfig.js\";\nimport { doImageSearch } from \"../scripts/search.js\";\nimport UserList from \"./userList.js\";\n\nexport async function renderTileHUD(\n  hud,\n  html,\n  tileData,\n  searchText = \"\",\n  fp_files = null,\n) {\n  const tile = hud.object;\n  const hudSettings = TVA_CONFIG.hud;\n\n  if (!hudSettings.enableSideMenu || !TVA_CONFIG.tilesEnabled) return;\n\n  const button = $(`\n  <div class=\"control-icon\" data-action=\"token-variants-side-selector\">\n    <img\n      id=\"token-variants-side-button\"\n      src=\"modules/token-variants/token-variants/img/token-images.svg\"\n      width=\"36\"\n      height=\"36\"\n      title=\"${game.i18n.localize(\"token-variants.windows.art-select.select-variant\")}\"\n    />\n  </div>\n`);\n\n  html.querySelector(\"div.right\").last().append(button);\n  html.querySelector(\"div.right\").click(_deactivateTokenVariantsSideSelector);\n\n  button.click((event) => _onButtonClick(event, tile));\n  button.contextmenu((event) => _onButtonRightClick(event, tile));\n}\n\nasync function _onButtonClick(event, tile) {\n  if (keyPressed(\"config\")) {\n    setNameDialog(tile);\n    return;\n  }\n\n  const button = event.target.closest(\".control-icon\");\n\n  // De-activate 'Status Effects'\n  button\n    .closest(\"div.right\")\n    .find(\"div.control-icon.effects\")\n    .removeClass(\"active\");\n  button.closest(\"div.right\").find(\".status-effects\").removeClass(\"active\");\n\n  // Remove contextmenu\n  button.find(\".contextmenu\").remove();\n\n  // Toggle variants side menu\n  button.classList.toggle(\"active\");\n  let variantsWrap = button.find(\".token-variants-wrap\");\n  if (button.hasClass(\"active\")) {\n    if (!variantsWrap.length) {\n      variantsWrap = await renderSideSelect(tile);\n      if (variantsWrap) button.find(\"img\").after(variantsWrap);\n      else return;\n    }\n    variantsWrap.addClass(\"active\");\n  } else {\n    variantsWrap.removeClass(\"active\");\n  }\n}\n\nfunction _onButtonRightClick(event, tile) {\n  // Display side menu if button is not active yet\n  const button = event.target.closest(\".control-icon\");\n  if (!button.hasClass(\"active\")) {\n    // button.trigger('click');\n    button.addClass(\"active\");\n  }\n\n  if (button.find(\".contextmenu\").length) {\n    // Contextmenu already displayed. Remove and activate images\n    button.find(\".contextmenu\").remove();\n    button.removeClass(\"active\").trigger(\"click\");\n    //button.find('.token-variants-wrap.images').addClass('active');\n  } else {\n    // Contextmenu is not displayed. Hide images, create it and add it\n    button.find(\".token-variants-wrap.images\").removeClass(\"active\");\n    const contextMenu = $(`\n    <div class=\"token-variants-wrap contextmenu active\">\n      <div class=\"token-variants-context-menu active\">\n        <input class=\"token-variants-side-search\" type=\"text\" />\n        <button class=\"flags\" type=\"button\"><i class=\"fab fa-font-awesome-flag\"></i><label>Flags</label></button>\n        <button class=\"file-picker\" type=\"button\"><i class=\"fas fa-file-import fa-fw\"></i><label>Browse Folders</label></button>\n      </div>\n    </div>\n      `);\n    button.append(contextMenu);\n\n    // Register contextmenu listeners\n    contextMenu\n      .find(\".token-variants-side-search\")\n      .on(\"keydown\", (event) => _onImageSearchKeyUp(event, tile))\n      .on(\"click\", (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n      });\n    contextMenu.find(\".flags\").click((event) => {\n      event.preventDefault();\n      event.stopPropagation();\n      new FlagsConfig(tile).render(true);\n    });\n    contextMenu.find(\".file-picker\").click(async (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n      new FilePicker({\n        type: \"folder\",\n        callback: async (path, fp) => {\n          const content = await FilePicker.browse(\n            fp.activeSource,\n            fp.result.target,\n          );\n          let files = content.files.filter((f) => isImage(f) || isVideo(f));\n          if (files.length) {\n            button.find(\".token-variants-wrap\").remove();\n            const sideSelect = await renderSideSelect(tile, null, files);\n            if (sideSelect) {\n              sideSelect.addClass(\"active\");\n              button.append(sideSelect);\n            }\n          }\n        },\n      }).render(true);\n    });\n  }\n}\n\nfunction _deactivateTokenVariantsSideSelector(event) {\n  const controlIcon = event.target.closest(\".control-icon\");\n  const dataAction = controlIcon.attr(\"data-action\");\n\n  switch (dataAction) {\n    case \"effects\":\n      break; // Effects button\n    case \"thwildcard-selector\":\n      break; // Token HUD Wildcard module button\n    default:\n      return;\n  }\n\n  event.target\n    .closest(\"div.right\")\n    .find('.control-icon[data-action=\"token-variants-side-selector\"]')\n    .removeClass(\"active\");\n  event.target\n    .closest(\"div.right\")\n    .find(\".token-variants-wrap\")\n    .removeClass(\"active\");\n}\n\nasync function renderSideSelect(tile, searchText = null, fp_files = null) {\n  const hudSettings = TVA_CONFIG.hud;\n  const worldHudSettings = TVA_CONFIG.worldHud;\n  const FULL_ACCESS = TVA_CONFIG.permissions.hudFullAccess[game.user.role];\n  let images = [];\n  let variants = [];\n  let imageDuplicates = new Set();\n  const pushImage = (img) => {\n    if (imageDuplicates.has(img.path)) {\n      if (\n        !images.find((obj) => obj.path === img.path && obj.name === img.name)\n      ) {\n        images.push(img);\n      }\n    } else {\n      images.push(img);\n      imageDuplicates.add(img.path);\n    }\n  };\n\n  if (!fp_files) {\n    if (searchText !== null && !searchText) return;\n\n    if (!searchText) {\n      variants = tile.document.getFlag(\"token-variants\", \"variants\") || [];\n      variants.forEach((variant) => {\n        for (const name of variant.names) {\n          pushImage({ path: variant.imgSrc, name: name });\n        }\n      });\n\n      // Parse directory flag and include the images\n      const directoryFlag = tile.document.getFlag(\n        \"token-variants\",\n        \"directory\",\n      );\n      if (directoryFlag) {\n        let dirFlagImages;\n        try {\n          let path = directoryFlag.path;\n          let source = directoryFlag.source;\n          let bucket = \"\";\n          if (source.startsWith(\"s3:\")) {\n            bucket = source.substring(3, source.length);\n            source = \"s3\";\n          }\n          const content = await FilePicker.browse(source, path, {\n            type: \"imagevideo\",\n            bucket,\n          });\n          dirFlagImages = content.files;\n        } catch (err) {\n          dirFlagImages = [];\n        }\n        dirFlagImages.forEach((f) => {\n          if (isImage(f) || isVideo(f))\n            pushImage({ path: f, name: getFileName(f) });\n        });\n      }\n    }\n\n    // Perform the search if needed\n    const search =\n      searchText ?? tile.document.getFlag(\"token-variants\", \"tileName\");\n    const noSearch =\n      !search || (!searchText && worldHudSettings.displayOnlySharedImages);\n    let artSearch = noSearch\n      ? null\n      : await doImageSearch(search, {\n          searchType: SEARCH_TYPE.TILE,\n          searchOptions: { keywordSearch: worldHudSettings.includeKeywords },\n        });\n\n    if (artSearch) {\n      artSearch.forEach((results) => {\n        images.push(...results);\n      });\n    }\n  } else {\n    images = fp_files.map((f) => {\n      return { path: f, name: getFileName(f) };\n    });\n  }\n\n  // Retrieving the possibly custom name attached as a flag to the token\n  let tileImageName = tile.document.getFlag(\"token-variants\", \"name\");\n  if (!tileImageName) {\n    tileImageName = getFileName(tile.document.texture.src);\n  }\n\n  let imagesParsed = [];\n\n  for (const imageObj of images) {\n    const img = isImage(imageObj.path);\n    const vid = isVideo(imageObj.path);\n\n    let shared = false;\n    if (game.user.isGM) {\n      variants.forEach((variant) => {\n        if (\n          variant.imgSrc === imageObj.path &&\n          variant.names.includes(imageObj.name)\n        ) {\n          shared = true;\n        }\n      });\n    }\n\n    const userMappings =\n      tile.document.getFlag(\"token-variants\", \"userMappings\") || {};\n    const [title, style] = genTitleAndStyle(\n      userMappings,\n      imageObj.path,\n      imageObj.name,\n    );\n\n    imagesParsed.push({\n      route: imageObj.path,\n      name: imageObj.name,\n      used:\n        imageObj.path === tile.document.texture.src &&\n        imageObj.name === tileImageName,\n      img,\n      vid,\n      unknownType: !img && !vid,\n      shared: shared,\n      hasConfig: false, //hasConfig,\n      title: title,\n      style: game.user.isGM && style ? \"box-shadow: \" + style + \";\" : null,\n    });\n  }\n\n  //\n  // Render\n  //\n  const imageDisplay = hudSettings.displayAsImage;\n  const imageOpacity = hudSettings.imageOpacity / 100;\n\n  const sideSelect = await renderTemplate(\n    \"modules/token-variants/token-variants/templates/sideSelect.html\",\n    {\n      imagesParsed,\n      imageDisplay,\n      imageOpacity,\n      autoplay: !TVA_CONFIG.playVideoOnHover,\n    },\n  );\n\n  // Activate listeners\n  sideSelect.find(\"video\").hover(\n    function () {\n      if (TVA_CONFIG.playVideoOnHover) {\n        this.play();\n        this.siblings(\".fa-play\").hide();\n      }\n    },\n    function () {\n      if (TVA_CONFIG.pauseVideoOnHoverOut) {\n        this.pause();\n        this.currentTime = 0;\n        this.siblings(\".fa-play\").show();\n      }\n    },\n  );\n  sideSelect\n    .find(\".token-variants-button-select\")\n    .click((event) => _onImageClick(event, tile));\n\n  if (FULL_ACCESS) {\n    sideSelect\n      .find(\".token-variants-button-select\")\n      .on(\"contextmenu\", (event) => _onImageRightClick(event, tile));\n  }\n\n  return sideSelect;\n}\n\nasync function _onImageClick(event, tile) {\n  event.preventDefault();\n  event.stopPropagation();\n\n  if (!tile) return;\n\n  const imgButton = event.target.closest(\".token-variants-button-select\");\n  const imgSrc = imgButton.attr(\"data-name\");\n  const name = imgButton.attr(\"data-filename\");\n  if (imgSrc) {\n    canvas.tiles.hud.clear();\n    await tile.document.update({ \"texture.src\": imgSrc });\n    try {\n      if (getFileName(imgSrc) !== name)\n        await tile.document.setFlag(\"token-variants\", \"name\", name);\n    } catch (e) {}\n  }\n}\n\nasync function _onImageRightClick(event, tile) {\n  event.preventDefault();\n  event.stopPropagation();\n\n  if (!tile) return;\n\n  const imgButton = event.target.closest(\".token-variants-button-select\");\n  const imgSrc = imgButton.attr(\"data-name\");\n  const name = imgButton.attr(\"data-filename\");\n\n  if (!imgSrc || !name) return;\n\n  if (keyPressed(\"config\") && game.user.isGM) {\n    const regenStyle = (tile, img) => {\n      const mappings =\n        tile.document.getFlag(\"token-variants\", \"userMappings\") || {};\n      const name = imgButton.attr(\"data-filename\");\n      const [title, style] = genTitleAndStyle(mappings, img, name);\n      imgButton\n        .closest(\".token-variants-wrap\")\n        .find(`.token-variants-button-select[data-name='${img}']`)\n        .css(\"box-shadow\", style)\n        .prop(\"title\", title);\n    };\n    new UserList(tile, imgSrc, regenStyle).render(true);\n    return;\n  }\n\n  let variants = tile.document.getFlag(\"token-variants\", \"variants\") || [];\n\n  // Remove selected variant if present in the flag, add otherwise\n  let del = false;\n  let updated = false;\n  for (let variant of variants) {\n    if (variant.imgSrc === imgSrc) {\n      let fNames = variant.names.filter((name) => name !== name);\n      if (fNames.length === 0) {\n        del = true;\n      } else if (fNames.length === variant.names.length) {\n        fNames.push(name);\n      }\n      variant.names = fNames;\n      updated = true;\n      break;\n    }\n  }\n  if (del) variants = variants.filter((variant) => variant.imgSrc !== imgSrc);\n  else if (!updated) variants.push({ imgSrc: imgSrc, names: [name] });\n\n  // Set shared variants as a flag\n  tile.document.unsetFlag(\"token-variants\", \"variants\");\n  if (variants.length > 0) {\n    tile.document.setFlag(\"token-variants\", \"variants\", variants);\n  }\n  imgButton.find(\".fa-share\").classList.toggle(\"active\"); // Display green arrow\n}\n\nasync function _onImageSearchKeyUp(event, tile) {\n  if (event.key === \"Enter\" || event.keyCode === 13) {\n    event.preventDefault();\n    if (event.target.value.length >= 3) {\n      const button = event.target.closest(\".control-icon\");\n      button.find(\".token-variants-wrap\").remove();\n      const sideSelect = await renderSideSelect(tile, event.target.value);\n      if (sideSelect) {\n        sideSelect.addClass(\"active\");\n        button.append(sideSelect);\n      }\n    }\n    return false;\n  }\n}\n\nfunction genTitleAndStyle(mappings, imgSrc, name) {\n  let title = TVA_CONFIG.worldHud.showFullPath ? imgSrc : name;\n  let style = \"\";\n  let offset = 2;\n  for (const [userId, img] of Object.entries(mappings)) {\n    if (img === imgSrc) {\n      const user = game.users.get(userId);\n      if (!user) continue;\n      if (style.length === 0) {\n        style = `inset 0 0 0 ${offset}px ${user.color}`;\n      } else {\n        style += `, inset 0 0 0 ${offset}px ${user.color}`;\n      }\n      offset += 2;\n      title += `\\nDisplayed to: ${user.name}`;\n    }\n  }\n  return [title, style];\n}\n\nfunction setNameDialog(tile) {\n  const tileName =\n    tile.document.getFlag(\"token-variants\", \"tileName\") || tile.id;\n  new Dialog({\n    title: `Assign a name to the Tile (3+ chars)`,\n    content: `<table style=\"width:100%\"><tr><th style=\"width:50%\"><label>Tile Name</label></th><td style=\"width:50%\"><input type=\"text\" name=\"input\" value=\"${tileName}\"/></td></tr></table>`,\n    buttons: {\n      Ok: {\n        label: `Save`,\n        callback: (html) => {\n          const name = html.querySelector(\"input\").val();\n          if (name) {\n            canvas.tiles.hud.clear();\n            tile.document.setFlag(\"token-variants\", \"tileName\", name);\n          }\n        },\n      },\n    },\n  }).render(true);\n}\n","import { renderTileHUD } from '../../applications/tileHUD.js';\nimport { renderTokenHUD } from '../../applications/tokenHUD.js';\nimport { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\nimport { registerHook, unregisterHook } from './hooks.js';\n\nconst feature_id = 'HUD';\n\nexport function registerHUDHooks() {\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.tilesEnabled) {\n    registerHook(feature_id, 'renderTileHUD', renderTileHUD);\n  } else {\n    unregisterHook(feature_id, 'renderTileHUD');\n  }\n\n  if (\n    FEATURE_CONTROL[feature_id] &&\n    (TVA_CONFIG.permissions.hudFullAccess[game.user.role] || TVA_CONFIG.permissions.hud[game.user.role])\n  ) {\n    registerHook(feature_id, 'renderTokenHUD', renderTokenHUD);\n  } else {\n    unregisterHook(feature_id, 'renderTokenHUD');\n  }\n}\n","import { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\nimport { registerHook, unregisterHook } from './hooks.js';\n\nconst feature_id = 'UserMappings';\n\nexport function registerUserMappingHooks() {\n  if (!FEATURE_CONTROL[feature_id]) {\n    ['updateToken', 'updateTile', 'sightRefresh'].forEach((id) => unregisterHook(feature_id, id));\n    return;\n  }\n\n  registerHook(feature_id, 'updateToken', _updateToken);\n  registerHook(feature_id, 'updateTile', _updateTile);\n  registerHook(feature_id, 'sightRefresh', _sightRefresh);\n}\n\nasync function _updateToken(token, change) {\n  // Update User Specific Image\n  if (change.flags?.['token-variants']) {\n    if ('userMappings' in change.flags['token-variants'] || '-=userMappings' in change.flags['token-variants']) {\n      const t = canvas.tokens.get(token.id);\n      if (t) {\n        await t.draw();\n        canvas.visibility.restrictVisibility();\n      }\n    }\n  }\n}\n\nasync function _updateTile(tile, change) {\n  // Update User Specific Image\n  if (change.flags?.['token-variants']) {\n    if ('userMappings' in change.flags['token-variants'] || '-=userMappings' in change.flags['token-variants']) {\n      const t = canvas.tiles.get(tile.id);\n      if (t) {\n        await t.draw();\n        canvas.visibility.restrictVisibility();\n      }\n    }\n  }\n}\n\nfunction _sightRefresh() {\n  if (!game.user.isGM) {\n    for (let t of canvas.tokens.placeables) {\n      if (_isInvisible(t)) t.visible = false;\n    }\n    for (let t of canvas.tiles.placeables) {\n      if (_isInvisible(t)) t.visible = false;\n    }\n  }\n}\n\nfunction _isInvisible(obj) {\n  const img = (obj.document.getFlag('token-variants', 'userMappings') || {})?.[game.userId];\n  return img === TVA_CONFIG.invisibleImage;\n}\n","import { insertArtSelectButton } from '../../applications/artSelect.js';\nimport { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\nimport { SEARCH_TYPE, updateTokenImage } from '../utils.js';\nimport { registerHook, unregisterHook } from './hooks.js';\n\nconst feature_id = 'Wildcards';\n\nexport function registerWildcardHooks() {\n  if (!FEATURE_CONTROL[feature_id]) {\n    ['renderTokenConfig', 'preCreateToken'].forEach((name) => unregisterHook(feature_id, name));\n    return;\n  }\n\n  // Insert default random image field\n  registerHook(feature_id, 'renderTokenConfig', _renderTokenConfig);\n\n  // Set Default Wildcard images if needed\n  registerHook(feature_id, 'preCreateToken', _preCreateToken);\n}\n\nasync function _renderTokenConfig(config, html) {\n  const checkboxRandomize = html.querySelector('input[name=\"randomImg\"]');\n  if (checkboxRandomize.length && !html.querySelector('.token-variants-proto').length) {\n    const defaultImg =\n      config.actor?.prototypeToken?.flags['token-variants']?.['randomImgDefault'] ||\n      config.actor?.prototypeToken?.flags['token-hud-wildcard']?.['default'] ||\n      '';\n\n    const field = await renderTemplate('/modules/token-variants/token-variants/token-variants/templates/protoTokenElement.html', {\n      defaultImg,\n      disableHUDButton: config.object?.getFlag('token-variants', 'disableHUDButton'),\n    });\n    checkboxRandomize.closest('.form-group').after(field);\n\n    const tvaFieldset = html.querySelector('.token-variants-proto');\n\n    tvaFieldset.find('button').click((event) => {\n      event.preventDefault();\n      const input = tvaFieldset.find('input');\n      new FilePicker({ current: input.val(), field: input[0] }).browse(defaultImg);\n    });\n\n    insertArtSelectButton(tvaFieldset, 'flags.token-variants.randomImgDefault', {\n      search: config.object.name,\n      searchType: SEARCH_TYPE.TOKEN,\n    });\n\n    // Hide/Show Default Img Form Group\n    const rdmImgFormGroup = tvaFieldset.find('.imagevideo').closest('.form-group');\n    const showHideGroup = function (checked) {\n      if (checked) {\n        rdmImgFormGroup.show();\n      } else {\n        rdmImgFormGroup.hide();\n      }\n      config.setPosition();\n    };\n    checkboxRandomize.on('click', (event) => showHideGroup(event.target.checked));\n    showHideGroup(checkboxRandomize.is(':checked'));\n  }\n}\n\nfunction _preCreateToken(tokenDocument, data, options, userId) {\n  if (game.user.id !== userId) return;\n  const update = {};\n  if (tokenDocument.actor?.prototypeToken?.randomImg) {\n    const defaultImg =\n      tokenDocument.actor?.prototypeToken?.flags['token-variants']?.['randomImgDefault'] ||\n      tokenDocument.actor?.prototypeToken?.flags['token-hud-wildcard']?.['default'] ||\n      '';\n    if (defaultImg) update['texture.src'] = defaultImg;\n  }\n\n  if (TVA_CONFIG.imgNameContainsDimensions || TVA_CONFIG.imgNameContainsFADimensions) {\n    updateTokenImage(update['texture.src'] ?? tokenDocument.texture.src, {\n      token: tokenDocument,\n      update,\n    });\n  }\n\n  if (!foundry.utils.isEmpty(update)) tokenDocument.updateSource(update);\n}\n","import { showArtSelect } from '../../token-variants.mjs';\nimport { doRandomSearch, doSyncSearch } from '../search.js';\nimport { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\nimport { keyPressed, nameForgeRandomize, SEARCH_TYPE, updateActorImage, updateTokenImage } from '../utils.js';\nimport { registerHook, unregisterHook } from './hooks.js';\n\nconst feature_id = 'PopUpAndRandomize';\n\nexport function registerPopRandomizeHooks() {\n  if (FEATURE_CONTROL[feature_id]) {\n    registerHook(feature_id, 'createActor', _createActor);\n    registerHook(feature_id, 'createToken', _createToken);\n  } else {\n    ['createActor', 'createToken'].forEach((name) => unregisterHook(feature_id, name));\n  }\n}\n\nasync function _createToken(token, options, userId) {\n  if (userId && game.user.id != userId) return;\n\n  // Check if random search is enabled and if so perform it\n  const actorRandSettings = game.actors.get(token.actorId)?.getFlag('token-variants', 'randomizerSettings');\n  const randSettings = foundry.utils.mergeObject(TVA_CONFIG.randomizer, actorRandSettings ?? {}, {\n    inplace: false,\n    recursive: false,\n  });\n\n  let vDown = keyPressed('v');\n  const flagTarget = token.actor ? game.actors.get(token.actor.id) : token.document ?? token;\n  const popupFlag = flagTarget.getFlag('token-variants', 'popups');\n\n  if ((vDown && randSettings.tokenCopyPaste) || (!vDown && randSettings.tokenCreate)) {\n    let performRandomSearch = true;\n    if (!actorRandSettings) {\n      if (randSettings.representedActorDisable && token.actor) performRandomSearch = false;\n      if (randSettings.linkedActorDisable && token.actorLink) performRandomSearch = false;\n      if (_disableRandomSearchForType(randSettings, token.actor)) performRandomSearch = false;\n    } else {\n      performRandomSearch = Boolean(actorRandSettings);\n    }\n\n    if (performRandomSearch) {\n      // Randomize Token Name if need be\n      const randomName = await nameForgeRandomize(randSettings);\n      if (randomName) {\n        token.update({ name: randomName });\n      }\n\n      const img = await doRandomSearch(token.name, {\n        searchType: SEARCH_TYPE.TOKEN,\n        actor: token.actor,\n        randomizerOptions: randSettings,\n      });\n      if (img) {\n        await updateTokenImage(img[0], {\n          token: token,\n          actor: token.actor,\n          imgName: img[1],\n        });\n      }\n\n      if (randSettings.diffImages) {\n        let imgPortrait;\n        if (randSettings.syncImages) {\n          if (!img) return;\n          imgPortrait = await doSyncSearch(img[1], {\n            searchType: SEARCH_TYPE.PORTRAIT,\n          });\n        } else {\n          // Prevent searches via method intended purely for tokens\n          if (!(randSettings.tokenName || randSettings.actorName)) randSettings.tokenName = true;\n          randSettings.wildcard = false;\n          randSettings.shared = false;\n          imgPortrait = await doRandomSearch(token.name, {\n            searchType: SEARCH_TYPE.PORTRAIT,\n            actor: token.actor,\n            randomizerOptions: randSettings,\n          });\n        }\n\n        if (imgPortrait) {\n          await updateActorImage(token.actor, imgPortrait[0]);\n        }\n      } else if (randSettings.tokenToPortrait) {\n        if (!img) return;\n        await updateActorImage(token.actor, img[0]);\n      }\n      return;\n    }\n    if (popupFlag == null && !randSettings.popupOnDisable) {\n      return;\n    }\n  } else if (randSettings.tokenCreate || randSettings.tokenCopyPaste) {\n    return;\n  }\n\n  // Check if pop-up is enabled and if so open it\n  if (!TVA_CONFIG.permissions.popups[game.user.role]) {\n    return;\n  }\n\n  let dirKeyDown = keyPressed('popupOverride');\n\n  if (vDown && TVA_CONFIG.popup.disableAutoPopupOnTokenCopyPaste) {\n    return;\n  }\n\n  if (!dirKeyDown || (dirKeyDown && vDown)) {\n    if (TVA_CONFIG.popup.disableAutoPopupOnTokenCreate && !vDown) {\n      return;\n    } else if (popupFlag == null && _disablePopupForType(token.actor)) {\n      return;\n    } else if (popupFlag != null && !popupFlag) {\n      return;\n    }\n  }\n\n  showArtSelect(token.name, {\n    callback: async function (imgSrc, imgName) {\n      if (TVA_CONFIG.popup.twoPopups) {\n        await updateActorImage(token.actor, imgSrc);\n        _twoPopupPrompt(token.actor, imgSrc, imgName, token);\n      } else {\n        updateTokenImage(imgSrc, {\n          actor: token.actor,\n          imgName: imgName,\n          token: token,\n        });\n      }\n    },\n    searchType: TVA_CONFIG.popup.twoPopups ? SEARCH_TYPE.PORTRAIT : SEARCH_TYPE.TOKEN,\n    object: token,\n    preventClose: TVA_CONFIG.popup.twoPopups && TVA_CONFIG.popup.twoPopupsNoDialog,\n  });\n}\n\nasync function _createActor(actor, options, userId) {\n  if (userId && game.user.id != userId) return;\n\n  // Check if random search is enabled and if so perform it\n  const randSettings = TVA_CONFIG.randomizer;\n  if (randSettings.actorCreate) {\n    let performRandomSearch = true;\n    if (randSettings.linkedActorDisable && actor.prototypeToken.actorLink) performRandomSearch = false;\n    if (_disableRandomSearchForType(randSettings, actor)) performRandomSearch = false;\n    if (performRandomSearch) {\n      const img = await doRandomSearch(actor.name, {\n        searchType: SEARCH_TYPE.PORTRAIT,\n        actor: actor,\n      });\n      if (img) {\n        await updateActorImage(actor, img[0]);\n      }\n\n      if (!img) return;\n\n      if (randSettings.diffImages) {\n        let imgToken;\n        if (randSettings.syncImages) {\n          imgToken = await doSyncSearch(img[1], { searchType: SEARCH_TYPE.TOKEN });\n        } else {\n          imgToken = await doRandomSearch(actor.name, {\n            searchType: SEARCH_TYPE.TOKEN,\n            actor: actor,\n          });\n        }\n\n        if (imgToken) {\n          await updateTokenImage(imgToken[0], { actor: actor, imgName: imgToken[1] });\n        }\n      }\n      return;\n    }\n    if (!randSettings.popupOnDisable) {\n      return;\n    }\n  }\n\n  // Check if pop-up is enabled and if so open it\n  if (!TVA_CONFIG.permissions.popups[game.user.role]) {\n    return;\n  }\n\n  if (TVA_CONFIG.popup.disableAutoPopupOnActorCreate && !keyPressed('popupOverride')) {\n    return;\n  } else if (_disablePopupForType(actor)) {\n    return;\n  }\n\n  showArtSelect(actor.name, {\n    callback: async function (imgSrc, name) {\n      const actTokens = actor.getActiveTokens();\n      const token = actTokens.length === 1 ? actTokens[0] : null;\n      await updateActorImage(actor, imgSrc);\n      if (TVA_CONFIG.popup.twoPopups) _twoPopupPrompt(actor, imgSrc, name, token);\n      else {\n        updateTokenImage(imgSrc, {\n          actor: actor,\n          imgName: name,\n          token: token,\n        });\n      }\n    },\n    searchType: TVA_CONFIG.popup.twoPopups ? SEARCH_TYPE.PORTRAIT : SEARCH_TYPE.PORTRAIT_AND_TOKEN,\n    object: actor,\n    preventClose: TVA_CONFIG.popup.twoPopups && TVA_CONFIG.popup.twoPopupsNoDialog,\n  });\n}\n\nfunction _disableRandomSearchForType(randSettings, actor) {\n  if (!actor) return false;\n  return randSettings[`${actor.type}Disable`] ?? false;\n}\n\nfunction _disablePopupForType(actor) {\n  if (!actor) return false;\n  return TVA_CONFIG.popup[`${actor.type}Disable`] ?? false;\n}\n\nfunction _twoPopupPrompt(actor, imgSrc, imgName, token) {\n  if (TVA_CONFIG.popup.twoPopups && TVA_CONFIG.popup.twoPopupsNoDialog) {\n    showArtSelect((token ?? actor.prototypeToken).name, {\n      callback: (imgSrc, name) =>\n        updateTokenImage(imgSrc, {\n          actor: actor,\n          imgName: name,\n          token: token,\n        }),\n      searchType: SEARCH_TYPE.TOKEN,\n      object: token ? token : actor,\n      force: true,\n    });\n  } else if (TVA_CONFIG.popup.twoPopups) {\n    let d = new Dialog({\n      title: 'Portrait -> Token',\n      content: `<p>${game.i18n.localize('token-variants.windows.art-select.apply-same-art')}</p>`,\n      buttons: {\n        one: {\n          icon: '<i class=\"fas fa-check\"></i>',\n          callback: () => {\n            updateTokenImage(imgSrc, {\n              actor: actor,\n              imgName: imgName,\n              token: token,\n            });\n            const artSelects = Object.values(ui.windows).filter((app) => app instanceof ArtSelect);\n            for (const app of artSelects) {\n              app.close();\n            }\n          },\n        },\n        two: {\n          icon: '<i class=\"fas fa-times\"></i>',\n          callback: () => {\n            showArtSelect((token ?? actor.prototypeToken).name, {\n              callback: (imgSrc, name) =>\n                updateTokenImage(imgSrc, {\n                  actor: actor,\n                  imgName: name,\n                  token: token,\n                }),\n              searchType: SEARCH_TYPE.TOKEN,\n              object: token ? token : actor,\n              force: true,\n            });\n          },\n        },\n      },\n      default: 'one',\n    });\n    d.render(true);\n  }\n}\n","import { registerEffectIconHooks } from './effectIconHooks.js';\nimport { registerArtSelectButtonHooks } from './artSelectButtonHooks.js';\nimport { registerOverlayHooks } from './overlayHooks.js';\nimport { registerEffectMappingHooks } from './effectMappingHooks.js';\nimport { registerHUDHooks } from './hudHooks.js';\nimport { registerUserMappingHooks } from './userMappingHooks.js';\nimport { registerWildcardHooks } from './wildcardHooks.js';\nimport { registerPopRandomizeHooks } from './popUpRandomizeHooks.js';\nimport { TVA_CONFIG } from '../settings.js';\n\nexport const REGISTERED_HOOKS = {};\n\nexport function registerHook(feature_id, name, fn, { once = false } = {}) {\n  if (!(feature_id in REGISTERED_HOOKS)) REGISTERED_HOOKS[feature_id] = {};\n  if (name in REGISTERED_HOOKS[feature_id]) return;\n  if (TVA_CONFIG.debug) console.info(`TVA | Registering Hook`, { feature_id, name, fn, once });\n  const num = Hooks.on(name, fn, { once });\n  REGISTERED_HOOKS[feature_id][name] = num;\n}\n\nexport function unregisterHook(feature_id, name) {\n  if (feature_id in REGISTERED_HOOKS && name in REGISTERED_HOOKS[feature_id]) {\n    if (TVA_CONFIG.debug)\n      console.info(`TVA | Un-Registering Hook`, {\n        feature_id,\n        name,\n        id: REGISTERED_HOOKS[feature_id][name],\n      });\n    Hooks.off(name, REGISTERED_HOOKS[feature_id][name]);\n    delete REGISTERED_HOOKS[feature_id][name];\n  }\n}\n\nexport function registerAllHooks() {\n  // Hide effect icons\n  registerEffectIconHooks();\n  // Display overlays\n  registerOverlayHooks();\n  // Insert Art Select buttons and contextmenu listeners\n  registerArtSelectButtonHooks();\n  // Effect Mapping related listening for state changes and applying configurations\n  registerEffectMappingHooks();\n  // Display HUD buttons for Tokens and Tiles\n  registerHUDHooks();\n  // Default Wildcard image controls\n  registerWildcardHooks();\n  // User to Image mappings for Tile and Tokens\n  registerUserMappingHooks();\n  // Handle pop-ups and randomization on token/actor create\n  registerPopRandomizeHooks();\n}\n","import { toggleTemplateOnSelected } from '../scripts/hooks/effectMappingHooks.js';\nimport { TVA_CONFIG, updateSettings } from '../scripts/settings.js';\nimport { BASE_IMAGE_CATEGORIES, uploadTokenImage } from '../scripts/utils.js';\nimport { sortMappingsToGroups } from './effectMappingForm.js';\nimport { Templates } from './templates.js';\nimport TokenCustomConfig from './tokenCustomConfig.js';\n\n// Edit overlay configuration as a json string\nexport function showOverlayJsonConfigDialog(overlayConfig, callback) {\n  const config = foundry.utils.deepClone(overlayConfig || {});\n  delete config.effect;\n  let content = `<div style=\"height: 300px;\" class=\"form-group stacked command\"><textarea style=\"height: 300px;\" class=\"configJson\">${JSON.stringify(\n    config,\n    null,\n    2\n  )}</textarea></div>`;\n\n  new Dialog({\n    title: `Overlay Configuration`,\n    content: content,\n    buttons: {\n      yes: {\n        icon: \"<i class='fas fa-save'></i>\",\n        label: 'Save',\n        callback: (html) => {\n          let json = html.find('.configJson').val();\n          if (json) {\n            try {\n              json = JSON.parse(json);\n            } catch (e) {\n              console.warn(`TVA |`, e);\n              json = {};\n            }\n          } else {\n            json = {};\n          }\n          callback(json);\n        },\n      },\n    },\n    default: 'yes',\n  }).render(true);\n}\n\n// Change categories assigned to a path\nexport async function showPathSelectCategoryDialog(event) {\n  event.preventDefault();\n  const typesInput = event.target.closest('.path-category').find('input');\n  const selectedTypes = typesInput.val().split(',');\n\n  const categories = BASE_IMAGE_CATEGORIES.concat(TVA_CONFIG.customImageCategories);\n\n  let content = '<div class=\"token-variants-popup-settings\">';\n\n  // Split into rows of 4\n  const splits = [];\n  let currSplit = [];\n  for (let i = 0; i < categories.length; i++) {\n    if (i > 0 && i + 1 != categories.length && i % 4 == 0) {\n      splits.push(currSplit);\n      currSplit = [];\n    }\n    currSplit.push(categories[i]);\n  }\n  if (currSplit.length) splits.push(currSplit);\n\n  for (const split of splits) {\n    content += '<header class=\"table-header flexrow\">';\n    for (const type of split) {\n      content += `<label>${type}</label>`;\n    }\n    content += '</header><ul class=\"setting-list\"><li class=\"setting form-group\"><div class=\"form-fields\">';\n    for (const type of split) {\n      content += `<input class=\"category\" type=\"checkbox\" name=\"${type}\" data-dtype=\"Boolean\" ${\n        selectedTypes.includes(type) ? 'checked' : ''\n      }>`;\n    }\n    content += '</div></li></ul>';\n  }\n  content += '</div>';\n\n  new Dialog({\n    title: `Image Categories/Filters`,\n    content: content,\n    buttons: {\n      yes: {\n        icon: \"<i class='fas fa-save'></i>\",\n        label: 'Apply',\n        callback: (html) => {\n          const types = [];\n          html\n            .find('.category')\n            .each(function () {\n              if (this.is(':checked')) {\n                types.push(this.attr('name'));\n              }\n            });\n          typesInput.val(types.join(','));\n        },\n      },\n    },\n    default: 'yes',\n  }).render(true);\n}\n\n// Change configs assigned to a path\nexport async function showPathSelectConfigForm(event) {\n  event.preventDefault();\n  const configInput = event.target.closest('.path-config').find('input');\n  let config = {};\n  try {\n    config = JSON.parse(configInput.val());\n  } catch (e) {}\n\n  const setting = game.settings.get('core', DefaultTokenConfig.SETTING);\n  const data = new foundry.data.PrototypeToken(setting);\n  const token = new TokenDocument(data, { actor: null });\n  new TokenCustomConfig(\n    token,\n    {},\n    null,\n    null,\n    (conf) => {\n      if (!conf) conf = {};\n      if (conf.flags == null || foundry.utils.isEmpty(conf.flags)) delete conf.flags;\n      configInput.val(JSON.stringify(conf));\n      const cog = configInput.siblings('.select-config');\n      if (foundry.utils.isEmpty(conf)) cog.removeClass('active');\n      else cog.addClass('active');\n    },\n    config\n  ).render(true);\n}\n\nexport async function showTokenCaptureDialog(token) {\n  if (!token) return;\n  let content = `<form>\n<div class=\"form-group\">\n  <label>Image Name</label>\n  <input type=\"text\" name=\"name\" value=\"${token.name}\">\n</div>\n<div class=\"form-group\">\n  <label>Image Path</label>\n    <div class=\"form-fields\">\n      <input type=\"text\" name=\"path\" value=\"modules/token-variants/\">\n      <button type=\"button\" class=\"file-picker\" data-type=\"folder\" data-target=\"path\" title=\"Browse Folders\" tabindex=\"-1\">\n        <i class=\"fas fa-file-import fa-fw\"></i>\n      </button>\n    </div>\n</div>\n<div class=\"form-group slim\">\n  <label>Width <span class=\"units\">(pixels)</span></label>\n  <div class=\"form-fields\">\n      <input type=\"number\" step=\"1\" name=\"width\" value=\"${token.mesh.texture.width}\">\n  </div>\n</div>\n<div class=\"form-group slim\">\n  <label>Height <span class=\"units\">(pixels)</span></label>\n  <div class=\"form-fields\">\n      <input type=\"number\" step=\"1\" name=\"height\" value=\"${token.mesh.texture.height}\">\n  </div>\n</div>\n<div class=\"form-group slim\">\n  <label>Scale</label>\n  <div class=\"form-fields\">\n    <input type=\"number\" step=\"any\" name=\"scale\" value=\"3\">\n  </div>\n</div>\n</form>`;\n\n  new Dialog({\n    title: `Save Token/Overlay Image`,\n    content: content,\n    buttons: {\n      yes: {\n        icon: \"<i class='fas fa-save'></i>\",\n        label: 'Save',\n        callback: (html) => {\n          const options = {};\n          html\n            .find('[name]')\n            .each(function () {\n              let val = parseFloat(this.value);\n              if (isNaN(val)) val = this.value;\n              options[this.name] = val;\n            });\n          uploadTokenImage(token, options);\n        },\n      },\n    },\n    render: (html) => {\n      html.querySelector('.file-picker').click(() => {\n        new FilePicker({\n          type: 'folder',\n          current: html.querySelector('[name=\"path\"]').val(),\n          callback: (path) => {\n            html.querySelector('[name=\"path\"]').val(path);\n          },\n        }).render();\n      });\n    },\n    default: 'yes',\n  }).render(true);\n}\n\nexport function showMappingSelectDialog(\n  mappings,\n  { title1 = 'Mappings', title2 = 'Select Mappings', buttonTitle = 'Confirm', callback = null } = {}\n) {\n  if (!mappings || !mappings.length) return;\n\n  let content = `<form style=\"overflow-y: scroll; height:400px;\"><h2>${title2}</h2>`;\n\n  const [_, mappingGroups] = sortMappingsToGroups(mappings);\n  for (const [group, obj] of Object.entries(mappingGroups)) {\n    if (obj.list.length) {\n      content += `<h4 style=\"text-align:center;\"><b>${group}</b></h4>`;\n      for (const mapping of obj.list) {\n        content += `\n        <div class=\"form-group\">\n          <label>${mapping.label}</label>\n          <div class=\"form-fields\">\n              <input type=\"checkbox\" name=\"${mapping.id}\" data-dtype=\"Boolean\">\n          </div>\n        </div>\n        `;\n      }\n    }\n  }\n\n  content += `</form><div class=\"form-group\"><button type=\"button\" class=\"select-all\">Select all</div>`;\n\n  new Dialog({\n    title: title1,\n    content: content,\n    buttons: {\n      Ok: {\n        label: buttonTitle,\n        callback: async (html) => {\n          if (!callback) return;\n          const selectedMappings = [];\n          html.querySelector('input[type=\"checkbox\"]').each(function () {\n            if (this.checked) {\n              const mapping = mappings.find((m) => m.id === this.name);\n              if (mapping) {\n                const cMapping = foundry.utils.deepClone(mapping);\n                selectedMappings.push(cMapping);\n                delete cMapping.targetActors;\n              }\n            }\n          });\n          callback(selectedMappings);\n        },\n      },\n    },\n    close: () => callback(null),\n    render: (html) => {\n      html.querySelector('.select-all').click(() => {\n        html.querySelector('input[type=\"checkbox\"]').prop('checked', true);\n      });\n    },\n  }).render(true);\n}\n\nexport function showUserTemplateCreateDialog(mappings) {\n  let content = `\n<div class=\"form-group\">\n  <label>Template Name</label>\n  <div class=\"form-fields\">\n    <input type=\"text\" name=\"templateName\" data-dtype=\"String\" value=\"\">\n  </div>\n</div>\n<div class=\"form-group\">\n  <label>Hover Text (optional)</label>\n  <div class=\"form-fields\">\n    <input type=\"text\" name=\"templateHint\" data-dtype=\"String\" value=\"\">\n  </div>\n</div>\n<div class=\"form-group\">\n  <label>Hover Image (optional)</label>\n  <div class=\"form-fields\">\n    <input type=\"text\" name=\"img\" data-dtype=\"String\" value=\"\">\n  </div>\n</div>`;\n\n  let dialog;\n  dialog = new Dialog({\n    title: 'Mapping Templates',\n    content,\n    buttons: {\n      create: {\n        label: 'Create Template',\n        callback: (html) => {\n          const name = html.querySelector('[name=\"templateName\"]').val().trim();\n          const hint = html.querySelector('[name=\"templateHint\"]').val().trim();\n          const img = html.querySelector('[name=\"img\"]').val().trim();\n          if (name.trim()) {\n            TVA_CONFIG.templateMappings.push({\n              id: foundry.utils.randomID(),\n              name,\n              hint,\n              img,\n              mappings: foundry.utils.deepClone(mappings),\n            });\n            updateSettings({ templateMappings: TVA_CONFIG.templateMappings });\n          }\n        },\n      },\n      cancel: {\n        label: 'Cancel',\n      },\n    },\n    default: 'cancel',\n  });\n  dialog.render(true);\n}\n\nexport function toggleTemplateDialog() {\n  new Templates({ callback: (templateName, mappings) => toggleTemplateOnSelected(templateName, mappings) }).render(\n    true\n  );\n}\n","export const DEFAULT_ACTIVE_EFFECT_CONFIG = {\n  id: '',\n  label: '',\n  expression: '',\n  codeExp: '',\n  imgName: '',\n  imgSrc: '',\n  priority: 50,\n  config: null,\n  overlay: false,\n  alwaysOn: false,\n  tokens: undefined,\n  disabled: false,\n  overlayConfig: null,\n  targetActors: null,\n  group: 'Default',\n};\n\nexport const DEFAULT_OVERLAY_CONFIG = {\n  img: '',\n  imgLinked: false,\n  alpha: 1,\n  scaleX: 1,\n  scaleY: 1,\n  offsetX: 0,\n  offsetY: 0,\n  angle: 0,\n  filter: 'NONE',\n  filterOptions: {},\n  inheritTint: false,\n  top: false,\n  bottom: false,\n  underlay: false,\n  linkRotation: true,\n  linkMirror: true,\n  linkOpacity: false,\n  linkScale: true,\n  linkDimensionX: false,\n  linkDimensionY: false,\n  linkStageScale: false,\n  mirror: false,\n  tint: null,\n  loop: true,\n  playOnce: false,\n  animation: {\n    rotate: false,\n    duration: 5000,\n    clockwise: true,\n    relative: false,\n  },\n  limitedUsers: [],\n  limitedToOwner: false,\n  limitOnProperty: '',\n  alwaysVisible: false,\n  text: {\n    text: '',\n    align: CONFIG.canvasTextStyle.align,\n    fontSize: CONFIG.canvasTextStyle.fontSize,\n    fontFamily: CONFIG.canvasTextStyle.fontFamily,\n    fill: CONFIG.canvasTextStyle.fill,\n    dropShadow: CONFIG.canvasTextStyle.dropShadow,\n    strokeThickness: CONFIG.canvasTextStyle.strokeThickness,\n    stroke: CONFIG.canvasTextStyle.stroke,\n    curve: { angle: 0, radius: 0, invert: false },\n    letterSpacing: CONFIG.canvasTextStyle.letterSpacing,\n    repeating: false,\n    wordWrap: false,\n    wordWrapWidth: 200,\n    breakWords: false,\n    maxHeight: 0,\n  },\n  parentID: '',\n  id: null,\n  anchor: { x: 0.5, y: 0.5 },\n  shapes: [],\n  variables: [],\n  interactivity: [],\n  ui: false,\n};\n\nexport const OVERLAY_SHAPES = {\n  Rectangle: {\n    type: 'rectangle',\n    x: 0,\n    y: 0,\n    width: 100,\n    height: 100,\n    radius: 0,\n    repeating: false,\n  },\n  Ellipse: {\n    type: 'ellipse',\n    x: 0,\n    y: 0,\n    width: 50,\n    height: 50,\n    repeating: false,\n  },\n  Polygon: {\n    type: 'polygon',\n    x: 0,\n    y: 0,\n    points: '0,1,0.95,0.31,0.59,-0.81,-0.59,-0.81,-0.95,0.31',\n    scale: 50,\n    repeating: false,\n  },\n  Torus: {\n    type: 'torus',\n    x: 0,\n    y: 0,\n    innerRadius: 50,\n    outerRadius: 100,\n    startAngle: 0,\n    endAngle: 180,\n    repeating: false,\n  },\n  CutCircle: {\n    type: 'cutCircle',\n    x: 0,\n    y: 0,\n    radius: 50,\n    cut: 0.5,\n    rotation: 0,\n    repeating: false,\n  },\n};\n\nexport const CORE_SHAPE = {\n  line: {\n    width: 1,\n    color: '#000000',\n    alpha: 1,\n  },\n  fill: { color: '#ffffff', color2: '', prc: '', alpha: 1 },\n};\n","import { getTokenConfig, setTokenConfig } from \"../scripts/utils.js\";\n\nexport default class TokenCustomConfig extends TokenConfig {\n  constructor(object, options, imgSrc, imgName, callback, config) {\n    let token;\n    if (object instanceof Actor) {\n      token = new TokenDocument(object.token, {\n        actor: object,\n      });\n    } else {\n      token = new TokenDocument(object.document, {\n        actor: game.actors.get(object.actorId),\n      });\n    }\n    super(token, options);\n    this.imgSrc = imgSrc;\n    this.imgName = imgName;\n    this.callback = callback;\n    this.config = config;\n    if (this.config) {\n      this.flags = this.config.flags;\n      this.tv_script = this.config.tv_script;\n    }\n  }\n\n  _getSubmitData(updateData = {}) {\n    if (!this.form)\n      throw new Error(\n        \"The FormApplication subclass has no registered form element\",\n      );\n    const fd = new FormDataExtended(this.form, { editors: this.editors });\n    let data = fd.object;\n    if (updateData)\n      data = foundry.utils.flattenObject(\n        foundry.utils.mergeObject(data, updateData),\n      );\n\n    // Clear detection modes array\n    if (!(\"detectionModes.0.id\" in data)) data.detectionModes = [];\n\n    // Treat \"None\" as null for bar attributes\n    data[\"bar1.attribute\"] ||= null;\n    data[\"bar2.attribute\"] ||= null;\n    return data;\n  }\n\n  async _updateObject(event, formData) {\n    const filtered = {};\n\n    const form = event.target.closest(\"form\");\n\n    form.find(\".form-group\").each(function (_) {\n      const tva_checkbox = this.find(\".tva-config-checkbox > input\");\n      if (tva_checkbox.length && tva_checkbox.is(\":checked\")) {\n        this.find(\"[name]\").each(function (_) {\n          const name = this.attr(\"name\");\n          filtered[name] = formData[name];\n        });\n      }\n    });\n\n    if (this.tv_script) {\n      filtered.tv_script = this.tv_script;\n    }\n\n    if (this.config) {\n      let config = foundry.utils.expandObject(filtered);\n      config.flags = config.flags\n        ? foundry.utils.mergeObject(this.flags || {}, config.flags)\n        : this.flags;\n      if (this.callback) this.callback(config);\n    } else {\n      const saved = setTokenConfig(this.imgSrc, this.imgName, filtered);\n      if (this.callback) this.callback(saved);\n    }\n  }\n\n  applyCustomConfig() {\n    const tokenConfig = foundry.utils.flattenObject(\n      this.config || getTokenConfig(this.imgSrc, this.imgName),\n    );\n    const form = this.form;\n    for (const key of Object.keys(tokenConfig)) {\n      const el = form.find(`[name=\"${key}\"]`);\n      if (el.is(\":checkbox\")) {\n        el.prop(\"checked\", tokenConfig[key]);\n      } else {\n        el.val(tokenConfig[key]);\n      }\n      el.trigger(\"change\");\n    }\n  }\n\n  // *************\n  // consider moving html injection to:\n  // _replaceHTML | _injectHTML\n\n  async activateListeners(html) {\n    await super.activateListeners(html);\n\n    // Disable image path controls\n    html.find(\".token-variants-image-select-button\").prop(\"disabled\", true);\n    html.find(\".file-picker\").prop(\"disabled\", true);\n    html.find(\".image\").prop(\"disabled\", true);\n\n    // Remove 'Assign Token' button\n    html.find(\".assign-token\").remove();\n\n    // Add checkboxes to control inclusion of specific tabs in the custom config\n    const tokenConfig =\n      this.config || getTokenConfig(this.imgSrc, this.imgName);\n    this.tv_script = tokenConfig.tv_script;\n\n    html.on(\"change\", \".tva-config-checkbox\", this._onCheckboxChange);\n\n    const processFormGroup = function (formGroup) {\n      // Checkbox is not added for the Image Path group\n      if (!formGroup.find('[name=\"img\"]').length) {\n        let savedField = false;\n        if (tokenConfig) {\n          const flatConfig = foundry.utils.flattenObject(tokenConfig);\n          formGroup.find(\"[name]\").each(function (_) {\n            const name = this.attr(\"name\");\n            if (name in flatConfig) {\n              savedField = true;\n            }\n          });\n        }\n\n        const checkbox = $(\n          `<div class=\"tva-config-checkbox\"><input type=\"checkbox\" data-dtype=\"Boolean\" ${\n            savedField ? 'checked=\"\"' : \"\"\n          }></div>`,\n        );\n        if (formGroup.find(\"p.hint\").length) {\n          formGroup.find(\"p.hint\").before(checkbox);\n        } else {\n          formGroup.append(checkbox);\n        }\n        checkbox.find(\"input\").trigger(\"change\");\n      }\n    };\n    // Add checkboxes to each form-group to control highlighting and which fields will are to be saved\n    html.find(\".form-group\").each(function (index) {\n      processFormGroup(this);\n    });\n\n    // Add 'update' and 'remove' config buttons\n    html.find(\".sheet-footer > button\").remove();\n    html\n      .find(\".sheet-footer\")\n      .append(\n        '<button type=\"submit\" value=\"1\"><i class=\"far fa-save\"></i> Save Config</button>',\n      );\n    if (tokenConfig) {\n      html\n        .find(\".sheet-footer\")\n        .append(\n          '<button type=\"button\" class=\"remove-config\"><i class=\"fas fa-trash\"></i> Remove Config</button>',\n        );\n      html\n        .querySelector(\".remove-config\")\n        .click(this._onRemoveConfig.bind(this));\n    }\n\n    // Pre-select image or appearance tab\n    html.find('.tabs > .item[data-tab=\"image\"] > i').trigger(\"click\");\n    html.find('.tabs > .item[data-tab=\"appearance\"] > i').trigger(\"click\");\n\n    document.activeElement.blur(); // Hack fix for key UP/DOWN effects not registering after config has been opened\n\n    // TokenConfig might be changed by some modules after activateListeners is processed\n    // Look out for these updates and add checkboxes for any newly added form-groups\n    const mutate = (mutations) => {\n      mutations.forEach((mutation) => {\n        mutation.addedNodes.forEach((node) => {\n          if (node.nodeName === \"DIV\" && node.className === \"form-group\") {\n            processFormGroup(node);\n            this.applyCustomConfig();\n          }\n        });\n      });\n    };\n\n    const observer = new MutationObserver(mutate);\n    observer.observe(html[0], {\n      characterData: false,\n      attributes: false,\n      childList: true,\n      subtree: true,\n    });\n\n    // On any field being changed we want to automatically select the form-group to be included in the update\n    html.on(\"change\", \"input, select\", onInputChange);\n    html.on(\"click\", \"button\", onInputChange);\n\n    this.applyCustomConfig();\n  }\n\n  async _onCheckboxChange(event) {\n    const checkbox = event.target;\n    checkbox.closest(\".form-group\").css({\n      \"outline-color\": checkbox.is(\":checked\") ? \"green\" : \"#ffcc6e\",\n      \"outline-width\": \"2px\",\n      \"outline-style\": \"dotted\",\n      \"margin-bottom\": \"5px\",\n    });\n    checkbox.closest(\".tva-config-checkbox\").css({\n      \"outline-color\": checkbox.is(\":checked\") ? \"green\" : \"#ffcc6e\",\n      \"outline-width\": \"2px\",\n      \"outline-style\": \"solid\",\n    });\n  }\n\n  async _onRemoveConfig(event) {\n    if (this.config) {\n      if (this.callback) this.callback({});\n    } else {\n      const saved = setTokenConfig(this.imgSrc, this.imgName, null);\n      if (this.callback) this.callback(saved);\n    }\n    this.close();\n  }\n\n  get id() {\n    return `token-custom-config-${this.object.id}`;\n  }\n\n  _getHeaderButtons() {\n    const buttons = super._getHeaderButtons();\n    return buttons;\n  }\n}\n\n// Toggle checkbox if input has been detected inside it's form-group\nasync function onInputChange(event) {\n  if (event.target.parentNode.className === \"tva-config-checkbox\") return;\n  event.target\n    .closest(\".form-group\")\n    .find(\".tva-config-checkbox input\")\n    .prop(\"checked\", true);\n}\n","import { cacheImages } from \"../scripts/search.js\";\nimport { TVA_CONFIG, updateSettings } from \"../scripts/settings.js\";\nimport { getFileName } from \"../scripts/utils.js\";\nimport EffectMappingForm from \"./effectMappingForm.js\";\nimport {\n  showPathSelectCategoryDialog,\n  showPathSelectConfigForm,\n} from \"./dialogs.js\";\n\nexport default class ConfigureSettings extends FormApplication {\n  constructor(\n    dummySettings,\n    {\n      searchPaths = true,\n      searchFilters = true,\n      searchAlgorithm = true,\n      randomizer = true,\n      popup = true,\n      permissions = true,\n      worldHud = true,\n      misc = true,\n      activeEffects = true,\n      features = false,\n    } = {},\n  ) {\n    super({}, {});\n    this.enabledTabs = {\n      searchPaths,\n      searchFilters,\n      searchAlgorithm,\n      randomizer,\n      features,\n      popup,\n      permissions,\n      worldHud,\n      misc,\n      activeEffects,\n    };\n    this.settings = foundry.utils.deepClone(TVA_CONFIG);\n    if (dummySettings) {\n      this.settings = foundry.utils.mergeObject(this.settings, dummySettings, {\n        insertKeys: false,\n      });\n      this.dummySettings = dummySettings;\n    }\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: \"token-variants-configure-settings\",\n      classes: [\"sheet\"],\n      template:\n        \"modules/token-variants/token-variants/templates/configureSettings.html\",\n      resizable: false,\n      minimizable: false,\n      title: \"Configure Settings\",\n      width: 700,\n      height: \"auto\",\n      tabs: [\n        {\n          navSelector: \".sheet-tabs\",\n          contentSelector: \".content\",\n          initial: \"searchPaths\",\n        },\n      ],\n    });\n  }\n\n  async getData(options) {\n    const data = super.getData(options);\n    const settings = this.settings;\n\n    data.enabledTabs = this.enabledTabs;\n\n    // === Search Paths ===\n    const paths = settings.searchPaths.map((path) => {\n      const r = {};\n      r.text = path.text;\n      r.icon = this._pathIcon(path.source || \"\");\n      r.cache = path.cache;\n      r.source = path.source || \"\";\n      r.types = path.types.join(\",\");\n      r.config = JSON.stringify(path.config ?? {});\n      r.hasConfig = path.config && !foundry.utils.isEmpty(path.config);\n      return r;\n    });\n    data.searchPaths = paths;\n\n    // === Search Filters ===\n    data.searchFilters = settings.searchFilters;\n    for (const filter in data.searchFilters) {\n      data.searchFilters[filter].label = filter;\n    }\n\n    // === Algorithm ===\n    data.algorithm = foundry.utils.deepClone(settings.algorithm);\n    data.algorithm.fuzzyThreshold = 100 - data.algorithm.fuzzyThreshold * 100;\n\n    // === Randomizer ===\n    // Get all actor types defined by the game system\n    data.randomizer = foundry.utils.deepClone(settings.randomizer);\n    const actorTypes = game.documentTypes.Actor;\n    data.randomizer.actorTypes = actorTypes.reduce((obj, t) => {\n      const label = CONFIG.Actor?.typeLabels?.[t] ?? t;\n      obj[t] = {\n        label: game.i18n.has(label) ? game.i18n.localize(label) : t,\n        disable: settings.randomizer[`${t}Disable`] ?? false,\n      };\n      return obj;\n    }, {});\n\n    data.randomizer.tokenToPortraitDisabled =\n      !(\n        settings.randomizer.tokenCreate || settings.randomizer.tokenCopyPaste\n      ) || data.randomizer.diffImages;\n\n    // === Pop-up ===\n    data.popup = foundry.utils.deepClone(settings.popup);\n    // Get all actor types defined by the game system\n    data.popup.actorTypes = actorTypes.reduce((obj, t) => {\n      const label = CONFIG.Actor?.typeLabels?.[t] ?? t;\n      obj[t] = {\n        type: t,\n        label: game.i18n.has(label) ? game.i18n.localize(label) : t,\n        disable: settings.popup[`${t}Disable`] ?? false,\n      };\n      return obj;\n    }, {});\n\n    // Split into arrays of max length 3\n    let allTypes = [];\n    let tempTypes = [];\n    let i = 0;\n    for (const [key, value] of Object.entries(data.popup.actorTypes)) {\n      tempTypes.push(value);\n      i++;\n      if (i % 3 == 0) {\n        allTypes.push(tempTypes);\n        tempTypes = [];\n      }\n    }\n    if (tempTypes.length > 0) allTypes.push(tempTypes);\n    data.popup.actorTypes = allTypes;\n\n    // === Permissions ===\n    data.permissions = settings.permissions;\n\n    // === Token HUD ===\n    data.worldHud = foundry.utils.deepClone(settings.worldHud);\n    data.worldHud.tokenHUDWildcardActive =\n      game.modules.get(\"token-hud-wildcard\")?.active;\n\n    // === Internal Effects ===\n    data.internalEffects = foundry.utils.deepClone(settings.internalEffects);\n\n    // === Misc ===\n    data.keywordSearch = settings.keywordSearch;\n    data.excludedKeywords = settings.excludedKeywords;\n    data.systemHpPath = settings.systemHpPath;\n    data.runSearchOnPath = settings.runSearchOnPath;\n    data.imgurClientId = settings.imgurClientId;\n    data.enableStatusConfig = settings.enableStatusConfig;\n    data.disableNotifs = settings.disableNotifs;\n    data.staticCache = settings.staticCache;\n    data.staticCacheFile = settings.staticCacheFile;\n    data.stackStatusConfig = settings.stackStatusConfig;\n    data.mergeGroup = settings.mergeGroup;\n    data.customImageCategories = settings.customImageCategories.join(\",\");\n    data.disableEffectIcons = settings.disableEffectIcons;\n    data.displayEffectIconsOnHover = settings.displayEffectIconsOnHover;\n    data.filterEffectIcons = settings.filterEffectIcons;\n    data.hideElevationTooltip = settings.hideElevationTooltip;\n    data.hideTokenBorder = settings.hideTokenBorder;\n    data.filterCustomEffectIcons = settings.filterCustomEffectIcons;\n    data.filterIconList = settings.filterIconList.join(\",\");\n    data.tilesEnabled = settings.tilesEnabled;\n    data.updateTokenProto = settings.updateTokenProto;\n    data.imgNameContainsDimensions = settings.imgNameContainsDimensions;\n    data.imgNameContainsFADimensions = settings.imgNameContainsFADimensions;\n    data.playVideoOnHover = settings.playVideoOnHover;\n    data.pauseVideoOnHoverOut = settings.pauseVideoOnHoverOut;\n    data.disableImageChangeOnPolymorphed =\n      settings.disableImageChangeOnPolymorphed;\n    data.disableImageUpdateOnNonPrototype =\n      settings.disableImageUpdateOnNonPrototype;\n    data.disableTokenUpdateAnimation = settings.disableTokenUpdateAnimation;\n    data.evaluateOverlayOnHover = settings.evaluateOverlayOnHover;\n\n    // Controls\n    data.pathfinder = [\"pf1e\", \"pf2e\"].includes(game.system.id);\n    data.dnd5e = game.system.id === \"dnd5e\";\n\n    return data;\n  }\n\n  /**\n   * @param {JQuery} html\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    // Search Paths\n    super.activateListeners(html);\n    html.querySelector(\"a.create-path\").click(this._onCreatePath.bind(this));\n    html.on(\n      \"input\",\n      \".searchSource\",\n      this._onSearchSourceTextChange.bind(this),\n    );\n    html.on(\"click\", \"a.delete-path\", this._onDeletePath.bind(this));\n    html.on(\"click\", \"a.convert-imgur\", this._onConvertImgurPath.bind(this));\n    html.on(\"click\", \"a.convert-json\", this._onConvertJsonPath.bind(this));\n    html.on(\n      \"click\",\n      \".path-image.source-icon a\",\n      this._onBrowseFolder.bind(this),\n    );\n    html.on(\n      \"click\",\n      \"a.select-category\",\n      showPathSelectCategoryDialog.bind(this),\n    );\n    html.on(\"click\", \"a.select-config\", showPathSelectConfigForm.bind(this));\n\n    // Search Filters\n    html.on(\"input\", \"input.filterRegex\", this._validateRegex.bind(this));\n\n    // Active Effects\n    const disableEffectIcons = html.querySelector(\n      '[name=\"disableEffectIcons\"]',\n    );\n    const filterEffectIcons = html.querySelector('[name=\"filterEffectIcons\"]');\n    disableEffectIcons\n      .on(\"change\", (e) => {\n        if (e.target.checked) filterEffectIcons.prop(\"checked\", false);\n      })\n      .trigger(\"change\");\n    filterEffectIcons.on(\"change\", (e) => {\n      if (e.target.checked) disableEffectIcons.prop(\"checked\", false);\n    });\n\n    // Algorithm\n    const algorithmTab = html.find('div[data-tab=\"searchAlgorithm\"]');\n    algorithmTab.find(`input[name=\"algorithm.exact\"]`).change((e) => {\n      e.target\n        .closest(\"form\")\n        .find('input[name=\"algorithm.fuzzy\"]')\n        .prop(\"checked\", !e.target.checked);\n    });\n    algorithmTab.find(`input[name=\"algorithm.fuzzy\"]`).change((e) => {\n      e.target\n        .closest(\"form\")\n        .find('input[name=\"algorithm.exact\"]')\n        .prop(\"checked\", !e.target.checked);\n    });\n    algorithmTab.find('input[name=\"algorithm.fuzzyThreshold\"]').change((e) => {\n      e.target\n        .siblings(\".token-variants-range-value\")\n        .html(`${e.target.value}%`);\n    });\n\n    // Randomizer\n    const tokenCreate = html.querySelector(\n      'input[name=\"randomizer.tokenCreate\"]',\n    );\n    const tokenCopyPaste = html.querySelector(\n      'input[name=\"randomizer.tokenCopyPaste\"]',\n    );\n    const tokenToPortrait = html.querySelector(\n      'input[name=\"randomizer.tokenToPortrait\"]',\n    );\n    const _toggle = () => {\n      tokenToPortrait.prop(\n        \"disabled\",\n        !(tokenCreate.is(\":checked\") || tokenCopyPaste.is(\":checked\")),\n      );\n    };\n    tokenCreate.change(_toggle);\n    tokenCopyPaste.change(_toggle);\n\n    const diffImages = html.querySelector(\n      'input[name=\"randomizer.diffImages\"]',\n    );\n    const syncImages = html.querySelector(\n      'input[name=\"randomizer.syncImages\"]',\n    );\n    diffImages.change(() => {\n      syncImages.prop(\"disabled\", !diffImages.is(\":checked\"));\n      tokenToPortrait.prop(\"disabled\", diffImages.is(\":checked\"));\n    });\n\n    // Token HUD\n    html\n      .querySelector('input[name=\"worldHud.updateActorImage\"]')\n      .change((event) => {\n        event.target\n          .closest(\"form\")\n          .find('input[name=\"worldHud.useNameSimilarity\"]')\n          .prop(\"disabled\", !event.target.checked);\n      });\n\n    // Static Cache\n    html.querySelector(\"button.token-variants-cache-images\").click((event) => {\n      const tab = event.target.closest(\".tab\");\n      const staticOn = tab.find('input[name=\"staticCache\"]');\n      const staticFile = tab.find('input[name=\"staticCacheFile\"]');\n      cacheImages({\n        staticCache: staticOn.is(\":checked\"),\n        staticCacheFile: staticFile.val(),\n      });\n    });\n\n    // Global Mappings\n    html.querySelector(\"button.token-variants-global-mapping\").click(() => {\n      const setting = game.settings.get(\"core\", DefaultTokenConfig.SETTING);\n      const data = new foundry.data.PrototypeToken(setting);\n      const token = new TokenDocument(data, { actor: null });\n      new EffectMappingForm(token, { globalMappings: true }).render(true);\n    });\n  }\n\n  /**\n   * Validates regex entered into Search Filter's RegEx input field\n   */\n  async _validateRegex(event) {\n    if (this._validRegex(event.target.value)) {\n      event.target.style.backgroundColor = \"\";\n    } else {\n      event.target.style.backgroundColor = \"#ff7066\";\n    }\n  }\n\n  _validRegex(val) {\n    if (val) {\n      try {\n        new RegExp(val);\n      } catch (e) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Open a FilePicker so the user can select a local folder to use as an image source\n   */\n  async _onBrowseFolder(event) {\n    const pathInput = event.target\n      .closest(\".table-row\")\n      .find(\".path-text input\");\n    const sourceInput = event.target\n      .closest(\".table-row\")\n      .find(\".path-source input\");\n\n    let activeSource = sourceInput.val() || \"data\";\n    let current = pathInput.val();\n\n    if (activeSource.startsWith(\"s3:\")) {\n      const bucketName = activeSource.replace(\"s3:\", \"\");\n      current = `${game.data.files.s3?.endpoint.protocol}//${bucketName}.${game.data.files.s3?.endpoint.host}/${current}`;\n    } else if (activeSource.startsWith(\"rolltable\")) {\n      let content = `<select style=\"width: 100%;\" name=\"table-name\" id=\"output-tableKey\">`;\n\n      game.tables.forEach((rollTable) => {\n        content += `<option value='${rollTable.name}'>${rollTable.name}</option>`;\n      });\n\n      content += `</select>`;\n\n      new Dialog({\n        title: `Select a Rolltable`,\n        content: content,\n        buttons: {\n          yes: {\n            icon: \"<i class='fas fa-check'></i>\",\n            label: \"Select\",\n            callback: (html) => {\n              pathInput.val();\n              const tableName = html\n                .querySelector(\"select[name='table-name']\")\n                .val();\n              pathInput.val(tableName);\n            },\n          },\n        },\n        default: \"yes\",\n      }).render(true);\n      return;\n    }\n\n    if (activeSource === \"json\") {\n      new FilePicker({\n        type: \"text\",\n        activeSource: \"data\",\n        current: current,\n        callback: (path, fp) => {\n          pathInput.val(path);\n        },\n      }).render(true);\n    } else {\n      new FilePicker({\n        type: \"folder\",\n        activeSource: activeSource,\n        current: current,\n        callback: (path, fp) => {\n          pathInput.val(fp.result.target);\n          if (fp.activeSource === \"s3\") {\n            sourceInput.val(`s3:${fp.result.bucket}`);\n          } else {\n            sourceInput.val(fp.activeSource);\n          }\n        },\n      }).render(true);\n    }\n  }\n\n  /**\n   * Converts Imgur path to a rolltable\n   */\n  async _onConvertImgurPath(event) {\n    event.preventDefault();\n\n    const pathInput = event.target\n      .closest(\".table-row\")\n      .find(\".path-text input\");\n    const sourceInput = event.target\n      .closest(\".table-row\")\n      .find(\".path-source input\");\n\n    const albumHash = pathInput.val();\n    const imgurClientId =\n      TVA_CONFIG.imgurClientId === \"\"\n        ? \"df9d991443bb222\"\n        : TVA_CONFIG.imgurClientId;\n\n    fetch(\"https://api.imgur.com/3/gallery/album/\" + albumHash, {\n      headers: {\n        Authorization: \"Client-ID \" + imgurClientId,\n        Accept: \"application/json\",\n      },\n    })\n      .then((response) => response.json())\n      .then(\n        async function (result) {\n          if (!result.success && location.hostname === \"localhost\") {\n            ui.notifications.warn(\n              game.i18n.format(\n                \"token-variants.notifications.warn.imgur-localhost\",\n              ),\n            );\n            return;\n          }\n\n          const data = result.data;\n\n          let resultsArray = [];\n          data.images.forEach((img, i) => {\n            resultsArray.push({\n              type: 0,\n              text: img.title ?? img.description ?? \"\",\n              weight: 1,\n              range: [i + 1, i + 1],\n              collection: \"Text\",\n              drawn: false,\n              img: img.link,\n            });\n          });\n\n          await RollTable.create({\n            name: data.title,\n            description:\n              \"Token Variant Art auto generated RollTable: https://imgur.com/gallery/\" +\n              albumHash,\n            results: resultsArray,\n            replacement: true,\n            displayRoll: true,\n            img: \"modules/token-variants/token-variants/img/token-images.svg\",\n          });\n\n          pathInput.val(data.title);\n          sourceInput.val(\"rolltable\").trigger(\"input\");\n        }.bind(this),\n      )\n      .catch((error) => console.warn(\"TVA | \", error));\n  }\n\n  /**\n   * Converts Json path to a rolltable\n   */\n  async _onConvertJsonPath(event) {\n    event.preventDefault();\n\n    const pathInput = event.target\n      .closest(\".table-row\")\n      .find(\".path-text input\");\n    const sourceInput = event.target\n      .closest(\".table-row\")\n      .find(\".path-source input\");\n\n    const jsonPath = pathInput.val();\n\n    fetch(jsonPath, {\n      headers: {\n        Accept: \"application/json\",\n      },\n    })\n      .then((response) => response.json())\n      .then(\n        async function (result) {\n          if (!result.length > 0) {\n            ui.notifications.warn(\n              game.i18n.format(\n                \"token-variants.notifications.warn.json-localhost\",\n              ),\n            );\n            return;\n          }\n\n          const data = result;\n          data.title = getFileName(jsonPath);\n\n          let resultsArray = [];\n          data.forEach((img, i) => {\n            resultsArray.push({\n              type: 0,\n              text: img.name ?? \"\",\n              weight: 1,\n              range: [i + 1, i + 1],\n              collection: \"Text\",\n              drawn: false,\n              img: img.path,\n            });\n          });\n\n          await RollTable.create({\n            name: data.title,\n            description:\n              \"Token Variant Art auto generated RollTable: \" + jsonPath,\n            results: resultsArray,\n            replacement: true,\n            displayRoll: true,\n            img: \"modules/token-variants/token-variants/img/token-images.svg\",\n          });\n\n          pathInput.val(data.title);\n          sourceInput.val(\"rolltable\").trigger(\"input\");\n        }.bind(this),\n      )\n      .catch((error) => console.warn(\"TVA | \", error));\n  }\n\n  /**\n   * Generates a new search path row\n   */\n  async _onCreatePath(event) {\n    event.preventDefault();\n    const table = event.currentTarget.closest(\".token-variant-table\");\n    let row = `\n    <li class=\"table-row flexrow\">\n        <div class=\"path-image source-icon\">\n            <a><i class=\"${this._pathIcon(\"\")}\"></i></a>\n        </div>\n        <div class=\"path-source\">\n          <input class=\"searchSource\" type=\"text\" name=\"searchPaths.source\" value=\"\" placeholder=\"data\"/>\n        </div>\n        <div class=\"path-text\">\n            <input class=\"searchPath\" type=\"text\" name=\"searchPaths.text\" value=\"\" placeholder=\"Path to folder\"/>\n        </div>\n        <div class=\"imgur-control\">\n            <a class=\"convert-imgur\" title=\"Convert to Rolltable\"><i class=\"fas fa-angle-double-left\"></i></a>\n        </div>\n        <div class=\"json-control\">\n          <a class=\"convert-json\" title=\"Convert to Rolltable\"><i class=\"fas fa-angle-double-left\"></i></a>\n        </div>\n        <div class=\"path-category\">\n            <a class=\"select-category\" title=\"Select image categories/filters\"><i class=\"fas fa-swatchbook\"></i></a>\n            <input type=\"hidden\" name=\"searchPaths.types\" value=\"Portrait,Token,PortraitAndToken\">\n        </div>\n        <div class=\"path-config\">\n          <a class=\"select-config\" title=\"Apply configuration to images under this path.\"><i class=\"fas fa-cog fa-lg\"></i></a>\n          <input type=\"hidden\" name=\"searchPaths.config\" value=\"{}\">\n         </div>\n        <div class=\"path-cache\">\n            <input type=\"checkbox\" name=\"searchPaths.cache\" data-dtype=\"Boolean\" checked/>\n        </div>\n        <div class=\"path-controls\">\n            <a class=\"delete-path\" title=\"Delete path\"><i class=\"fas fa-trash\"></i></a>\n        </div>\n    </li>\n  `;\n    table.append(row);\n\n    this._reIndexPaths(table);\n\n    this.setPosition(); // Auto-resize window\n  }\n\n  async _reIndexPaths(table) {\n    table\n      .find(\".path-source\")\n      .find(\"input\")\n      .each(function (index) {\n        this.attr(\"name\", `searchPaths.${index}.source`);\n      });\n\n    table\n      .find(\".path-text\")\n      .find(\"input\")\n      .each(function (index) {\n        this.attr(\"name\", `searchPaths.${index}.text`);\n      });\n\n    table\n      .find(\".path-cache\")\n      .find(\"input\")\n      .each(function (index) {\n        this.attr(\"name\", `searchPaths.${index}.cache`);\n      });\n    table\n      .find(\".path-category\")\n      .find(\"input\")\n      .each(function (index) {\n        this.attr(\"name\", `searchPaths.${index}.types`);\n      });\n    table\n      .find(\".path-config\")\n      .find(\"input\")\n      .each(function (index) {\n        this.attr(\"name\", `searchPaths.${index}.config`);\n      });\n  }\n\n  async _onDeletePath(event) {\n    event.preventDefault();\n\n    const li = event.currentTarget.closest(\".table-row\");\n    li.remove();\n\n    const table = event.currentTarget.closest(\".token-variant-table\");\n    this._reIndexPaths(table);\n\n    this.setPosition(); // Auto-resize window\n  }\n\n  async _onSearchSourceTextChange(event) {\n    const image = this._pathIcon(event.target.value);\n    const imgur = image === \"fas fa-info\";\n    const json = image === \"fas fa-brackets-curly\";\n\n    const imgurControl = event.currentTarget\n      .closest(\".table-row\")\n      .find(\".imgur-control\");\n    if (imgur) imgurControl.addClass(\"active\");\n    else imgurControl.removeClass(\"active\");\n\n    const jsonControl = event.currentTarget\n      .closest(\".table-row\")\n      .find(\".json-control\");\n    if (json) jsonControl.addClass(\"active\");\n    else jsonControl.removeClass(\"active\");\n\n    event.currentTarget\n      .closest(\".table-row\")\n      .find(\".path-image i\")\n      .attr(\"class\", image);\n  }\n\n  // Return icon appropriate for the path provided\n  _pathIcon(source) {\n    if (source.startsWith(\"s3\")) {\n      return \"fas fa-database\";\n    } else if (source.startsWith(\"rolltable\")) {\n      return \"fas fa-dice\";\n    } else if (\n      source.startsWith(\"forgevtt\") ||\n      source.startsWith(\"forge-bazaar\")\n    ) {\n      return \"fas fa-hammer\";\n    } else if (source.startsWith(\"imgur\")) {\n      return \"fas fa-info\";\n    } else if (source.startsWith(\"json\")) {\n      return \"fas fa-brackets-curly\";\n    }\n\n    return \"fas fa-folder\";\n  }\n\n  /**\n   * @param {Event} event\n   * @param {Object} formData\n   */\n  async _updateObject(event, formData) {\n    const settings = this.settings;\n    formData = foundry.utils.expandObject(formData);\n\n    // Search Paths\n    settings.searchPaths = formData.hasOwnProperty(\"searchPaths\")\n      ? Object.values(formData.searchPaths)\n      : [];\n    settings.searchPaths.forEach((path) => {\n      if (!path.source) path.source = \"data\";\n      if (path.types) path.types = path.types.split(\",\");\n      else path.types = [];\n      if (path.config) {\n        try {\n          path.config = JSON.parse(path.config);\n        } catch (e) {\n          delete path.config;\n        }\n      } else delete path.config;\n    });\n\n    // Search Filters\n    for (const filter in formData.searchFilters) {\n      if (!this._validRegex(formData.searchFilters[filter].regex))\n        formData.searchFilters[filter].regex = \"\";\n    }\n    foundry.utils.mergeObject(settings.searchFilters, formData.searchFilters);\n\n    // Algorithm\n    formData.algorithm.fuzzyLimit = parseInt(formData.algorithm.fuzzyLimit);\n    if (\n      isNaN(formData.algorithm.fuzzyLimit) ||\n      formData.algorithm.fuzzyLimit < 1\n    )\n      formData.algorithm.fuzzyLimit = 50;\n    formData.algorithm.fuzzyThreshold =\n      (100 - formData.algorithm.fuzzyThreshold) / 100;\n    foundry.utils.mergeObject(settings.algorithm, formData.algorithm);\n\n    // Randomizer\n    foundry.utils.mergeObject(settings.randomizer, formData.randomizer);\n\n    // Pop-up\n    foundry.utils.mergeObject(settings.popup, formData.popup);\n\n    // Permissions\n    foundry.utils.mergeObject(settings.permissions, formData.permissions);\n\n    // Token HUD\n    foundry.utils.mergeObject(settings.worldHud, formData.worldHud);\n\n    // Internal Effects\n    foundry.utils.mergeObject(\n      settings.internalEffects,\n      formData.internalEffects,\n    );\n\n    // Misc\n    foundry.utils.mergeObject(settings, {\n      keywordSearch: formData.keywordSearch,\n      excludedKeywords: formData.excludedKeywords,\n      systemHpPath: formData.systemHpPath?.trim(),\n      runSearchOnPath: formData.runSearchOnPath,\n      imgurClientId: formData.imgurClientId,\n      enableStatusConfig: formData.enableStatusConfig,\n      disableNotifs: formData.disableNotifs,\n      staticCache: formData.staticCache,\n      staticCacheFile: formData.staticCacheFile,\n      tilesEnabled: formData.tilesEnabled,\n      stackStatusConfig: formData.stackStatusConfig,\n      mergeGroup: formData.mergeGroup,\n      customImageCategories: (formData.customImageCategories || \"\")\n        .split(\",\")\n        .map((t) => t.trim())\n        .filter((t) => t),\n      disableEffectIcons: formData.disableEffectIcons,\n      displayEffectIconsOnHover: formData.displayEffectIconsOnHover,\n      filterEffectIcons: formData.filterEffectIcons,\n      hideElevationTooltip: formData.hideElevationTooltip,\n      hideTokenBorder: formData.hideTokenBorder,\n      filterCustomEffectIcons: formData.filterCustomEffectIcons,\n      filterIconList: (formData.filterIconList || \"\")\n        .split(\",\")\n        .map((t) => t.trim())\n        .filter((t) => t),\n      updateTokenProto: formData.updateTokenProto,\n      imgNameContainsDimensions: formData.imgNameContainsDimensions,\n      imgNameContainsFADimensions: formData.imgNameContainsFADimensions,\n      playVideoOnHover: formData.playVideoOnHover,\n      pauseVideoOnHoverOut: formData.pauseVideoOnHoverOut,\n      disableImageChangeOnPolymorphed: formData.disableImageChangeOnPolymorphed,\n      disableImageUpdateOnNonPrototype:\n        formData.disableImageUpdateOnNonPrototype,\n      disableTokenUpdateAnimation: formData.disableTokenUpdateAnimation,\n      evaluateOverlayOnHover: formData.evaluateOverlayOnHover,\n    });\n\n    // Global Mappings\n    settings.globalMappings = TVA_CONFIG.globalMappings;\n\n    // Save Settings\n    if (this.dummySettings) {\n      mergeObjectFix(this.dummySettings, settings, { insertKeys: false });\n    } else {\n      updateSettings(settings);\n    }\n  }\n}\n\n// ========================\n// v8 support, broken merge\n// ========================\nexport function mergeObjectFix(\n  original,\n  other = {},\n  {\n    insertKeys = true,\n    insertValues = true,\n    overwrite = true,\n    recursive = true,\n    inplace = true,\n    enforceTypes = false,\n  } = {},\n  _d = 0,\n) {\n  other = other || {};\n  if (!(original instanceof Object) || !(other instanceof Object)) {\n    throw new Error(\"One of original or other are not Objects!\");\n  }\n  const options = {\n    insertKeys,\n    insertValues,\n    overwrite,\n    recursive,\n    inplace,\n    enforceTypes,\n  };\n\n  // Special handling at depth 0\n  if (_d === 0) {\n    if (!inplace) original = foundry.utils.deepClone(original);\n    if (Object.keys(original).some((k) => /\\./.test(k)))\n      original = foundry.utils.expandObject(original);\n    if (Object.keys(other).some((k) => /\\./.test(k)))\n      other = foundry.utils.expandObject(other);\n  }\n\n  // Iterate over the other object\n  for (let k of Object.keys(other)) {\n    const v = other[k];\n    if (original.hasOwnProperty(k))\n      _mergeUpdate(original, k, v, options, _d + 1);\n    else _mergeInsertFix(original, k, v, options, _d + 1);\n  }\n  return original;\n}\n\nfunction _mergeInsertFix(\n  original,\n  k,\n  v,\n  { insertKeys, insertValues } = {},\n  _d,\n) {\n  // Recursively create simple objects\n  if (v?.constructor === Object && insertKeys) {\n    original[k] = mergeObjectFix({}, v, { insertKeys: true, inplace: true });\n    return;\n  }\n\n  // Delete a key\n  if (k.startsWith(\"-=\")) {\n    delete original[k.slice(2)];\n    return;\n  }\n\n  // Insert a key\n  const canInsert = (_d <= 1 && insertKeys) || (_d > 1 && insertValues);\n  if (canInsert) original[k] = v;\n}\n\nfunction _mergeUpdate(\n  original,\n  k,\n  v,\n  { insertKeys, insertValues, enforceTypes, overwrite, recursive } = {},\n  _d,\n) {\n  const x = original[k];\n  const tv = foundry.utils.getType(v);\n  const tx = foundry.utils.getType(x);\n\n  // Recursively merge an inner object\n  if (tv === \"Object\" && tx === \"Object\" && recursive) {\n    return mergeObjectFix(\n      x,\n      v,\n      {\n        insertKeys: insertKeys,\n        insertValues: insertValues,\n        overwrite: overwrite,\n        inplace: true,\n        enforceTypes: enforceTypes,\n      },\n      _d,\n    );\n  }\n\n  // Overwrite an existing value\n  if (overwrite) {\n    if (tx !== \"undefined\" && tv !== tx && enforceTypes) {\n      throw new Error(`Mismatched data types encountered during object merge.`);\n    }\n    original[k] = v;\n  }\n}\n","import { FILTERS } from '../../applications/overlayConfig.js';\nimport { evaluateComparator, getTokenEffects } from '../hooks/effectMappingHooks.js';\nimport { registerOverlayRefreshHook, unregisterOverlayRefreshHooks } from '../hooks/overlayHooks.js';\nimport { DEFAULT_OVERLAY_CONFIG } from '../models.js';\nimport { interpolateColor, removeMarkedOverlays } from '../token/overlay.js';\nimport { executeMacro, toggleCEEffect, toggleTMFXPreset, tv_executeScript } from '../utils.js';\nimport { HTMLOverlay } from './HTMLOverlay.js';\n\nexport class TVAOverlay extends PrimarySpriteMesh {\n  constructor(pTexture, token, config) {\n    super({ name: 'TVAOverlay', object: token });\n    if (pTexture.shapes) pTexture.shapes = this.addChild(pTexture.shapes);\n\n    this.pseudoTexture = pTexture;\n    this.texture = pTexture.texture;\n    //this.setTexture(pTexture, { refresh: false });\n    this.occludedAlpha = 1; // Prevent overlay from fading when occluded\n\n    this.ready = false;\n    this.overlaySort = 0;\n    this.filtersApplied = false;\n\n    this.overlayConfig = foundry.utils.mergeObject(DEFAULT_OVERLAY_CONFIG, config, { inplace: false });\n    if (pTexture.html) this.addHTMLOverlay();\n\n    // linkDimensions has been converted to linkDimensionsX and linkDimensionsY\n    // Make sure we're using the latest fields\n    // 20/07/2023\n    if (!('linkDimensionsX' in this.overlayConfig) && this.overlayConfig.linkDimensions) {\n      this.overlayConfig.linkDimensionsX = true;\n      this.overlayConfig.linkDimensionsY = true;\n    }\n\n    this._registerHooks(this.overlayConfig);\n    this._tvaPlay().then(() => this.refresh());\n\n    // Workaround needed for v12 visible property\n    Object.defineProperty(this, 'visible', {\n      get: this._customVisible,\n      set: function () {},\n      configurable: true,\n    });\n\n    this.eventMode = 'none';\n  }\n\n  enableInteractivity() {\n    if (this.mouseInteractionManager && !this.overlayConfig.interactivity?.length) {\n      this.removeAllListeners();\n      this.mouseInteractionManager = null;\n      this.cursor = null;\n      this.eventMode = 'none';\n      return;\n    } else if (this.mouseInteractionManager || !this.overlayConfig.interactivity?.length) return;\n\n    if (!this.overlayConfig.ui) {\n      if (canvas.primary.eventMode === 'passive') {\n        canvas.primary.eventMode = 'passive';\n      }\n    }\n\n    this.eventMode = 'static';\n\n    // If this overlay iss interactable all of its parents need to be set as interactable too\n    let parent = this.parent;\n    while (parent instanceof TVAOverlay || parent?.parent instanceof TVAOverlay) {\n      parent.eventMode = 'passive';\n      parent = parent.parent;\n    }\n\n    this.cursor = 'pointer';\n    const token = this.object;\n    const sprite = this;\n\n    const runInteraction = function (event, listener) {\n      sprite.overlayConfig.interactivity.forEach((i) => {\n        if (i.listener === listener) {\n          event.preventDefault();\n          event.stopPropagation();\n          if (i.script) tv_executeScript(i.script, { token });\n          if (i.macro) executeMacro(i.macro, token);\n          if (i.ceEffect) toggleCEEffect(token, i.ceEffect);\n          if (i.tmfxPreset) toggleTMFXPreset(token, i.tmfxPreset);\n        }\n      });\n    };\n\n    const permissions = {\n      hoverIn: () => true,\n      hoverOut: () => true,\n      clickLeft: () => true,\n      clickLeft2: () => true,\n      clickRight: () => true,\n      clickRight2: () => true,\n      dragStart: () => false,\n    };\n\n    const callbacks = {\n      hoverIn: (event) => runInteraction(event, 'hoverIn'),\n      hoverOut: (event) => runInteraction(event, 'hoverOut'),\n      clickLeft: (event) => runInteraction(event, 'clickLeft'),\n      clickLeft2: (event) => runInteraction(event, 'clickLeft2'),\n      clickRight: (event) => runInteraction(event, 'clickRight'),\n      clickRight2: (event) => runInteraction(event, 'clickRight2'),\n      dragLeftStart: null,\n      dragLeftMove: null,\n      dragLeftDrop: null,\n      dragLeftCancel: null,\n      dragRightStart: null,\n      dragRightMove: null,\n      dragRightDrop: null,\n      dragRightCancel: null,\n      longPress: null,\n    };\n\n    const options = { target: null };\n\n    // Create the interaction manager\n    const mgr = new MouseInteractionManager(this, canvas.stage, permissions, callbacks, options);\n    this.mouseInteractionManager = mgr.activate();\n  }\n\n  /**\n   * Override\n   */\n  _onAdded() {\n    // do nothing\n    // foundry throws inconsequential errors within this method\n  }\n\n  _customVisible() {\n    const ov = this.overlayConfig;\n    if (!this.ready || !(this.object.visible || ov.alwaysVisible)) return false;\n\n    if (ov.limitedToOwner && !this.object.isOwner) return false;\n    if (ov.limitedUsers?.length && !ov.limitedUsers.includes(game.user.id)) return false;\n\n    if (ov.limitOnEffect || ov.limitOnProperty) {\n      const speaker = ChatMessage.getSpeaker();\n      let token = canvas.ready ? canvas.tokens.get(speaker.token) : null;\n      if (!token) return false;\n      if (ov.limitOnEffect) {\n        if (!getTokenEffects(token).includes(ov.limitOnEffect)) return false;\n      }\n      if (ov.limitOnProperty) {\n        if (!evaluateComparator(token.document, ov.limitOnProperty)) return false;\n      }\n    }\n\n    if (this.object.detectionLevel === 1) return Boolean(ov.impreciseVisible);\n\n    if (\n      ov.limitOnHover ||\n      ov.limitOnControl ||\n      ov.limitOnHighlight ||\n      ov.limitOnHUD ||\n      ov.limitOnTarget ||\n      ov.limitOnAnyTarget\n    ) {\n      if (ov.limitOnHover && canvas.controls.ruler._state === Ruler.STATES.INACTIVE && this.object.hover) return true;\n      if (ov.limitOnControl && this.object.controlled) return true;\n      if (ov.limitOnHighlight && (canvas.tokens.highlightObjects ?? canvas.tokens._highlight)) return true;\n      if (ov.limitOnHUD && this.object.hasActiveHUD) return true;\n      if (ov.limitOnAnyTarget && this.object.targeted.size) return true;\n      if (ov.limitOnTarget && this.object.targeted.some((u) => u.id === game.userId)) return true;\n      return false;\n    }\n    return true;\n  }\n\n  get sortLayer() {\n    return this.object.mesh?.sortLayer || 0;\n  }\n\n  get zIndex() {\n    let zIndex = this.object.mesh.zIndex;\n    if (this.overlayConfig.ui && this.overlayConfig.bottom) zIndex -= 9999;\n    return zIndex;\n  }\n\n  // Overlays have the same sort order as the parent\n  get sort() {\n    const sort = this.object.mesh.sort;\n    if (this.overlayConfig.top) return sort + 9999;\n    else if (this.overlayConfig.bottom) return sort - 9999;\n    return sort;\n  }\n\n  get _lastSortedIndex() {\n    return (this.object.mesh._lastSortedIndex || 0) + this.overlaySort;\n  }\n\n  get elevation() {\n    const elevation = this.object.mesh?.elevation;\n    if (this.overlayConfig.bottom && elevation > 0) return 0;\n    else if (this.overlayConfig.top) return elevation + 9999;\n    return elevation;\n  }\n\n  set _lastSortedIndex(val) {}\n\n  async _tvaPlay() {\n    // Ensure playback state for video\n    const source = this.texture?.baseTexture?.resource?.source;\n    if (source?.tagName === 'VIDEO') {\n      // Detach video from others\n      const s = source.cloneNode(true);\n      if (this.overlayConfig.playOnce) {\n        s.onended = () => {\n          this.alpha = 0;\n          this.tvaVideoEnded = true;\n        };\n      }\n\n      await new Promise((resolve) => (s.oncanplay = resolve));\n      this.texture = PIXI.Texture.from(s, { resourceOptions: { autoPlay: false } });\n\n      const options = {\n        loop: this.overlayConfig.loop && !this.overlayConfig.playOnce,\n        volume: 0,\n        offset: 0,\n        playing: true,\n      };\n      game.video.play(s, options);\n    }\n  }\n\n  addChildAuto(...children) {\n    if (this.pseudoTexture?.shapes) {\n      return this.pseudoTexture.shapes.addChild(...children);\n    } else {\n      return this.addChild(...children);\n    }\n  }\n\n  setTexture(pTexture, { preview = false, refresh = true, configuration = null, refreshFilters = false } = {}) {\n    // Text preview handling\n    if (preview) {\n      this._swapChildren(pTexture);\n      if (this.originalTexture) this._destroyTexture();\n      else {\n        this.originalTexture = this.pseudoTexture;\n        if (this.originalTexture.shapes) this.removeChild(this.originalTexture.shapes);\n      }\n      this.pseudoTexture = pTexture;\n      this.texture = pTexture.texture;\n      if (pTexture.shapes) pTexture.shapes = this.addChild(pTexture.shapes);\n    } else if (this.originalTexture) {\n      this._swapChildren(this.originalTexture);\n      this._destroyTexture();\n      this.pseudoTexture = this.originalTexture;\n      this.texture = this.originalTexture.texture;\n      if (this.originalTexture.shapes) this.pseudoTexture.shapes = this.addChild(this.originalTexture.shapes);\n      delete this.originalTexture;\n    } else {\n      this._swapChildren(pTexture);\n      this._destroyTexture();\n      this.pseudoTexture = pTexture;\n      this.texture = pTexture.texture;\n      if (pTexture.shapes) this.pseudoTexture.shapes = this.addChild(pTexture.shapes);\n    }\n\n    if (this.pseudoTexture.html) this.addHTMLOverlay();\n    if (refresh) this.refresh(configuration, { fullRefresh: !preview, refreshFilters });\n  }\n\n  refresh(configuration, { preview = false, fullRefresh = true, previewTexture = null, refreshFilters = false } = {}) {\n    if (!this.overlayConfig || !this.texture) return;\n\n    // Text preview handling\n    if (previewTexture || this.originalTexture) {\n      this.setTexture(previewTexture, { preview: Boolean(previewTexture), refresh: false });\n    }\n\n    // Register/Unregister hooks that should refresh this overlay\n    if (configuration) {\n      this._registerHooks(configuration);\n    }\n\n    const config = foundry.utils.mergeObject(this.overlayConfig, configuration ?? {}, { inplace: !preview });\n\n    if (preview && this.htmlOverlay) this.htmlOverlay.render(config, true);\n\n    this.enableInteractivity(config);\n\n    if (fullRefresh) {\n      const source = foundry.utils.getProperty(this.texture, 'baseTexture.resource.source');\n      if (source && source.tagName === 'VIDEO') {\n        if (!source.loop && config.loop) {\n          game.video.play(source);\n        } else if (source.loop && !config.loop) {\n          game.video.stop(source);\n        }\n        source.loop = config.loop;\n      }\n    }\n\n    const shapes = this.pseudoTexture.shapes;\n\n    // Scale the image using the same logic as the token\n    const dimensions = shapes ?? this.texture;\n    if (config.linkScale && !config.parentID) {\n      const scale = this.scale;\n      const aspect = dimensions.width / dimensions.height;\n      if (aspect >= 1) {\n        scale.x = (this.object.w * Math.abs(this.object.document.texture.scaleX)) / dimensions.width;\n        scale.y = Number(scale.x);\n      } else {\n        scale.y = (this.object.h * Math.abs(this.object.document.texture.scaleY)) / dimensions.height;\n        scale.x = Number(scale.y);\n      }\n    } else if (config.linkStageScale) {\n      this.scale.x = 1 / canvas.stage.scale.x;\n      this.scale.y = 1 / canvas.stage.scale.y;\n    } else if (config.linkDimensionsX || config.linkDimensionsY) {\n      if (config.linkDimensionsX) {\n        this.scale.x = this.object.document.width;\n      }\n      if (config.linkDimensionsY) {\n        this.scale.y = this.object.document.height;\n      }\n    } else {\n      this.scale.x = config.width ? config.width / dimensions.width : 1;\n      this.scale.y = config.height ? config.height / dimensions.height : 1;\n    }\n\n    // Adjust scale according to config\n    this.scale.x = this.scale.x * config.scaleX;\n    this.scale.y = this.scale.y * config.scaleY;\n\n    // Check if mirroring should be inherited from the token and if so apply it\n    if (config.linkMirror && !config.parentID) {\n      this.scale.x = Math.abs(this.scale.x) * (this.object.document.texture.scaleX < 0 ? -1 : 1);\n      this.scale.y = Math.abs(this.scale.y) * (this.object.document.texture.scaleY < 0 ? -1 : 1);\n    }\n\n    if (this.anchor) {\n      if (!config.anchor) this.anchor.set(0.5, 0.5);\n      else this.anchor.set(config.anchor.x, config.anchor.y);\n    }\n\n    let xOff = 0;\n    let yOff = 0;\n    if (shapes) {\n      shapes.position.x = -this.anchor.x * shapes.width;\n      shapes.position.y = -this.anchor.y * shapes.height;\n      if (config.animation.relative) {\n        this.pivot.set(0, 0);\n        shapes.pivot.set((0.5 - this.anchor.x) * shapes.width, (0.5 - this.anchor.y) * shapes.height);\n        xOff = shapes.pivot.x * this.scale.x;\n        yOff = shapes.pivot.y * this.scale.y;\n      }\n    } else if (config.animation.relative) {\n      xOff = (0.5 - this.anchor.x) * this.width;\n      yOff = (0.5 - this.anchor.y) * this.height;\n      this.pivot.set((0.5 - this.anchor.x) * this.texture.width, (0.5 - this.anchor.y) * this.texture.height);\n    }\n\n    // Position\n    const pOffsetX = config.pOffsetX || 0;\n    const pOffsetY = config.pOffsetY || 0;\n    if (config.parentID) {\n      const anchor = this.parent.anchor ?? { x: 0, y: 0 };\n      const pWidth = (this.parent.shapesWidth ?? this.parent.width) / this.parent.scale.x;\n      const pHeight = (this.parent.shapesHeight ?? this.parent.height) / this.parent.scale.y;\n      this.position.set(\n        pOffsetX + -config.offsetX * pWidth - anchor.x * pWidth + pWidth / 2,\n        pOffsetY + -config.offsetY * pHeight - anchor.y * pHeight + pHeight / 2\n      );\n    } else {\n      if (config.animation.relative) {\n        this.position.set(\n          this.object.document.x + this.object.w / 2 + pOffsetX + -config.offsetX * this.object.w + xOff,\n          this.object.document.y + this.object.h / 2 + pOffsetY + -config.offsetY * this.object.h + yOff\n        );\n      } else {\n        this.position.set(this.object.document.x + this.object.w / 2, this.object.document.y + this.object.h / 2);\n        this.pivot.set(\n          -pOffsetX / this.scale.x + (config.offsetX * this.object.w) / this.scale.x,\n          -pOffsetY / this.scale.y + (config.offsetY * this.object.h) / this.scale.y\n        );\n      }\n    }\n\n    // Set alpha but only if playOnce is disabled and the video hasn't\n    // finished playing yet. Otherwise we want to keep alpha as 0 to keep the video hidden\n    if (!this.tvaVideoEnded) {\n      this.alpha = config.linkOpacity ? this.object.document.alpha : config.alpha;\n    }\n\n    // Angle in degrees\n    if (fullRefresh) {\n      if (config.linkRotation) this.angle = this.object.document.rotation + config.angle;\n      else this.angle = config.angle;\n    } else if (!config.animation.rotate) {\n      if (config.linkRotation) this.angle = this.object.document.rotation + config.angle;\n    }\n\n    // Apply color tinting\n    const tint = config.inheritTint\n      ? this.object.document.texture.tint\n      : interpolateColor(config.tint, config.interpolateColor, true);\n    this.tint = tint ? Color.from(tint) : 0xffffff;\n    if (shapes) {\n      shapes.tint = this.tint;\n      shapes.alpha = this.alpha;\n    }\n\n    if (fullRefresh) {\n      if (config.animation.rotate) {\n        this.animate(config);\n      } else {\n        this.stopAnimation();\n      }\n    }\n\n    // Apply filters\n    if (fullRefresh && (refreshFilters || !this.filtersApplied)) this._applyFilters(config);\n    //if (fullRefresh) this.filters = this._getFilters(config);\n\n    if (preview && this.children) {\n      this.children.forEach((ch) => {\n        if (ch instanceof TVAOverlay) ch.refresh(null, { preview: true });\n      });\n    }\n\n    if (this.htmlOverlay) {\n      this.htmlOverlay.setPosition({\n        left: this.x - this.pivot.x * this.scale.x - this.width * this.anchor.x,\n        top: this.y - this.pivot.y * this.scale.y - this.height * this.anchor.y,\n        width: this.width,\n        height: this.height,\n        angle: this.angle,\n      });\n    }\n\n    this.ready = true;\n  }\n\n  _activateTicker() {\n    this._deactivateTicker();\n    canvas.app.ticker.add(this.updatePosition, this, PIXI.UPDATE_PRIORITY.HIGH);\n  }\n\n  _deactivateTicker() {\n    canvas.app.ticker.remove(this.updatePosition, this);\n  }\n\n  updatePosition() {\n    let coord = canvas.canvasCoordinatesFromClient({\n      x: window.innerWidth / 2 + this.overlayConfig.offsetX * window.innerWidth,\n      y: window.innerHeight / 2 + this.overlayConfig.offsetY * window.innerHeight,\n    });\n    this.position.set(coord.x, coord.y);\n  }\n\n  async _applyFilters(config) {\n    this.filtersApplied = true;\n    const filterName = config.filter;\n    const FilterClass = PIXI.filters[filterName];\n    const options = foundry.utils.mergeObject(FILTERS[filterName]?.defaultValues || {}, config.filterOptions);\n    let filter;\n    if (FilterClass) {\n      if (FILTERS[filterName]?.argType === 'args') {\n        let args = [];\n        const controls = FILTERS[filterName]?.controls;\n        if (controls) {\n          controls.forEach((c) => args.push(options[c.name]));\n        }\n        filter = new FilterClass(...args);\n      } else if (FILTERS[filterName]?.argType === 'options') {\n        filter = new FilterClass(options);\n      } else {\n        filter = new FilterClass();\n      }\n    } else if (filterName === 'OutlineOverlayFilter') {\n      filter = OutlineFilter.create(options);\n      filter.thickness = options.trueThickness ?? 1;\n      filter.animated = options.animate ?? false;\n    } else if (filterName === 'Token Magic FX') {\n      this.applyTVAFilters(await constructTMFXFilters(options.params || [], this));\n      return;\n    }\n\n    if (filter) {\n      this.applyTVAFilters([filter]);\n      this.filters = [filter];\n    } else {\n      this.removeTVAFilters();\n    }\n  }\n\n  applyTVAFilters(filters) {\n    if (filters?.length) {\n      this.removeTVAFilters();\n      this.filters = (this.filters || []).concat(filters);\n    }\n  }\n\n  removeTVAFilters() {\n    if (this.filters) this.filters = this.filters.filter((f) => !f.tvaFilter);\n  }\n\n  async stopAnimation() {\n    if (this.animationName) {\n      CanvasAnimation.terminateAnimation(this.animationName);\n    }\n  }\n\n  async animate(config) {\n    if (!this.animationName) this.animationName = this.object.sourceId + '.' + foundry.utils.randomID(5);\n\n    let newAngle = this.angle + (config.animation.clockwise ? 360 : -360);\n    const rotate = [{ parent: this, attribute: 'angle', to: newAngle }];\n\n    const completed = await CanvasAnimation.animate(rotate, {\n      duration: config.animation.duration,\n      name: this.animationName,\n    });\n    if (completed) {\n      this.animate(config);\n    }\n  }\n\n  _registerHooks(configuration) {\n    if (configuration.linkStageScale) registerOverlayRefreshHook(this, 'canvasPan');\n    else unregisterOverlayRefreshHooks(this, 'canvasPan');\n  }\n\n  _swapChildren(to) {\n    const from = this.pseudoTexture;\n    if (from.shapes) {\n      this.removeChild(this.pseudoTexture.shapes);\n      const children = from.shapes.removeChildren();\n      if (to?.shapes) children.forEach((c) => to.shapes.addChild(c)?.refresh());\n      else children.forEach((c) => this.addChild(c)?.refresh());\n    } else if (to?.shapes) {\n      const children = this.removeChildren();\n      children.forEach((c) => to.shapes.addChild(c)?.refresh());\n    }\n  }\n\n  _destroyTexture() {\n    if (this.texture.textLabel || this.texture.destroyable) {\n      this.texture.destroy(true);\n    }\n\n    if (this.pseudoTexture?.shapes) {\n      this.removeChild(this.pseudoTexture.shapes);\n      this.pseudoTexture.shapes.destroy();\n    } else if (this.pseudoTexture?.html) {\n      this.removeHTMLOverlay();\n    }\n  }\n\n  destroy() {\n    this.stopAnimation();\n    unregisterOverlayRefreshHooks(this);\n\n    if (this.children) {\n      for (const ch of this.children) {\n        if (ch instanceof TVAOverlay) ch.tvaRemove = true;\n      }\n      removeMarkedOverlays(this.object);\n      if (this.pseudoTexture.shapes) {\n        this.pseudoTexture.shapes.children.forEach((c) => c.destroy());\n        this.removeChild(this.pseudoTexture.shapes)?.destroy();\n        //  this.pseudoTexture.shapes.destroy();\n      }\n    }\n\n    if (this.texture.textLabel || this.texture.destroyable) {\n      return super.destroy(true);\n    } else if (this.texture?.baseTexture.resource?.source?.tagName === 'VIDEO') {\n      this.texture.baseTexture.destroy();\n    }\n\n    this.removeHTMLOverlay();\n\n    super.destroy();\n  }\n\n  // Foundry BUG Fix\n  calculateTrimmedVertices() {\n    return PIXI.Sprite.prototype.calculateTrimmedVertices.call(this);\n  }\n\n  addHTMLOverlay() {\n    if (!this.htmlOverlay) this.htmlOverlay = new HTMLOverlay(this.overlayConfig, this.object);\n  }\n\n  removeHTMLOverlay() {\n    if (this.htmlOverlay) this.htmlOverlay.remove();\n    this.htmlOverlay = null;\n  }\n}\n\nasync function constructTMFXFilters(paramsArray, sprite) {\n  if (typeof TokenMagic === 'undefined' || !('filterTypes' in TokenMagic)) return [];\n\n  try {\n    paramsArray = eval(paramsArray);\n  } catch (e) {\n    return [];\n  }\n\n  if (!Array.isArray(paramsArray)) {\n    paramsArray = TokenMagic.getPreset(paramsArray);\n  }\n  if (!(paramsArray instanceof Array && paramsArray.length > 0)) return [];\n\n  let filters = [];\n  for (const params of paramsArray) {\n    if (!params.hasOwnProperty('filterType') || !TokenMagic.filterTypes.hasOwnProperty(params.filterType)) {\n      // one invalid ? all rejected.\n      return [];\n    }\n\n    if (!params.hasOwnProperty('rank')) {\n      params.rank = 5000;\n    }\n\n    if (!params.hasOwnProperty('filterId') || params.filterId == null) {\n      params.filterId = foundry.utils.randomID();\n    }\n\n    if (!params.hasOwnProperty('enabled') || !(typeof params.enabled === 'boolean')) {\n      params.enabled = true;\n    }\n\n    params.filterInternalId = foundry.utils.randomID();\n\n    const gms = game.users.filter((user) => user.isGM);\n    params.filterOwner = gms.length ? gms[0].id : game.data.userId;\n    // params.placeableType = placeable._TMFXgetPlaceableType();\n    params.updateId = foundry.utils.randomID();\n\n    const filterClass = TokenMagic.filterTypes[params.filterType];\n    if (filterClass) {\n      class ModTMFX extends filterClass {\n        assignPlaceable() {\n          this.targetPlaceable = sprite.object;\n          this.placeableImg = sprite;\n        }\n\n        async _TMFXsetAnimeFlag() {}\n      }\n\n      const filter = new ModTMFX(params);\n      if (filter) {\n        // Patch fixes\n        filter.placeableImg = sprite;\n        filter.targetPlaceable = sprite.object;\n        // end of fixes\n        filter.tvaFilter = true;\n        filters.unshift(filter);\n      }\n    }\n  }\n  return filters;\n}\n\nclass OutlineFilter extends OutlineOverlayFilter {\n  /** @inheritdoc */\n  static createFragmentShader() {\n    return `\n    varying vec2 vTextureCoord;\n    varying vec2 vFilterCoord;\n    uniform sampler2D uSampler;\n    \n    uniform vec2 thickness;\n    uniform vec4 outlineColor;\n    uniform vec4 filterClamp;\n    uniform float alphaThreshold;\n    uniform float time;\n    uniform bool knockout;\n    uniform bool wave;\n    \n    ${this.CONSTANTS}\n    ${this.WAVE()}\n    \n    void main(void) {\n        float dist = distance(vFilterCoord, vec2(0.5)) * 2.0;\n        vec4 ownColor = texture2D(uSampler, vTextureCoord);\n        vec4 wColor = wave ? outlineColor * \n                             wcos(0.0, 1.0, dist * 75.0, \n                                  -time * 0.01 + 3.0 * dot(vec4(1.0), ownColor)) \n                             * 0.33 * (1.0 - dist) : vec4(0.0);\n        float texAlpha = smoothstep(alphaThreshold, 1.0, ownColor.a);\n        vec4 curColor;\n        float maxAlpha = 0.;\n        vec2 displaced;\n        for ( float angle = 0.0; angle <= TWOPI; angle += ${this.#quality.toFixed(7)} ) {\n            displaced.x = vTextureCoord.x + thickness.x * cos(angle);\n            displaced.y = vTextureCoord.y + thickness.y * sin(angle);\n            curColor = texture2D(uSampler, clamp(displaced, filterClamp.xy, filterClamp.zw));\n            curColor.a = clamp((curColor.a - 0.6) * 2.5, 0.0, 1.0);\n            maxAlpha = max(maxAlpha, curColor.a);\n        }\n        float resultAlpha = max(maxAlpha, texAlpha);\n        vec3 result = (ownColor.rgb + outlineColor.rgb * (1.0 - texAlpha)) * resultAlpha;\n        gl_FragColor = vec4((ownColor.rgb + outlineColor.rgb * (1. - ownColor.a)) * resultAlpha, resultAlpha);\n    }\n    `;\n  }\n\n  static get #quality() {\n    switch (canvas.performance.mode) {\n      case CONST.CANVAS_PERFORMANCE_MODES.LOW:\n        return (Math.PI * 2) / 10;\n      case CONST.CANVAS_PERFORMANCE_MODES.MED:\n        return (Math.PI * 2) / 20;\n      default:\n        return (Math.PI * 2) / 30;\n    }\n  }\n}\n","import { TVA_CONFIG, updateSettings } from '../scripts/settings.js';\nimport { SEARCH_TYPE, decodeURISafely } from '../scripts/utils.js';\nimport { insertArtSelectButton } from './artSelect.js';\n\nexport default class UserList extends FormApplication {\n  constructor(object, img, regenStyle) {\n    super({}, {});\n    this.object = object;\n    this.img = img;\n    this.regenStyle = regenStyle;\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: 'token-variants-user-list',\n      classes: ['sheet'],\n      template: 'modules/token-variants/token-variants/templates/userList.html',\n      resizable: false,\n      minimizable: false,\n      title: 'User To Image',\n      width: 300,\n    });\n  }\n\n  async getData(options) {\n    const data = super.getData(options);\n    const mappings = this.object.document.getFlag('token-variants', 'userMappings') || {};\n    let users = [];\n    game.users.forEach((user) => {\n      users.push({\n        avatar: user.avatar,\n        name: user.name,\n        apply: user.id in mappings && mappings[user.id] === this.img,\n        userId: user.id,\n        color: user.color,\n      });\n    });\n    data.users = users;\n    data.invisibleImage = TVA_CONFIG.invisibleImage;\n    return data;\n  }\n\n  /**\n   * @param {JQuery} html\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n    insertArtSelectButton(html, 'invisibleImage', {\n      search: 'Invisible Image',\n      searchType: SEARCH_TYPE.TOKEN,\n    });\n  }\n\n  async _updateObject(event, formData) {\n    const mappings = this.object.document.getFlag('token-variants', 'userMappings') || {};\n\n    if (formData.invisibleImage !== TVA_CONFIG.invisibleImage) {\n      updateSettings({ invisibleImage: decodeURISafely(formData.invisibleImage) });\n    }\n    delete formData.invisibleImage;\n\n    const affectedImages = [this.img];\n\n    for (const [userId, apply] of Object.entries(formData)) {\n      if (apply) {\n        if (mappings[userId] && mappings[userId] !== this.img) affectedImages.push(mappings[userId]);\n        mappings[userId] = this.img;\n      } else if (mappings[userId] === this.img) {\n        delete mappings[userId];\n        mappings['-=' + userId] = null;\n      }\n    }\n\n    if (Object.keys(mappings).filter((userId) => !userId.startsWith('-=')).length === 0) {\n      await this.object.document.unsetFlag('token-variants', 'userMappings');\n    } else {\n      await this.object.document.setFlag('token-variants', 'userMappings', mappings);\n    }\n\n    for (const img of affectedImages) {\n      this.regenStyle(this.object, img);\n    }\n  }\n}\n","export default class FlagsConfig extends FormApplication {\n  constructor(obj) {\n    super({}, {});\n    if (obj instanceof Tile) {\n      this.objectToFlag = obj.document;\n      this.isTile = true;\n    } else {\n      this.objectToFlag = game.actors.get(obj.document.actorId) || obj.document;\n    }\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: \"token-variants-token-flags\",\n      classes: [\"sheet\"],\n      template:\n        \"modules/token-variants/token-variants/templates/flagsConfig.html\",\n      resizable: true,\n      minimizable: false,\n      title: \"Flags\",\n      width: 500,\n    });\n  }\n\n  async getData(options) {\n    const data = super.getData(options);\n    const popups = this.objectToFlag.getFlag(\"token-variants\", \"popups\");\n    const disableNameSearch = this.objectToFlag.getFlag(\n      \"token-variants\",\n      \"disableNameSearch\",\n    );\n    const directory =\n      this.objectToFlag.getFlag(\"token-variants\", \"directory\") || {};\n\n    return foundry.utils.mergeObject(data, {\n      popups: popups,\n      popupsSetFlag: popups != null,\n      disableNameSearch: disableNameSearch,\n      disableNameSearchSetFlag: disableNameSearch != null,\n      directory: directory.path,\n      directorySource: directory.source,\n      directorySetFlag: !foundry.utils.isEmpty(directory),\n      tile: this.isTile,\n    });\n  }\n\n  /**\n   * @param {JQuery} html\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.find(\".controlFlag\").click((e) => {\n      e.target.siblings(\".flag\").prop(\"disabled\", !e.target.checked);\n    });\n    html.find(\".directory-fp\").click((event) => {\n      new FilePicker({\n        type: \"folder\",\n        activeSource: \"data\",\n        callback: (path, fp) => {\n          html.find('[name=\"directory\"]').val(fp.result.target);\n          event.target\n            .closest(\"button\")\n            .attr(\"title\", \"Directory: \" + fp.result.target);\n          const sourceEl = html.find('[name=\"directorySource\"]');\n          if (fp.activeSource === \"s3\") {\n            sourceEl.val(`s3:${fp.result.bucket}`);\n          } else {\n            sourceEl.val(fp.activeSource);\n          }\n        },\n      }).render(true);\n    });\n  }\n\n  /**\n   * @param {Event} event\n   * @param {Object} formData\n   */\n  async _updateObject(event, formData) {\n    if (\"directory\" in formData) {\n      formData.directory = {\n        path: formData.directory,\n        source: formData.directorySource,\n      };\n    }\n\n    [\"popups\", \"disableNameSearch\", \"directory\"].forEach((flag) => {\n      if (flag in formData) {\n        this.objectToFlag.setFlag(\"token-variants\", flag, formData[flag]);\n      } else {\n        this.objectToFlag.unsetFlag(\"token-variants\", flag);\n      }\n    });\n  }\n}\n","export const CORE_TEMPLATES = [\n  {\n    name: 'Tint Red when HP is below 10%',\n    hint: 'Tint token red when HP falls below 10%',\n    img: 'https://user-images.githubusercontent.com/7693704/243428871-c52130b3-2f12-4de7-a86e-fabc67e865a9.png',\n    group: 'Health',\n    mappings: [\n      {\n        id: 'MmLSOlJx',\n        label: 'Tint Red',\n        expression: 'hp<=10%',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {\n          texture: {\n            tint: '#ff0000',\n          },\n        },\n        overlay: false,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          label: 'Tint Red',\n        },\n        group: 'Low HP',\n        i: 0,\n      },\n    ],\n    id: 'Ob9LP35K',\n  },\n  {\n    name: 'Health State Text Overlay',\n    hint: `Displays text overlay based on percentage health. \\n0% < hp <= 25% : Critical\\n25% < hp <= 50% : Bloodied\\n50% < hp <= 75% : Wounded\\n75% < hp : Healthy`,\n    img: 'https://user-images.githubusercontent.com/7693704/243426356-ceab629c-c16c-42b3-9004-af7dafb62eb7.png',\n    group: 'Health',\n    mappings: [\n      {\n        id: 'jqaFdwkQ',\n        label: 'Bloodied',\n        expression: 'hp>25% && hp<=50%',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          parent: '',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionX: false,\n          linkDimensionY: false,\n          linkOpacity: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: 0.51,\n          scaleX: 0.76,\n          scaleY: 0.76,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 1,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Bloodied',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#ff5900',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: null,\n            },\n          },\n          label: 'Bloodied',\n          id: 'jqaFdwkQ',\n        },\n        group: 'Health State Overlay',\n        i: 0,\n      },\n      {\n        id: 'm4GQVz5O',\n        label: 'Critical',\n        expression: 'hp>0 && hp<=25%',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          parent: '',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionX: false,\n          linkDimensionY: false,\n          linkOpacity: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: 0.51,\n          scaleX: 0.76,\n          scaleY: 0.76,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 1,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Critical',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#ff0000',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: null,\n            },\n          },\n          label: 'Critical',\n          id: 'm4GQVz5O',\n        },\n        group: 'Health State Overlay',\n        i: 1,\n      },\n      {\n        id: 'H1wrS5N1',\n        label: 'Healthy',\n        expression: 'hp>75%',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          parent: '',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionX: false,\n          linkDimensionY: false,\n          linkOpacity: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: 0.51,\n          scaleX: 0.76,\n          scaleY: 0.76,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 1,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Healthy',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#2bff00',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: null,\n            },\n          },\n          label: 'Healthy',\n          id: 'H1wrS5N1',\n        },\n        group: 'Health State Overlay',\n        i: 2,\n      },\n      {\n        id: 'IojJZS7v',\n        label: 'Wounded',\n        expression: 'hp>50% && hp<=75%',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          parent: '',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionX: false,\n          linkDimensionY: false,\n          linkOpacity: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: 0.51,\n          scaleX: 0.76,\n          scaleY: 0.76,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 1,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Wounded',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#ffbb00',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: null,\n            },\n          },\n          label: 'Wounded',\n          id: 'IojJZS7v',\n        },\n        group: 'Health State Overlay',\n        i: 3,\n      },\n    ],\n    id: 'JNClkgGU',\n  },\n  {\n    name: 'Health State Text Overlay - Passed Check',\n    hint: 'Same as Health State Text Overlay except also requiring the Token actor to have Reveal Health active effect applied to it.',\n    img: 'https://user-images.githubusercontent.com/7693704/243429385-f62b111c-3d9c-4cd8-9c27-f5b13e09fea2.png',\n    group: 'Health',\n    mappings: [\n      {\n        id: 'k0XbFE7a',\n        label: 'Bloodied',\n        expression: 'Reveal Health && hp>25% && hp<=50%',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          parent: '',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionX: false,\n          linkDimensionY: false,\n          linkOpacity: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: 0.51,\n          scaleX: 0.76,\n          scaleY: 0.76,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 1,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Bloodied',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#ff5900',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: null,\n            },\n          },\n          label: 'Bloodied',\n          id: 'k0XbFE7a',\n        },\n        group: 'Health State Overlay - Passed Check',\n        i: 0,\n      },\n      {\n        id: 'a1VxhnWK',\n        label: 'Critical',\n        expression: 'Reveal Health && hp>0 && hp<=25%',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          parent: '',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionX: false,\n          linkDimensionY: false,\n          linkOpacity: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: 0.51,\n          scaleX: 0.76,\n          scaleY: 0.76,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 1,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Critical',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#ff0000',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: null,\n            },\n          },\n          label: 'Critical',\n          id: 'a1VxhnWK',\n        },\n        group: 'Health State Overlay - Passed Check',\n        i: 1,\n      },\n      {\n        id: 'DNuBTXe8',\n        label: 'Healthy',\n        expression: 'Reveal Health && hp>75%',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          parent: '',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionX: false,\n          linkDimensionY: false,\n          linkOpacity: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: 0.51,\n          scaleX: 0.76,\n          scaleY: 0.76,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 1,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Healthy',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#2bff00',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: null,\n            },\n          },\n          label: 'Healthy',\n          id: 'DNuBTXe8',\n        },\n        group: 'Health State Overlay - Passed Check',\n        i: 2,\n      },\n      {\n        id: 'ROPjrvLu',\n        label: 'Wounded',\n        expression: 'Reveal Health && hp>50% && hp<=75%',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          parent: '',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionX: false,\n          linkDimensionY: false,\n          linkOpacity: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: 0.51,\n          scaleX: 0.76,\n          scaleY: 0.76,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 1,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Wounded',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#ffbb00',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: null,\n            },\n          },\n          label: 'Wounded',\n          id: 'ROPjrvLu',\n        },\n        group: 'Health State Overlay - Passed Check',\n        i: 3,\n      },\n    ],\n    id: '0ZJQiOdD',\n  },\n  {\n    name: 'Fancy Nameplate',\n    hint: 'Displays a curved red nameplate underneath the token.',\n    img: 'https://user-images.githubusercontent.com/7693704/244439674-12510686-2f72-44b3-8a1d-e6cc7fbb00c6.png',\n    mappings: [\n      {\n        id: 'DTbwvQiG',\n        label: 'Token Nameplate',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          parent: '',\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionX: false,\n          linkDimensionY: false,\n          linkOpacity: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: -0.51,\n          scaleX: 0.68,\n          scaleY: 0.68,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '{{name}}',\n            fontFamily: 'Modesto Condensed',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#ff0000',\n            dropShadow: 'true',\n            strokeThickness: 3,\n            stroke: '#111111',\n            curve: {\n              radius: 450,\n              invert: true,\n            },\n          },\n          shapes: [\n            {\n              line: {\n                width: 1,\n                color: '#111111',\n                alpha: 1,\n              },\n              fill: {\n                color: '#111111',\n                alpha: 1,\n              },\n            },\n          ],\n          label: 'Token Nameplate',\n        },\n        group: 'Nameplate',\n        i: 0,\n      },\n    ],\n    id: 'Ik1uNcWU',\n  },\n  {\n    name: 'Info Box #1',\n    hint: 'Displays information about the token/actor when hovering over or controlling them. This box will adjust to canvas zoom.',\n    img: 'https://user-images.githubusercontent.com/7693704/244441852-b50f3ca6-e0c3-4ce0-b498-ddd00edcbdca.png',\n    system: 'dnd5e',\n    group: 'Info',\n    mappings: [\n      {\n        id: 'W8BPK9hv',\n        label: 'Box Background',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'W8BPK9hv',\n          parentID: '',\n          ui: true,\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: true,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.55,\n          offsetY: 0,\n          scaleX: 0.73,\n          scaleY: 0.73,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0.5,\n          },\n          filter: 'DropShadowFilter',\n          filterOptions: {\n            rotation: 45,\n            distance: 16.9,\n            color: '#000000',\n            alpha: 0.52,\n            shadowOnly: false,\n            blur: 2,\n            quality: 3,\n          },\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: true,\n          limitOnHighlight: false,\n          limitOnControl: true,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          shapes: [\n            {\n              shape: {\n                type: 'rectangle',\n                x: '0',\n                y: '0',\n                width: '450',\n                height: '200',\n                radius: '0',\n              },\n              label: '',\n              line: {\n                width: 2,\n                color: '#ffffff',\n                alpha: 1,\n              },\n              fill: {\n                color: '#508fe2',\n                color2: '',\n                prc: '',\n                alpha: 0.55,\n              },\n            },\n          ],\n          effect: '',\n          label: 'Box Background',\n        },\n        group: 'Info Box',\n        i: 0,\n      },\n      {\n        id: 'bkoP4Qpo',\n        label: 'Legendary Actions',\n        expression: 'actor.system.resources.legact.max>0',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          id: 'bkoP4Qpo',\n          parentID: 'W8BPK9hv',\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.47,\n          offsetY: -0.02,\n          scaleX: 0.5,\n          scaleY: 0.5,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Legendary: Action {{actor.system.resources.legact.value}}/{{actor.system.resources.legact.max}} Resistance {{actor.system.resources.legres.value}}/{{actor.system.resources.legres.max}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Legendary Actions',\n        },\n        group: 'Info Box',\n        i: 1,\n      },\n      {\n        id: 'OvcWUW13',\n        label: 'Mods',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'OvcWUW13',\n          parentID: 'W8BPK9hv',\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: -0.38,\n          scaleX: 0.57,\n          scaleY: 0.57,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'STR {{actor.system.abilities.str.mod}}  DEX {{actor.system.abilities.dex.mod}}  CON {{actor.system.abilities.con.mod}}  INT {{actor.system.abilities.int.mod}}  WIS {{actor.system.abilities.wis.mod}}  CHA {{actor.system.abilities.cha.mod}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Mods',\n        },\n        group: 'Info Box',\n        i: 2,\n      },\n      {\n        id: 'jybTYLTB',\n        label: 'Token Name',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 51,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'jybTYLTB',\n          parentID: 'W8BPK9hv',\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.47,\n          offsetY: 0.35,\n          scaleX: 0.77,\n          scaleY: 0.77,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Name: {{name}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Token Name',\n        },\n        group: 'Info Box',\n        i: 3,\n      },\n      {\n        id: 'bGbHPbw6',\n        label: 'HP',\n        expression: 'hp>40%',\n        imgName: '',\n        imgSrc: '',\n        priority: 52,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          id: 'bGbHPbw6',\n          parentID: 'W8BPK9hv',\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.47,\n          offsetY: 0.23,\n          scaleX: 0.82,\n          scaleY: 0.82,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'HP: {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#6b6b6b',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'HP',\n        },\n        group: 'Info Box',\n        i: 4,\n      },\n      {\n        id: 'S9gXdyGY',\n        label: 'Low HP',\n        expression: 'hp<=40%',\n        imgName: '',\n        imgSrc: '',\n        priority: 52,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          id: 'S9gXdyGY',\n          parentID: 'W8BPK9hv',\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.47,\n          offsetY: 0.23,\n          scaleX: 0.82,\n          scaleY: 0.82,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'HP: {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#ff0000',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#6b6b6b',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Low HP',\n        },\n        group: 'Info Box',\n        i: 5,\n      },\n      {\n        id: 'k9Ws74Hc',\n        label: 'Actor AC',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 53,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'k9Ws74Hc',\n          parentID: 'W8BPK9hv',\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.25,\n          offsetY: 0.46,\n          scaleX: 1,\n          scaleY: 1,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'AC: {{actor.system.attributes.ac.value}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Actor AC',\n        },\n        group: 'Info Box',\n        i: 6,\n      },\n      {\n        id: 'eIxjLZmy',\n        label: 'Movement Label',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 54,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'eIxjLZmy',\n          parentID: 'W8BPK9hv',\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.25,\n          offsetY: 0.2,\n          scaleX: 0.61,\n          scaleY: 0.61,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Movement',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Movement Label',\n        },\n        group: 'Info Box',\n        i: 7,\n      },\n      {\n        id: 'k5xYpZAZ',\n        label: 'Movement Walk',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 55,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'k5xYpZAZ',\n          parentID: 'W8BPK9hv',\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.36,\n          offsetY: -0.03,\n          scaleX: 1,\n          scaleY: 1,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '{{actor.system.attributes.movement.walk}}ft',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Movement Walk',\n        },\n        group: 'Info Box',\n        i: 8,\n      },\n      {\n        id: 'dHHZRQXG',\n        label: 'Movement Fly',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 56,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'dHHZRQXG',\n          parentID: 'W8BPK9hv',\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.36,\n          offsetY: -0.16,\n          scaleX: 0.33,\n          scaleY: 0.33,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Fly {{actor.system.attributes.movement.fly}}, Swim {{actor.system.attributes.movement.swim}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Movement Fly',\n        },\n        group: 'Info Box',\n        i: 9,\n      },\n    ],\n    id: 'wuMcLy3T',\n  },\n  {\n    name: 'Info Box #2',\n    hint: 'Displays information about the token/actor when hovering over or controlling them. This box will adjust to canvas zoom.',\n    img: 'https://user-images.githubusercontent.com/7693704/244750685-81988600-5153-4d29-acb0-2c62111bed14.png',\n    system: 'dnd5e',\n    mappings: [\n      {\n        id: 'f0pV6Pnl',\n        label: 'Box Background',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'f0pV6Pnl',\n          parentID: '',\n          ui: true,\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: true,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.55,\n          offsetY: 0,\n          scaleX: 1,\n          scaleY: 1,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: true,\n          limitOnHighlight: false,\n          limitOnControl: true,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          shapes: [\n            {\n              shape: {\n                type: 'rectangle',\n                x: '0',\n                y: '0',\n                width: '200',\n                height: '300',\n                radius: '0',\n              },\n              label: '',\n              line: {\n                width: 2,\n                color: '#ffffff',\n                alpha: 1,\n              },\n              fill: {\n                color: '#2e5a94',\n                color2: '',\n                prc: '',\n                alpha: 0.9,\n              },\n            },\n          ],\n          effect: '',\n          label: 'Box Background',\n        },\n        group: 'Info Box #2',\n        i: 0,\n      },\n      {\n        id: 'n2Adi1fi',\n        label: 'HP',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 51,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'n2Adi1fi',\n          parentID: 'f0pV6Pnl',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.45,\n          offsetY: 0.42,\n          scaleX: 0.84,\n          scaleY: 0.84,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'HP: {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'HP',\n        },\n        group: 'Info Box #2',\n        i: 1,\n      },\n      {\n        id: 'hCKVzw3Z',\n        label: ' AC',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 52,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'hCKVzw3Z',\n          parentID: 'f0pV6Pnl',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.45,\n          offsetY: 0.31,\n          scaleX: 0.84,\n          scaleY: 0.84,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'AC: {{actor.system.attributes.ac.value}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: ' AC',\n        },\n        group: 'Info Box #2',\n        i: 2,\n      },\n      {\n        id: '2nYmUTwu',\n        label: ' Speed',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 53,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: '2nYmUTwu',\n          parentID: 'f0pV6Pnl',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.45,\n          offsetY: 0.2,\n          scaleX: 0.84,\n          scaleY: 0.84,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Speed: {{actor.system.attributes.movement.walk}}ft',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: ' Speed',\n        },\n        group: 'Info Box #2',\n        i: 3,\n      },\n      {\n        id: 's1NtDiUV',\n        label: 'Perception',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 54,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 's1NtDiUV',\n          parentID: 'f0pV6Pnl',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: 0.15,\n          scaleX: 0.84,\n          scaleY: 0.84,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Perception',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Perception',\n        },\n        group: 'Info Box #2',\n        i: 4,\n      },\n      {\n        id: 'jYeRIoG2',\n        label: 'Passive Perception',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 55,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'jYeRIoG2',\n          parentID: 'f0pV6Pnl',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.47,\n          offsetY: 0,\n          scaleX: 0.51,\n          scaleY: 0.51,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Passive: {{actor.system.skills.prc.passive}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Passive Perception',\n        },\n        group: 'Info Box #2',\n        i: 5,\n      },\n      {\n        id: 'KYMdkTVI',\n        label: 'Active Perception',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 56,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'KYMdkTVI',\n          parentID: 'f0pV6Pnl',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.48,\n          offsetY: 0,\n          scaleX: 0.51,\n          scaleY: 0.51,\n          angle: 0,\n          anchor: {\n            x: 1,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Active: {{actor.system.skills.prc.total}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Active Perception',\n        },\n        group: 'Info Box #2',\n        i: 6,\n      },\n      {\n        id: 'Ewbg54II',\n        label: 'CHA',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 57,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'Ewbg54II',\n          parentID: 'f0pV6Pnl',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.31,\n          offsetY: -0.3,\n          scaleX: 0.51,\n          scaleY: 0.51,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'CHA\\\\n{{actor.system.abilities.cha.mod}} {{actor.system.abilities.cha.save}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'CHA',\n        },\n        group: 'Info Box #2',\n        i: 7,\n      },\n      {\n        id: '2le1Nagp',\n        label: 'CON',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 57,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: '2le1Nagp',\n          parentID: 'f0pV6Pnl',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.31,\n          offsetY: -0.11,\n          scaleX: 0.51,\n          scaleY: 0.51,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'CON\\\\n{{actor.system.abilities.con.mod}} {{actor.system.abilities.con.save}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'CON',\n        },\n        group: 'Info Box #2',\n        i: 8,\n      },\n      {\n        id: 'ahKmjzLj',\n        label: 'DEX',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 57,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'ahKmjzLj',\n          parentID: 'f0pV6Pnl',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: -0.11,\n          scaleX: 0.51,\n          scaleY: 0.51,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'DEX\\\\n{{actor.system.abilities.dex.mod}} {{actor.system.abilities.dex.save}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'DEX',\n        },\n        group: 'Info Box #2',\n        i: 9,\n      },\n      {\n        id: 'gQzyq0zm',\n        label: 'INT',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 57,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'gQzyq0zm',\n          parentID: 'f0pV6Pnl',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.32,\n          offsetY: -0.3,\n          scaleX: 0.51,\n          scaleY: 0.51,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'INT\\\\n{{actor.system.abilities.int.mod}} {{actor.system.abilities.int.save}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'INT',\n        },\n        group: 'Info Box #2',\n        i: 10,\n      },\n      {\n        id: 'hYGg1oAt',\n        label: 'STR',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 57,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'hYGg1oAt',\n          parentID: 'f0pV6Pnl',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.32,\n          offsetY: -0.11,\n          scaleX: 0.51,\n          scaleY: 0.51,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'STR\\\\n{{actor.system.abilities.str.mod}} {{actor.system.abilities.str.save}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'STR',\n        },\n        group: 'Info Box #2',\n        i: 11,\n      },\n      {\n        id: 'uQ5zS3K6',\n        label: 'WIS',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 57,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'uQ5zS3K6',\n          parentID: 'f0pV6Pnl',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: -0.3,\n          scaleX: 0.51,\n          scaleY: 0.51,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'WIS\\\\n{{actor.system.abilities.wis.mod}} {{actor.system.abilities.wis.save}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'WIS',\n        },\n        group: 'Info Box #2',\n        i: 12,\n      },\n    ],\n    id: 'Wtq9HDsX',\n  },\n  {\n    name: 'Info Box #3',\n    hint: 'Displays information about the token/actor when hovering over or controlling them. This box will adjust to canvas zoom.',\n    img: 'https://user-images.githubusercontent.com/7693704/244750246-794625b9-9e1d-4322-9265-fc295f02ca2b.png',\n    system: 'dnd5e',\n    mappings: [\n      {\n        id: 'Gt11vjXV',\n        label: 'Box Background',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'Gt11vjXV',\n          parentID: '',\n          ui: true,\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: true,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.55,\n          offsetY: 0,\n          scaleX: 1,\n          scaleY: 1,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: true,\n          limitOnHighlight: false,\n          limitOnControl: true,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          shapes: [\n            {\n              shape: {\n                type: 'rectangle',\n                x: '0',\n                y: '0',\n                width: '240',\n                height: '300',\n                radius: '0',\n              },\n              label: '',\n              line: {\n                width: 2,\n                color: '#ffffff',\n                alpha: 1,\n              },\n              fill: {\n                color: '#2e5a94',\n                color2: '',\n                prc: '',\n                alpha: 0.9,\n              },\n            },\n          ],\n          effect: '',\n          label: 'Box Background',\n        },\n        group: 'Info Box #3',\n        i: 0,\n      },\n      {\n        id: 'o4XWzdDM',\n        label: 'HP',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 51,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'o4XWzdDM',\n          parentID: 'Gt11vjXV',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.44,\n          offsetY: 0.42,\n          scaleX: 0.84,\n          scaleY: 0.84,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: ' {{actor.system.attributes.hp.value}}/{{actor.system.attributes.hp.max}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'HP',\n        },\n        group: 'Info Box #3',\n        i: 1,\n      },\n      {\n        id: 'eAv2dSV6',\n        label: 'AC',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 52,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'eAv2dSV6',\n          parentID: 'Gt11vjXV',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.43,\n          offsetY: 0.28,\n          scaleX: 0.84,\n          scaleY: 0.84,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: ' {{actor.system.attributes.ac.value}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'AC',\n        },\n        group: 'Info Box #3',\n        i: 2,\n      },\n      {\n        id: 'SCfkWTni',\n        label: 'Fly Speed',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 53,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'SCfkWTni',\n          parentID: 'Gt11vjXV',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.04,\n          offsetY: 0.13,\n          scaleX: 0.84,\n          scaleY: 0.84,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: ' {{actor.system.attributes.movement.fly}}ft',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Fly Speed',\n        },\n        group: 'Info Box #3',\n        i: 3,\n      },\n      {\n        id: 'e5LPzVta',\n        label: 'Walk Speed',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 53,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'e5LPzVta',\n          parentID: 'Gt11vjXV',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.45,\n          offsetY: 0.13,\n          scaleX: 0.84,\n          scaleY: 0.84,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: ' {{actor.system.attributes.movement.walk}}ft',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Walk Speed',\n        },\n        group: 'Info Box #3',\n        i: 4,\n      },\n      {\n        id: 'XlopagaT',\n        label: 'Passive Perception',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 55,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'XlopagaT',\n          parentID: 'Gt11vjXV',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.45,\n          offsetY: -0.02,\n          scaleX: 0.83,\n          scaleY: 0.83,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: ' {{actor.system.skills.prc.passive}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Passive Perception',\n        },\n        group: 'Info Box #3',\n        i: 5,\n      },\n      {\n        id: 'CeXgVxA0',\n        label: 'Active Perception',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 56,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'CeXgVxA0',\n          parentID: 'Gt11vjXV',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.03,\n          offsetY: -0.02,\n          scaleX: 0.83,\n          scaleY: 0.83,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: ' {{actor.system.skills.prc.total}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Active Perception',\n        },\n        group: 'Info Box #3',\n        i: 6,\n      },\n      {\n        id: '0WWf1iGM',\n        label: 'CHA',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 57,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: '0WWf1iGM',\n          parentID: 'Gt11vjXV',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.31,\n          offsetY: -0.3,\n          scaleX: 0.51,\n          scaleY: 0.51,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'CHA\\\\n{{actor.system.abilities.cha.mod}}  {{actor.system.abilities.cha.save}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'CHA',\n        },\n        group: 'Info Box #3',\n        i: 7,\n      },\n      {\n        id: 'AU8tTXat',\n        label: 'CON',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 57,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'AU8tTXat',\n          parentID: 'Gt11vjXV',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.31,\n          offsetY: -0.11,\n          scaleX: 0.51,\n          scaleY: 0.51,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'CON\\\\n{{actor.system.abilities.con.mod}}  {{actor.system.abilities.con.save}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'CON',\n        },\n        group: 'Info Box #3',\n        i: 8,\n      },\n      {\n        id: 'JZKNmgvY',\n        label: 'DEX',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 57,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'JZKNmgvY',\n          parentID: 'Gt11vjXV',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: -0.11,\n          scaleX: 0.51,\n          scaleY: 0.51,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'DEX\\\\n{{actor.system.abilities.dex.mod}}  {{actor.system.abilities.dex.save}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'DEX',\n        },\n        group: 'Info Box #3',\n        i: 9,\n      },\n      {\n        id: 'AUGurJtx',\n        label: 'INT',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 57,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'AUGurJtx',\n          parentID: 'Gt11vjXV',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.32,\n          offsetY: -0.3,\n          scaleX: 0.51,\n          scaleY: 0.51,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'INT\\\\n{{actor.system.abilities.int.mod}}  {{actor.system.abilities.int.save}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'INT',\n        },\n        group: 'Info Box #3',\n        i: 10,\n      },\n      {\n        id: 'z0PMTFxo',\n        label: 'STR',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 57,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'z0PMTFxo',\n          parentID: 'Gt11vjXV',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0.32,\n          offsetY: -0.11,\n          scaleX: 0.51,\n          scaleY: 0.51,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'STR\\\\n{{actor.system.abilities.str.mod}}  {{actor.system.abilities.str.save}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'STR',\n        },\n        group: 'Info Box #3',\n        i: 11,\n      },\n      {\n        id: 'YXUiGPBv',\n        label: 'WIS',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 57,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'YXUiGPBv',\n          parentID: 'Gt11vjXV',\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: true,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: -0.3,\n          scaleX: 0.51,\n          scaleY: 0.51,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'WIS\\\\n{{actor.system.abilities.wis.mod}}  {{actor.system.abilities.wis.save}}',\n            fontFamily: 'Signika',\n            fontSize: 36,\n            letterSpacing: 0,\n            fill: '#FFFFFF',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'WIS',\n        },\n        group: 'Info Box #3',\n        i: 12,\n      },\n    ],\n    id: 'vQJ3coCJ',\n  },\n  {\n    name: 'Facing Direction',\n    hint: 'Displays an arrow in the top-right corner of the token showing the direction it is facing.',\n    img: 'https://user-images.githubusercontent.com/7693704/244647284-2213caf5-6d49-4413-ab5f-83901ffbc8e6.png',\n    mappings: [\n      {\n        id: '9UEOkJ1J',\n        label: 'Arrow',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: '9UEOkJ1J',\n          parentID: '',\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: true,\n          animation: {\n            relative: true,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.5,\n          offsetY: 0.5,\n          scaleX: 0.51,\n          scaleY: 0.51,\n          angle: 90,\n          anchor: {\n            x: 0.5,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '➢',\n            fontFamily: 'Signika',\n            fontSize: 63,\n            letterSpacing: 0,\n            fill: '#ff0000',\n            dropShadow: null,\n            strokeThickness: 3,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Arrow',\n        },\n        group: 'Facing Direction',\n        i: 0,\n      },\n    ],\n    id: 'Z8CTgmOg',\n  },\n  {\n    name: 'Combat Markers',\n    hint: 'Displays rotating markers for tokens in combat.',\n    img: 'https://user-images.githubusercontent.com/7693704/257478593-81b9192d-1ffe-4f0b-8e5d-806218d7e25f.png',\n    mappings: [\n      {\n        id: '9R3glzOK',\n        label: 'Your Turn is Next!',\n        expression: 'combat-turn-next',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          label: 'Your Turn is Next!',\n          parent: '',\n          underlay: true,\n          bottom: true,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: true,\n            duration: 30000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: false,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: 0,\n          scaleX: 1.6,\n          scaleY: 1.6,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: 'Next Turn  =  = =  =  =  = Next turn =  =  =  =  = ',\n            fontFamily: 'Signika',\n            fontSize: 41,\n            letterSpacing: 0,\n            fill: '#e6a800',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 125,\n              invert: false,\n            },\n          },\n          effect: '',\n        },\n        group: 'Combat',\n        i: 0,\n      },\n      {\n        id: 'qoWG5AD0',\n        label: 'Your Turn!',\n        expression: 'combat-turn',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          label: 'Your Turn!',\n          parent: '',\n          underlay: true,\n          bottom: true,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: true,\n            duration: 30000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: true,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: false,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: 0,\n          offsetY: 0,\n          scaleX: 1.6,\n          scaleY: 1.6,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '= Your Turn  =  = =  =  =  = Your turn =  =  =  =  =  ',\n            fontFamily: 'Signika',\n            fontSize: 41,\n            letterSpacing: 0,\n            fill: '#00ace6',\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 125,\n              invert: false,\n            },\n          },\n          effect: '',\n        },\n        group: 'Combat',\n        i: 1,\n      },\n    ],\n    id: 'YpoX5zxO',\n  },\n  {\n    name: 'Disposition Markers',\n    hint: 'Displays circles underneath tokens coloured based on their disposition.',\n    img: 'https://user-images.githubusercontent.com/7693704/246497702-5de47dc9-21ef-43a1-86db-b3f85eb8ddb1.png',\n    mappings: [\n      {\n        id: 'TzP6MBC1',\n        label: 'Friendly',\n        expression: 'disposition=1',\n        codeExp: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          id: 'TzP6MBC1',\n          parentID: '',\n          underlay: true,\n          bottom: true,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: '5000',\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          imgLinked: false,\n          repeating: false,\n          alpha: '1',\n          tint: '#1acb2f',\n          interpolateColor: {\n            color2: '',\n            prc: '',\n          },\n          width: '',\n          height: '',\n          scaleX: '0.24',\n          scaleY: '0.24',\n          angle: '0',\n          pOffsetX: '',\n          pOffsetY: '',\n          offsetX: '0',\n          offsetY: '0',\n          anchor: {\n            x: 0.5,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedToOwner: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnHUD: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '',\n            repeating: false,\n            fontFamily: 'Signika',\n            fill: '#FFFFFF',\n            interpolateColor: {\n              color2: '',\n              prc: '',\n            },\n            fontSize: '36',\n            align: 'center',\n            letterSpacing: '0',\n            dropShadow: 'true',\n            strokeThickness: '1',\n            stroke: '#111111',\n            wordWrap: false,\n            wordWrapWidth: '200',\n            breakWords: false,\n            maxHeight: '0',\n            curve: {\n              angle: '0',\n              radius: '0',\n              invert: false,\n            },\n          },\n          shapes: [\n            {\n              shape: {\n                type: 'ellipse',\n                x: '0',\n                y: '0',\n                width: '{{object.w}} * @scale',\n                height: '{{object.h}} * @scale',\n              },\n              label: '',\n              line: {\n                width: '0',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ffffff',\n                alpha: '0.75',\n                interpolateColor: {\n                  color2: '',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'ellipse',\n                x: '{{object.w}} * @inner',\n                y: '{{object.w}} * @inner',\n                width: '{{object.w}} * @scale - {{object.w}} * @inner',\n                height: '{{object.h}} * @scale - {{object.h}} * @inner',\n              },\n              label: '',\n              line: {\n                width: '0',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#b8b8b8',\n                alpha: '0.7',\n                interpolateColor: {\n                  color2: '',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n          ],\n          variables: [\n            {\n              name: 'scale',\n              value: '2.3',\n            },\n            {\n              name: 'inner',\n              value: '0.3',\n            },\n          ],\n          effect: '',\n          interactivity: [],\n          label: 'Friendly',\n        },\n        group: 'Disposition Markers',\n        i: 2,\n      },\n      {\n        id: 'oIsQWISB',\n        label: 'Hostile',\n        expression: 'disposition=-1',\n        codeExp: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          id: 'oIsQWISB',\n          parentID: '',\n          underlay: true,\n          bottom: true,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: '5000',\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          imgLinked: false,\n          repeating: false,\n          alpha: '1',\n          tint: '#eb0000',\n          interpolateColor: {\n            color2: '',\n            prc: '',\n          },\n          width: '',\n          height: '',\n          scaleX: '0.24',\n          scaleY: '0.24',\n          angle: '0',\n          pOffsetX: '',\n          pOffsetY: '',\n          offsetX: '0',\n          offsetY: '0',\n          anchor: {\n            x: 0.5,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedToOwner: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnHUD: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '',\n            repeating: false,\n            fontFamily: 'Signika',\n            fill: '#FFFFFF',\n            interpolateColor: {\n              color2: '',\n              prc: '',\n            },\n            fontSize: '36',\n            align: 'center',\n            letterSpacing: '0',\n            dropShadow: 'true',\n            strokeThickness: '1',\n            stroke: '#111111',\n            wordWrap: false,\n            wordWrapWidth: '200',\n            breakWords: false,\n            maxHeight: '0',\n            curve: {\n              angle: '0',\n              radius: '0',\n              invert: false,\n            },\n          },\n          shapes: [\n            {\n              shape: {\n                type: 'ellipse',\n                x: '0',\n                y: '0',\n                width: '{{object.w}} * @scale',\n                height: '{{object.h}} * @scale',\n              },\n              label: '',\n              line: {\n                width: '0',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ffffff',\n                alpha: '0.75',\n                interpolateColor: {\n                  color2: '',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'ellipse',\n                x: '{{object.w}} * @inner',\n                y: '{{object.w}} * @inner',\n                width: '{{object.w}} * @scale - {{object.w}} * @inner',\n                height: '{{object.h}} * @scale - {{object.h}} * @inner',\n              },\n              label: '',\n              line: {\n                width: '0',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#b8b8b8',\n                alpha: '0.7',\n                interpolateColor: {\n                  color2: '',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n          ],\n          variables: [\n            {\n              name: 'scale',\n              value: '2.3',\n            },\n            {\n              name: 'inner',\n              value: '0.3',\n            },\n          ],\n          effect: '',\n          interactivity: [],\n          label: 'Hostile',\n        },\n        group: 'Disposition Markers',\n        i: 3,\n      },\n      {\n        id: 'fYxJ9Bbc',\n        label: 'Neutral',\n        expression: 'disposition=0',\n        codeExp: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          id: 'fYxJ9Bbc',\n          parentID: '',\n          underlay: true,\n          bottom: true,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: '5000',\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          imgLinked: false,\n          repeating: false,\n          alpha: '1',\n          tint: '',\n          interpolateColor: {\n            color2: '',\n            prc: '',\n          },\n          width: '',\n          height: '',\n          scaleX: '0.24',\n          scaleY: '0.24',\n          angle: '0',\n          pOffsetX: '',\n          pOffsetY: '',\n          offsetX: '0',\n          offsetY: '0',\n          anchor: {\n            x: 0.5,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedToOwner: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnHUD: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '',\n            repeating: false,\n            fontFamily: 'Signika',\n            fill: '#FFFFFF',\n            interpolateColor: {\n              color2: '',\n              prc: '',\n            },\n            fontSize: '36',\n            align: 'center',\n            letterSpacing: '0',\n            dropShadow: 'true',\n            strokeThickness: '1',\n            stroke: '#111111',\n            wordWrap: false,\n            wordWrapWidth: '200',\n            breakWords: false,\n            maxHeight: '0',\n            curve: {\n              angle: '0',\n              radius: '0',\n              invert: false,\n            },\n          },\n          shapes: [\n            {\n              shape: {\n                type: 'ellipse',\n                x: '0',\n                y: '0',\n                width: '{{object.w}} * @scale',\n                height: '{{object.h}} * @scale',\n              },\n              label: '',\n              line: {\n                width: '0',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ffffff',\n                alpha: '0.75',\n                interpolateColor: {\n                  color2: '',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'ellipse',\n                x: '{{object.w}} * @inner',\n                y: '{{object.w}} * @inner',\n                width: '{{object.w}} * @scale - {{object.w}} * @inner',\n                height: '{{object.h}} * @scale - {{object.h}} * @inner',\n              },\n              label: '',\n              line: {\n                width: '0',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#b8b8b8',\n                alpha: '0.7',\n                interpolateColor: {\n                  color2: '',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n          ],\n          variables: [\n            {\n              name: 'scale',\n              value: '2.3',\n            },\n            {\n              name: 'inner',\n              value: '0.3',\n            },\n          ],\n          effect: '',\n          interactivity: [],\n          label: 'Neutral',\n        },\n        group: 'Disposition Markers',\n        i: 4,\n      },\n      {\n        id: 'PyEXXb5J',\n        label: 'Secret',\n        expression: 'disposition=-2',\n        codeExp: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: false,\n        disabled: false,\n        overlayConfig: {\n          id: 'PyEXXb5J',\n          parentID: '',\n          underlay: true,\n          bottom: true,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: '5000',\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          imgLinked: false,\n          repeating: false,\n          alpha: '1',\n          tint: '#ba24ff',\n          interpolateColor: {\n            color2: '',\n            prc: '',\n          },\n          width: '',\n          height: '',\n          scaleX: '0.24',\n          scaleY: '0.24',\n          angle: '0',\n          pOffsetX: '',\n          pOffsetY: '',\n          offsetX: '0',\n          offsetY: '0',\n          anchor: {\n            x: 0.5,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedToOwner: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnHUD: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '',\n            repeating: false,\n            fontFamily: 'Signika',\n            fill: '#FFFFFF',\n            interpolateColor: {\n              color2: '',\n              prc: '',\n            },\n            fontSize: '36',\n            align: 'center',\n            letterSpacing: '0',\n            dropShadow: 'true',\n            strokeThickness: '1',\n            stroke: '#111111',\n            wordWrap: false,\n            wordWrapWidth: '200',\n            breakWords: false,\n            maxHeight: '0',\n            curve: {\n              angle: '0',\n              radius: '0',\n              invert: false,\n            },\n          },\n          shapes: [\n            {\n              shape: {\n                type: 'ellipse',\n                x: '0',\n                y: '0',\n                width: '{{object.w}} * @scale',\n                height: '{{object.h}} * @scale',\n              },\n              label: '',\n              line: {\n                width: '0',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ffffff',\n                alpha: '0.75',\n                interpolateColor: {\n                  color2: '',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'ellipse',\n                x: '{{object.w}} * @inner',\n                y: '{{object.w}} * @inner',\n                width: '{{object.w}} * @scale - {{object.w}} * @inner',\n                height: '{{object.h}} * @scale - {{object.h}} * @inner',\n              },\n              label: '',\n              line: {\n                width: '0',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#b8b8b8',\n                alpha: '0.7',\n                interpolateColor: {\n                  color2: '',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n          ],\n          variables: [\n            {\n              name: 'scale',\n              value: '2.3',\n            },\n            {\n              name: 'inner',\n              value: '0.3',\n            },\n          ],\n          effect: '',\n          interactivity: [],\n          label: 'Secret',\n        },\n        group: 'Disposition Markers',\n        i: 5,\n      },\n    ],\n    id: 'yjqfAagB',\n  },\n  {\n    name: 'Health Bar',\n    hint: 'A recreation of the standard health bar using Overlays.',\n    img: 'https://user-images.githubusercontent.com/7693704/257246890-d41894a0-7f40-4e91-a47a-bc10d6f198e6.png',\n    group: 'Health',\n    mappings: [\n      {\n        id: 'dgIBKbcU',\n        label: 'Health Bar',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'dgIBKbcU',\n          parentID: '',\n          ui: true,\n          underlay: true,\n          bottom: true,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          repeating: false,\n          alpha: 1,\n          tint: '',\n          interpolateColor: {\n            color2: '',\n            prc: '',\n          },\n          offsetX: 0,\n          offsetY: -0.5,\n          scaleX: 1,\n          scaleY: 1,\n          angle: 0,\n          anchor: {\n            x: 0.5,\n            y: 1,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '',\n            repeating: false,\n            fontFamily: 'Signika',\n            fill: '#FFFFFF',\n            interpolateColor: {\n              color2: '',\n              prc: '',\n            },\n            fontSize: 36,\n            align: 'left',\n            letterSpacing: 0,\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          shapes: [\n            {\n              shape: {\n                type: 'rectangle',\n                x: '0',\n                y: '0',\n                width: '{{object.w}}',\n                height: '{{object.h}} * @height',\n                radius: '3',\n              },\n              label: '',\n              line: {\n                width: 1,\n                color: '#000000',\n                alpha: 1,\n              },\n              fill: {\n                color: '#5c5c5c',\n                alpha: 0.65,\n                interpolateColor: {\n                  color2: '',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'rectangle',\n                x: '0',\n                y: '0',\n                width: '{{object.w}} * ( {{hp}} / {{hpMax}} )',\n                height: '{{object.h}} * @height',\n                radius: '3',\n              },\n              label: '',\n              line: {\n                width: 1,\n                color: '#000000',\n                alpha: 1,\n              },\n              fill: {\n                color: '#ff0000',\n                alpha: 1,\n                interpolateColor: {\n                  color2: '#74da0e',\n                  prc: '{{hp}} / {{hpMax}}',\n                },\n              },\n              repeating: false,\n            },\n          ],\n          variables: [\n            {\n              name: 'height',\n              value: '0.079',\n            },\n          ],\n          effect: '',\n          label: 'Health Bar',\n        },\n        group: 'Health Bar',\n        i: 0,\n      },\n    ],\n    id: 'GDyvkEB4',\n  },\n  {\n    name: 'Health Ring',\n    hint: 'A ring shaped health bar.',\n    img: 'https://user-images.githubusercontent.com/7693704/257246432-a339394f-489a-4436-9d4b-427c285d4f27.png',\n    group: 'Health',\n    mappings: [\n      {\n        id: 'erOTHzIc',\n        label: 'Health Ring',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: 'erOTHzIc',\n          parentID: '',\n          ui: true,\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          repeating: false,\n          alpha: 1,\n          tint: '',\n          interpolateColor: {\n            color2: '',\n            prc: '',\n          },\n          offsetX: 0,\n          offsetY: 0,\n          scaleX: 1.02,\n          scaleY: 1.02,\n          angle: -90,\n          anchor: {\n            x: 0.5,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '',\n            repeating: false,\n            fontFamily: 'Signika',\n            fill: '#ffffff',\n            interpolateColor: {\n              color2: '',\n              prc: '',\n            },\n            fontSize: 36,\n            align: 'left',\n            letterSpacing: 0,\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          shapes: [\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '{{object.w}} / @ringScale * @innerRadius',\n                outerRadius: '{{object.w}} / @ringScale * @outerRadius',\n                startAngle: '0',\n                endAngle: '360',\n              },\n              label: 'Background',\n              line: {\n                width: 0,\n                color: '#000000',\n                alpha: 1,\n              },\n              fill: {\n                color: '#b0b0b0',\n                alpha: 0.6,\n                interpolateColor: {\n                  color2: '',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '{{object.w}} / @ringScale * @innerRadius',\n                outerRadius: '{{object.w}} / @ringScale * @outerRadius',\n                startAngle: '0',\n                endAngle: '{{hp}} / {{hpMax}} * 360',\n              },\n              label: 'Health Tracker',\n              line: {\n                width: 0,\n                color: '#000000',\n                alpha: 1,\n              },\n              fill: {\n                color: '#ff0000',\n                alpha: 1,\n                interpolateColor: {\n                  color2: '#74da0e',\n                  prc: '{{hp}} / {{hpMax}}',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '{{object.w}} / @ringScale * @innerRadius',\n                outerRadius: '{{object.w}} / @ringScale * @outerRadius',\n                startAngle: '0',\n                endAngle: '360',\n              },\n              label: 'Outline',\n              line: {\n                width: 1,\n                color: '#000000',\n                alpha: 1,\n              },\n              fill: {\n                color: '#b0b0b0',\n                alpha: 0,\n                interpolateColor: {\n                  color2: '',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n          ],\n          variables: [\n            {\n              name: 'ringScale',\n              value: '1.8',\n            },\n            {\n              name: 'innerRadius',\n              value: '0.9',\n            },\n            {\n              name: 'outerRadius',\n              value: '1.0',\n            },\n          ],\n          effect: '',\n          label: 'Health Ring',\n        },\n        group: 'Health Ring',\n        i: 0,\n      },\n    ],\n    id: 'yITi94hC',\n  },\n  {\n    name: 'Health Hearts',\n    hint: 'Displays up to 10 hearts to the right of the token based on their current health. Each heart is representative of 10% of the health.',\n    img: 'https://user-images.githubusercontent.com/7693704/257349483-1864d4ca-a2de-468d-872d-6d8c2847434a.png',\n    group: 'Health',\n    mappings: [\n      {\n        id: '4uCpbtHY',\n        label: 'Hearts',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: '4uCpbtHY',\n          parentID: '',\n          ui: true,\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: true,\n          linkDimensionsY: true,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          alpha: 1,\n          tint: '',\n          offsetX: -0.53,\n          offsetY: 0.5,\n          scaleX: 0.5,\n          scaleY: 0.5,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: ' ',\n            repeating: true,\n            repeat: {\n              value: '{{hp}}',\n              increment: '10',\n              isPercentage: true,\n              maxValue: '{{hpMax}}',\n              perRow: '2',\n              maxRows: '',\n            },\n            fontFamily: 'Signika',\n            fill: '#ff0000',\n            fontSize: 36,\n            align: 'left',\n            letterSpacing: 0,\n            dropShadow: null,\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          effect: '',\n          label: 'Hearts',\n        },\n        group: 'Health Hearts',\n        i: 0,\n      },\n    ],\n    id: 'T2DrD0Em',\n  },\n  {\n    name: 'Health Circles',\n    hint: 'Displays up to 10 circles to the right of the token based on their current health. Each circle is representative of 10% of the health.',\n    img: 'https://user-images.githubusercontent.com/7693704/257476414-c42bdbc0-c57b-4367-8207-3e2e4273094f.png',\n    group: 'Health',\n    mappings: [\n      {\n        id: '0vETg18v',\n        label: 'Health Circles',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: '0vETg18v',\n          parentID: '',\n          ui: true,\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: true,\n          linkDimensionsY: true,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          repeating: false,\n          alpha: 1,\n          tint: '',\n          interpolateColor: {\n            color2: '',\n            prc: '',\n          },\n          offsetX: -0.52,\n          offsetY: 0.6,\n          scaleX: 0.46,\n          scaleY: 0.46,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '',\n            repeating: false,\n            fontFamily: 'Signika',\n            fill: '#ffffff',\n            interpolateColor: {\n              color2: '',\n              prc: '',\n            },\n            fontSize: 36,\n            align: 'left',\n            letterSpacing: 0,\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          shapes: [\n            {\n              shape: {\n                type: 'ellipse',\n                x: '0',\n                y: '0',\n                width: '25',\n                height: '25',\n              },\n              label: '',\n              line: {\n                width: 1,\n                color: '#000000',\n                alpha: 1,\n              },\n              fill: {\n                color: '#ff0000',\n                alpha: 1,\n                interpolateColor: {\n                  color2: '#74da0e',\n                  prc: '{{hp}} / {{hpMax}}',\n                },\n              },\n              repeating: true,\n              repeat: {\n                value: '{{hp}}',\n                increment: '10',\n                isPercentage: true,\n                maxValue: '{{hpMax}}',\n                perRow: '2',\n                maxRows: '',\n                paddingX: '3',\n                paddingY: '3',\n              },\n            },\n          ],\n          effect: '',\n          label: 'Health Circles',\n        },\n        group: 'Health Circles',\n        i: 0,\n      },\n    ],\n    id: 'kJ0Fi54w',\n  },\n  {\n    name: 'Health Squares',\n    hint: 'Displays up to 10 squares to the right of the token based on their current health. Each square is representative of 10% of the health.',\n    img: 'https://user-images.githubusercontent.com/7693704/257477099-689cd23a-0e4a-4d9a-aaa2-bf88b169ede8.png',\n    group: 'Health',\n    mappings: [\n      {\n        id: '0vETg18v',\n        label: 'Health Squares',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: '0vETg18v',\n          parentID: '',\n          ui: true,\n          underlay: false,\n          bottom: false,\n          top: false,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: 5000,\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: true,\n          linkDimensionsY: true,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          repeating: false,\n          alpha: 1,\n          tint: '',\n          interpolateColor: {\n            color2: '',\n            prc: '',\n          },\n          offsetX: -0.52,\n          offsetY: 0.6,\n          scaleX: 0.46,\n          scaleY: 0.46,\n          angle: 0,\n          anchor: {\n            x: 0,\n            y: 0,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedUsers: [],\n          limitOnHover: false,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '',\n            repeating: false,\n            fontFamily: 'Signika',\n            fill: '#ffffff',\n            interpolateColor: {\n              color2: '',\n              prc: '',\n            },\n            fontSize: 36,\n            align: 'left',\n            letterSpacing: 0,\n            dropShadow: 'true',\n            strokeThickness: 1,\n            stroke: '#111111',\n            curve: {\n              radius: 0,\n              invert: false,\n            },\n          },\n          shapes: [\n            {\n              shape: {\n                type: 'rectangle',\n                x: '0',\n                y: '0',\n                width: '50',\n                height: '50',\n                radius: '0',\n              },\n              label: '',\n              line: {\n                width: 1,\n                color: '#000000',\n                alpha: 1,\n              },\n              fill: {\n                color: '#ff0000',\n                alpha: 1,\n                interpolateColor: {\n                  color2: '#74da0e',\n                  prc: '{{hp}} / {{hpMax}}',\n                },\n              },\n              repeating: true,\n              repeat: {\n                value: '{{hp}}',\n                increment: '10',\n                isPercentage: true,\n                maxValue: '{{hpMax}}',\n                perRow: '2',\n                maxRows: '',\n                paddingX: '3',\n                paddingY: '3',\n              },\n            },\n          ],\n          effect: '',\n          label: 'Health Squares',\n        },\n        group: 'Health Squares',\n        i: 0,\n      },\n    ],\n    id: 'zzeRhmmk',\n  },\n  {\n    name: 'Spell Slot Ring',\n    hint: 'Remaining spell slots represented as a ring.',\n    img: 'https://user-images.githubusercontent.com/7693704/261663740-444d86b9-ee9f-4a2f-963f-6886a2af29cc.png',\n    system: 'dnd5e',\n    mappings: [\n      {\n        id: '1SS3KhwM',\n        label: 'Spell Slot Ring',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 50,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: '1SS3KhwM',\n          parentID: '',\n          ui: true,\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: '5000',\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          repeating: false,\n          alpha: '1',\n          tint: '',\n          interpolateColor: {\n            color2: '',\n            prc: '',\n          },\n          width: '{{object.w}} * @Scale',\n          height: '{{object.w}} * @Scale',\n          scaleX: '1',\n          scaleY: '1',\n          angle: '0',\n          offsetX: '0',\n          offsetY: '0',\n          anchor: {\n            x: 0.5,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedToOwner: true,\n          limitedUsers: [],\n          limitOnHover: true,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '',\n            repeating: false,\n            fontFamily: 'Signika',\n            fill: '#ffffff',\n            interpolateColor: {\n              color2: '',\n              prc: '',\n            },\n            fontSize: '36',\n            align: 'left',\n            letterSpacing: '0',\n            dropShadow: 'true',\n            strokeThickness: '1',\n            stroke: '#111111',\n            wordWrap: false,\n            wordWrapWidth: '200',\n            breakWords: false,\n            maxHeight: '0',\n            curve: {\n              angle: '0',\n              radius: '0',\n              invert: false,\n            },\n          },\n          shapes: [\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer ',\n                startAngle: '0',\n                endAngle: '360',\n              },\n              label: 'BaseLayer',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#3b3b3b',\n                alpha: '1',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90',\n                endAngle: '-90 + ( {{actor.system.spells.spell1.value}} * @Tick )',\n              },\n              label: '1st level',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff0000',\n                alpha: '1',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 4 * @Tick )',\n                endAngle: '-90 + ( 4 * @Tick ) + ( {{actor.system.spells.spell2.value}} * @Tick )',\n              },\n              label: '2nd Level',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff8800',\n                alpha: '1',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 7 * @Tick )',\n                endAngle: '-90 + ( 7 * @Tick ) + ( {{actor.system.spells.spell3.value}} * @Tick )',\n              },\n              label: '3rd Level',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ffdd00',\n                alpha: '1',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 10 * @Tick )',\n                endAngle: '-90 + ( 10 * @Tick ) + ( {{actor.system.spells.spell4.value}} * @Tick )',\n              },\n              label: '4th Level',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#37ff00',\n                alpha: '1',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 13 * @Tick )',\n                endAngle: '-90 + ( 13 * @Tick ) + ( {{actor.system.spells.spell5.value}} * @Tick )',\n              },\n              label: '5th Level',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#00ffcc',\n                alpha: '0.95',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 16 * @Tick )',\n                endAngle: '-90 + ( 16 * @Tick ) + ( {{actor.system.spells.spell6.value}} * @Tick )',\n              },\n              label: '6th Level',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#00b3ff',\n                alpha: '1',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 18 * @Tick )',\n                endAngle: '-90 + ( 18 * @Tick ) + ( {{actor.system.spells.spell7.value}} * @Tick )',\n              },\n              label: '7th Level',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#001eff',\n                alpha: '1',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 20 * @Tick )',\n                endAngle: '-90 + ( 20 * @Tick ) + ( {{actor.system.spells.spell8.value}} * @Tick )',\n              },\n              label: '8th Level',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ae00ff',\n                alpha: '1',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 21 * @Tick )',\n                endAngle: '-90 + ( 21 * @Tick ) + ( {{actor.system.spells.spell9.value}} * @Tick )',\n              },\n              label: '9th Level - Copy',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '1',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90',\n                endAngle: '-90 + ( 1 * @Tick )',\n              },\n              label: 'Outline 1',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 1 * @Tick )',\n                endAngle: '-90 + ( 2 * @Tick )',\n              },\n              label: 'Outline 2',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 2 * @Tick )',\n                endAngle: '-90 + ( 3 * @Tick )',\n              },\n              label: 'Outline 3',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 3 * @Tick )',\n                endAngle: '-90 + ( 4 * @Tick )',\n              },\n              label: 'Outline 4',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 4 * @Tick )',\n                endAngle: '-90 + ( 5 * @Tick )',\n              },\n              label: 'Outline 5',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 5 * @Tick )',\n                endAngle: '-90 + ( 6 * @Tick )',\n              },\n              label: 'Outline 6',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 6 * @Tick )',\n                endAngle: '-90 + ( 7 * @Tick )',\n              },\n              label: 'Outline 7',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 7 * @Tick )',\n                endAngle: '-90 + ( 8 * @Tick )',\n              },\n              label: 'Outline 8',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 8 * @Tick )',\n                endAngle: '-90 + ( 9 * @Tick )',\n              },\n              label: 'Outline 9',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 9 * @Tick )',\n                endAngle: '-90 + ( 10 * @Tick )',\n              },\n              label: 'Outline 10',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 10 * @Tick )',\n                endAngle: '-90 + ( 11 * @Tick )',\n              },\n              label: 'Outline 11',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 11 * @Tick )',\n                endAngle: '-90 + ( 12 * @Tick )',\n              },\n              label: 'Outline 12',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 12 * @Tick )',\n                endAngle: '-90 + ( 13 * @Tick )',\n              },\n              label: 'Outline 13',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 13 * @Tick )',\n                endAngle: '-90 + ( 14 * @Tick )',\n              },\n              label: 'Outline 14',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 14 * @Tick )',\n                endAngle: '-90 + ( 15 * @Tick )',\n              },\n              label: 'Outline 15',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 15 * @Tick )',\n                endAngle: '-90 + ( 16 * @Tick )',\n              },\n              label: 'Outline 16',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 16 * @Tick )',\n                endAngle: '-90 + ( 17 * @Tick )',\n              },\n              label: 'Outline 17',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 17 * @Tick )',\n                endAngle: '-90 + ( 18 * @Tick )',\n              },\n              label: 'Outline 18',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 18 * @Tick )',\n                endAngle: '-90 + ( 19 * @Tick )',\n              },\n              label: 'Outline 19',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 19 * @Tick )',\n                endAngle: '-90 + ( 20 * @Tick )',\n              },\n              label: 'Outline 20',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 20 * @Tick )',\n                endAngle: '-90 + ( 21 * @Tick )',\n              },\n              label: 'Outline 21',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n            {\n              shape: {\n                type: 'torus',\n                x: '0',\n                y: '0',\n                innerRadius: '@Inner',\n                outerRadius: '@Outer',\n                startAngle: '-90 + ( 21 * @Tick )',\n                endAngle: '-90 + ( 22 * @Tick )',\n              },\n              label: 'Outline 22',\n              line: {\n                width: '1',\n                color: '#000000',\n                alpha: '1',\n              },\n              fill: {\n                color: '#ff00ea',\n                alpha: '0',\n                interpolateColor: {\n                  color2: '#ffffff',\n                  prc: '',\n                },\n              },\n              repeating: false,\n            },\n          ],\n          variables: [\n            {\n              name: 'Tick',\n              value: '16.3636363636363636',\n            },\n            {\n              name: 'Inner',\n              value: '66',\n            },\n            {\n              name: 'Outer',\n              value: '80',\n            },\n            {\n              name: 'Scale',\n              value: '1.8',\n            },\n          ],\n          effect: '',\n          label: 'Spell Slot Ring',\n        },\n        group: 'Spell Slot Ring',\n        i: 0,\n      },\n      {\n        id: '3IAo8ZUu',\n        label: 'Spell Slot Numbers',\n        expression: '',\n        imgName: '',\n        imgSrc: '',\n        priority: 60,\n        config: {},\n        overlay: true,\n        alwaysOn: true,\n        disabled: false,\n        overlayConfig: {\n          id: '3IAo8ZUu',\n          parentID: '',\n          ui: true,\n          underlay: false,\n          bottom: false,\n          top: true,\n          inheritTint: false,\n          linkRotation: false,\n          animation: {\n            relative: false,\n            rotate: false,\n            duration: '5000',\n            clockwise: true,\n          },\n          linkMirror: false,\n          linkScale: false,\n          linkDimensionsX: false,\n          linkDimensionsY: false,\n          linkOpacity: false,\n          linkStageScale: false,\n          loop: true,\n          playOnce: false,\n          img: '',\n          repeating: false,\n          alpha: '1',\n          tint: '',\n          interpolateColor: {\n            color2: '',\n            prc: '',\n          },\n          width: '{{object.w}} * @Scale',\n          height: '{{object.w}} * @Scale',\n          scaleX: '1',\n          scaleY: '1',\n          angle: '1',\n          offsetX: '0',\n          offsetY: '0.009',\n          anchor: {\n            x: 0.5,\n            y: 0.5,\n          },\n          filter: 'NONE',\n          alwaysVisible: false,\n          limitedToOwner: true,\n          limitedUsers: [],\n          limitOnHover: true,\n          limitOnHighlight: false,\n          limitOnControl: false,\n          limitOnEffect: '',\n          limitOnProperty: '',\n          text: {\n            text: '4455566778911112223334',\n            repeating: false,\n            fontFamily: 'Signika',\n            fill: '#ffffff',\n            interpolateColor: {\n              color2: '',\n              prc: '',\n            },\n            fontSize: '45',\n            align: 'left',\n            letterSpacing: '41.5',\n            dropShadow: null,\n            strokeThickness: '4',\n            stroke: '#111111',\n            wordWrap: false,\n            wordWrapWidth: '200',\n            breakWords: false,\n            maxHeight: '0',\n            curve: {\n              angle: '360',\n              radius: '220',\n              invert: false,\n            },\n          },\n          variables: [\n            {\n              name: 'Scale',\n              value: '1.85',\n            },\n          ],\n          effect: '',\n          label: 'Spell Slot Numbers',\n        },\n        group: 'Spell Slot Ring',\n        i: 1,\n      },\n    ],\n    id: 'FeFzTjjE',\n  },\n];\n","import { FEATURE_CONTROL, TVA_CONFIG, getFlagMappings, updateSettings } from '../settings.js';\nimport {\n  applyCEEffect,\n  applyTMFXPreset,\n  determineAddedRemovedEffects,\n  executeMacro,\n  EXPRESSION_OPERATORS,\n  getAllActorTokens,\n  getFileName,\n  mergeMappings,\n  tv_executeScript,\n  updateTokenImage,\n} from '../utils.js';\nimport { broadcastDrawOverlays, drawOverlays } from '../token/overlay.js';\nimport { registerHook, unregisterHook } from './hooks.js';\nimport { CORE_TEMPLATES } from '../mappingTemplates.js';\n\nconst EXPRESSION_MATCH_RE = /(\\\\\\()|(\\\\\\))|(\\|\\|)|(\\&\\&)|(\\\\\\!)/g;\nconst PF2E_ITEM_TYPES = ['condition', 'effect', 'weapon', 'equipment'];\nconst ITEM_TYPES = ['equipment', 'weapon'];\nconst feature_id = 'EffectMappings';\n\nexport function registerEffectMappingHooks() {\n  if (!FEATURE_CONTROL[feature_id]) {\n    [\n      'canvasReady',\n      'createActiveEffect',\n      'deleteActiveEffect',\n      'preUpdateActiveEffect',\n      'updateActiveEffect',\n      'createCombatant',\n      'deleteCombatant',\n      'preUpdateCombat',\n      'updateCombat',\n      'deleteCombat',\n      'preUpdateToken',\n      'preUpdateActor',\n      'updateActor',\n      'updateToken',\n      'createToken',\n      'preUpdateItem',\n      'updateItem',\n      'createItem',\n      'deleteItem',\n    ].forEach((name) => unregisterHook(feature_id, name));\n    return;\n  }\n\n  if (game.user.isGM) {\n    registerHook(feature_id, 'canvasReady', _refreshTokenMappings);\n    _refreshTokenMappings();\n  }\n\n  registerHook(feature_id, 'createActiveEffect', (activeEffect, options, userId) => {\n    if (activeEffect.disabled || game.userId !== userId) return;\n    const effectName = activeEffect.name ?? activeEffect.label;\n    _updateImageOnEffectChange(effectName, activeEffect, true);\n  });\n  registerHook(feature_id, 'deleteActiveEffect', (activeEffect, options, userId) => {\n    if (activeEffect.disabled || game.userId !== userId) return;\n    const effectName = activeEffect.name ?? activeEffect.label;\n    _updateImageOnEffectChange(effectName, activeEffect, false);\n  });\n  registerHook(feature_id, 'preUpdateActiveEffect', _preUpdateActiveEffect);\n  registerHook(feature_id, 'updateActiveEffect', _updateActiveEffect);\n  registerHook(feature_id, 'preUpdateToken', _preUpdateToken);\n  registerHook(feature_id, 'preUpdateActor', _preUpdateActor);\n  registerHook(feature_id, 'updateActor', _updateActor);\n  registerHook(feature_id, 'updateToken', _updateToken);\n  registerHook(feature_id, 'createToken', _createToken);\n  registerHook(feature_id, 'createCombatant', _createCombatant);\n  registerHook(feature_id, 'deleteCombatant', (combatant, options, userId) => {\n    if (game.userId !== userId) return;\n    _deleteCombatant(combatant);\n  });\n  registerHook(feature_id, 'preUpdateCombat', _preUpdateCombat);\n  registerHook(feature_id, 'updateCombat', _updateCombat);\n  registerHook(feature_id, 'deleteCombat', (combat, options, userId) => {\n    if (game.userId !== userId) return;\n    combat.combatants.forEach((combatant) => {\n      _deleteCombatant(combatant);\n    });\n  });\n\n  const applicable_item_types = game.system.id === 'pf2e' ? PF2E_ITEM_TYPES : ITEM_TYPES;\n  // Want to track condition/effect previous name so that the config can be reverted for it\n  registerHook(feature_id, 'preUpdateItem', (item, change, options, userId) => {\n    if (game.user.id === userId && applicable_item_types.includes(item.type)) {\n      options['token-variants-old-name'] = item.name;\n    }\n    _preUpdateAssign(getActorParent(item), change, options);\n  });\n\n  registerHook(feature_id, 'createItem', (item, options, userId) => {\n    if (game.userId !== userId || !applicable_item_types.includes(item.type)) return;\n    _updateImageOnEffectChange(item.name, item, true);\n  });\n\n  registerHook(feature_id, 'deleteItem', (item, options, userId) => {\n    if (game.userId !== userId || !applicable_item_types.includes(item.type) || item.disabled) return;\n    _updateImageOnEffectChange(item.name, item, false);\n  });\n\n  // Status Effects can be applied \"stealthily\" on item equip/un-equip\n  registerHook(feature_id, 'updateItem', _updateItem);\n}\n\nasync function _refreshTokenMappings() {\n  for (const tkn of canvas.tokens.placeables) {\n    await updateWithEffectMapping(tkn);\n  }\n}\n\nfunction _createCombatant(combatant, options, userId) {\n  if (game.userId !== userId) return;\n  const token = combatant._token || canvas.tokens.get(combatant.tokenId);\n  if (!token || !token.actor) return;\n\n  updateWithEffectMapping(token, {\n    added: ['token-variants-combat'],\n  });\n}\n\nfunction _preUpdateActiveEffect(activeEffect, change, options, userId) {\n  if (game.userId !== userId || !getActorParent(activeEffect)) return;\n\n  if ('name' in change) {\n    options['token-variants-old-name'] = activeEffect.name;\n  }\n}\n\nfunction _updateActiveEffect(activeEffect, change, options, userId) {\n  if (game.userId !== userId || !getActorParent(activeEffect)) return;\n\n  const added = [];\n  const removed = [];\n\n  if ('disabled' in change) {\n    if (change.disabled) removed.push(activeEffect.name);\n    else added.push(activeEffect.name);\n  }\n  if ('name' in change) {\n    removed.push(options['token-variants-old-name']);\n    added.push(change.name);\n  }\n\n  if (added.length || removed.length) {\n    _updateImageOnMultiEffectChange(getActorParent(activeEffect), added, removed);\n  }\n}\n\nfunction _preUpdateToken(token, change, options, userId) {\n  if (game.user.id !== userId || (change.actorId && token.actorId !== change.actorId)) return;\n  const preUpdateEffects = getTokenEffects(token, true);\n  if (preUpdateEffects.length) {\n    foundry.utils.setProperty(options, 'token-variants.preUpdateEffects', preUpdateEffects);\n  }\n\n  if (game.system.id === 'dnd5e' && token.actor?.isPolymorphed) {\n    foundry.utils.setProperty(options, 'token-variants.wasPolymorphed', true);\n  }\n}\n\nasync function _updateToken(token, change, options, userId) {\n  if (game.user.id !== userId || change.actorId) return;\n\n  // TODO\n  token.object?.tvaOverlays?.forEach((ov) => ov.htmlOverlay?.render());\n\n  const addedEffects = new Set();\n  const removedEffects = new Set();\n  const preUpdateEffects = foundry.utils.getProperty(options, 'token-variants.preUpdateEffects') || [];\n  const postUpdateEffects = getTokenEffects(token, true);\n  determineAddedRemovedEffects(addedEffects, removedEffects, postUpdateEffects, preUpdateEffects);\n\n  if (addedEffects.size || removedEffects.size || 'actorLink' in change) {\n    updateWithEffectMapping(token, { added: Array.from(addedEffects), removed: Array.from(removedEffects) });\n  } else if (foundry.utils.getProperty(options, 'token-variants.wasPolymorphed') && !token.actor?.isPolymorphed) {\n    updateWithEffectMapping(token);\n  }\n\n  if (game.userId === userId && 'hidden' in change) {\n    updateWithEffectMapping(token, {\n      added: change.hidden ? ['token-variants-visibility'] : [],\n      removed: !change.hidden ? ['token-variants-visibility'] : [],\n    });\n  }\n}\n\nfunction _preUpdateActor(actor, change, options, userId) {\n  if (game.user.id !== userId) return;\n  _preUpdateAssign(actor, change, options);\n}\n\nasync function _updateActor(actor, change, options, userId) {\n  if (game.user.id !== userId) return;\n\n  if ('flags' in change && 'token-variants' in change.flags) {\n    const tokenVariantFlags = change.flags['token-variants'];\n    if ('effectMappings' in tokenVariantFlags || '-=effectMappings' in tokenVariantFlags) {\n      const tokens = actor.token ? [actor.token] : getAllActorTokens(actor, true, false);\n      tokens.forEach((tkn) => updateWithEffectMapping(tkn));\n      for (const tkn of tokens) {\n        if (tkn.object && TVA_CONFIG.filterEffectIcons) {\n          await tkn.object.drawEffects();\n        }\n      }\n    }\n  }\n\n  _preUpdateCheck(actor, options);\n}\n\nfunction _preUpdateAssign(actor, change, options) {\n  if (!actor) return;\n\n  // Determine which comparators are applicable so that we can compare after the\n  // actor update\n  const tokens = actor.token ? [actor.token] : getAllActorTokens(actor, true, false);\n  if (TVA_CONFIG.internalEffects.hpChange.enabled && tokens.length) {\n    applyHpChangeEffect(actor, change, tokens);\n  }\n  for (const tkn of tokens) {\n    const preUpdateEffects = getTokenEffects(tkn, true);\n\n    if (preUpdateEffects.length) {\n      foundry.utils.setProperty(options, 'token-variants.' + tkn.id + '.preUpdateEffects', preUpdateEffects);\n    }\n  }\n}\n\nfunction _preUpdateCheck(actor, options, pAdded = [], pRemoved = []) {\n  if (!actor) return;\n  const tokens = actor.token ? [actor.token] : getAllActorTokens(actor, true, false);\n  for (const tkn of tokens) {\n    // Check if effects changed by comparing them against the ones calculated in preUpdate*\n    const added = new Set([...pAdded]);\n    const removed = new Set([...pRemoved]);\n    const postUpdateEffects = getTokenEffects(tkn, true);\n    const preUpdateEffects = foundry.utils.getProperty(options, 'token-variants.' + tkn.id + '.preUpdateEffects') ?? [];\n\n    determineAddedRemovedEffects(added, removed, postUpdateEffects, preUpdateEffects);\n    if (added.size || removed.size)\n      updateWithEffectMapping(tkn, { added: Array.from(added), removed: Array.from(removed) });\n  }\n}\n\nfunction _createToken(token, options, userId) {\n  if (userId && userId === game.user.id) updateWithEffectMapping(token);\n}\n\nfunction _preUpdateCombat(combat, round, options, userId) {\n  if (game.userId !== userId) return;\n  options['token-variants'] = {\n    combatantId: combat?.combatant?.token?.id,\n    nextCombatantId: combat?.nextCombatant?.token?.id,\n  };\n}\n\nfunction _updateCombat(combat, round, options, userId) {\n  if (game.userId !== userId) return;\n\n  const previousCombatantId = options['token-variants']?.combatantId;\n  const previousNextCombatantId = options['token-variants']?.nextCombatantId;\n\n  const currentCombatantId = combat?.combatant?.token?.id;\n  const currentNextCombatantId = combat?.nextCombatant?.token?.id;\n\n  const updateCombatant = function (id, added = [], removed = []) {\n    if (game.user.isGM) {\n      const token = canvas.tokens.get(id);\n      if (token) updateWithEffectMapping(token, { added, removed });\n    } else {\n      const message = {\n        handlerName: 'effectMappings',\n        args: { tokenId: id, sceneId: canvas.scene.id, added, removed },\n        type: 'UPDATE',\n      };\n      game.socket?.emit('module.token-variants', message);\n    }\n  };\n\n  if (previousCombatantId !== currentCombatantId) {\n    if (previousCombatantId) updateCombatant(previousCombatantId, [], ['combat-turn']);\n    if (currentCombatantId) updateCombatant(currentCombatantId, ['combat-turn'], []);\n  }\n  if (previousNextCombatantId !== currentNextCombatantId) {\n    if (previousNextCombatantId) updateCombatant(previousNextCombatantId, [], ['combat-turn-next']);\n    if (currentNextCombatantId) updateCombatant(currentNextCombatantId, ['combat-turn-next'], []);\n  }\n}\n\nfunction _updateItem(item, change, options, userId) {\n  const added = [];\n  const removed = [];\n\n  if (game.user.id === userId) {\n    // Handle condition/effect name change\n    if (options['token-variants-old-name'] != null && options['token-variants-old-name'] !== item.name) {\n      added.push(item.name);\n      removed.push(options['token-variants-old-name']);\n    }\n\n    _preUpdateCheck(getActorParent(item), options, added, removed);\n  }\n}\n\nlet EFFECT_M_QUEUES = {};\nlet EFFECT_M_TIMER;\n\nexport async function updateWithEffectMapping(token, { added = [], removed = [] } = {}) {\n  const callUpdateWithEffectMapping = function () {\n    for (const id of Object.keys(EFFECT_M_QUEUES)) {\n      const m = EFFECT_M_QUEUES[id];\n      _updateWithEffectMapping(m.token, m.opts.added, m.opts.removed);\n    }\n    EFFECT_M_QUEUES = {};\n  };\n\n  clearTimeout(EFFECT_M_TIMER);\n\n  if (token.id in EFFECT_M_QUEUES) {\n    const opts = EFFECT_M_QUEUES[token.id].opts;\n    added.forEach((a) => opts.added.add(a));\n    removed.forEach((a) => opts.removed.add(a));\n  } else {\n    EFFECT_M_QUEUES[token.id] = {\n      token,\n      opts: { added: new Set(added), removed: new Set(removed) },\n    };\n  }\n  EFFECT_M_TIMER = setTimeout(callUpdateWithEffectMapping, 100);\n}\n\nasync function _updateWithEffectMapping(token, added, removed) {\n  const placeable = token.object ?? token._object ?? token;\n  token = token.document ?? token;\n\n  const tokenImgName = token.getFlag('token-variants', 'name') || getFileName(token.texture.src);\n  let tokenDefaultImg = token.getFlag('token-variants', 'defaultImg');\n  const animate = !TVA_CONFIG.disableTokenUpdateAnimation;\n  const tokenUpdateObj = {};\n  const hadActiveHUD = token.object?.hasActiveHUD;\n  const toggleStatus = canvas.tokens.hud.object?.id === token.id ? canvas.tokens.hud._statusEffects : false;\n\n  let effects = getTokenEffects(token);\n\n  // If effect is included in `added` or `removed` we need to:\n  // 1. Insert it into `effects` if it's not there in case of 'added' and place it on top of the list\n  // 2. Remove it in case of 'removed'\n  for (const ef of added) {\n    const i = effects.findIndex((s) => s === ef);\n    if (i === -1) {\n      effects.push(ef);\n    } else if (i < effects.length - 1) {\n      effects.splice(i, 1);\n      effects.push(ef);\n    }\n  }\n  for (const ef of removed) {\n    const i = effects.findIndex((s) => s === ef);\n    if (i !== -1) {\n      effects.splice(i, 1);\n    }\n  }\n\n  const mappings = getAllEffectMappings(token);\n\n  // 3. Configurations may contain effect names in a form of a logical expressions\n  //    We need to evaluate them and insert them into effects/added/removed if needed\n  for (const mapping of mappings) {\n    evaluateMappingExpression(mapping, effects, token, added, removed);\n  }\n\n  // Accumulate all scripts that will need to be run after the update\n  const executeOnCallback = [];\n  const deferredUpdateScripts = [];\n  for (const ef of removed) {\n    const script = mappings.find((m) => m.id === ef)?.config?.tv_script;\n    if (script) {\n      if (script.onRemove) {\n        if (script.onRemove.includes('tvaUpdate')) deferredUpdateScripts.push(script.onRemove);\n        else executeOnCallback.push({ script: script.onRemove, token });\n      }\n      if (script.tmfxPreset) executeOnCallback.push({ tmfxPreset: script.tmfxPreset, token, action: 'remove' });\n      if (script.ceEffect?.name) executeOnCallback.push({ ceEffect: script.ceEffect, token, action: 'remove' });\n      if (script.macroOnApply) executeOnCallback.push({ macro: script.macroOnApply, token });\n    }\n  }\n  for (const ef of added) {\n    const script = mappings.find((m) => m.id === ef)?.config?.tv_script;\n    if (script) {\n      if (script.onApply) {\n        if (script.onApply.includes('tvaUpdate')) deferredUpdateScripts.push(script.onApply);\n        else executeOnCallback.push({ script: script.onApply, token });\n      }\n      if (script.tmfxPreset) executeOnCallback.push({ tmfxPreset: script.tmfxPreset, token, action: 'apply' });\n      if (script.ceEffect?.name) executeOnCallback.push({ ceEffect: script.ceEffect, token, action: 'apply' });\n      if (script.macroOnRemove) executeOnCallback.push({ macro: script.macroOnRemove, token });\n    }\n  }\n\n  // Next we're going to determine what configs need to be applied and in what order\n  // Filter effects that do not have a mapping and sort based on priority\n  effects = mappings.filter((m) => effects.includes(m.id)).sort((ef1, ef2) => ef1.priority - ef2.priority);\n\n  // Check if image update should be prevented based on module settings\n  let disableImageUpdate = false;\n  if (TVA_CONFIG.disableImageChangeOnPolymorphed && token.actor?.isPolymorphed) {\n    disableImageUpdate = true;\n  } else if (\n    TVA_CONFIG.disableImageUpdateOnNonPrototype &&\n    token.actor?.prototypeToken?.texture?.src !== token.texture.src\n  ) {\n    disableImageUpdate = true;\n    const tknImg = token.texture.src;\n    for (const m of mappings) {\n      if (m.imgSrc === tknImg) {\n        disableImageUpdate = false;\n        break;\n      }\n    }\n  }\n\n  if (disableImageUpdate) {\n    tokenDefaultImg = '';\n  }\n\n  let updateCall;\n\n  if (effects.length > 0) {\n    // Some effect mappings may not have images, find a mapping with one if it exists\n    const newImg = { imgSrc: '', imgName: '' };\n\n    if (!disableImageUpdate) {\n      for (let i = effects.length - 1; i >= 0; i--) {\n        if (effects[i].imgSrc) {\n          let iSrc = effects[i].imgSrc;\n          if (iSrc.includes('*') || (iSrc.includes('{') && iSrc.includes('}'))) {\n            // wildcard image, if this effect hasn't been newly applied we do not want to randomize the image again\n            if (!added.has(effects[i].overlayConfig?.effect)) {\n              newImg.imgSrc = token.texture.src;\n              newImg.imgName = getFileName(newImg.imgSrc);\n              break;\n            }\n          }\n          newImg.imgSrc = effects[i].imgSrc;\n          newImg.imgName = effects[i].imgName;\n          break;\n        }\n      }\n    }\n\n    // Collect custom configs to be applied to the token\n    let config;\n    if (TVA_CONFIG.stackStatusConfig) {\n      config = {};\n      for (const ef of effects) {\n        config = foundry.utils.mergeObject(config, ef.config);\n      }\n    } else {\n      for (let i = effects.length - 1; i >= 0; i--) {\n        if (effects[i].config && Object.keys(effects[i].config).length !== 0) {\n          config = effects[i].config;\n          break;\n        }\n      }\n    }\n\n    // Use or update the default (original) token image\n    if (!newImg.imgSrc && tokenDefaultImg) {\n      delete tokenUpdateObj.flags?.['token-variants']?.defaultImg;\n      foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.-=defaultImg', null);\n      newImg.imgSrc = tokenDefaultImg.imgSrc;\n      newImg.imgName = tokenDefaultImg.imgName;\n    } else if (!tokenDefaultImg && newImg.imgSrc) {\n      foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.defaultImg', {\n        imgSrc: token.texture.src,\n        imgName: tokenImgName,\n      });\n    }\n\n    updateCall = () =>\n      updateTokenImage(newImg.imgSrc ?? null, {\n        token,\n        imgName: newImg.imgName ? newImg.imgName : tokenImgName,\n        tokenUpdate: tokenUpdateObj,\n        callback: _postTokenUpdateProcessing.bind(null, token, hadActiveHUD, toggleStatus, executeOnCallback),\n        config: config,\n        animate,\n      });\n  }\n\n  // If no mapping has been found and the default image (image prior to effect triggered update) is different from current one\n  // reset the token image back to default\n  if (effects.length === 0 && tokenDefaultImg) {\n    delete tokenUpdateObj.flags?.['token-variants']?.defaultImg;\n    foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.-=defaultImg', null);\n\n    updateCall = () =>\n      updateTokenImage(tokenDefaultImg.imgSrc, {\n        token,\n        imgName: tokenDefaultImg.imgName,\n        tokenUpdate: tokenUpdateObj,\n        callback: _postTokenUpdateProcessing.bind(null, token, hadActiveHUD, toggleStatus, executeOnCallback),\n        animate,\n      });\n    // If no default image exists but a custom effect is applied, we still want to perform an update to\n    // clear it\n  } else if (effects.length === 0 && token.getFlag('token-variants', 'usingCustomConfig')) {\n    updateCall = () =>\n      updateTokenImage(token.texture.src, {\n        token,\n        imgName: tokenImgName,\n        tokenUpdate: tokenUpdateObj,\n        callback: _postTokenUpdateProcessing.bind(null, token, hadActiveHUD, toggleStatus, executeOnCallback),\n        animate,\n      });\n  }\n\n  if (updateCall) {\n    if (deferredUpdateScripts.length) {\n      for (let i = 0; i < deferredUpdateScripts.length; i++) {\n        if (i === deferredUpdateScripts.length - 1) {\n          await tv_executeScript(deferredUpdateScripts[i], {\n            token,\n            tvaUpdate: () => {\n              updateCall();\n            },\n          });\n        } else {\n          await tv_executeScript(deferredUpdateScripts[i], {\n            token,\n            tvaUpdate: () => {},\n          });\n        }\n      }\n    } else {\n      updateCall();\n    }\n  } else {\n    if (executeOnCallback.length || deferredUpdateScripts.length) {\n      _postTokenUpdateProcessing(token, hadActiveHUD, toggleStatus, executeOnCallback);\n      _postTokenUpdateProcessing(token, hadActiveHUD, toggleStatus, deferredUpdateScripts);\n    }\n  }\n  broadcastDrawOverlays(placeable);\n}\n\nasync function _postTokenUpdateProcessing(token, hadActiveHUD, toggleStatus, scripts) {\n  if (hadActiveHUD && token.object) {\n    canvas.tokens.hud.bind(token.object);\n    if (toggleStatus) canvas.tokens.hud._toggleStatusEffects(true);\n  }\n  for (const scr of scripts) {\n    if (scr.script) {\n      await tv_executeScript(scr.script, { token: scr.token });\n    } else if (scr.tmfxPreset) {\n      await applyTMFXPreset(scr.token, scr.tmfxPreset, scr.action);\n    } else if (scr.ceEffect) {\n      await applyCEEffect(scr.token, scr.ceEffect, scr.action);\n    } else if (scr.macro) {\n      await executeMacro(scr.macro, token);\n    }\n  }\n}\n\nexport function getAllEffectMappings(token = null, includeDisabled = false) {\n  let allMappings = getFlagMappings(token);\n  const unique = new Set();\n\n  // TODO: replace with a setting\n  allMappings.forEach((m) => unique.add(TVA_CONFIG.mergeGroup ? m.group : m.label));\n\n  // Sort out global mappings that do not apply to this actor\n  let applicableGlobal = TVA_CONFIG.globalMappings;\n  if (token?.actor?.type) {\n    const actorType = token.actor.type;\n    applicableGlobal = applicableGlobal.filter((m) => {\n      if (!m.targetActors || m.targetActors.includes(actorType)) {\n        return !unique.has(TVA_CONFIG.mergeGroup ? m.group : m.label);\n      }\n      return false;\n    });\n  }\n  allMappings = allMappings.concat(applicableGlobal);\n\n  if (!includeDisabled) allMappings = allMappings.filter((m) => !m.disabled);\n\n  return allMappings;\n}\n\nexport async function setOverlayVisibility({\n  userName = null,\n  userId = null,\n  label = null,\n  group = null,\n  token = null,\n  visible = true,\n} = {}) {\n  if (!label && !group) return;\n  if (userName) userId = game.users.find((u) => u.name === userName)?.id;\n  if (!userId) return;\n\n  let tokenMappings = getFlagMappings(token);\n  let globalMappings = TVA_CONFIG.globalMappings;\n\n  let updateToken = false;\n  let updateGlobal = false;\n\n  const updateMappings = function (mappings) {\n    mappings = mappings.filter((m) => m.overlay && (m.label === label || m.group === group));\n    let found = false;\n    if (mappings.length) found = true;\n\n    mappings.forEach((m) => {\n      const overlayConfig = m.overlayConfig;\n      if (visible) {\n        if (!overlayConfig.limitedUsers) overlayConfig.limitedUsers = [];\n        if (!overlayConfig.limitedUsers.find((u) => u === userId)) overlayConfig.limitedUsers.push(userId);\n      } else if (overlayConfig.limitedUsers) {\n        overlayConfig.limitedUsers = overlayConfig.limitedUsers.filter((u) => u !== userId);\n      }\n    });\n    return found;\n  };\n\n  updateToken = updateMappings(tokenMappings);\n  updateGlobal = updateMappings(globalMappings);\n\n  if (updateGlobal) await updateSettings({ globalMappings: globalMappings });\n  if (updateToken) {\n    const actor = game.actors.get(token.document.actorId);\n    if (actor) await actor.setFlag('token-variants', 'effectMappings', tokenMappings);\n  }\n  if (updateToken || updateGlobal) drawOverlays(token);\n}\n\nfunction _getTemplateMappings(templateName) {\n  return (\n    TVA_CONFIG.templateMappings.find((t) => t.name === templateName) ??\n    CORE_TEMPLATES.find((t) => t.name === templateName)\n  )?.mappings;\n}\n\nexport async function applyTemplate(token, templateName = null, mappings = null) {\n  if (templateName) mappings = _getTemplateMappings(templateName);\n  if (!token || !mappings) return;\n\n  const actor = game.actors.get(token.actor.id);\n  if (!actor) return;\n  const templateMappings = foundry.utils.deepClone(mappings);\n  templateMappings.forEach((tm) => (tm.tokens = [token.id]));\n\n  const actMappings = mergeMappings(templateMappings, getFlagMappings(actor));\n  await actor.setFlag('token-variants', 'effectMappings', actMappings);\n  await updateWithEffectMapping(token);\n  drawOverlays(token);\n}\n\nexport async function removeTemplate(token, templateName = null, mappings = null) {\n  if (templateName) mappings = _getTemplateMappings(templateName);\n  if (!token || !mappings) return;\n\n  const actor = game.actors.get(token.actor.id);\n  if (!actor) return;\n\n  let actMappings = getFlagMappings(actor);\n  mappings.forEach((m) => {\n    let i = actMappings.findIndex((m2) => m2.id === m.id);\n    if (i !== -1) {\n      actMappings[i].tokens = actMappings[i].tokens.filter((t) => t !== token.id);\n      if (actMappings[i].tokens.length === 0) actMappings.splice(i, 1);\n    }\n  });\n\n  if (actMappings.length) await actor.setFlag('token-variants', 'effectMappings', actMappings);\n  else await actor.unsetFlag('token-variants', 'effectMappings');\n  await updateWithEffectMapping(token);\n  drawOverlays(token);\n}\n\nexport function toggleTemplate(token, templateName = null, mappings = null) {\n  if (templateName) mappings = _getTemplateMappings(templateName);\n  if (!token || !mappings) return;\n\n  const actor = game.actors.get(token.actor.id);\n  if (!actor) return;\n\n  const actMappings = getFlagMappings(actor);\n  if (actMappings.some((m) => mappings.some((m2) => m2.id === m.id && m.tokens?.includes(token.id)))) {\n    removeTemplate(token, null, mappings);\n  } else {\n    applyTemplate(token, null, mappings);\n  }\n}\n\nexport function toggleTemplateOnSelected(templateName = null, mappings = null) {\n  canvas.tokens.controlled.forEach((t) => toggleTemplate(t, templateName, mappings));\n}\n\nfunction getHPChangeEffect(token, effects) {\n  const internals = token.actor?.getFlag('token-variants', 'internalEffects') || {};\n  const delta = foundry.utils.getProperty(token, 'delta.flags.token-variants.internalEffects');\n  if (delta) foundry.utils.mergeObject(internals, delta);\n  if (internals['hp--'] != null) effects.push('hp--');\n  if (internals['hp++'] != null) effects.push('hp++');\n}\n\nfunction applyHpChangeEffect(actor, change, tokens) {\n  let duration = Number(TVA_CONFIG.internalEffects.hpChange.duration);\n\n  const newHpValue = foundry.utils.getProperty(change, `system.${TVA_CONFIG.systemHpPath}.value`);\n  if (newHpValue != null) {\n    const [currentHpVal, _] = getTokenHP(tokens[0]);\n    if (currentHpVal !== newHpValue) {\n      if (currentHpVal < newHpValue) {\n        foundry.utils.setProperty(change, 'flags.token-variants.internalEffects.-=hp--', null);\n        foundry.utils.setProperty(change, 'flags.token-variants.internalEffects.hp++', newHpValue - currentHpVal);\n        if (duration) {\n          setTimeout(() => {\n            actor.update({\n              'flags.token-variants.internalEffects.-=hp++': null,\n            });\n          }, duration * 1000);\n        }\n      } else {\n        foundry.utils.setProperty(change, 'flags.token-variants.internalEffects.-=hp++', null);\n        foundry.utils.setProperty(change, 'flags.token-variants.internalEffects.hp--', newHpValue - currentHpVal);\n        if (duration) {\n          setTimeout(() => {\n            actor.update({\n              'flags.token-variants.internalEffects.-=hp--': null,\n            });\n          }, duration * 1000);\n        }\n      }\n    }\n  }\n}\n\nexport function getTokenEffects(token, includeExpressions = false) {\n  const tokenDoc = token.document ?? token;\n  let effects = [];\n\n  // TVA Effects\n  const tokenInCombat = game.combats.some((combat) => {\n    return combat.combatants.some((c) => c.tokenId === tokenDoc.id);\n  });\n  if (tokenInCombat) {\n    effects.push('token-variants-combat');\n  }\n\n  if (game.combat?.started) {\n    if (game.combat?.combatant?.token?.id === tokenDoc.id) {\n      effects.push('combat-turn');\n    } else if (game.combat?.nextCombatant?.token?.id === tokenDoc.id) {\n      effects.push('combat-turn-next');\n    }\n  }\n  if (tokenDoc.hidden) {\n    effects.push('token-variants-visibility');\n  }\n\n  if (TVA_CONFIG.internalEffects.hpChange.enabled) {\n    getHPChangeEffect(tokenDoc, effects);\n  }\n\n  // Actor/Token effects\n  if (tokenDoc.actorLink) {\n    getEffectsFromActor(tokenDoc.actor, effects);\n  } else {\n    if (game.system.id === 'pf2e') {\n      (tokenDoc.delta?.items || []).forEach((item) => {\n        if (_activePF2EItem(item)) {\n          effects.push(item.name);\n        }\n      });\n    } else {\n      (tokenDoc.actor?.effects || [])\n        .filter((ef) => !ef.disabled && !ef.isSuppressed)\n        .forEach((ef) => effects.push(ef.name));\n      getEffectsFromActor(tokenDoc.actor, effects);\n    }\n  }\n\n  // Expression/Mapping effects\n  evaluateComparatorEffects(tokenDoc, effects);\n  evaluateStateEffects(tokenDoc, effects);\n\n  // Include mappings marked as always applicable\n  // as well as the ones defined as logical expressions if needed\n  const mappings = getAllEffectMappings(tokenDoc);\n\n  for (const m of mappings) {\n    if (m.tokens?.length && !m.tokens.includes(data.id)) continue;\n    if (m.alwaysOn) effects.unshift(m.id);\n    else if (includeExpressions) {\n      const evaluation = evaluateMappingExpression(m, effects, tokenDoc);\n      if (evaluation) effects.unshift(m.id);\n    }\n  }\n\n  return effects;\n}\n\nexport function getEffectsFromActor(actor, effects = []) {\n  if (!actor) return effects;\n\n  if (game.system.id === 'pf2e') {\n    (actor.items || []).forEach((item, id) => {\n      if (_activePF2EItem(item)) effects.push(item.name);\n    });\n  } else {\n    (actor.effects || []).forEach((activeEffect, id) => {\n      if (!activeEffect.disabled && !activeEffect.isSuppressed) effects.push(activeEffect.name ?? activeEffect.label);\n    });\n\n    if (game.system.id === 'dnd5e') {\n      (actor.temporaryEffects || []).forEach((activeEffect, id) => {\n        if (!activeEffect.disabled && !activeEffect.isSuppressed) effects.push(activeEffect.name ?? activeEffect.label);\n      });\n    }\n\n    if (game.system.id === 'shadowrun5e') {\n      (actor.items || []).forEach((item) => {\n        if (\n          ['weapon', 'armor', 'bioware', 'cyberware', 'device', 'equipment'].includes(item.type) &&\n          item.system.technology.equipped\n        )\n          effects.push(item.name);\n      });\n    } else {\n      (actor.items || []).forEach((item) => {\n        if (ITEM_TYPES.includes(item.type) && item.system.equipped) effects.push(item.name ?? item.label);\n      });\n    }\n  }\n\n  return effects;\n}\n\nfunction _activePF2EItem(item) {\n  if (PF2E_ITEM_TYPES.includes(item.type)) {\n    if ('active' in item) {\n      return item.active;\n    } else if ('isEquipped' in item) {\n      return item.isEquipped;\n    } else {\n      return true;\n    }\n  }\n  return false;\n}\n\nexport const VALID_EXPRESSION = new RegExp('([a-zA-Z0-9\\\\-\\\\.\\\\+]+)([><=]+)(\".*\"|-?\\\\d+)(%{0,1})');\n\nexport function evaluateComparator(token, expression) {\n  const match = expression.match(VALID_EXPRESSION);\n  if (match) {\n    const property = match[1];\n\n    let currVal;\n    let maxVal;\n    if (property === 'hp') {\n      [currVal, maxVal] = getTokenHP(token);\n    } else if (property === 'hp++' || property === 'hp--') {\n      [currVal, maxVal] = getTokenHP(token);\n      currVal = foundry.utils.getProperty(token, `actor.flags.token-variants.internalEffects.${property}`) ?? 0;\n    } else currVal = foundry.utils.getProperty(token._source, property);\n\n    if (currVal == null) currVal = foundry.utils.getProperty(token, property);\n    if (currVal == null) currVal = 0;\n\n    const sign = match[2];\n    let val = Number(match[3]);\n    if (isNaN(val)) {\n      val = match[3].substring(1, match[3].length - 1);\n      if (val === 'true') val = true;\n      if (val === 'false') val = false;\n      // Convert currVal to a truthy/falsy one if this is a bool check\n      if (val === true || val === false) {\n        if (foundry.utils.isEmpty(currVal)) currVal = false;\n        else currVal = Boolean(currVal);\n      }\n    }\n    const isPercentage = Boolean(match[4]);\n\n    if (property === 'rotation') {\n      maxVal = 360;\n    } else if (maxVal == null) {\n      maxVal = 999999;\n    }\n    const toCompare = isPercentage ? (currVal / maxVal) * 100 : currVal;\n\n    let passed = false;\n    if (sign === '=') {\n      passed = toCompare == val;\n    } else if (sign === '>') {\n      passed = toCompare > val;\n    } else if (sign === '<') {\n      passed = toCompare < val;\n    } else if (sign === '>=') {\n      passed = toCompare >= val;\n    } else if (sign === '<=') {\n      passed = toCompare <= val;\n    } else if (sign === '<>') {\n      passed = toCompare < val || toCompare > val;\n    }\n    return passed;\n  }\n  return false;\n}\n\nexport function evaluateComparatorEffects(token, effects = []) {\n  token = token.document ?? token;\n\n  const mappings = getAllEffectMappings(token);\n\n  const matched = new Set();\n\n  for (const m of mappings) {\n    const expressions = m.expression\n      .split(EXPRESSION_MATCH_RE)\n      .filter(Boolean)\n      .map((exp) => exp.trim())\n      .filter(Boolean);\n    for (let i = 0; i < expressions.length; i++) {\n      if (evaluateComparator(token, expressions[i])) {\n        matched.add(expressions[i]);\n      }\n    }\n  }\n\n  // Remove duplicate expressions and insert into effects\n  matched.forEach((exp) => effects.unshift(exp));\n\n  return effects;\n}\n\nexport function evaluateStateEffects(token, effects) {\n  if (game.system.id === 'pf2e') {\n    if ((token.document ?? token).actor?.effects.some((ef) => ef.statuses.has('dead'))) effects.push('Dead');\n  }\n}\n\n/**\n * Replaces {1,a,5,b} type string in the expressions with (1|a|5|b)\n * @param {*} exp\n * @returns\n */\nfunction _findReplaceBracketWildcard(exp) {\n  let nExp = '';\n  let lIndex = 0;\n  while (lIndex >= 0) {\n    let i1 = exp.indexOf('\\\\\\\\\\\\{', lIndex);\n    if (i1 !== -1) {\n      let i2 = exp.indexOf('\\\\\\\\\\\\}', i1);\n      if (i2 !== -1) {\n        nExp += exp.substring(lIndex, i1);\n        nExp +=\n          '(' +\n          exp\n            .substring(i1 + 4, i2)\n            .split(',')\n            .join('|') +\n          ')';\n      }\n      lIndex = i2 + 4;\n    } else {\n      return nExp + exp.substring(lIndex, exp.length);\n    }\n  }\n  return nExp ?? exp;\n}\n\nfunction _testRegExEffect(effect, effects) {\n  let re = effect.replace(/[/\\-\\\\^$+?.()|[\\]{}]/g, '\\\\$&').replaceAll('\\\\\\\\*', '.*');\n  re = _findReplaceBracketWildcard(re);\n  re = new RegExp('^' + re + '$');\n  return effects.find((ef) => re.test(ef));\n}\n\nexport function evaluateMappingExpression(mapping, effects, token, added = new Set(), removed = new Set()) {\n  let arrExpression = mapping.expression\n    .split(EXPRESSION_MATCH_RE)\n    .filter(Boolean)\n    .map((s) => s.trim())\n    .filter(Boolean);\n\n  let temp = '';\n  let hasAdded = false;\n  let hasRemoved = false;\n  for (let exp of arrExpression) {\n    if (EXPRESSION_OPERATORS.includes(exp)) {\n      temp += exp.replace('\\\\', '');\n      continue;\n    }\n\n    if (/\\\\\\*|\\\\{.*\\\\}/g.test(exp)) {\n      let rExp = _testRegExEffect(exp, effects);\n      if (rExp) {\n        temp += 'true';\n      } else {\n        temp += 'false';\n      }\n\n      if (_testRegExEffect(exp, added)) hasAdded = true;\n      else if (_testRegExEffect(exp, removed)) hasRemoved = true;\n      continue;\n    } else if (effects.includes(exp)) {\n      temp += 'true';\n    } else {\n      temp += 'false';\n    }\n\n    if (!hasAdded && added.has(exp)) hasAdded = true;\n    if (!hasRemoved && removed.has(exp)) hasRemoved = true;\n  }\n\n  try {\n    let evaluation = eval(temp);\n\n    // Evaluate JS code\n    if (mapping.codeExp) {\n      try {\n        token = token.document ?? token;\n        if (!eval(mapping.codeExp)) evaluation = false;\n        else if (!mapping.expression) evaluation = true;\n      } catch (e) {\n        evaluation = false;\n      }\n    }\n\n    if (evaluation) {\n      if (hasAdded || hasRemoved) {\n        added.add(mapping.id);\n        effects.push(mapping.id);\n      } else effects.unshift(mapping.id);\n    } else if (hasRemoved || hasAdded) {\n      removed.add(mapping.id);\n    }\n    return evaluation;\n  } catch (e) {}\n  return false;\n}\n\nexport function getTokenHP(token) {\n  let attributes;\n\n  if (token.actorLink) {\n    attributes = foundry.utils.getProperty(token.actor?.system, TVA_CONFIG.systemHpPath);\n  } else {\n    attributes = foundry.utils.mergeObject(\n      foundry.utils.getProperty(token.actor?.system, TVA_CONFIG.systemHpPath) || {},\n      foundry.utils.getProperty(token.delta?.system) || {},\n      {\n        inplace: false,\n      }\n    );\n  }\n\n  return [attributes?.value, attributes?.max];\n}\n\nasync function _updateImageOnEffectChange(effectName, source, added = true) {\n  const actor = getActorParent(source);\n  if (!actor) return;\n  const tokens = actor.token ? [actor.token] : getAllActorTokens(actor, true, false);\n  for (const token of tokens) {\n    await updateWithEffectMapping(token, {\n      added: added ? [effectName] : [],\n      removed: !added ? [effectName] : [],\n    });\n  }\n}\n\nfunction getActorParent(ent) {\n  while (ent && !(ent instanceof Actor)) ent = ent.parent;\n  return ent;\n}\n\nasync function _updateImageOnMultiEffectChange(actor, added = [], removed = []) {\n  if (!actor) return;\n  const tokens = actor.token ? [actor.token] : getAllActorTokens(actor, true, false);\n  for (const token of tokens) {\n    await updateWithEffectMapping(token, {\n      added: added,\n      removed: removed,\n    });\n  }\n}\n\nasync function _deleteCombatant(combatant) {\n  const token = combatant._token || canvas.tokens.get(combatant.tokenId);\n  if (!token || !token.actor) return;\n  await updateWithEffectMapping(token, {\n    removed: ['token-variants-combat'],\n  });\n}\n","import { TVA_CONFIG } from '../settings.js';\nimport { decodeURISafely } from '../utils.js';\nimport { registerWrapper } from './wrappers.js';\n\nconst feature_id = 'UserMappings';\n\nexport function registerUserMappingWrappers() {\n  registerWrapper(feature_id, 'Tile.prototype.draw', _draw);\n  registerWrapper(feature_id, 'Token.prototype.draw', _draw);\n}\n\nasync function _draw(wrapped, ...args) {\n  let result;\n\n  // If the Token/Tile has a UserToImage mappings momentarily set document.texture.src to it\n  // so that it's texture gets loaded instead of the actual Token image\n  const mappings = this.document.getFlag('token-variants', 'userMappings') || {};\n  const img = mappings[game.userId];\n  let previous;\n  if (img) {\n    previous = this.document.texture.src;\n    this.document.texture.src = img;\n    this.tva_iconOverride = img;\n    result = await wrapped(...args);\n    this.document.texture.src = previous;\n    overrideVisibility(this, img);\n  } else {\n    overrideVisibility(this);\n    result = await wrapped(...args);\n  }\n\n  return result;\n}\n\n/**\n * If the img is the same as TVA_CONFIG.invisibleImage then we'll override the isVisible\n * getter to return false of this client if it's not a GM. Reset it to default if not.\n * @param {*} obj object whose isVisible is to be overriden\n * @param {*} img UserToImage mapping\n */\nfunction overrideVisibility(obj, img) {\n  if (img && decodeURISafely(img) === TVA_CONFIG.invisibleImage && !obj.tva_customVisibility) {\n    const originalIsVisible = _getIsVisibleDescriptor(obj).get;\n    Object.defineProperty(obj, 'isVisible', {\n      get: function () {\n        const isVisible = originalIsVisible.call(this);\n        if (isVisible && !game.user.isGM) return false;\n        return isVisible;\n      },\n      configurable: true,\n    });\n    obj.tva_customVisibility = true;\n  } else if (!img && obj.tva_customVisibility) {\n    Object.defineProperty(obj, 'isVisible', _getIsVisibleDescriptor(obj));\n    delete obj.tva_customVisibility;\n  }\n}\n\nfunction _getIsVisibleDescriptor(obj) {\n  let iObj = Object.getPrototypeOf(obj);\n  let descriptor = null;\n  while (iObj) {\n    descriptor = Object.getOwnPropertyDescriptor(iObj, 'isVisible');\n    if (descriptor) break;\n    iObj = Object.getPrototypeOf(iObj);\n  }\n  return descriptor;\n}\n\n/**\n * Assign an image to be displayed to only that user.\n * @param {*} token token the image is to be applied to\n * @param {*} img image to be displayed, if no image is provided unassignUserSpecificImage(...) will be called\n * @param {*} opts.userName name of the user that the image is to be displayed to\n * @param {*} opts.id id of the user that the image is to be displayed to\n * @returns\n */\nexport function assignUserSpecificImage(token, img, { userName = null, userId = null } = {}) {\n  if (!img) return unassignUserSpecificImage(token, { userName, userId });\n\n  if (userName instanceof Array) {\n    for (const name of userName) assignUserSpecificImage(token, img, { userName: name });\n    return;\n  }\n\n  if (userId instanceof Array) {\n    for (const id of userId) assignUserSpecificImage(token, img, { userId: id });\n    return;\n  }\n\n  let id = userId;\n  if (!id && userName) {\n    id = game.users.find((u) => u.name === userName)?.id;\n  }\n  if (!id) return;\n\n  const doc = token.document ?? token;\n  const mappings = doc.getFlag('token-variants', 'userMappings') || {};\n\n  mappings[id] = img;\n  doc.setFlag('token-variants', 'userMappings', mappings);\n}\n\n/**\n * Calls assignUserSpecificImage passing in all currently selected tokens.\n * @param {*} img image to be displayed\n * @param {*} opts id or name of the user as per assignUserSpecificImage(...)\n */\nexport function assignUserSpecificImageToSelected(img, opts = {}) {\n  const selected = [...canvas.tokens.controlled];\n  for (const t of selected) assignUserSpecificImage(t, img, opts);\n}\n\n/**\n * Un-assign image if one has been set to be displayed to a user.\n * @param {*} token token the image is to be removed from\n * @param {*} opts.userName name of the user that the image is to be removed for\n * @param {*} opts.id id of the user that the image is to be removed for\n */\nexport function unassignUserSpecificImage(token, { userName = null, userId = null } = {}) {\n  if (userName instanceof Array) {\n    for (const name of userName) unassignUserSpecificImage(token, { userName: name });\n    return;\n  }\n\n  if (userId instanceof Array) {\n    for (const id of userId) unassignUserSpecificImage(token, { userId: id });\n    return;\n  }\n\n  let id = userId;\n  if (!id && userName) {\n    id = game.users.find((u) => u.name === userName)?.id;\n  }\n  if (!id) {\n    if (!userName && !userId) (token.document ?? token).unsetFlag('token-variants', 'userMappings');\n  } else {\n    const update = {};\n    update['flags.token-variants.userMappings.-=' + id] = null;\n    (token.document ?? token).update(update);\n  }\n}\n\n/**\n * Calls unassignUserSpecificImage passing in all currently selected tokens.\n * @param {*} opts id or name of the user as per unassignUserSpecificImage(...)\n */\nexport function unassignUserSpecificImageFromSelected(opts = {}) {\n  const selected = [...canvas.tokens.controlled];\n  for (const t of selected) unassignUserSpecificImage(t, opts);\n}\n","import { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\nimport { HTMLOverlay } from '../sprite/HTMLOverlay.js';\nimport { TVAOverlay } from '../sprite/TVAOverlay.js';\nimport { drawOverlays } from '../token/overlay.js';\nimport { registerHook, unregisterHook } from './hooks.js';\n\nconst feature_id = 'Overlays';\n\nexport function registerOverlayHooks() {\n  if (!FEATURE_CONTROL[feature_id]) {\n    [\n      'refreshToken',\n      'destroyToken',\n      'updateActor',\n      'renderCombatTracker',\n      'updateToken',\n      'createToken',\n      'hoverToken',\n      'renderHeadsUpDisplay',\n    ].forEach((id) => unregisterHook(feature_id, id));\n    return;\n  } else if (!TVA_CONFIG.evaluateOverlayOnHover) {\n    unregisterHook(feature_id, 'hoverToken');\n  }\n\n  if (TVA_CONFIG.evaluateOverlayOnHover) {\n    registerHook(feature_id, 'hoverToken', function (token, hover) {\n      drawOverlays(token);\n    });\n  }\n\n  registerHook(feature_id, 'createToken', async function (token) {\n    if (token.object) drawOverlays(token.object);\n  });\n\n  registerHook(feature_id, 'updateToken', async function (token) {\n    if (token.object) drawOverlays(token.object);\n  });\n\n  registerHook(feature_id, 'refreshToken', (token) => {\n    if (token.tvaOverlays)\n      for (const child of token.tvaOverlays) {\n        if (child instanceof TVAOverlay) {\n          child.refresh(null, { preview: false, fullRefresh: false });\n        }\n      }\n  });\n\n  registerHook(feature_id, 'destroyToken', (token) => {\n    if (token.tvaOverlays)\n      for (const child of token.tvaOverlays) {\n        child.parent?.removeChild(child)?.destroy();\n      }\n  });\n\n  registerHook(feature_id, 'updateActor', async function (actor) {\n    if (actor.getActiveTokens)\n      actor.getActiveTokens(true).forEach((token) => {\n        drawOverlays(token);\n      });\n  });\n\n  registerHook(feature_id, 'renderCombatTracker', function () {\n    for (const tkn of canvas.tokens.placeables) {\n      drawOverlays(tkn);\n    }\n  });\n\n  registerHook(feature_id, 'renderHeadsUpDisplay', () => {\n    HTMLOverlay.hudRendered();\n  });\n}\n\nconst REFRESH_HOOKS = {};\n\nexport function registerOverlayRefreshHook(tvaOverlay, hookName) {\n  if (!(hookName in REFRESH_HOOKS)) {\n    registerHook('TVAOverlayRefresh', hookName, () => {\n      REFRESH_HOOKS[hookName]?.forEach((s) => s.refresh());\n    });\n    REFRESH_HOOKS[hookName] = [tvaOverlay];\n  } else if (!REFRESH_HOOKS[hookName].find((s) => s == tvaOverlay)) {\n    REFRESH_HOOKS[hookName].push(tvaOverlay);\n  }\n}\n\nexport function unregisterOverlayRefreshHooks(tvaOverlay, hookName = null) {\n  const unregister = function (hook) {\n    if (REFRESH_HOOKS[hook]) {\n      let index = REFRESH_HOOKS[hook].findIndex((s) => s == tvaOverlay);\n      if (index > -1) {\n        REFRESH_HOOKS[hook].splice(index, 1);\n        if (!REFRESH_HOOKS[hook].length) {\n          unregisterHook('TVAOverlayRefresh', hook);\n          delete REFRESH_HOOKS[hook];\n        }\n      }\n    }\n  };\n\n  if (hookName) unregister(hookName);\n  else {\n    Object.keys(REFRESH_HOOKS).forEach((k) => unregister(k));\n  }\n}\n","import {\n  CORE_SHAPE,\n  DEFAULT_OVERLAY_CONFIG,\n  OVERLAY_SHAPES,\n} from \"../scripts/models.js\";\nimport {\n  VALID_EXPRESSION,\n  getAllEffectMappings,\n} from \"../scripts/hooks/effectMappingHooks.js\";\nimport {\n  evaluateOverlayExpressions,\n  genTexture,\n} from \"../scripts/token/overlay.js\";\nimport { SEARCH_TYPE } from \"../scripts/utils.js\";\nimport { showArtSelect } from \"../token-variants.mjs\";\nimport { sortMappingsToGroups } from \"./effectMappingForm.js\";\nimport { getFlagMappings } from \"../scripts/settings.js\";\nimport { Reticle } from \"../scripts/reticle.js\";\n\nexport class OverlayConfig extends FormApplication {\n  constructor(\n    config,\n    callback,\n    token,\n    { mapping, global = false, actor } = {},\n  ) {\n    super({}, {});\n    this.config = config ?? {};\n\n    if (\n      (this.config.img || this.config.imgLinked) &&\n      !(this.config.img instanceof Array)\n    ) {\n      this.config.img = [\n        { src: this.config.img, linked: this.config.imgLinked },\n      ];\n    }\n\n    this.config.id = mapping.id;\n    this.callback = callback;\n    this.token = canvas.tokens.get(token._id);\n    this.previewConfig = foundry.utils.deepClone(this.config);\n    this.mapping = mapping;\n    this.global = global;\n    this.actor = actor;\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: \"token-variants-overlay-config\",\n      classes: [\"sheet\"],\n      template:\n        \"modules/token-variants/token-variants/templates/overlayConfig.html\",\n      resizable: false,\n      minimizable: false,\n      title: \"Overlay Settings\",\n      width: 500,\n      height: \"auto\",\n      //tabs: [{ navSelector: '.sheet-tabs', contentSelector: '.content', initial: 'misc' }, ],\n\n      tabs: [\n        {\n          navSelector: '.tabs[data-group=\"main\"]',\n          contentSelector: \"form\",\n          initial: \"misc\",\n        },\n        {\n          navSelector: '.tabs[data-group=\"html\"]',\n          contentSelector: '.tab[data-tab=\"html\"]',\n          initial: \"template\",\n        },\n      ],\n    });\n  }\n\n  get title() {\n    let scope = \"GLOBAL\";\n    if (!this.global && this.actor) {\n      scope = this.actor.name;\n    }\n    return `${this.mapping.label} — [${scope}]`;\n  }\n\n  /**\n   * @param {JQuery} html\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    html.querySelector(\".reticle\").on(\"click\", (event) => {\n      const icons = this.getPreviewIcons();\n      if (icons.length) {\n        Reticle.activate({\n          tvaOverlay: icons[0].icon,\n          app: this,\n          config: this.previewConfig,\n        });\n      }\n    });\n\n    html.querySelector(\".repeat\").on(\"change\", (event) => {\n      const fieldset = event.target.closest(\"fieldset\");\n      const content = fieldset.find(\".content\");\n      if (event.target.checked) {\n        content.show();\n        fieldset.addClass(\"active\");\n      } else {\n        content.hide();\n        fieldset.removeClass(\"active\");\n      }\n      this.setPosition();\n    });\n\n    // Insert Controls to the Shape Legend\n    const shapeLegends = html.querySelector(\".shape-legend\");\n    let config = this.config;\n    shapeLegends.each(function (i) {\n      const legend = this;\n      legend.append(\n        `&nbsp;<a class=\"cloneShape\" data-index=\"${i}\" title=\"Clone\"><i class=\"fas fa-clone\"></i></a>\n         &nbsp;<a class=\"deleteShape\" data-index=\"${i}\" title=\"Remove\"><i class=\"fas fa-trash-alt\"></i></a>`,\n      );\n      if (i != 0) {\n        legend.append(\n          `&nbsp;<a class=\"moveShapeUp\" data-index=\"${i}\" title=\"Move Up\"><i class=\"fas fa-arrow-up\"></i></a>`,\n        );\n      }\n      if (i != shapeLegends.length - 1) {\n        legend.append(\n          `&nbsp;<a class=\"moveShapeDown\" data-index=\"${i}\" title=\"Move Down\"><i class=\"fas fa-arrow-down\"></i></a>`,\n        );\n      }\n      legend.append(\n        `<input class=\"shape-legend-input\" type=\"text\" name=\"shapes.${i}.label\" value=\"${\n          config.shapes?.[i]?.label ?? \"\"\n        }\">`,\n      );\n    });\n\n    // Shape listeners\n    html.querySelector(\".addShape\").on(\"click\", this._onAddShape.bind(this));\n    html.querySelector(\".addImage\").on(\"click\", this._onAddImage.bind(this));\n    html.querySelector(\".addEvent\").on(\"click\", this._onAddEvent.bind(this));\n    html\n      .querySelector(\".deleteShape\")\n      .on(\"click\", this._onDeleteShape.bind(this));\n    html\n      .querySelector(\".deleteImage\")\n      .on(\"click\", this._onDeleteImage.bind(this));\n    html\n      .querySelector(\".deleteEvent\")\n      .on(\"click\", this._onDeleteEvent.bind(this));\n    html\n      .querySelector(\".moveShapeUp\")\n      .on(\"click\", this._onMoveShapeUp.bind(this));\n    html\n      .querySelector(\".moveShapeDown\")\n      .on(\"click\", this._onMoveShapeDown.bind(this));\n    html\n      .querySelector(\".cloneShape\")\n      .on(\"click\", this._onCloneShape.bind(this));\n\n    html\n      .querySelector(\"input,select\")\n      .on(\"change\", this._onInputChange.bind(this));\n    html\n      .querySelector(\"color-picker\")\n      .on(\"input\", this._onInputChange.bind(this));\n    html.querySelector(\"textarea\").on(\"change\", this._onInputChange.bind(this));\n    const parentId = html.querySelector('[name=\"parentID\"]');\n    parentId.on(\"change\", (event) => {\n      if (event.target.value === \"TOKEN\") {\n        html.querySelector(\".token-specific-fields\").show();\n      } else {\n        html.querySelector(\".token-specific-fields\").hide();\n      }\n      this.setPosition();\n    });\n    parentId.trigger(\"change\");\n    html\n      .find('[name=\"ui\"]')\n      .on(\"change\", (event) => {\n        if (parentId.val() === \"TOKEN\") {\n          if (event.target.checked) {\n            html.querySelector(\".ui-hide\").hide();\n          } else {\n            html.querySelector(\".ui-hide\").show();\n          }\n          this.setPosition();\n        }\n      })\n      .trigger(\"change\");\n\n    html.querySelector('[name=\"filter\"]').on(\"change\", (event) => {\n      html.querySelector(\".filterOptions\").empty();\n      const filterOptions = genFilterOptionControls(event.target.value);\n      html.querySelector(\".filterOptions\").append(filterOptions);\n      this.setPosition({ height: \"auto\" });\n      this.activateListeners(filterOptions);\n    });\n\n    html.querySelector(\".token-variants-image-select-button\").click((event) => {\n      showArtSelect(this.token?.name ?? \"overlay\", {\n        searchType: SEARCH_TYPE.TOKEN,\n        callback: (imgSrc, imgName) => {\n          if (imgSrc)\n            event.target\n              .closest(\".form-group\")\n              .find(\"input\")\n              .val(imgSrc)\n              .trigger(\"change\");\n        },\n      });\n    });\n\n    html.querySelector(\".presetImport\").on(\"click\", (event) => {\n      const presetName = event.target\n        .closest(\".form-group\")\n        .find(\".tmfxPreset\")\n        .val();\n      if (presetName) {\n        const preset = TokenMagic.getPreset(presetName);\n        if (preset) {\n          event.target\n            .closest(\".form-group\")\n            .find(\"textarea\")\n            .val(JSON.stringify(preset, null, 2))\n            .trigger(\"change\");\n        }\n      }\n    });\n\n    // Controls for locking scale sliders together\n    let scaleState = { locked: true };\n\n    // Range inputs need to be triggered when slider moves to initiate preview\n    html\n      .find(\".range-value\")\n      .siblings('[type=\"range\"]')\n      .on(\"change\", (event) => {\n        event.target\n          .siblings(\".range-value\")\n          .val(event.target.value)\n          .trigger(\"change\");\n      });\n\n    const lockButtons = html.find(\".scaleLock > a\");\n    const sliderScaleWidth = html.find('[name=\"scaleX\"]');\n    const sliderScaleHeight = html.find('[name=\"scaleY\"]');\n    const sliderWidth = html.querySelector(\".scaleX\");\n    const sliderHeight = html.querySelector(\".scaleY\");\n\n    lockButtons.on(\"click\", function () {\n      scaleState.locked = !scaleState.locked;\n      lockButtons.html(\n        scaleState.locked\n          ? '<i class=\"fas fa-link\"></i>'\n          : '<i class=\"fas fa-unlink\"></i>',\n      );\n    });\n\n    sliderScaleWidth.on(\"change\", function () {\n      if (\n        scaleState.locked &&\n        sliderScaleWidth.val() !== sliderScaleHeight.val()\n      ) {\n        sliderScaleHeight.val(sliderScaleWidth.val()).trigger(\"change\");\n        sliderHeight.val(sliderScaleWidth.val());\n      }\n    });\n    sliderScaleHeight.on(\"change\", function () {\n      if (\n        scaleState.locked &&\n        sliderScaleWidth.val() !== sliderScaleHeight.val()\n      ) {\n        sliderScaleWidth.val(sliderScaleHeight.val()).trigger(\"change\");\n        sliderWidth.val(sliderScaleHeight.val());\n      }\n    });\n    html.on(\"change\", \".scaleX\", () => {\n      sliderScaleWidth.trigger(\"change\");\n    });\n    html.on(\"change\", \".scaleY\", () => {\n      sliderScaleHeight.trigger(\"change\");\n    });\n\n    html.querySelector(\".me-edit-json\").on(\"click\", async (event) => {\n      const textarea = event.target.closest(\".form-group\").find(\"textarea\");\n      let params;\n      try {\n        params = eval(textarea.val());\n      } catch (e) {\n        console.warn(\"TVA |\", e);\n      }\n\n      if (params) {\n        let param;\n        if (Array.isArray(params)) {\n          if (params.length === 1) param = params[0];\n          else {\n            let i = await promptParamChoice(params);\n            if (i < 0) return;\n            param = params[i];\n          }\n        } else {\n          param = params;\n        }\n\n        if (param)\n          game.modules\n            .get(\"multi-token-edit\")\n            .api.showGenericForm(param, param.filterType ?? \"TMFX\", {\n              inputChangeCallback: (selected) => {\n                foundry.utils.mergeObject(param, selected, { inplace: true });\n                textarea.val(JSON.stringify(params, null, 2)).trigger(\"change\");\n              },\n            });\n      }\n    });\n\n    const underlay = html.querySelector('[name=\"underlay\"]');\n    const top = html.querySelector('[name=\"top\"]');\n    const bottom = html.querySelector('[name=\"bottom\"]');\n    underlay.change(function () {\n      if (this.checked) top.prop(\"checked\", false);\n      else bottom.prop(\"checked\", false);\n    });\n    top.change(function () {\n      if (this.checked) {\n        underlay.prop(\"checked\", false);\n        bottom.prop(\"checked\", false);\n      }\n    });\n    bottom.change(function () {\n      if (this.checked) {\n        underlay.prop(\"checked\", true);\n        top.prop(\"checked\", false);\n      }\n    });\n\n    const linkScale = html.querySelector('[name=\"linkScale\"]');\n    const linkDimensions = html.querySelector(\n      '[name=\"linkDimensionsX\"], [name=\"linkDimensionsY\"]',\n    );\n    const linkStageScale = html.querySelector('[name=\"linkStageScale\"]');\n    linkScale.change(function () {\n      if (this.checked) {\n        linkDimensions.prop(\"checked\", false);\n        linkStageScale.prop(\"checked\", false);\n      }\n    });\n    linkDimensions.change(function () {\n      if (this.checked) {\n        linkScale.prop(\"checked\", false);\n        linkStageScale.prop(\"checked\", false);\n      }\n    });\n    linkStageScale.change(function () {\n      if (this.checked) {\n        linkScale.prop(\"checked\", false);\n        linkDimensions.prop(\"checked\", false);\n      }\n    });\n\n    // Setting border color for property expression\n    const limitOnProperty = html.querySelector('[name=\"limitOnProperty\"]');\n    limitOnProperty.on(\"input\", (event) => {\n      const input = event.target;\n      if (input.val() === \"\") {\n        input.removeClass(\"tvaValid\");\n        input.removeClass(\"tvaInvalid\");\n      } else if (input.val().match(VALID_EXPRESSION)) {\n        input.addClass(\"tvaValid\");\n        input.removeClass(\"tvaInvalid\");\n      } else {\n        input.addClass(\"tvaInvalid\");\n        input.removeClass(\"tvaValid\");\n      }\n    });\n    limitOnProperty.trigger(\"input\");\n\n    html\n      .querySelector(\".create-variable\")\n      .on(\"click\", this._onCreateVariable.bind(this));\n    html\n      .querySelector(\".delete-variable\")\n      .on(\"click\", this._onDeleteVariable.bind(this));\n  }\n\n  _onDeleteVariable(event) {\n    let index = event.target.closest(\"tr\").data(\"index\");\n    if (index != null) {\n      this.config = this._getSubmitData();\n      if (!this.config.variables) this.config.variables = [];\n      this.config.variables.splice(index, 1);\n      this.render(true);\n    }\n  }\n\n  _onCreateVariable(event) {\n    this.config = this._getSubmitData();\n    if (!this.config.variables) this.config.variables = [];\n    this.config.variables.push({ name: \"\", value: \"\" });\n    this.render(true);\n  }\n\n  _onAddShape(event) {\n    let shape = event.target.siblings(\"select\").val();\n    shape = foundry.utils.deepClone(OVERLAY_SHAPES[shape]);\n    shape = foundry.utils.mergeObject(foundry.utils.deepClone(CORE_SHAPE), {\n      shape,\n    });\n\n    this.config = this._getSubmitData();\n\n    if (!this.config.shapes) this.config.shapes = [];\n    this.config.shapes.push(shape);\n\n    this.render(true);\n  }\n\n  _onAddImage(event) {\n    this.config = this._getSubmitData();\n    if (!this.config.img) this.config.img = [];\n    else if (!(this.config.img instanceof Array)) {\n      this.config.img = [\n        { src: this.config.img, linked: this.config.imgLinked },\n      ];\n    }\n    this.config.img.push({ src: \"\", linked: false });\n    this.render(true);\n  }\n\n  _onAddEvent(event) {\n    let listener = event.target.siblings(\"select\").val();\n\n    this.config = this._getSubmitData();\n    if (!this.config.interactivity) this.config.interactivity = [];\n    this.config.interactivity.push({ listener, macro: \"\", script: \"\" });\n\n    this.render(true);\n  }\n\n  _onDeleteShape(event) {\n    const index = event.target.closest(\".deleteShape\").data(\"index\");\n    if (index == null) return;\n\n    this.config = this._getSubmitData();\n    if (!this.config.shapes) this.config.shapes = [];\n    this.config.shapes.splice(index, 1);\n\n    this.render(true);\n  }\n\n  _onDeleteImage(event) {\n    const index = event.target.closest(\".deleteImage\").data(\"index\");\n    if (index == null) return;\n\n    this.config = this._getSubmitData();\n    if (!(this.config.img instanceof Array)) this.config.img = [];\n    else this.config.img.splice(index, 1);\n\n    if (!this.config.img.length) this.config.img = \"\";\n\n    this.render(true);\n  }\n\n  _onDeleteEvent(event) {\n    const index = event.target.closest(\".deleteEvent\").data(\"index\");\n    if (index == null) return;\n\n    this.config = this._getSubmitData();\n    if (!this.config.interactivity) this.config.interactivity = [];\n    this.config.interactivity.splice(index, 1);\n\n    this.render(true);\n  }\n\n  _onCloneShape(event) {\n    const index = event.target.closest(\".cloneShape\").data(\"index\");\n    if (!index && index != 0) return;\n\n    this.config = this._getSubmitData();\n    if (!this.config.shapes) return;\n    const nShape = foundry.utils.deepClone(this.config.shapes[index]);\n    if (nShape.label) {\n      nShape.label = nShape.label + \" - Copy\";\n    }\n    this.config.shapes.push(nShape);\n\n    this.render(true);\n  }\n\n  _onMoveShapeUp(event) {\n    const index = event.target.closest(\".moveShapeUp\").data(\"index\");\n    if (!index) return;\n\n    this.config = this._getSubmitData();\n    if (!this.config.shapes) this.config.shapes = [];\n    if (this.config.shapes.length >= 2) this._swapShapes(index, index - 1);\n\n    this.render(true);\n  }\n\n  _onMoveShapeDown(event) {\n    const index = event.target.closest(\".moveShapeDown\").data(\"index\");\n    if (!index && index != 0) return;\n\n    this.config = this._getSubmitData();\n    if (!this.config.shapes) this.config.shapes = [];\n    if (this.config.shapes.length >= 2) this._swapShapes(index, index + 1);\n\n    this.render(true);\n  }\n\n  _swapShapes(i1, i2) {\n    let temp = this.config.shapes[i1];\n    this.config.shapes[i1] = this.config.shapes[i2];\n    this.config.shapes[i2] = temp;\n  }\n\n  _convertColor(colString) {\n    try {\n      const c = Color.fromString(colString);\n      return [...c.rgb, 1];\n    } catch (e) {\n      return [1, 1, 1, 1];\n    }\n  }\n\n  async _onInputChange(event) {\n    this.previewConfig = this._getSubmitData();\n    if (event.target.type === \"color\") {\n      const color = event.target.siblings(\".color\");\n      color.val(event.target.value).trigger(\"change\");\n      return;\n    }\n    this._applyPreviews();\n  }\n\n  getPreviewIcons() {\n    if (!this.config.id) return [];\n    const tokens = this.token ? [this.token] : canvas.tokens.placeables;\n    const previewIcons = [];\n    for (const tkn of tokens) {\n      if (tkn.tvaOverlays) {\n        for (const c of tkn.tvaOverlays) {\n          if (c.overlayConfig && c.overlayConfig.id === this.config.id) {\n            // Effect icon found, however if we're in global preview then we need to take into account\n            // a token/actor specific mapping which may override the global one\n            if (this.token) {\n              previewIcons.push({ token: tkn, icon: c });\n            } else if (\n              !getFlagMappings(tkn).find((m) => m.id === this.config.id)\n            ) {\n              previewIcons.push({ token: tkn, icon: c });\n            }\n          }\n        }\n      }\n    }\n    return previewIcons;\n  }\n\n  async _applyPreviews() {\n    const targets = this.getPreviewIcons();\n    for (const target of targets) {\n      const preview = evaluateOverlayExpressions(\n        foundry.utils.deepClone(this.previewConfig),\n        target.token,\n        {\n          overlayConfig: this.previewConfig,\n        },\n      );\n      target.icon.refresh(preview, {\n        preview: true,\n        previewTexture: await genTexture(target.token, preview),\n        refreshFilters: true,\n      });\n    }\n  }\n\n  async _removePreviews() {\n    const targets = this.getPreviewIcons();\n    for (const target of targets) {\n      target.icon.refresh(null, { refreshFilters: true });\n    }\n  }\n\n  async getData(options) {\n    const data = super.getData(options);\n    data.filters = Object.keys(PIXI.filters);\n    data.filters.push(\"OutlineOverlayFilter\");\n    data.filters.sort();\n    data.tmfxActive = game.modules.get(\"tokenmagic\")?.active;\n    if (data.tmfxActive) {\n      data.tmfxPresets = TokenMagic.getPresets().map((p) => p.name);\n      data.filters.unshift(\"Token Magic FX\");\n    }\n    data.filters.unshift(\"NONE\");\n    const settings = foundry.utils.mergeObject(\n      DEFAULT_OVERLAY_CONFIG,\n      this.config,\n      {\n        inplace: false,\n      },\n    );\n\n    data.ceActive = game.modules.get(\"dfreds-convenient-effects\")?.active;\n    if (data.ceActive) {\n      data.ceEffects = game.dfreds.effectInterface\n        .findEffects()\n        .map((ef) => ef.name);\n    }\n    data.macros = game.macros.map((m) => m.name);\n\n    if (settings.filter !== \"NONE\") {\n      const filterOptions = genFilterOptionControls(\n        settings.filter,\n        settings.filterOptions,\n      );\n      if (filterOptions) {\n        settings.filterOptions = filterOptions;\n      } else {\n        settings.filterOptions = null;\n      }\n    } else {\n      settings.filterOptions = null;\n    }\n\n    data.users = game.users.map((u) => {\n      return {\n        id: u.id,\n        name: u.name,\n        selected: settings.limitedUsers.includes(u.id),\n      };\n    });\n\n    data.fonts = Object.keys(CONFIG.fontDefinitions).concat(\n      Object.keys(game.settings.get(\"core\", FontConfig.SETTING)),\n    );\n    data.fontWeights = [\n      \"normal\",\n      \"bold\",\n      \"bolder\",\n      \"lighter\",\n      \"100\",\n      \"200\",\n      \"300\",\n      \"400\",\n      \"500\",\n      \"600\",\n      \"700\",\n      \"800\",\n      \"900\",\n    ];\n\n    const allMappings = getAllEffectMappings(this.token, true).filter(\n      (m) => m.id !== this.config.id,\n    );\n    const [_, groupedMappings] = sortMappingsToGroups(allMappings);\n\n    data.parents = groupedMappings;\n    if (!data.parentID) data.parentID = \"TOKEN\";\n    if (!data.anchor) data.anchor = { x: 0.5, y: 0.5 };\n\n    // Cache Partials\n    for (const shapeName of Object.keys(OVERLAY_SHAPES)) {\n      await getTemplate(\n        `modules/token-variants/token-variants/templates/partials/shape${shapeName}.html`,\n      );\n    }\n    await getTemplate(\n      \"modules/token-variants/token-variants/templates/partials/repeating.html\",\n    );\n    await getTemplate(\n      \"modules/token-variants/token-variants/templates/partials/interpolateColor.html\",\n    );\n\n    data.allShapes = Object.keys(OVERLAY_SHAPES);\n    data.textAlignmentOptions = [\n      { value: \"left\", label: \"Left\" },\n      { value: \"center\", label: \"Center\" },\n      { value: \"right\", label: \"Right\" },\n      { value: \"justify\", label: \"Justify\" },\n    ];\n\n    data.vision5e = game.modules.get(\"vision-5e\")?.active;\n\n    // linkDimensions has been converted to linkDimensionsX and linkDimensionsY\n    // Make sure we're using the latest fields\n    // 20/07/2023\n    if (!(\"linkDimensionsX\" in settings) && settings.linkDimensions) {\n      settings.linkDimensionsX = true;\n      settings.linkDimensionsY = true;\n    }\n\n    return foundry.utils.mergeObject(data, settings);\n  }\n\n  _getHeaderButtons() {\n    const buttons = super._getHeaderButtons();\n    buttons.unshift({\n      label: \"Core Variables\",\n      class: \".core-variables\",\n      icon: \"fas fa-file-import fa-fw\",\n      onclick: () => {\n        let content = `\n        <table>\n          <tr><th>Variable</th><th>Description</th></tr>\n          <tr><td>@hp</td><td>Actor Health</td></tr>\n          <tr><td>@hpMax</td><td>Actor Health (Max)</td></tr>\n          <tr><td>@gridSize</td><td>Grid Size (Pixels)</td></tr>\n          <tr><td>@label</td><td>Mapping's Label Field</td></tr>\n        </table>\n        `;\n\n        new Dialog({\n          title: `Core Variables`,\n          content,\n          buttons: {},\n        }).render(true);\n      },\n    });\n    return buttons;\n  }\n\n  async close(options = {}) {\n    super.close(options);\n    this._removePreviews();\n  }\n\n  _getSubmitData() {\n    let formData = super._getSubmitData();\n    formData = foundry.utils.expandObject(formData);\n    if (formData.img) {\n      const images = Object.values(formData.img);\n      if (images.length === 1) {\n        formData.img = images[0].src;\n        formData.imgLinked = images[0].linked;\n      } else {\n        formData.img = images;\n      }\n    }\n\n    if (!formData.repeating) delete formData.repeat;\n    if (!formData.text.repeating) delete formData.text.repeat;\n\n    if (formData.shapes) {\n      formData.shapes = Object.values(formData.shapes);\n      formData.shapes.forEach((shape) => {\n        if (!shape.repeating) delete shape.repeat;\n      });\n    }\n\n    if (formData.interactivity) {\n      formData.interactivity = Object.values(formData.interactivity)\n        .map((e) => {\n          e.macro = e.macro.trim();\n          e.script = e.script.trim();\n          if (e.tmfxPreset) e.tmfxPreset = e.tmfxPreset.trim();\n          if (e.ceEffect) e.ceEffect = e.ceEffect.trim();\n          return e;\n        })\n        .filter((e) => e.macro || e.script || e.ceEffect || e.tmfxPreset);\n    } else {\n      formData.interactivity = [];\n    }\n\n    if (formData.variables) {\n      formData.variables = Object.values(formData.variables);\n      formData.variables = formData.variables.filter(\n        (v) => v.name.trim() && v.value.trim(),\n      );\n    }\n    if (formData.limitedUsers) {\n      if (foundry.utils.getType(formData.limitedUsers) === \"string\")\n        formData.limitedUsers = [formData.limitedUsers];\n      formData.limitedUsers = formData.limitedUsers.filter((uid) => uid);\n    } else {\n      formData.limitedUsers = [];\n    }\n\n    formData.limitOnEffect = formData.limitOnEffect.trim();\n    formData.limitOnProperty = formData.limitOnProperty.trim();\n    if (formData.parentID === \"TOKEN\") formData.parentID = \"\";\n\n    if (\n      formData.filter === \"OutlineOverlayFilter\" &&\n      formData.filterOptions?.outlineColor\n    ) {\n      formData.filterOptions.outlineColor = this._convertColor(\n        formData.filterOptions.outlineColor,\n      );\n    } else if (formData.filter === \"BevelFilter\") {\n      if (formData.filterOptions?.lightColor)\n        formData.filterOptions.lightColor = Number(\n          Color.fromString(formData.filterOptions.lightColor),\n        );\n      if (formData.filterOptions?.shadowColor)\n        formData.filterOptions.shadowColor = Number(\n          Color.fromString(formData.filterOptions.shadowColor),\n        );\n    } else if (\n      [\n        \"DropShadowFilter\",\n        \"GlowFilter\",\n        \"OutlineFilter\",\n        \"FilterFire\",\n      ].includes(formData.filter)\n    ) {\n      if (formData.filterOptions?.color)\n        formData.filterOptions.color = Number(\n          Color.fromString(formData.filterOptions.color),\n        );\n    }\n\n    return formData;\n  }\n\n  /**\n   * @param {Event} event\n   * @param {Object} formData\n   */\n  async _updateObject(event, formData) {\n    if (this.callback) this.callback(formData);\n  }\n}\n\nexport const FILTERS = {\n  OutlineOverlayFilter: {\n    defaultValues: {\n      outlineColor: [0, 0, 0, 1],\n      trueThickness: 1,\n      animate: false,\n    },\n    controls: [\n      {\n        type: \"color\",\n        name: \"outlineColor\",\n      },\n      {\n        type: \"range\",\n        label: \"Thickness\",\n        name: \"trueThickness\",\n        min: 0,\n        max: 5,\n        step: 0.01,\n      },\n      {\n        type: \"boolean\",\n        label: \"Oscillate\",\n        name: \"animate\",\n      },\n    ],\n    argType: \"args\",\n  },\n  AlphaFilter: {\n    defaultValues: {\n      alpha: 1,\n    },\n    controls: [\n      {\n        type: \"range\",\n        name: \"alpha\",\n        min: 0,\n        max: 1,\n        step: 0.01,\n      },\n    ],\n    argType: \"args\",\n  },\n  BlurFilter: {\n    defaultValues: {\n      strength: 8,\n      quality: 4,\n    },\n    controls: [\n      { type: \"range\", name: \"strength\", min: 0, max: 20, step: 1 },\n      { type: \"range\", name: \"quality\", min: 0, max: 20, step: 1 },\n    ],\n    argType: \"args\",\n  },\n  BlurFilterPass: {\n    defaultValues: {\n      horizontal: false,\n      strength: 8,\n      quality: 4,\n    },\n    controls: [\n      {\n        type: \"boolean\",\n        name: \"horizontal\",\n      },\n      { type: \"range\", name: \"strength\", min: 0, max: 20, step: 1 },\n      { type: \"range\", name: \"quality\", min: 0, max: 20, step: 1 },\n    ],\n    argType: \"args\",\n  },\n  NoiseFilter: {\n    defaultValues: {\n      noise: 0.5,\n      seed: 4475160954091,\n    },\n    controls: [\n      { type: \"range\", name: \"noise\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"seed\", min: 0, max: 100000, step: 1 },\n    ],\n    argType: \"args\",\n  },\n  AdjustmentFilter: {\n    defaultValues: {\n      gamma: 1,\n      saturation: 1,\n      contrast: 1,\n      brightness: 1,\n      red: 1,\n      green: 1,\n      blue: 1,\n      alpha: 1,\n    },\n    controls: [\n      { type: \"range\", name: \"gamma\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"saturation\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"contrast\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"brightness\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"red\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"green\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"blue\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"alpha\", min: 0, max: 1, step: 0.01 },\n    ],\n    argType: \"options\",\n  },\n  AdvancedBloomFilter: {\n    defaultValues: {\n      threshold: 0.5,\n      bloomScale: 1,\n      brightness: 1,\n      blur: 8,\n      quality: 4,\n    },\n    controls: [\n      { type: \"range\", name: \"threshold\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"bloomScale\", min: 0, max: 5, step: 0.01 },\n      { type: \"range\", name: \"brightness\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"blur\", min: 0, max: 20, step: 1 },\n      { type: \"range\", name: \"quality\", min: 0, max: 20, step: 1 },\n    ],\n    argType: \"options\",\n  },\n  AsciiFilter: {\n    defaultValues: {\n      size: 8,\n    },\n    controls: [{ type: \"range\", name: \"size\", min: 0, max: 20, step: 0.01 }],\n    argType: \"args\",\n  },\n  BevelFilter: {\n    defaultValues: {\n      rotation: 45,\n      thickness: 2,\n      lightColor: 0xffffff,\n      lightAlpha: 0.7,\n      shadowColor: 0x000000,\n      shadowAlpha: 0.7,\n    },\n    controls: [\n      { type: \"range\", name: \"rotation\", min: 0, max: 360, step: 1 },\n      { type: \"range\", name: \"thickness\", min: 0, max: 20, step: 0.01 },\n      { type: \"color\", name: \"lightColor\" },\n      { type: \"range\", name: \"lightAlpha\", min: 0, max: 1, step: 0.01 },\n      { type: \"color\", name: \"shadowColor\" },\n      { type: \"range\", name: \"shadowAlpha\", min: 0, max: 1, step: 0.01 },\n    ],\n    argType: \"options\",\n  },\n  BloomFilter: {\n    defaultValues: {\n      blur: 2,\n      quality: 4,\n    },\n    controls: [\n      { type: \"range\", name: \"blur\", min: 0, max: 20, step: 1 },\n      { type: \"range\", name: \"quality\", min: 0, max: 20, step: 1 },\n    ],\n    argType: \"args\",\n  },\n  BulgePinchFilter: {\n    defaultValues: {\n      radius: 100,\n      strength: 1,\n    },\n    controls: [\n      { type: \"range\", name: \"radius\", min: 0, max: 500, step: 1 },\n      { type: \"range\", name: \"strength\", min: -1, max: 1, step: 0.01 },\n    ],\n    argType: \"options\",\n  },\n  CRTFilter: {\n    defaultValues: {\n      curvature: 1,\n      lineWidth: 1,\n      lineContrast: 0.25,\n      verticalLine: false,\n      noise: 0.3,\n      noiseSize: 1,\n      seed: 0,\n      vignetting: 0.3,\n      vignettingAlpha: 1,\n      vignettingBlur: 0.3,\n      time: 0,\n    },\n    controls: [\n      { type: \"range\", name: \"curvature\", min: 0, max: 20, step: 0.01 },\n      { type: \"range\", name: \"lineWidth\", min: 0, max: 20, step: 0.01 },\n      { type: \"range\", name: \"lineContrast\", min: 0, max: 5, step: 0.01 },\n      { type: \"boolean\", name: \"verticalLine\" },\n      { type: \"range\", name: \"noise\", min: 0, max: 2, step: 0.01 },\n      { type: \"range\", name: \"noiseSize\", min: 0, max: 20, step: 0.01 },\n      { type: \"range\", name: \"seed\", min: 0, max: 100000, step: 1 },\n      { type: \"range\", name: \"vignetting\", min: 0, max: 20, step: 0.01 },\n      { type: \"range\", name: \"vignettingAlpha\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"vignettingBlur\", min: 0, max: 5, step: 0.01 },\n      { type: \"range\", name: \"time\", min: 0, max: 10000, step: 1 },\n    ],\n    argType: \"options\",\n  },\n  DotFilter: {\n    defaultValues: {\n      scale: 1,\n      angle: 5,\n    },\n    controls: [\n      { type: \"range\", name: \"scale\", min: 0, max: 50, step: 1 },\n      { type: \"range\", name: \"angle\", min: 0, max: 360, step: 0.1 },\n    ],\n    argType: \"args\",\n  },\n  DropShadowFilter: {\n    defaultValues: {\n      rotation: 45,\n      distance: 5,\n      color: 0x000000,\n      alpha: 0.5,\n      shadowOnly: false,\n      blur: 2,\n      quality: 3,\n    },\n    controls: [\n      { type: \"range\", name: \"rotation\", min: 0, max: 360, step: 0.1 },\n      { type: \"range\", name: \"distance\", min: 0, max: 100, step: 0.1 },\n      { type: \"color\", name: \"color\" },\n      { type: \"range\", name: \"alpha\", min: 0, max: 1, step: 0.01 },\n      { type: \"boolean\", name: \"shadowOnly\" },\n      { type: \"range\", name: \"blur\", min: 0, max: 20, step: 0.1 },\n      { type: \"range\", name: \"quality\", min: 0, max: 20, step: 1 },\n    ],\n    argType: \"options\",\n  },\n  EmbossFilter: {\n    defaultValues: {\n      strength: 5,\n    },\n    controls: [{ type: \"range\", name: \"strength\", min: 0, max: 20, step: 1 }],\n    argType: \"args\",\n  },\n  GlitchFilter: {\n    defaultValues: {\n      slices: 5,\n      offset: 100,\n      direction: 0,\n      fillMode: 0,\n      seed: 0,\n      average: false,\n      minSize: 8,\n      sampleSize: 512,\n    },\n    controls: [\n      { type: \"range\", name: \"slices\", min: 0, max: 50, step: 1 },\n      { type: \"range\", name: \"distance\", min: 0, max: 1000, step: 1 },\n      { type: \"range\", name: \"direction\", min: 0, max: 360, step: 0.1 },\n      {\n        type: \"select\",\n        name: \"fillMode\",\n        options: [\n          { value: 0, label: \"TRANSPARENT\" },\n          { value: 1, label: \"ORIGINAL\" },\n          { value: 2, label: \"LOOP\" },\n          { value: 3, label: \"CLAMP\" },\n          { value: 4, label: \"MIRROR\" },\n        ],\n      },\n      { type: \"range\", name: \"seed\", min: 0, max: 10000, step: 1 },\n      { type: \"boolean\", name: \"average\" },\n      { type: \"range\", name: \"minSize\", min: 0, max: 500, step: 1 },\n      { type: \"range\", name: \"sampleSize\", min: 0, max: 1024, step: 1 },\n    ],\n    argType: \"options\",\n  },\n  GlowFilter: {\n    defaultValues: {\n      distance: 10,\n      outerStrength: 4,\n      innerStrength: 0,\n      color: 0xffffff,\n      quality: 0.1,\n      knockout: false,\n    },\n    controls: [\n      { type: \"range\", name: \"distance\", min: 1, max: 50, step: 1 },\n      { type: \"range\", name: \"outerStrength\", min: 0, max: 20, step: 1 },\n      { type: \"range\", name: \"innerStrength\", min: 0, max: 20, step: 1 },\n      { type: \"color\", name: \"color\" },\n      { type: \"range\", name: \"quality\", min: 0, max: 5, step: 0.1 },\n      { type: \"boolean\", name: \"knockout\" },\n    ],\n    argType: \"options\",\n  },\n  GodrayFilter: {\n    defaultValues: {\n      angle: 30,\n      gain: 0.5,\n      lacunarity: 2.5,\n      parallel: true,\n      time: 0,\n      alpha: 1.0,\n    },\n    controls: [\n      { type: \"range\", name: \"angle\", min: 0, max: 360, step: 0.1 },\n      { type: \"range\", name: \"gain\", min: 0, max: 5, step: 0.01 },\n      { type: \"range\", name: \"lacunarity\", min: 0, max: 5, step: 0.01 },\n      { type: \"boolean\", name: \"parallel\" },\n      { type: \"range\", name: \"time\", min: 0, max: 10000, step: 1 },\n      { type: \"range\", name: \"alpha\", min: 0, max: 1, step: 0.01 },\n    ],\n    argType: \"options\",\n  },\n  KawaseBlurFilter: {\n    defaultValues: {\n      blur: 4,\n      quality: 3,\n      clamp: false,\n    },\n    controls: [\n      { type: \"range\", name: \"blur\", min: 0, max: 20, step: 0.1 },\n      { type: \"range\", name: \"quality\", min: 0, max: 20, step: 1 },\n      { type: \"boolean\", name: \"clamp\" },\n    ],\n    argType: \"args\",\n  },\n  OldFilmFilter: {\n    defaultValues: {\n      sepia: 0.3,\n      noise: 0.3,\n      noiseSize: 1.0,\n      scratch: 0.5,\n      scratchDensity: 0.3,\n      scratchWidth: 1.0,\n      vignetting: 0.3,\n      vignettingAlpha: 1.0,\n      vignettingBlur: 0.3,\n    },\n    controls: [\n      { type: \"range\", name: \"sepia\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"noise\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"noiseSize\", min: 0, max: 5, step: 0.01 },\n      { type: \"range\", name: \"scratch\", min: 0, max: 5, step: 0.01 },\n      { type: \"range\", name: \"scratchDensity\", min: 0, max: 5, step: 0.01 },\n      { type: \"range\", name: \"scratchWidth\", min: 0, max: 20, step: 0.01 },\n      { type: \"range\", name: \"vignetting\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"vignettingAlpha\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"vignettingBlur\", min: 0, max: 5, step: 0.01 },\n    ],\n    argType: \"options\",\n  },\n  OutlineFilter: {\n    defaultValues: {\n      thickness: 1,\n      color: 0x000000,\n      quality: 0.1,\n    },\n    controls: [\n      { type: \"range\", name: \"thickness\", min: 0, max: 20, step: 0.1 },\n      { type: \"color\", name: \"color\" },\n      { type: \"range\", name: \"quality\", min: 0, max: 1, step: 0.01 },\n    ],\n    argType: \"args\",\n  },\n  PixelateFilter: {\n    defaultValues: {\n      size: 1,\n    },\n    controls: [{ type: \"range\", name: \"size\", min: 1, max: 100, step: 1 }],\n    argType: \"args\",\n  },\n  RGBSplitFilter: {\n    defaultValues: {\n      red: [-10, 0],\n      green: [0, 10],\n      blue: [0, 0],\n    },\n    controls: [\n      { type: \"point\", name: \"red\", min: 0, max: 50, step: 1 },\n      { type: \"point\", name: \"green\", min: 0, max: 50, step: 1 },\n      { type: \"point\", name: \"blue\", min: 0, max: 50, step: 1 },\n    ],\n    argType: \"args\",\n  },\n  RadialBlurFilter: {\n    defaultValues: {\n      angle: 0,\n      center: [0, 0],\n      radius: -1,\n    },\n    controls: [\n      { type: \"range\", name: \"angle\", min: 0, max: 360, step: 1 },\n      { type: \"point\", name: \"center\", min: 0, max: 1000, step: 1 },\n      { type: \"range\", name: \"radius\", min: -1, max: 1000, step: 1 },\n    ],\n    argType: \"args\",\n  },\n  ReflectionFilter: {\n    defaultValues: {\n      mirror: true,\n      boundary: 0.5,\n      amplitude: [0, 20],\n      waveLength: [30, 100],\n      alpha: [1, 1],\n      time: 0,\n    },\n    controls: [\n      { type: \"boolean\", name: \"mirror\" },\n      { type: \"range\", name: \"boundary\", min: 0, max: 1, step: 0.01 },\n      { type: \"point\", name: \"amplitude\", min: 0, max: 100, step: 1 },\n      { type: \"point\", name: \"waveLength\", min: 0, max: 500, step: 1 },\n      { type: \"point\", name: \"alpha\", min: 0, max: 1, step: 0.01 },\n      { type: \"range\", name: \"time\", min: 0, max: 10000, step: 1 },\n    ],\n    argType: \"options\",\n  },\n  DisplacementFilter: {\n    defaultValues: {\n      sprite: \"\",\n      textureScale: 1,\n      displacementScale: 1,\n    },\n    controls: [\n      { type: \"text\", name: \"sprite\" },\n      { type: \"range\", name: \"textureScale\", min: 0, max: 100, step: 0.1 },\n      { type: \"range\", name: \"displacementScale\", min: 0, max: 100, step: 0.1 },\n    ],\n    argType: \"options\",\n  },\n  \"Token Magic FX\": {\n    defaultValues: {\n      params: [],\n    },\n    controls: [\n      { type: \"tmfxPreset\", name: \"tmfxPreset\" },\n      { type: \"json\", name: \"params\" },\n    ],\n  },\n};\n\nfunction genFilterOptionControls(filterName, filterOptions = {}) {\n  if (!(filterName in FILTERS)) return;\n\n  const options = foundry.utils.mergeObject(\n    FILTERS[filterName].defaultValues,\n    filterOptions,\n  );\n  const values = getControlValues(filterName, options);\n\n  const controls = FILTERS[filterName].controls;\n  let controlsHTML = \"<fieldset><legend>Options</legend>\";\n  for (const control of controls) {\n    controlsHTML += genControl(control, values);\n  }\n  controlsHTML += \"</fieldset>\";\n\n  return controlsHTML;\n}\n\nfunction getControlValues(filterName, options) {\n  if (filterName === \"OutlineOverlayFilter\") {\n    options.outlineColor = Color.fromRGB(options.outlineColor).toString();\n  } else if (filterName === \"BevelFilter\") {\n    options.lightColor = Color.from(options.lightColor).toString();\n    options.shadowColor = Color.from(options.shadowColor).toString();\n  } else if (\n    [\"DropShadowFilter\", \"GlowFilter\", \"OutlineFilter\"].includes(filterName)\n  ) {\n    options.color = Color.from(options.color).toString();\n  }\n  return options;\n}\n\nfunction genControl(control, values) {\n  const val = values[control.name];\n  const name = control.name;\n  const label = control.label ?? name.charAt(0).toUpperCase() + name.slice(1);\n  const type = control.type;\n  if (type === \"color\") {\n    return `\n<div class=\"form-group\">\n  <label>${label}</label>\n  <div class=\"form-fields\">\n      <input class=\"color\" type=\"text\" name=\"filterOptions.${name}\" value=\"${val}\">\n      <input type=\"color\" value=\"${val}\" data-edit=\"filterOptions.${name}\">\n  </div>\n</div>\n`;\n  } else if (type === \"range\") {\n    return `\n<div class=\"form-group\">\n  <label>${label}</label>\n  <div class=\"form-fields\">\n      <input type=\"range\" name=\"filterOptions.${name}\" value=\"${val}\" min=\"${control.min}\" max=\"${control.max}\" step=\"${control.step}\">\n      <span class=\"range-value\">${val}</span>\n  </div>\n</div>\n`;\n  } else if (type === \"boolean\") {\n    return `\n<div class=\"form-group\">\n  <label>${label}</label>\n  <div class=\"form-fields\">\n      <input type=\"checkbox\" name=\"filterOptions.${name}\" data-dtype=\"Boolean\" value=\"${val}\" ${val ? \"checked\" : \"\"}>\n  </div>\n</div>\n    `;\n  } else if (type === \"select\") {\n    let select = `\n    <div class=\"form-group\">\n    <label>${label}</label>\n    <div class=\"form-fields\">\n      <select name=\"${name}\">\n`;\n\n    for (const opt of control.options) {\n      select += `<option value=\"${opt.value}\" ${val === opt.value ? 'selected=\"selected\"' : \"\"}>${opt.label}</option>`;\n    }\n\n    select += `</select></div></div>`;\n\n    return select;\n  } else if (type === \"point\") {\n    return `\n<div class=\"form-group\">\n  <label>${label}</label>\n  <div class=\"form-fields\">\n      <input type=\"range\" name=\"filterOptions.${name}\" value=\"${val[0]}\" min=\"${control.min}\" max=\"${control.max}\" step=\"${control.step}\">\n      <span class=\"range-value\">${val[0]}</span>\n  </div>\n  <div class=\"form-fields\">\n    <input type=\"range\" name=\"filterOptions.${name}\" value=\"${val[1]}\" min=\"${control.min}\" max=\"${control.max}\" step=\"${control.step}\">\n    <span class=\"range-value\">${val[1]}</span>\n  </div>\n</div>\n`;\n  } else if (type === \"json\") {\n    let control = `\n<div class=\"form-group\">\n  <label>${label}</label>\n  <div class=\"form-fields\">\n      <textarea style=\"width: 450px; height: 200px;\" name=\"filterOptions.${name}\">${val}</textarea>\n  </div>`;\n    const massEdit = game.modules.get(\"multi-token-edit\");\n    if (massEdit?.active && massEdit.api.showGenericForm) {\n      control += `\n  <div style=\"text-align: right; color: orangered;\">\n      <a> <i class=\"me-edit-json fas fa-edit\" title=\"Show Generic Form\"></i></a>\n  </div>`;\n    }\n    control += `</div>`;\n    return control;\n  } else if (type === \"text\") {\n    return `\n<div class=\"form-group\">\n  <label>${label}</label>\n  <div class=\"form-fields\">\n      <input type=\"text\" name=\"filterOptions.${name}\" value=\"${val}\">\n  </div>\n</div>\n`;\n  } else if (type === \"tmfxPreset\" && game.modules.get(\"tokenmagic\")?.active) {\n    return `\n      <div class=\"form-group\">\n        <label>Preset <span class=\"units\">(TMFX)</span></label>\n        <div class=\"form-fields\">\n          <input list=\"tmfxPresets\" class=\"tmfxPreset\">\n          <button type=\"button\" class=\"presetImport\"><i class=\"fas fa-download\"></i></button>\n        </div>\n      `;\n  }\n  return \"\";\n}\n\nasync function promptParamChoice(params) {\n  return new Promise((resolve, reject) => {\n    const buttons = {};\n    for (let i = 0; i < params.length; i++) {\n      const label = params[i].filterType ?? params[i].filterId;\n      buttons[label] = {\n        label,\n        callback: () => {\n          resolve(i);\n        },\n      };\n    }\n\n    const dialog = new Dialog({\n      title: \"Select Filter To Edit\",\n      content: \"\",\n      buttons,\n      close: () => resolve(-1),\n    });\n    dialog.render(true);\n  });\n}\n","import { TVA_CONFIG } from '../settings.js';\nimport { TVAOverlay } from '../sprite/TVAOverlay.js';\nimport { string2Hex, waitForTokenTexture } from '../utils.js';\nimport { getAllEffectMappings, getTokenEffects, getTokenHP } from '../hooks/effectMappingHooks.js';\n\nexport const FONT_LOADING = {};\n\nexport async function drawOverlays(token) {\n  if (token.tva_drawing_overlays) return;\n  token.tva_drawing_overlays = true;\n\n  const mappings = getAllEffectMappings(token);\n  const effects = getTokenEffects(token, true);\n  let processedMappings = mappings\n    .filter((m) => m.overlay && effects.includes(m.id))\n    .sort(\n      (m1, m2) =>\n        m1.priority - (m1.overlayConfig?.parentID ? 0 : 999) - (m2.priority - (m2.overlayConfig?.parentID ? 0 : 999))\n    );\n\n  // See if the whole stack or just top of the stack should be used according to settings\n  if (processedMappings.length) {\n    processedMappings = TVA_CONFIG.stackStatusConfig\n      ? processedMappings\n      : [processedMappings[processedMappings.length - 1]];\n  }\n\n  // Process strings as expressions\n  const overlays = processedMappings.map((m) => {\n    m.overlayConfig.id = m.id; // TODO: For some reason ID can get de-synced between mapping and overlay\n    return evaluateOverlayExpressions(foundry.utils.deepClone(m.overlayConfig), token, m);\n  });\n\n  if (overlays.length) {\n    waitForTokenTexture(token, async (token) => {\n      if (!token.tvaOverlays) token.tvaOverlays = [];\n      // Temporarily mark every overlay for removal.\n      // We'll only keep overlays that are still applicable to the token\n      _markAllOverlaysForRemoval(token);\n\n      // To keep track of the overlay order\n      let overlaySort = 0;\n      let underlaySort = 0;\n\n      // Process overlays\n      for (const ov of overlays) {\n        let sprite = _findTVAOverlay(ov.id, token);\n        if (sprite) {\n          _evaluateLinkedImages(ov, token.document.texture.src);\n\n          const diff = foundry.utils.diffObject(sprite.overlayConfig, ov);\n\n          // Check if we need to create a new texture or simply refresh the overlay\n          if (!foundry.utils.isEmpty(diff)) {\n            const refreshFilters = Boolean(diff.filter || diff.filterOptions);\n            if (ov.img instanceof Array && ov.img.length > 1) {\n              sprite.refresh(ov, { refreshFilters });\n            } else if (diff.img || diff.text || diff.shapes || diff.repeat || diff.html) {\n              sprite.setTexture(await genTexture(token, ov), { configuration: ov, refreshFilters });\n            } else if (diff.parentID) {\n              sprite.parent?.removeChild(sprite)?.destroy();\n              sprite = null;\n            } else {\n              sprite.refresh(ov, { refreshFilters });\n            }\n          } else if (diff.text?.text || diff.shapes) {\n            sprite.setTexture(await genTexture(token, ov), { configuration: ov, refreshFilters });\n          }\n\n          if ('ui' in diff) {\n            sprite.parent.removeChild(sprite);\n            const layer = ov.ui ? canvas.tokens : canvas.primary;\n            sprite = layer.addChild(sprite);\n          }\n        }\n        if (!sprite) {\n          if (ov.parentID) {\n            const parent = _findTVAOverlay(ov.parentID, token);\n            if (parent && !parent.tvaRemove)\n              sprite = parent.addChildAuto(new TVAOverlay(await genTexture(token, ov), token, ov));\n          } else {\n            const layer = ov.ui ? canvas.tokens : canvas.primary;\n            sprite = layer.addChild(new TVAOverlay(await genTexture(token, ov), token, ov));\n          }\n          if (sprite) token.tvaOverlays.push(sprite);\n        }\n\n        // If the sprite has a parent confirm that the parent has not been removed\n        if (sprite?.overlayConfig.parentID) {\n          const parent = _findTVAOverlay(sprite.overlayConfig.parentID, token);\n          if (!parent || parent.tvaRemove) sprite = null;\n        }\n\n        if (sprite) {\n          sprite.tvaRemove = false; // Sprite in use, do not remove\n\n          // Assign order to the overlay\n          if (sprite.overlayConfig.underlay) {\n            underlaySort -= 0.01;\n            sprite.overlaySort = underlaySort;\n          } else {\n            overlaySort += 0.01;\n            sprite.overlaySort = overlaySort;\n          }\n\n          sprite.parent.sortableChildren = true;\n          sprite.parent.sortDirty = true;\n        }\n      }\n\n      removeMarkedOverlays(token);\n      token.tva_drawing_overlays = false;\n    });\n  } else {\n    _removeAllOverlays(token);\n    token.tva_drawing_overlays = false;\n  }\n}\n\nfunction _evaluateLinkedImages(ov, tokenImage) {\n  if (ov.img instanceof Array) {\n    for (const img of ov.img) {\n      if (img.linked) img.src = tokenImage;\n    }\n  } else if (ov.imgLinked) ov.img = tokenImage;\n}\n\n// function _getLayer(ov) {\n//   const layer = ov.ui ? canvas.tokens : canvas.primary;\n//   if (!layer.tvaOverlay) layer.tvaOverlays = layer.addChild(new PIXI.Container());\n//   return layer.tvaOverlays;\n// }\n\nexport async function genTexture(token, conf) {\n  if (conf.img) {\n    return await generateImage(token, conf);\n  } else if (conf.text?.text != null) {\n    return await generateTextTexture(token, conf);\n  } else if (conf.shapes?.length) {\n    return await generateShapeTexture(token, conf.shapes);\n  } else if (conf.html?.template) {\n    return { html: true, texture: await loadTexture('modules\\\\token-variants\\\\img\\\\html_bg.webp') };\n  } else {\n    return {\n      texture: await loadTexture('modules/token-variants/token-variants/img/token-images.svg'),\n    };\n  }\n}\n\nasync function generateImage(token, conf) {\n  _evaluateLinkedImages(conf, token.document.texture.src);\n\n  let img = conf.img;\n\n  if (img instanceof Array) {\n    img = img[Math.floor(Math.random() * img.length)].src;\n  }\n\n  let texture = await loadTexture(img, {\n    fallback: 'modules/token-variants/token-variants/img/token-images.svg',\n  });\n\n  // Repeat image if needed\n  // Repeating the shape if necessary\n  if (conf.repeating && conf.repeat) {\n    const repeat = conf.repeat;\n    let numRepeats;\n    if (repeat.isPercentage) {\n      numRepeats = Math.ceil(repeat.value / repeat.maxValue / (repeat.increment / 100));\n    } else {\n      numRepeats = Math.ceil(repeat.value / repeat.increment);\n    }\n    let n = 0;\n    let rows = 0;\n    const maxRows = repeat.maxRows ?? Infinity;\n    let xOffset = 0;\n    let yOffset = 0;\n    const paddingX = repeat.paddingX ?? 0;\n    const paddingY = repeat.paddingY ?? 0;\n    let container = new PIXI.Container();\n    while (numRepeats > 0) {\n      let img = new PIXI.Sprite(texture);\n      img.x = xOffset;\n      img.y = yOffset;\n      container.addChild(img);\n      xOffset += texture.width + paddingX;\n      numRepeats--;\n      n++;\n      if (numRepeats != 0 && n >= repeat.perRow) {\n        rows += 1;\n        if (rows >= maxRows) break;\n        yOffset += texture.height + paddingY;\n        xOffset = 0;\n        n = 0;\n      }\n    }\n\n    texture = _renderContainer(container, texture.resolution);\n  }\n\n  return { texture };\n}\n\nfunction _renderContainer(container, resolution, { width = null, height = null } = {}) {\n  const bounds = container.getLocalBounds();\n  const matrix = new PIXI.Matrix();\n  matrix.tx = -bounds.x;\n  matrix.ty = -bounds.y;\n\n  const renderTexture = PIXI.RenderTexture.create({\n    width: width ?? bounds.width,\n    height: height ?? bounds.height,\n    resolution: resolution,\n  });\n\n  canvas.app.renderer.render(container, {\n    renderTexture,\n    clear: true,\n    transform: matrix,\n    skipUpdateTransform: false,\n  });\n\n  renderTexture.destroyable = true;\n  return renderTexture;\n}\n\n// Return width and height of the drawn shape\nfunction _drawShape(graphics, shape, xOffset = 0, yOffset = 0) {\n  if (shape.type === 'rectangle') {\n    graphics.drawRoundedRect(shape.x + xOffset, shape.y + yOffset, shape.width, shape.height, shape.radius);\n    return [shape.width, shape.height];\n  } else if (shape.type === 'ellipse') {\n    graphics.drawEllipse(shape.x + xOffset + shape.width, shape.y + yOffset + shape.height, shape.width, shape.height);\n    return [shape.width * 2, shape.height * 2];\n  } else if (shape.type === 'polygon') {\n    graphics.drawPolygon(\n      shape.points.split(',').map((p, i) => Number(p) * shape.scale + (i % 2 === 0 ? shape.x : shape.y))\n    );\n  } else if (shape.type === 'torus') {\n    drawTorus(\n      graphics,\n      shape.x + xOffset + shape.outerRadius,\n      shape.y + yOffset + shape.outerRadius,\n      shape.innerRadius,\n      shape.outerRadius,\n      Math.toRadians(shape.startAngle),\n      shape.endAngle >= 360 ? Math.PI * 2 : Math.toRadians(shape.endAngle)\n    );\n    return [shape.outerRadius * 2, shape.outerRadius * 2];\n  } else if (shape.type === 'cutCircle') {\n    drawCutCircle(\n      graphics,\n      shape.x + xOffset + shape.radius,\n      shape.y + yOffset + shape.radius,\n      shape.radius,\n      shape.rotation,\n      shape.cut\n    );\n  }\n}\n\nexport async function generateShapeTexture(token, shapes) {\n  let graphics = new PIXI.Graphics();\n\n  for (const obj of shapes) {\n    graphics.beginFill(interpolateColor(obj.fill.color, obj.fill.interpolateColor), obj.fill.alpha);\n    graphics.lineStyle(obj.line.width, string2Hex(obj.line.color), obj.line.alpha);\n\n    const shape = obj.shape;\n\n    // Repeating the shape if necessary\n    if (obj.repeating && obj.repeat) {\n      const repeat = obj.repeat;\n      let numRepeats;\n      if (repeat.isPercentage) {\n        numRepeats = Math.ceil(repeat.value / repeat.maxValue / (repeat.increment / 100));\n      } else {\n        numRepeats = Math.ceil(repeat.value / repeat.increment);\n      }\n      let n = 0;\n      let rows = 0;\n      const maxRows = repeat.maxRows ?? Infinity;\n      let xOffset = 0;\n      let yOffset = 0;\n      const paddingX = repeat.paddingX ?? 0;\n      const paddingY = repeat.paddingY ?? 0;\n      while (numRepeats > 0) {\n        const [width, height] = _drawShape(graphics, shape, xOffset, yOffset);\n        xOffset += width + paddingX;\n        numRepeats--;\n        n++;\n        if (numRepeats != 0 && n >= repeat.perRow) {\n          rows += 1;\n          if (rows >= maxRows) break;\n          yOffset += height + paddingY;\n          xOffset = 0;\n          n = 0;\n        }\n      }\n    } else {\n      _drawShape(graphics, shape);\n    }\n  }\n\n  // Store original graphics dimensions as these may change when children are added\n  graphics.shapesWidth = Number(graphics.width);\n  graphics.shapesHeight = Number(graphics.height);\n\n  return { texture: PIXI.Texture.EMPTY, shapes: graphics };\n}\n\nfunction drawTorus(graphics, x, y, innerRadius, outerRadius, startArc = 0, endArc = Math.PI * 2) {\n  if (Math.abs(endArc - startArc) >= Math.PI * 2) {\n    return graphics.drawCircle(x, y, outerRadius).beginHole().drawCircle(x, y, innerRadius).endHole();\n  }\n\n  graphics.finishPoly();\n  graphics.arc(x, y, innerRadius, endArc, startArc, true).arc(x, y, outerRadius, startArc, endArc, false).finishPoly();\n}\n\nfunction drawCutCircle(graphics, x, y, radius, rotation, cut) {\n  if (cut >= 1) return;\n  else if (cut <= 0) return graphics.drawCircle(x, y, radius);\n\n  let startAngle = -90 + 180 * cut + rotation;\n  let endAngle = 270 - 180 * cut + rotation;\n\n  graphics.arc(x, y, radius, Math.toRadians(startAngle), Math.toRadians(endAngle), false).closePath().finishPoly();\n}\n\nexport function interpolateColor(minColor, interpolate, rString = false) {\n  if (!interpolate || !interpolate.color2 || !interpolate.prc) return rString ? minColor : string2Hex(minColor);\n\n  if (!PIXI.Color) return _interpolateV10(minColor, interpolate, rString);\n\n  const percentage = interpolate.prc;\n  minColor = new PIXI.Color(minColor);\n  const maxColor = new PIXI.Color(interpolate.color2);\n\n  let minHsv = rgb2hsv(minColor.red, minColor.green, minColor.blue);\n  let maxHsv = rgb2hsv(maxColor.red, maxColor.green, maxColor.blue);\n\n  let deltaHue = maxHsv[0] - minHsv[0];\n  let deltaAngle = deltaHue + (Math.abs(deltaHue) > 180 ? (deltaHue < 0 ? 360 : -360) : 0);\n\n  let targetHue = minHsv[0] + deltaAngle * percentage;\n  let targetSaturation = (1 - percentage) * minHsv[1] + percentage * maxHsv[1];\n  let targetValue = (1 - percentage) * minHsv[2] + percentage * maxHsv[2];\n\n  let result = new PIXI.Color({ h: targetHue, s: targetSaturation * 100, v: targetValue * 100 });\n  return rString ? result.toHex() : result.toNumber();\n}\n\nfunction _interpolateV10(minColor, interpolate, rString = false) {\n  const percentage = interpolate.prc;\n  minColor = PIXI.utils.hex2rgb(string2Hex(minColor));\n  const maxColor = PIXI.utils.hex2rgb(string2Hex(interpolate.color2));\n\n  let minHsv = rgb2hsv(minColor[0], minColor[1], minColor[2]);\n  let maxHsv = rgb2hsv(maxColor[0], maxColor[1], maxColor[2]);\n\n  let deltaHue = maxHsv[0] - minHsv[0];\n  let deltaAngle = deltaHue + (Math.abs(deltaHue) > 180 ? (deltaHue < 0 ? 360 : -360) : 0);\n\n  let targetHue = minHsv[0] + deltaAngle * percentage;\n  let targetSaturation = (1 - percentage) * minHsv[1] + percentage * maxHsv[1];\n  let targetValue = (1 - percentage) * minHsv[2] + percentage * maxHsv[2];\n\n  let result = Color.fromHSV([targetHue / 360, targetSaturation, targetValue]);\n  return rString ? result.toString() : Number(result);\n}\n\n/**\n * Converts a color from RGB to HSV space.\n * Source: https://stackoverflow.com/questions/8022885/rgb-to-hsv-color-in-javascript/54070620#54070620\n */\nfunction rgb2hsv(r, g, b) {\n  let v = Math.max(r, g, b),\n    c = v - Math.min(r, g, b);\n  let h = c && (v == r ? (g - b) / c : v == g ? 2 + (b - r) / c : 4 + (r - g) / c);\n  return [60 * (h < 0 ? h + 6 : h), v && c / v, v];\n}\n\nconst CORE_VARIABLES = {\n  '@hp': (token) => getTokenHP(token)?.[0],\n  '@hpMax': (token) => getTokenHP(token)?.[1],\n  '@gridSize': () => canvas.grid?.size,\n  '@label': (_, conf) => conf.label,\n};\n\nfunction _evaluateString(str, token, conf) {\n  let variables = conf.overlayConfig?.variables;\n  const re2 = new RegExp('@\\\\w+', 'gi');\n  str = str.replace(re2, function replace(match) {\n    let name = match.substr(1, match.length);\n    let v = variables?.find((v) => v.name === name);\n    if (v) return v.value;\n    else if (match in CORE_VARIABLES) return CORE_VARIABLES[match](token, conf);\n    return match;\n  });\n\n  const re = new RegExp('{{.*?}}', 'gi');\n  str = str\n    .replace(re, function replace(match) {\n      const property = match.substring(2, match.length - 2);\n      if (conf && property === 'effect') {\n        return conf.expression;\n      }\n      if (token && property === 'hp') return getTokenHP(token)?.[0];\n      else if (token && property === 'hpMax') return getTokenHP(token)?.[1];\n      const val = foundry.utils.getProperty(token.document ?? token, property);\n      return val ?? 0;\n    })\n    .replace('\\\\n', '\\n');\n\n  return str;\n}\n\nfunction _executeString(evalString, token) {\n  try {\n    const actor = token.actor; // So that actor is easily accessible within eval() scope\n    const result = eval(evalString);\n    if (foundry.utils.getType(result) === 'Object') evalString;\n    return result;\n  } catch (e) {}\n  return evalString;\n}\n\nexport function evaluateOverlayExpressions(obj, token, conf) {\n  for (const [k, v] of Object.entries(obj)) {\n    if (\n      ![\n        'label',\n        'interactivity',\n        'variables',\n        'id',\n        'parentID',\n        'limitedUsers',\n        'filter',\n        //'filterOptions',\n        'limitOnProperty',\n        'html',\n      ].includes(k)\n    ) {\n      obj[k] = _evaluateObjExpressions(v, token, conf);\n    }\n  }\n  return obj;\n}\n\n// Evaluate provided object values substituting in {{path.to.property}} with token properties, and performing eval() on strings\nfunction _evaluateObjExpressions(obj, token, conf) {\n  const t = foundry.utils.getType(obj);\n  if (t === 'string') {\n    const str = _evaluateString(obj, token, conf);\n    return _executeString(str, token);\n  } else if (t === 'Array') {\n    for (let i = 0; i < obj.length; i++) {\n      obj[i] = _evaluateObjExpressions(obj[i], token, conf);\n    }\n  } else if (t === 'Object') {\n    for (const [k, v] of Object.entries(obj)) {\n      // Exception for text overlay\n      if (k === 'text' && foundry.utils.getType(v) === 'string' && v) {\n        const evalString = _evaluateString(v, token, conf);\n        const result = _executeString(evalString, token);\n        if (foundry.utils.getType(result) !== 'string') obj[k] = evalString;\n        else obj[k] = result;\n      } else obj[k] = _evaluateObjExpressions(v, token, conf);\n    }\n  }\n  return obj;\n}\n\nexport async function generateTextTexture(token, conf) {\n  await FONT_LOADING.loading;\n  let label = conf.text.text;\n\n  // Repeating the string if necessary\n  if (conf.text.repeating && conf.text.repeat) {\n    let tmp = '';\n    const repeat = conf.text.repeat;\n    let numRepeats;\n    if (repeat.isPercentage) {\n      numRepeats = Math.ceil(repeat.value / repeat.maxValue / (repeat.increment / 100));\n    } else {\n      numRepeats = Math.ceil(repeat.value / repeat.increment);\n    }\n    let n = 0;\n    let rows = 0;\n    let maxRows = repeat.maxRows ?? Infinity;\n    while (numRepeats > 0) {\n      tmp += label;\n      numRepeats--;\n      n++;\n      if (numRepeats != 0 && n >= repeat.perRow) {\n        rows += 1;\n        if (rows >= maxRows) break;\n        tmp += '\\n';\n        n = 0;\n      }\n    }\n    label = tmp;\n  }\n\n  let style = PreciseText.getTextStyle({\n    ...conf.text,\n    fontFamily: [conf.text.fontFamily, 'fontAwesome'].join(','),\n    fill: interpolateColor(conf.text.fill, conf.text.interpolateColor, true),\n  });\n  const text = new PreciseText(label, style);\n  text.updateText(false);\n\n  const texture = text.texture;\n  const height = conf.text.maxHeight ? Math.min(texture.height, conf.text.maxHeight) : null;\n  const curve = conf.text.curve;\n\n  if (!height && !curve?.radius && !curve?.angle) {\n    texture.textLabel = label;\n    return { texture };\n  }\n\n  const container = new PIXI.Container();\n\n  if (curve?.radius || curve?.angle) {\n    // Curve the text\n    const letterSpacing = conf.text.letterSpacing ?? 0;\n    const radius = curve.angle ? (texture.width + letterSpacing) / (Math.PI * 2) / (curve.angle / 360) : curve.radius;\n    const maxRopePoints = 100;\n    const step = Math.PI / maxRopePoints;\n\n    let ropePoints = maxRopePoints - Math.round((texture.width / (radius * Math.PI)) * maxRopePoints);\n    ropePoints /= 2;\n\n    const points = [];\n    for (let i = maxRopePoints - ropePoints; i > ropePoints; i--) {\n      const x = radius * Math.cos(step * i);\n      const y = radius * Math.sin(step * i);\n      points.push(new PIXI.Point(x, curve.invert ? y : -y));\n    }\n    const rope = new PIXI.SimpleRope(texture, points);\n    container.addChild(rope);\n  } else {\n    container.addChild(new PIXI.Sprite(texture));\n  }\n\n  const renderTexture = _renderContainer(container, 2, { height });\n  text.destroy();\n\n  renderTexture.textLabel = label;\n  return { texture: renderTexture };\n}\n\nfunction _markAllOverlaysForRemoval(token) {\n  for (const child of token.tvaOverlays) {\n    if (child instanceof TVAOverlay) {\n      child.tvaRemove = true;\n    }\n  }\n}\n\nexport function removeMarkedOverlays(token) {\n  const sprites = [];\n  for (const child of token.tvaOverlays) {\n    if (child.tvaRemove) {\n      child.parent?.removeChild(child)?.destroy();\n    } else {\n      sprites.push(child);\n    }\n  }\n  token.tvaOverlays = sprites;\n}\n\nfunction _findTVAOverlay(id, token) {\n  for (const child of token.tvaOverlays) {\n    if (child.overlayConfig?.id === id) {\n      return child;\n    }\n  }\n  return null;\n}\n\nfunction _removeAllOverlays(token) {\n  if (token.tvaOverlays)\n    for (const child of token.tvaOverlays) {\n      child.parent?.removeChild(child)?.destroy();\n    }\n  token.tvaOverlays = null;\n}\n\nexport function broadcastDrawOverlays(token) {\n  // Need to broadcast to other users to re-draw the overlay\n  if (token) drawOverlays(token);\n  const actorId = token.document?.actorLink ? token.actor?.id : null;\n  const message = {\n    handlerName: 'drawOverlays',\n    args: { tokenId: token.id, actorId },\n    type: 'UPDATE',\n  };\n  game.socket?.emit('module.token-variants', message);\n}\n","import { TVA_CONFIG, updateSettings, _arrayAwareDiffObject } from './settings.js';\nimport { showArtSelect } from '../token-variants.mjs';\nimport EffectMappingForm from '../applications/effectMappingForm.js';\nimport CompendiumMapConfig from '../applications/compendiumMap.js';\nimport { toggleTemplateDialog } from '../applications/dialogs.js';\n\nconst simplifyRegex = new RegExp(/[^A-Za-z0-9/\\\\]/g);\n\nexport const SUPPORTED_COMP_ATTRIBUTES = ['rotation', 'elevation'];\nexport const EXPRESSION_OPERATORS = ['\\\\(', '\\\\)', '&&', '||', '\\\\!'];\n\n// Types of searches\nexport const SEARCH_TYPE = {\n  PORTRAIT: 'Portrait',\n  TOKEN: 'Token',\n  PORTRAIT_AND_TOKEN: 'PortraitAndToken',\n  TILE: 'Tile',\n  ITEM: 'Item',\n  JOURNAL: 'JournalEntry',\n  MACRO: 'Macro',\n};\n\nexport const BASE_IMAGE_CATEGORIES = [\n  'Portrait',\n  'Token',\n  'PortraitAndToken',\n  'Tile',\n  'Item',\n  'JournalEntry',\n  'Macro',\n  'RollTable',\n];\n\nexport const PRESSED_KEYS = {\n  popupOverride: false,\n  config: false,\n};\n\nconst BATCH_UPDATES = {\n  TOKEN: [],\n  TOKEN_CALLBACKS: [],\n  TOKEN_CONTEXT: { animate: true },\n  ACTOR: [],\n  ACTOR_CONTEXT: null,\n};\n\nexport function startBatchUpdater() {\n  canvas.app.ticker.add(() => {\n    if (BATCH_UPDATES.TOKEN.length) {\n      canvas.scene.updateEmbeddedDocuments('Token', BATCH_UPDATES.TOKEN, BATCH_UPDATES.TOKEN_CONTEXT).then(() => {\n        for (const cb of BATCH_UPDATES.TOKEN_CALLBACKS) {\n          cb();\n        }\n        BATCH_UPDATES.TOKEN_CALLBACKS = [];\n      });\n      BATCH_UPDATES.TOKEN = [];\n    }\n    if (BATCH_UPDATES.ACTOR.length !== 0) {\n      if (BATCH_UPDATES.ACTOR_CONTEXT) Actor.updateDocuments(BATCH_UPDATES.ACTOR, BATCH_UPDATES.ACTOR_CONTEXT);\n      else Actor.updateDocuments(BATCH_UPDATES.ACTOR);\n      BATCH_UPDATES.ACTOR = [];\n      BATCH_UPDATES.ACTOR_CONTEXT = null;\n    }\n  });\n}\n\nexport function queueTokenUpdate(id, update, callback = null, animate = true) {\n  update._id = id;\n  BATCH_UPDATES.TOKEN.push(update);\n  BATCH_UPDATES.TOKEN_CONTEXT = { animate };\n  if (callback) BATCH_UPDATES.TOKEN_CALLBACKS.push(callback);\n}\n\nexport function queueActorUpdate(id, update, context = null) {\n  update._id = id;\n  BATCH_UPDATES.ACTOR.push(update);\n  BATCH_UPDATES.ACTOR_CONTEXT = context;\n}\n\n/**\n * Updates Token and/or Proto Token  with the new image and custom configuration if one exists.\n * @param {string} imgSrc Image source path/url\n * @param {object} [options={}] Update options\n * @param {Token[]} [options.token] Token to be updated with the new image\n * @param {Actor} [options.actor] Actor with Proto Token to be updated with the new image\n * @param {string} [options.imgName] Image name if it differs from the file name. Relevant for rolltable sourced images.\n * @param {object} [options.tokenUpdate] Token update to be merged and performed at the same time as image update\n * @param {object} [options.actorUpdate] Actor update to be merged and performed at the same time as image update\n * @param {string} [options.pack] Compendium pack of the Actor being updated\n * @param {func} [options.callback] Callback to be executed when a batch update has been performed\n * @param {object} [options.config] Token Configuration settings to be applied to the token\n */\nexport async function updateTokenImage(\n  imgSrc,\n  {\n    token = null,\n    actor = null,\n    imgName = null,\n    tokenUpdate = {},\n    actorUpdate = {},\n    pack = '',\n    callback = null,\n    config = undefined,\n    animate = true,\n    update = null,\n    applyDefaultConfig = true,\n  } = {}\n) {\n  if (!(token || actor)) {\n    console.warn(game.i18n.localize('token-variants.notifications.warn.update-image-no-token-actor'));\n    return;\n  }\n\n  token = token?.document ?? token;\n\n  // Check if it's a wildcard image\n  if ((imgSrc && imgSrc.includes('*')) || (imgSrc.includes('{') && imgSrc.includes('}'))) {\n    const images = await wildcardImageSearch(imgSrc);\n    if (images.length) {\n      imgSrc = images[Math.floor(Math.random() * images.length)];\n    }\n  }\n\n  if (!actor && token.actor) {\n    actor = game.actors.get(token.actor.id);\n  }\n\n  const getDefaultConfig = (token, actor) => {\n    let configEntries = [];\n    if (token) configEntries = token.getFlag('token-variants', 'defaultConfig') || [];\n    else if (actor) {\n      const tokenData = actor.prototypeToken;\n      if ('token-variants' in tokenData.flags && 'defaultConfig' in tokenData['token-variants'])\n        configEntries = tokenData['token-variants']['defaultConfig'];\n    }\n    return foundry.utils.expandObject(Object.fromEntries(configEntries));\n  };\n\n  const constructDefaultConfig = (origData, customConfig) => {\n    const flatOrigData = foundry.utils.flattenObject(origData);\n    TokenDataAdapter.dataToForm(flatOrigData);\n    const flatCustomConfig = foundry.utils.flattenObject(customConfig);\n    let filtered = foundry.utils.filterObject(flatOrigData, flatCustomConfig);\n\n    // Flags need special treatment as once set they are not removed via absence of them in the update\n    for (let [k, v] of Object.entries(flatCustomConfig)) {\n      if (k.startsWith('flags.')) {\n        if (!(k in flatOrigData)) {\n          let splitK = k.split('.');\n          splitK[splitK.length - 1] = '-=' + splitK[splitK.length - 1];\n          filtered[splitK.join('.')] = null;\n        }\n      }\n    }\n\n    return Object.entries(filtered);\n  };\n\n  let tokenUpdateObj = tokenUpdate;\n  if (imgSrc) {\n    foundry.utils.setProperty(tokenUpdateObj, 'texture.src', imgSrc);\n    if (imgName && getFileName(imgSrc) === imgName)\n      foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.-=name', null);\n    else foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.name', imgName);\n  }\n\n  const tokenCustomConfig = foundry.utils.mergeObject(\n    getTokenConfigForUpdate(imgSrc || token?.texture.src, imgName, token),\n    config ?? {}\n  );\n  const usingCustomConfig = token?.getFlag('token-variants', 'usingCustomConfig');\n  const defaultConfig = getDefaultConfig(token);\n  if (!foundry.utils.isEmpty(tokenCustomConfig) || usingCustomConfig) {\n    tokenUpdateObj = modMergeObject(tokenUpdateObj, defaultConfig);\n  }\n\n  if (!foundry.utils.isEmpty(tokenCustomConfig)) {\n    if (token) {\n      foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.usingCustomConfig', true);\n      let doc = token.document ?? token;\n      const tokenData = doc.toObject ? doc.toObject() : foundry.utils.deepClone(doc);\n\n      const defConf = constructDefaultConfig(foundry.utils.mergeObject(tokenData, defaultConfig), tokenCustomConfig);\n      foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.defaultConfig', defConf);\n    } else if (actor && !token) {\n      foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.usingCustomConfig', true);\n      const tokenData = actor.prototypeToken instanceof Object ? actor.prototypeToken : actor.prototypeToken.toObject();\n      const defConf = constructDefaultConfig(tokenData, tokenCustomConfig);\n      foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.defaultConfig', defConf);\n    }\n\n    // Fix, an empty flag may be passed which would overwrite any current flags in the updateObj\n    // Remove it before doing the merge\n    if (!tokenCustomConfig.flags) {\n      delete tokenCustomConfig.flags;\n    }\n\n    tokenUpdateObj = modMergeObject(tokenUpdateObj, tokenCustomConfig);\n  } else if (usingCustomConfig) {\n    foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.-=usingCustomConfig', null);\n    delete tokenUpdateObj?.flags?.['token-variants']?.defaultConfig;\n    foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.-=defaultConfig', null);\n  }\n\n  if (!applyDefaultConfig) {\n    foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.-=usingCustomConfig', null);\n    delete tokenUpdateObj?.flags?.['token-variants']?.defaultConfig;\n    foundry.utils.setProperty(tokenUpdateObj, 'flags.token-variants.-=defaultConfig', null);\n  }\n\n  if (!foundry.utils.isEmpty(tokenUpdateObj)) {\n    if (actor && !token) {\n      TokenDataAdapter.formToData(actor.prototypeToken, tokenUpdateObj);\n      actorUpdate.prototypeToken = tokenUpdateObj;\n      if (pack) {\n        queueActorUpdate(actor.id, actorUpdate, { pack: pack });\n      } else {\n        await (actor.document ?? actor).update(actorUpdate);\n      }\n    }\n\n    if (token) {\n      TokenDataAdapter.formToData(token, tokenUpdateObj);\n      if (TVA_CONFIG.updateTokenProto && token.actor) {\n        if (update) {\n          foundry.utils.mergeObject(update, { prototypeToken: tokenUpdateObj });\n        } else {\n          // Timeout to prevent race conditions with other modules namely MidiQOL\n          // this is a low priority update so it should be Ok to do\n          if (token.actorLink) {\n            setTimeout(() => queueActorUpdate(token.actor.id, { prototypeToken: tokenUpdateObj }), 500);\n          } else if (token.baseActor) {\n            setTimeout(() => token.baseActor.update({ prototypeToken: tokenUpdateObj }), 500);\n          }\n        }\n      }\n\n      if (update) {\n        foundry.utils.mergeObject(update, tokenUpdateObj);\n      } else {\n        if (token.object) queueTokenUpdate(token.id, tokenUpdateObj, callback, animate);\n        else {\n          await token.update(tokenUpdateObj, { animate });\n          callback();\n        }\n      }\n    }\n  }\n}\n\n/**\n * Assign new artwork to the actor\n */\nexport async function updateActorImage(actor, imgSrc, directUpdate = true, pack = '') {\n  if (!actor) return;\n  if (directUpdate) {\n    await (actor.document ?? actor).update({\n      img: imgSrc,\n    });\n  } else {\n    queueActorUpdate(\n      actor.id,\n      {\n        img: imgSrc,\n      },\n      pack ? { pack: pack } : null\n    );\n  }\n}\n\nasync function showTileArtSelect() {\n  for (const tile of canvas.tiles.controlled) {\n    const tileName = tile.document.getFlag('token-variants', 'tileName') || tile.id;\n    showArtSelect(tileName, {\n      callback: async function (imgSrc, name) {\n        tile.document.update({ img: imgSrc });\n      },\n      searchType: SEARCH_TYPE.TILE,\n    });\n  }\n}\n\n/**\n * Checks if a key is pressed taking into account current game version.\n * @param {string} key v/Ctrl/Shift/Alt\n * @returns\n */\nexport function keyPressed(key) {\n  if (key === 'v') return game.keyboard.downKeys.has('KeyV');\n  return PRESSED_KEYS[key];\n}\n\nexport function registerKeybinds() {\n  game.keybindings.register('token-variants', 'popupOverride', {\n    name: 'Popup Override',\n    hint: 'When held will trigger popups even when they are disabled.',\n    editable: [\n      {\n        key: 'ShiftLeft',\n      },\n    ],\n    onDown: () => {\n      PRESSED_KEYS.popupOverride = true;\n    },\n    onUp: () => {\n      PRESSED_KEYS.popupOverride = false;\n    },\n    restricted: false,\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\n  });\n  game.keybindings.register('token-variants', 'config', {\n    name: 'Config',\n    hint: 'When held during a mouse Left-Click of an Image or an Active Affect will display a configuration window.',\n    editable: [\n      {\n        key: 'ShiftLeft',\n      },\n    ],\n    onDown: () => {\n      PRESSED_KEYS.config = true;\n    },\n    onUp: () => {\n      PRESSED_KEYS.config = false;\n    },\n    restricted: false,\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\n  });\n  game.keybindings.register('token-variants', 'showArtSelectPortrait', {\n    name: 'Show Art Select: Portrait',\n    hint: 'Brings up an Art Select pop-up to change the portrait images of the selected tokens.',\n    editable: [\n      {\n        key: 'Digit1',\n        modifiers: ['Shift'],\n      },\n    ],\n    onDown: () => {\n      for (const token of canvas.tokens.controlled) {\n        const actor = token.actor;\n        if (!actor) continue;\n        showArtSelect(actor.name, {\n          callback: async function (imgSrc, name) {\n            await updateActorImage(actor, imgSrc);\n          },\n          searchType: SEARCH_TYPE.PORTRAIT,\n          object: actor,\n        });\n      }\n      if (TVA_CONFIG.tilesEnabled && canvas.tokens.controlled.length === 0) showTileArtSelect();\n    },\n    restricted: true,\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\n  });\n  game.keybindings.register('token-variants', 'showArtSelectToken', {\n    name: 'Show Art Select: Token',\n    hint: 'Brings up an Art Select pop-up to change the token images of the selected tokens.',\n    editable: [\n      {\n        key: 'Digit2',\n        modifiers: ['Shift'],\n      },\n    ],\n    onDown: () => {\n      for (const token of canvas.tokens.controlled) {\n        showArtSelect(token.name, {\n          callback: async function (imgSrc, imgName) {\n            updateTokenImage(imgSrc, {\n              actor: token.actor,\n              imgName: imgName,\n              token: token,\n            });\n          },\n          searchType: SEARCH_TYPE.TOKEN,\n          object: token,\n        });\n      }\n      if (TVA_CONFIG.tilesEnabled && canvas.tokens.controlled.length === 0) showTileArtSelect();\n    },\n    restricted: true,\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\n  });\n  game.keybindings.register('token-variants', 'showArtSelectGeneral', {\n    name: 'Show Art Select: Portrait+Token',\n    hint: 'Brings up an Art Select pop-up to change both Portrait and Token images of the selected tokens.',\n    editable: [\n      {\n        key: 'Digit3',\n        modifiers: ['Shift'],\n      },\n    ],\n    onDown: () => {\n      for (const token of canvas.tokens.controlled) {\n        const actor = token.actor;\n        showArtSelect(token.name, {\n          callback: async function (imgSrc, imgName) {\n            if (actor) await updateActorImage(actor, imgSrc);\n            updateTokenImage(imgSrc, {\n              actor: token.actor,\n              imgName: imgName,\n              token: token,\n            });\n          },\n          searchType: SEARCH_TYPE.PORTRAIT_AND_TOKEN,\n          object: token,\n        });\n      }\n      if (TVA_CONFIG.tilesEnabled && canvas.tokens.controlled.length === 0) showTileArtSelect();\n    },\n    restricted: true,\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\n  });\n  game.keybindings.register('token-variants', 'openGlobalMappings', {\n    name: 'Open Global Effect Configurations',\n    hint: 'Brings up the settings window for Global Effect Configurations',\n    editable: [\n      {\n        key: 'KeyG',\n        modifiers: ['Shift'],\n      },\n    ],\n    onDown: () => {\n      const setting = game.settings.get('core', DefaultTokenConfig.SETTING);\n      const data = new foundry.data.PrototypeToken(setting);\n      const token = new TokenDocument(data, { actor: null });\n      new EffectMappingForm(token, { globalMappings: true }).render(true);\n    },\n    restricted: true,\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\n  });\n\n  game.keybindings.register('token-variants', 'compendiumMapper', {\n    name: 'Compendium Mapper',\n    hint: 'Opens Compendium Mapper',\n    editable: [\n      {\n        key: 'KeyM',\n        modifiers: ['Shift'],\n      },\n    ],\n    onDown: () => {\n      new CompendiumMapConfig().render(true);\n    },\n    restricted: true,\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\n  });\n\n  game.keybindings.register('token-variants', 'toggleTemplate', {\n    name: 'Toggle Template Dialog',\n    hint: 'Brings up a dialog from which you can toggle templates on currently selected tokens.',\n    editable: [],\n    onDown: toggleTemplateDialog,\n    restricted: true,\n    precedence: CONST.KEYBINDING_PRECEDENCE.NORMAL,\n  });\n}\n\n/**\n * Retrieves a custom token configuration if one exists for the given image\n */\nexport function getTokenConfig(imgSrc, imgName) {\n  imgSrc = decodeURISafely(imgSrc);\n  if (!imgName) imgName = getFileName(imgSrc);\n  const tokenConfigs = (TVA_CONFIG.tokenConfigs || []).flat();\n  return tokenConfigs.find((config) => config.tvImgSrc == imgSrc && config.tvImgName == imgName) ?? {};\n}\n\n/**\n * Retrieves a custom token configuration if one exists for the given image and removes control keys\n * returning a clean config that can be used in token update.\n */\nexport function getTokenConfigForUpdate(imgSrc, imgName, token) {\n  if (!imgSrc) return {};\n\n  let tokenConfig = {};\n  for (const path of TVA_CONFIG.searchPaths) {\n    if (path.config && imgSrc.startsWith(path.text)) {\n      foundry.utils.mergeObject(tokenConfig, path.config);\n    }\n  }\n\n  let imgConfig = getTokenConfig(imgSrc, imgName ?? getFileName(imgSrc));\n  if (!foundry.utils.isEmpty(imgConfig)) {\n    imgConfig = foundry.utils.deepClone(imgConfig);\n    delete imgConfig.tvImgSrc;\n    delete imgConfig.tvImgName;\n    if (token) TokenDataAdapter.formToData(token, imgConfig);\n\n    for (var key in imgConfig) {\n      if (!key.startsWith('tvTab_')) {\n        tokenConfig[key] = imgConfig[key];\n      }\n    }\n  }\n\n  if (TVA_CONFIG.imgNameContainsDimensions || TVA_CONFIG.imgNameContainsFADimensions) {\n    extractDimensionsFromImgName(imgSrc, tokenConfig);\n  }\n\n  return tokenConfig;\n}\n\n/**\n * Adds or removes a custom token configuration\n */\nexport function setTokenConfig(imgSrc, imgName, tokenConfig) {\n  const tokenConfigs = (TVA_CONFIG.tokenConfigs || []).flat();\n  const tcIndex = tokenConfigs.findIndex((config) => config.tvImgSrc == imgSrc && config.tvImgName == imgName);\n\n  let deleteConfig = !tokenConfig || Object.keys(tokenConfig).length === 0;\n  if (!deleteConfig) {\n    tokenConfig['tvImgSrc'] = imgSrc;\n    tokenConfig['tvImgName'] = imgName;\n  }\n\n  if (tcIndex != -1 && !deleteConfig) {\n    tokenConfigs[tcIndex] = tokenConfig;\n  } else if (tcIndex != -1 && deleteConfig) {\n    tokenConfigs.splice(tcIndex, 1);\n  } else if (!deleteConfig) {\n    tokenConfigs.push(tokenConfig);\n  }\n  updateSettings({ tokenConfigs: tokenConfigs });\n  return !deleteConfig;\n}\n\n/**\n * Extracts the file name from the given path.\n */\nexport function getFileName(path) {\n  if (!path) return '';\n  return decodeURISafely(path).split('\\\\').pop().split('/').pop().split('.').slice(0, -1).join('.');\n}\n\n/**\n * Extracts the file name including the extension from the given path.\n */\nexport function getFileNameWithExt(path) {\n  if (!path) return '';\n  return decodeURISafely(path).split('\\\\').pop().split('/').pop();\n}\n\n/**\n * Extract the directory path excluding the file name.\n */\nexport function getFilePath(path) {\n  return decodeURISafely(path).match(/(.*)[\\/\\\\]/)[1] || '';\n}\n\n/**\n * Simplify name.\n */\nexport function simplifyName(name) {\n  return name.replace(simplifyRegex, '').toLowerCase();\n}\n\nexport function simplifyPath(path) {\n  return decodeURIComponentSafely(path).replace(simplifyRegex, '').toLowerCase();\n}\n\n/**\n * Parses the 'excludedKeyword' setting (a comma separated string) into a Set\n */\nexport function parseKeywords(keywords) {\n  return keywords\n    .split(/\\W/)\n    .map((word) => simplifyName(word))\n    .filter((word) => word != '');\n}\n\n/**\n * Returns true of provided path points to an image\n */\nexport function isImage(path) {\n  var extension = path.split('.');\n  extension = extension[extension.length - 1].toLowerCase();\n  return ['jpg', 'jpeg', 'png', 'svg', 'webp', 'gif'].includes(extension);\n}\n\n/**\n * Returns true of provided path points to a video\n */\nexport function isVideo(path) {\n  var extension = path.split('.');\n  extension = extension[extension.length - 1].toLowerCase();\n  return ['mp4', 'ogg', 'webm', 'm4v'].includes(extension);\n}\n\n/**\n * Send a recursive HTTP asset browse request to ForgeVTT\n * @param {string} path Asset Library path\n * @param {string} apiKey Key with read access to the Asset Library\n * @returns\n */\nexport async function callForgeVTT(path, apiKey) {\n  return new Promise(async (resolve, reject) => {\n    if (typeof ForgeVTT === 'undefined' || !ForgeVTT.usingTheForge) return resolve({});\n\n    const url = `${ForgeVTT.FORGE_URL}/api/assets/browse`;\n    const xhr = new XMLHttpRequest();\n    xhr.withCredentials = true;\n    xhr.open('POST', url);\n    xhr.setRequestHeader('Access-Key', apiKey);\n    xhr.setRequestHeader('X-XSRF-TOKEN', await ForgeAPI.getXSRFToken());\n    xhr.responseType = 'json';\n\n    xhr.onreadystatechange = () => {\n      if (xhr.readyState !== 4) return;\n      resolve(xhr.response);\n    };\n    xhr.onerror = (err) => {\n      resolve({ code: 500, error: err.message });\n    };\n    let formData = {\n      path: path,\n      options: {\n        recursive: true,\n      },\n    };\n    formData = JSON.stringify(formData);\n    xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');\n    xhr.send(formData);\n  });\n}\n\n/**\n * Retrieves filters based on the type of search.\n * @param {SEARCH_TYPE} searchType\n */\nexport function getFilters(searchType, filters) {\n  // Select filters based on type of search\n  filters = filters ? filters : TVA_CONFIG.searchFilters;\n\n  if (filters[searchType]) {\n    filters = filters[searchType];\n  } else {\n    filters = {\n      include: '',\n      exclude: '',\n      regex: '',\n    };\n  }\n\n  if (filters.regex) filters.regex = new RegExp(filters.regex);\n  return filters;\n}\n\nexport function userRequiresImageCache(perm) {\n  const permissions = perm ? perm : TVA_CONFIG.permissions;\n  const role = game.user.role;\n  return (\n    permissions.popups[role] ||\n    permissions.portrait_right_click[role] ||\n    permissions.image_path_button[role] ||\n    permissions.hudFullAccess[role]\n  );\n}\n\nexport async function waitForTokenTexture(token, callback, checks = 40) {\n  // v10/v9 compatibility\n\n  if (!token.mesh || !token.mesh.texture) {\n    checks--;\n    if (checks > 1)\n      new Promise((resolve) => setTimeout(resolve, 1)).then(() => waitForTokenTexture(token, callback, checks));\n    return;\n  }\n\n  callback(token);\n}\n\nexport function flattenSearchResults(results) {\n  let flattened = [];\n  if (!results) return flattened;\n  results.forEach((images) => {\n    flattened = flattened.concat(images);\n  });\n  return flattened;\n}\n\n// Slightly modified version of mergeObject; added an option to ignore -= keys\nexport function modMergeObject(\n  original,\n  other = {},\n  {\n    insertKeys = true,\n    insertValues = true,\n    overwrite = true,\n    recursive = true,\n    inplace = true,\n    enforceTypes = false,\n  } = {},\n  _d = 0\n) {\n  other = other || {};\n  if (!(original instanceof Object) || !(other instanceof Object)) {\n    throw new Error('One of original or other are not Objects!');\n  }\n  const options = {\n    insertKeys,\n    insertValues,\n    overwrite,\n    recursive,\n    inplace,\n    enforceTypes,\n  };\n\n  // Special handling at depth 0\n  if (_d === 0) {\n    if (!inplace) original = foundry.utils.deepClone(original);\n    if (Object.keys(original).some((k) => /\\./.test(k))) original = foundry.utils.expandObject(original);\n    if (Object.keys(other).some((k) => /\\./.test(k))) other = foundry.utils.expandObject(other);\n  }\n\n  // Iterate over the other object\n  for (let k of Object.keys(other)) {\n    const v = other[k];\n    if (original.hasOwnProperty('-=' + k)) {\n      original[k] = original['-=' + k];\n      delete original['-=' + k];\n    }\n    if (original.hasOwnProperty(k)) _modMergeUpdate(original, k, v, options, _d + 1);\n    else _modMergeInsert(original, k, v, options, _d + 1);\n  }\n  return original;\n}\n\n/**\n * A helper function for merging objects when the target key does not exist in the original\n * @private\n */\nfunction _modMergeInsert(original, k, v, { insertKeys, insertValues } = {}, _d) {\n  // Recursively create simple objects\n  if (v?.constructor === Object) {\n    original[k] = modMergeObject({}, v, {\n      insertKeys: true,\n      inplace: true,\n    });\n    return;\n  }\n\n  // Delete a key\n  // if (k.startsWith('-=')) {\n  //   delete original[k.slice(2)];\n  //   return;\n  // }\n\n  // Insert a key\n  const canInsert = (_d <= 1 && insertKeys) || (_d > 1 && insertValues);\n  if (canInsert) original[k] = v;\n}\n\n/**\n * A helper function for merging objects when the target key exists in the original\n * @private\n */\nfunction _modMergeUpdate(original, k, v, { insertKeys, insertValues, enforceTypes, overwrite, recursive } = {}, _d) {\n  const x = original[k];\n  const tv = foundry.utils.getType(v);\n  const tx = foundry.utils.getType(x);\n\n  // Recursively merge an inner object\n  if (tv === 'Object' && tx === 'Object' && recursive) {\n    return modMergeObject(\n      x,\n      v,\n      {\n        insertKeys: insertKeys,\n        insertValues: insertValues,\n        overwrite: overwrite,\n        inplace: true,\n        enforceTypes: enforceTypes,\n      },\n      _d\n    );\n  }\n\n  // Overwrite an existing value\n  if (overwrite) {\n    if (tx !== 'undefined' && tv !== tx && enforceTypes) {\n      throw new Error(`Mismatched data types encountered during object merge.`);\n    }\n    original[k] = v;\n  }\n}\n\nexport async function tv_executeScript(script, { actor, token, tvaUpdate } = {}) {\n  // Add variables to the evaluation scope\n  const speaker = ChatMessage.getSpeaker();\n  const character = game.user.character;\n\n  token = token?.object || token || (canvas.ready ? canvas.tokens.get(speaker.token) : null);\n  actor = actor || token?.actor || game.actors.get(speaker.actor);\n\n  // Attempt script execution\n  const AsyncFunction = async function () {}.constructor;\n  try {\n    const fn = AsyncFunction('speaker', 'actor', 'token', 'character', 'tvaUpdate', `${script}`);\n    await fn.call(null, speaker, actor, token, character, tvaUpdate);\n  } catch (err) {\n    ui.notifications.error(`There was an error in your script syntax. See the console (F12) for details`);\n    console.error(err);\n  }\n}\n\nexport async function executeMacro(macroName, token) {\n  token = token?.object || token;\n  game.macros.find((m) => m.name === macroName)?.execute({ token });\n}\n\nexport async function applyTMFXPreset(token, presetName, action = 'apply') {\n  token = token.object ?? token;\n  if (game.modules.get('tokenmagic')?.active && token.document) {\n    const preset = TokenMagic.getPreset(presetName);\n    if (preset) {\n      if (action === 'apply') {\n        await TokenMagic.addUpdateFilters(token, preset);\n      } else if (action === 'remove') {\n        await TokenMagic.deleteFilters(token, presetName);\n      }\n    }\n  }\n}\n\nexport async function toggleTMFXPreset(token, presetName) {\n  token = token.object ?? token;\n  if (game.modules.get('tokenmagic')?.active && token.document) {\n    if (TokenMagic.hasFilterId(token, presetName)) {\n      applyTMFXPreset(token, presetName, 'remove');\n    } else {\n      applyTMFXPreset(token, presetName, 'apply');\n    }\n  }\n}\n\nexport async function applyCEEffect(tokenDoc, ceEffect, action = 'apply') {\n  if (game.modules.get('dfreds-convenient-effects')?.active) {\n    if (!ceEffect.apply && !ceEffect.remove) return;\n    else if (!ceEffect.apply || !ceEffect.remove) {\n      if (action === 'apply') {\n        if (ceEffect.remove) action = 'remove';\n      } else return;\n    }\n\n    let uuid = tokenDoc.actor?.uuid;\n    if (uuid) {\n      if (action === 'apply') {\n        await game.dfreds.effectInterface.addEffect({\n          effectName: ceEffect.name,\n          uuid,\n          origin: 'token-variants',\n          overlay: false,\n        });\n      } else {\n        await game.dfreds.effectInterface.removeEffect({ effectName: ceEffect.name, uuid });\n      }\n    }\n  }\n}\n\nexport async function toggleCEEffect(token, effectName) {\n  if (game.modules.get('dfreds-convenient-effects')?.active) {\n    let uuid = (token.document ?? token).actor?.uuid;\n    await game.dfreds.effectInterface.toggleEffect(effectName, {\n      uuids: [uuid],\n      overlay: false,\n    });\n  }\n}\n\nexport class TokenDataAdapter {\n  static dataToForm(data) {\n    if ('texture.scaleX' in data) {\n      data.scale = Math.abs(data['texture.scaleX']);\n      data.mirrorX = data['texture.scaleX'] < 0;\n    }\n    if ('texture.scaleY' in data) {\n      data.scale = Math.abs(data['texture.scaleY']);\n      data.mirrorY = data['texture.scaleY'] < 0;\n    }\n  }\n\n  static formToData(token, formData) {\n    // Scale/mirroring\n    if ('scale' in formData || 'mirrorX' in formData || 'mirrorY' in formData) {\n      const doc = token.document ? token.document : token;\n      if (!('scale' in formData)) formData.scale = Math.abs(doc.texture.scaleX);\n      if (!('mirrorX' in formData)) formData.mirrorX = doc.texture.scaleX < 0;\n      if (!('mirrorY' in formData)) formData.mirrorY = doc.texture.scaleY < 0;\n      foundry.utils.setProperty(formData, 'texture.scaleX', formData.scale * (formData.mirrorX ? -1 : 1));\n      foundry.utils.setProperty(formData, 'texture.scaleY', formData.scale * (formData.mirrorY ? -1 : 1));\n      ['scale', 'mirrorX', 'mirrorY'].forEach((k) => delete formData[k]);\n    }\n  }\n}\n\nexport function determineAddedRemovedEffects(addedEffects, removedEffects, newEffects, oldEffects) {\n  for (const ef of newEffects) {\n    if (!oldEffects.includes(ef)) {\n      addedEffects.add(ef);\n    }\n  }\n  for (const ef of oldEffects) {\n    if (!newEffects.includes(ef)) {\n      removedEffects.add(ef);\n    }\n  }\n}\n\nexport async function wildcardImageSearch(imgSrc) {\n  let source = 'data';\n  const browseOptions = { wildcard: true };\n\n  // Support non-user sources\n  if (/\\.s3\\./.test(imgSrc)) {\n    source = 's3';\n    const { bucket, keyPrefix } = FilePicker.parseS3URL(imgSrc);\n    if (bucket) {\n      browseOptions.bucket = bucket;\n      imgSrc = keyPrefix;\n    }\n  } else if (imgSrc.startsWith('icons/')) source = 'public';\n\n  // Retrieve wildcard content\n  try {\n    const content = await FilePicker.browse(source, imgSrc, browseOptions);\n    return content.files;\n  } catch (err) {}\n  return [];\n}\n\n/**\n * Returns a random name generated using Name Forge module\n * @param {*} randomizerSettings\n * @returns\n */\nexport async function nameForgeRandomize(randomizerSettings) {\n  const nameForgeSettings = randomizerSettings.nameForge;\n  if (nameForgeSettings?.randomize && nameForgeSettings?.models) {\n    const nameForge = game.modules.get('nameforge');\n    if (nameForge?.active) {\n      const randomNames = [];\n      for (const modelKey of nameForgeSettings.models) {\n        const modelProp = foundry.utils.getProperty(nameForge.models, modelKey);\n        if (modelProp) {\n          const model = await nameForge.api.createModel(modelProp);\n          if (model) {\n            randomNames.push(nameForge.api.generateName(model)[0]);\n          }\n        }\n      }\n      return randomNames[Math.floor(Math.random() * randomNames.length)];\n    }\n  }\n\n  return null;\n}\n\n/**\n * Upload Token and associated overlays as a single image\n */\nexport async function uploadTokenImage(token, options) {\n  let renderTexture = captureToken(token, options);\n  if (renderTexture) {\n    const b64 = canvas.app.renderer.extract.base64(renderTexture, 'image/webp', 1);\n    let res = await fetch(b64);\n    let blob = await res.blob();\n    const filename = options.name + `.webp`;\n    let file = new File([blob], filename, { type: 'image/webp' });\n    await FilePicker.upload('data', options.path, file, {});\n  }\n}\n\n/**\n * Modified version of 'dev7355608' captureCanvas function. Captures combined Token and Overlay image\n */\nfunction captureToken(token, { scale = 3, width = null, height = null } = {}) {\n  if (!canvas.ready || !token) {\n    return;\n  }\n\n  width = width ?? token.texture.width;\n  height = height ?? token.texture.height;\n\n  scale = scale * Math.min(width / token.texture.width, height / token.texture.height);\n\n  const renderer = canvas.app.renderer;\n  const viewPosition = { ...canvas.scene._viewPosition };\n\n  renderer.resize(width ?? renderer.screen.width, height ?? renderer.screen.height);\n\n  width = canvas.screenDimensions[0] = renderer.screen.width;\n  height = canvas.screenDimensions[1] = renderer.screen.height;\n\n  canvas.stage.position.set(width / 2, height / 2);\n\n  canvas.pan({\n    x: token.center.x,\n    y: token.center.y,\n    scale,\n  });\n\n  const renderTexture = PIXI.RenderTexture.create({\n    width,\n    height,\n    resolution: token.texture.resolution,\n  });\n\n  const cacheParent = canvas.stage.enableTempParent();\n\n  canvas.stage.updateTransform();\n  canvas.stage.disableTempParent(cacheParent);\n\n  let spritesToRender = [token.mesh];\n  if (token.tvaOverlays) spritesToRender = spritesToRender.concat(token.tvaOverlays);\n  spritesToRender.sort((sprite) => sprite.sort);\n\n  for (const sprite of spritesToRender) {\n    renderer.render(sprite, { renderTexture, skipUpdateTransform: true, clear: false });\n  }\n\n  canvas._onResize();\n  canvas.pan(viewPosition);\n\n  return renderTexture;\n}\n\nexport function getAllActorTokens(actor, linked = false, document = false) {\n  if (actor.isToken) {\n    if (document) return [actor.token];\n    else if (actor.token.object) return [actor.token.object];\n    else return [];\n  }\n\n  const tokens = [];\n  game.scenes.forEach((scene) =>\n    scene.tokens.forEach((token) => {\n      if (token.actorId === actor.id) {\n        if (linked && token.actorLink) tokens.push(token);\n        else if (!linked) tokens.push(token);\n      }\n    })\n  );\n  if (document) return tokens;\n  else return tokens.map((token) => token.object).filter((token) => token);\n}\n\nexport function extractDimensionsFromImgName(img, dimensions = {}) {\n  const name = getFileName(img);\n\n  let scale;\n  if (TVA_CONFIG.imgNameContainsDimensions) {\n    const height = name.match(/_height(.*)_/)?.[1];\n    if (height) dimensions.height = parseFloat(height);\n    const width = name.match(/_width(.*)_/)?.[1];\n    if (width) dimensions.width = parseFloat(width);\n    scale = name.match(/_scale(.*)_/)?.[1];\n    if (scale) scale = Math.max(parseFloat(scale), 0.2);\n  }\n  if (TVA_CONFIG.imgNameContainsFADimensions) {\n    scale = name.match(/_Scale(\\d+)_/)?.[1];\n    if (scale) {\n      scale = Math.max(parseInt(scale) / 100, 0.2);\n    }\n  }\n  if (scale) {\n    dimensions['texture.scaleX'] = scale;\n    dimensions['texture.scaleY'] = scale;\n  }\n  return dimensions;\n}\n\nexport function string2Hex(hexString) {\n  return PIXI.utils.string2hex(hexString);\n}\n\nexport function decodeURISafely(uri) {\n  try {\n    return decodeURI(uri);\n  } catch (e) {\n    console.warn('URI Component not decodable: ' + uri);\n    return uri;\n  }\n}\n\nexport function decodeURIComponentSafely(uri) {\n  try {\n    return decodeURIComponent(uri);\n  } catch (e) {\n    console.warn('URI Component not decodable: ' + uri);\n    return uri;\n  }\n}\n\nexport function mergeMappings(from, to) {\n  const changedIDs = {};\n\n  for (const m of from) {\n    const i = to.findIndex((mapping) => mapping.label === m.label && mapping.group === m.group);\n    if (i === -1) to.push(m);\n    else {\n      changedIDs[to.id] = m.id;\n      if (to[i].tokens?.length) {\n        if (!m.tokens) m.tokens = [];\n        to[i].tokens.forEach((id) => {\n          if (!m.tokens.includes(id)) m.tokens.push(id);\n        });\n      }\n      to[i] = m;\n    }\n  }\n\n  // If parent's id has been changed we need to update all the children\n  to.forEach((m) => {\n    let pID = m.overlayConfig?.parentID;\n    if (pID && pID in changedIDs) {\n      m.overlayConfig.parentID = changedIDs[pID];\n    }\n  });\n\n  return to;\n}\n\nexport function isResponsibleGM() {\n  const isResponsibleGM = !game.users\n    .filter((user) => user.isGM && (user.active || user.isActive))\n    .some((other) => other.id < game.user.id);\n  return isResponsibleGM;\n}\n","import { registerSettings, TVA_CONFIG, exportSettingsToJSON, updateSettings } from './scripts/settings.js';\nimport { ArtSelect, addToArtSelectQueue } from './applications/artSelect.js';\nimport {\n  SEARCH_TYPE,\n  registerKeybinds,\n  updateTokenImage,\n  startBatchUpdater,\n  userRequiresImageCache,\n  waitForTokenTexture,\n  isResponsibleGM,\n} from './scripts/utils.js';\nimport { FONT_LOADING, broadcastDrawOverlays, drawOverlays } from './scripts/token/overlay.js';\nimport {\n  getTokenEffects,\n  setOverlayVisibility,\n  toggleTemplate,\n  toggleTemplateOnSelected,\n  updateWithEffectMapping,\n} from './scripts/hooks/effectMappingHooks.js';\nimport { cacheImages, doImageSearch, doRandomSearch, isCaching } from './scripts/search.js';\nimport { REGISTERED_HOOKS, registerAllHooks, registerHook } from './scripts/hooks/hooks.js';\nimport { REGISTERED_WRAPPERS, registerAllWrappers } from './scripts/wrappers/wrappers.js';\nimport {\n  assignUserSpecificImage,\n  assignUserSpecificImageToSelected,\n  unassignUserSpecificImage,\n  unassignUserSpecificImageFromSelected,\n} from './scripts/wrappers/userMappingWrappers.js';\nimport { toggleTemplateDialog } from './applications/dialogs.js';\n\n// Tracks if module has been initialized\nlet MODULE_INITIALIZED = false;\nexport function isInitialized() {\n  return MODULE_INITIALIZED;\n}\nlet onInit = [];\n\n/**\n * Initialize the Token Variants module on Foundry VTT init\n */\nasync function initialize() {\n  // Initialization should only be performed once\n  if (MODULE_INITIALIZED) {\n    return;\n  }\n\n  // Font Awesome need to be loaded manually on FireFox\n  FONT_LOADING.loading = FontConfig.loadFont('fontAwesome', {\n    editor: false,\n    fonts: [{ urls: ['fonts/fontawesome/webfonts/fa-solid-900.ttf'] }],\n  });\n\n  // Want this to be executed once the module has initialized\n  onInit.push(() => {\n    // Need to wait for icons do be drawn first however I could not find a way\n    // to wait until that has occurred. Instead we'll just wait for some static\n    // amount of time.\n    new Promise((resolve) => setTimeout(resolve, 500)).then(() => {\n      for (const tkn of canvas.tokens.placeables) {\n        drawOverlays(tkn); // Draw Overlays\n\n        // Disable effect icons\n        if (TVA_CONFIG.disableEffectIcons) {\n          waitForTokenTexture(tkn, (token) => {\n            token.effects.removeChildren().forEach((c) => c.destroy());\n            token.effects.bg = token.effects.addChild(new PIXI.Graphics());\n            token.effects.overlay = null;\n          });\n        } else if (TVA_CONFIG.filterEffectIcons) {\n          waitForTokenTexture(tkn, (token) => {\n            token.drawEffects();\n          });\n        }\n      }\n    });\n  });\n\n  if (userRequiresImageCache()) cacheImages();\n\n  // Register ALL Hooks\n  registerAllHooks();\n\n  // Startup ticker that will periodically call 'updateEmbeddedDocuments' with all the accrued updates since the last tick\n  startBatchUpdater();\n\n  registerHook('Search', 'renderArtSelect', () => {\n    ArtSelect.executing = false;\n  });\n\n  // Handle broadcasts\n  game.socket?.on(`module.token-variants`, (message) => {\n    if (message.handlerName === 'forgeSearchPaths' && message.type === 'UPDATE') {\n      // Workaround for forgeSearchPaths setting to be updated by non-GM clients\n      if (!game.user.isGM) return;\n      if (!isResponsibleGM()) return;\n      updateSettings({ forgeSearchPaths: message.args });\n    } else if (message.handlerName === 'drawOverlays' && message.type === 'UPDATE') {\n      if (message.args.all) {\n        if (canvas.scene.id !== message.args.sceneId) {\n          for (const tkn of canvas.tokens.placeables) {\n            drawOverlays(tkn);\n          }\n        }\n      } else if (message.args.actorId) {\n        const actor = game.actors.get(message.args.actorId);\n        if (actor) actor.getActiveTokens(true)?.forEach((tkn) => drawOverlays(tkn));\n      } else if (message.args.tokenId) {\n        const tkn = canvas.tokens.get(message.args.tokenId);\n        if (tkn) drawOverlays(tkn);\n      }\n    } else if (message.handlerName === 'effectMappings') {\n      if (!game.user.isGM) return;\n      if (!isResponsibleGM()) return;\n      const args = message.args;\n      const token = game.scenes.get(args.sceneId)?.tokens.get(args.tokenId);\n      if (token) updateWithEffectMapping(token, { added: args.added, removed: args.removed });\n    }\n  });\n\n  MODULE_INITIALIZED = true;\n  for (const cb of onInit) {\n    cb();\n  }\n  onInit = [];\n}\n\n/**\n * Performs searches and displays the Art Select pop-up with the results\n * @param {string} search The text to be used as the search criteria\n * @param {object} [options={}] Options which customize the search\n * @param {Function[]} [options.callback] Function to be called with the user selected image path\n * @param {SEARCH_TYPE|string} [options.searchType] Controls filters applied to the search results\n * @param {Token|Actor} [options.object] Token/Actor used when displaying Custom Token Config prompt\n * @param {boolean} [options.force] If true will always override the current Art Select window if one exists instead of adding it to the queue\n * @param {object} [options.searchOptions] Override search and filter settings\n */\nexport async function showArtSelect(\n  search,\n  {\n    callback = null,\n    searchType = SEARCH_TYPE.PORTRAIT_AND_TOKEN,\n    object = null,\n    force = false,\n    preventClose = false,\n    image1 = '',\n    image2 = '',\n    displayMode = ArtSelect.IMAGE_DISPLAY.NONE,\n    multipleSelection = false,\n    searchOptions = {},\n    allImages = null,\n  } = {}\n) {\n  if (isCaching()) return;\n\n  const artSelects = Object.values(ui.windows).filter((app) => app instanceof ArtSelect);\n  if (ArtSelect.executing || (!force && artSelects.length !== 0)) {\n    addToArtSelectQueue(search, {\n      callback,\n      searchType,\n      object,\n      preventClose,\n      searchOptions,\n      allImages,\n    });\n    return;\n  }\n\n  ArtSelect.executing = true;\n  if (!allImages)\n    allImages = await doImageSearch(search, {\n      searchType: searchType,\n      searchOptions: searchOptions,\n    });\n\n  new ArtSelect(search, {\n    allImages: allImages,\n    searchType: searchType,\n    callback: callback,\n    object: object,\n    preventClose: preventClose,\n    image1: image1,\n    image2: image2,\n    displayMode: displayMode,\n    multipleSelection: multipleSelection,\n    searchOptions: searchOptions,\n  }).render(true);\n}\n\n// Initialize module\nregisterHook('main', 'ready', initialize, { once: true });\n\n// Register API and Keybinds\nregisterHook('main', 'init', function () {\n  registerSettings();\n  registerAllWrappers();\n\n  registerKeybinds();\n\n  const api = {\n    cacheImages,\n    doImageSearch,\n    doRandomSearch,\n    getTokenEffects,\n    showArtSelect,\n    updateTokenImage,\n    exportSettingsToJSON,\n    assignUserSpecificImage,\n    assignUserSpecificImageToSelected,\n    unassignUserSpecificImage,\n    unassignUserSpecificImageFromSelected,\n    setOverlayVisibility,\n    toggleTemplateDialog,\n    toggleTemplate,\n    toggleTemplateOnSelected,\n    drawOverlays,\n    broadcastDrawOverlays,\n    TVA_CONFIG,\n  };\n\n  Object.defineProperty(api, 'hooks', {\n    get() {\n      return foundry.utils.deepClone(REGISTERED_HOOKS);\n    },\n    configurable: true,\n  });\n\n  Object.defineProperty(api, 'wrappers', {\n    get() {\n      return foundry.utils.deepClone(REGISTERED_WRAPPERS);\n    },\n    configurable: true,\n  });\n\n  game.modules.get('token-variants').api = api;\n});\n","import { getAllEffectMappings } from '../hooks/effectMappingHooks.js';\nimport { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\nimport { registerWrapper, unregisterWrapper } from './wrappers.js';\n\nconst feature_id = 'EffectIcons';\n\nexport function registerEffectIconWrappers() {\n  unregisterWrapper(feature_id, 'Token.prototype.drawEffects');\n  unregisterWrapper(feature_id, 'CombatTracker.prototype.getData');\n  if (!FEATURE_CONTROL[feature_id]) return;\n\n  if (!TVA_CONFIG.disableEffectIcons && TVA_CONFIG.filterEffectIcons && !['pf1e', 'pf2e'].includes(game.system.id)) {\n    registerWrapper(feature_id, 'Token.prototype.drawEffects', _drawEffects, 'OVERRIDE');\n  } else if (TVA_CONFIG.disableEffectIcons) {\n    registerWrapper(feature_id, 'Token.prototype._drawEffects', _drawEffects_fullReplace, 'OVERRIDE');\n  } else if (TVA_CONFIG.displayEffectIconsOnHover) {\n    registerWrapper(feature_id, 'Token.prototype.drawEffects', _drawEffects_hoverOnly, 'WRAPPER');\n  }\n\n  if (TVA_CONFIG.disableEffectIcons || TVA_CONFIG.filterCustomEffectIcons) {\n    registerWrapper(feature_id, 'CombatTracker.prototype.getData', _combatTrackerGetData, 'WRAPPER');\n  }\n}\n\nasync function _drawEffects_hoverOnly(wrapped, ...args) {\n  let result = await wrapped(...args);\n  this.effects.visible = this.hover;\n  return result;\n}\n\nasync function _drawEffects_fullReplace(...args) {\n  this.effects.removeChildren().forEach((c) => c.destroy());\n  this.effects.bg = this.effects.addChild(new PIXI.Graphics());\n  this.effects.overlay = null;\n}\n\nasync function _combatTrackerGetData(wrapped, ...args) {\n  let data = await wrapped(...args);\n\n  if (data && data.combat && data.turns) {\n    const combat = data.combat;\n    for (const turn of data.turns) {\n      const combatant = combat.combatants.find((c) => c.id === turn.id);\n      if (combatant) {\n        if (TVA_CONFIG.disableEffectIcons) {\n          turn.effects = new Set();\n        } else if (TVA_CONFIG.filterEffectIcons) {\n          const restrictedEffects = _getRestrictedEffects(combatant.token);\n\n          // Copied from CombatTracker.getData(...)\n          turn.effects = new Set();\n          if (combatant.token) {\n            combatant.token.effects.forEach((e) => turn.effects.add(e));\n            if (combatant.token.overlayEffect) turn.effects.add(combatant.token.overlayEffect);\n          }\n\n          // modified to filter restricted effects\n          if (combatant.actor) {\n            for (const effect of combatant.actor.temporaryEffects) {\n              if (effect.statuses.has(CONFIG.specialStatusEffects.DEFEATED)) {\n              } else if (effect.icon && !restrictedEffects.includes(effect.name ?? effect.label))\n                turn.effects.add(effect.icon);\n            }\n          }\n          // end of copy\n        }\n      }\n    }\n  }\n  return data;\n}\n\nasync function _drawEffects(...args) {\n  this.effects.renderable = false;\n\n  // Clear Effects Container\n  this.effects.removeChildren().forEach((c) => c.destroy());\n  this.effects.bg = this.effects.addChild(new PIXI.Graphics());\n  this.effects.bg.zIndex = -1;\n  this.effects.overlay = null;\n\n  // Categorize effects\n  let activeEffects = this.actor?.temporaryEffects || [];\n  let overlayEffect = activeEffects.findLast((e) => e.img && e.getFlag('core', 'overlay'));\n\n  // Modified from the original token.drawEffects\n  if (TVA_CONFIG.displayEffectIconsOnHover) this.effects.visible = this.hover;\n  if (activeEffects.length) {\n    const restrictedEffects = _getRestrictedEffects(this.document);\n    activeEffects = activeEffects.filter((ef) => !restrictedEffects.includes(ef.name));\n  }\n  // End of modifications\n\n  // Draw effects\n  const promises = [];\n  for (const [i, effect] of activeEffects.entries()) {\n    if (!effect.img) continue;\n    const promise =\n      effect === overlayEffect ? this._drawOverlay(effect.img, effect.tint) : this._drawEffect(effect.img, effect.tint);\n    promises.push(\n      promise.then((e) => {\n        if (e) e.zIndex = i;\n      })\n    );\n  }\n  await Promise.allSettled(promises);\n\n  this.effects.sortChildren();\n  this.effects.renderable = true;\n  this.renderFlags.set({ refreshEffects: true });\n}\n\nfunction _getRestrictedEffects(tokenDoc) {\n  let restrictedEffects = TVA_CONFIG.filterIconList;\n  if (TVA_CONFIG.filterCustomEffectIcons) {\n    const mappings = getAllEffectMappings(tokenDoc);\n    if (mappings) restrictedEffects = restrictedEffects.concat(mappings.map((m) => m.expression));\n  }\n  return restrictedEffects;\n}\n","import { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\nimport { registerWrapper, unregisterWrapper } from './wrappers.js';\n\nconst feature_id = 'HideElement';\n\nexport function registerHideElementWrappers() {\n  unregisterWrapper(feature_id, 'Token.prototype._getTooltipText');\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.hideElevationTooltip) {\n    registerWrapper(feature_id, 'Token.prototype._getTooltipText', _getTooltipText, 'WRAPPER');\n  }\n\n  unregisterWrapper(feature_id, 'Token.prototype._refreshBorder');\n  if (FEATURE_CONTROL[feature_id] && TVA_CONFIG.hideTokenBorder) {\n    registerWrapper(feature_id, 'Token.prototype._refreshBorder', _refreshVisibility, 'OVERRIDE');\n  }\n}\n\nfunction _getTooltipText(wrapped, ...args) {\n  wrapped(...args);\n  return '';\n}\n\nfunction _refreshVisibility(...args) {}\n","import { TOKEN_HUD_VARIANTS } from '../../applications/tokenHUD.js';\nimport { Reticle } from '../reticle.js';\nimport { FEATURE_CONTROL, TVA_CONFIG } from '../settings.js';\nimport { registerWrapper, unregisterWrapper } from './wrappers.js';\n\nconst feature_id = 'HUD';\n\nexport function registerHUDWrappers() {\n  unregisterWrapper(feature_id, 'TokenHUD.prototype.clear');\n  if (FEATURE_CONTROL[feature_id]) {\n    registerWrapper(feature_id, 'TokenHUD.prototype.clear', _clear, 'MIXED');\n  }\n}\n\nfunction _clear(wrapped, ...args) {\n  _applyVariantFlags();\n\n  // HUD should not close if we're in assisted overlay positioning mode\n  if (Reticle.active && Reticle.mode === 'hud') return;\n  return wrapped(...args);\n}\n\nasync function _applyVariantFlags() {\n  const { actor, variants } = TOKEN_HUD_VARIANTS;\n  if (actor) {\n    if (!variants?.length) {\n      actor.unsetFlag('token-variants', 'variants');\n    } else {\n      actor.setFlag('token-variants', 'variants', variants);\n    }\n  }\n  TOKEN_HUD_VARIANTS.actor = null;\n  TOKEN_HUD_VARIANTS.variants = null;\n}\n","import { registerEffectIconWrappers } from './effectIconWrappers.js';\nimport { registerHideElementWrappers } from './hideElementWrappers.js';\nimport { registerHUDWrappers } from './hudWrappers.js';\nimport { registerUserMappingWrappers } from './userMappingWrappers.js';\n\nexport const REGISTERED_WRAPPERS = {};\n\nexport function registerWrapper(feature_id, name, fn, method = 'WRAPPER') {\n  if (typeof libWrapper !== 'function') return;\n  if (!(feature_id in REGISTERED_WRAPPERS)) REGISTERED_WRAPPERS[feature_id] = {};\n  if (name in REGISTERED_WRAPPERS[feature_id]) return;\n\n  REGISTERED_WRAPPERS[feature_id][name] = libWrapper.register('token-variants', name, fn, method);\n}\n\nexport function unregisterWrapper(feature_id, name) {\n  if (typeof libWrapper !== 'function') return;\n  if (feature_id in REGISTERED_WRAPPERS && name in REGISTERED_WRAPPERS[feature_id]) {\n    libWrapper.unregister('token-variants', REGISTERED_WRAPPERS[feature_id][name]);\n    delete REGISTERED_WRAPPERS[feature_id][name];\n  }\n}\n\nexport function registerAllWrappers() {\n  // User to Image mappings for Tile and Tokens\n  registerUserMappingWrappers();\n  // Hide effect icons\n  registerEffectIconWrappers();\n  // Token HUD Variants Management\n  registerHUDWrappers();\n  // Hide Core Token Elements\n  registerHideElementWrappers();\n}\n","export default class RandomizerConfig extends FormApplication {\n  constructor(obj) {\n    super({}, {});\n    this.actor = game.actors.get(obj.actorId);\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: 'token-variants-token-flags',\n      classes: ['sheet'],\n      template: 'modules/token-variants/token-variants/templates/randomizerConfig.html',\n      resizable: true,\n      minimizable: false,\n      title: 'Randomizer',\n      width: 500,\n    });\n  }\n\n  async getData(options) {\n    const data = super.getData(options);\n    const settings = this.actor.getFlag('token-variants', 'randomizerSettings') || {};\n    data.randomizer = settings;\n    data.hasSettings = !foundry.utils.isEmpty(settings);\n    data.nameForgeActive = game.modules.get('nameforge')?.active;\n    if (data.randomizer.nameForge?.models && Array.isArray(data.randomizer.nameForge.models)) {\n      data.randomizer.nameForge.models = data.randomizer.nameForge.models.join(',');\n    }\n    return data;\n  }\n\n  /**\n   * @param {JQuery} html\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.querySelector('.selectNameForgeModels').click(this._selectNameForgeModels.bind(this));\n\n    // Can't have both tokenName and actorName checkboxes checked at the same time\n    const tokenName = html.querySelector('input[name=\"randomizer.tokenName\"]');\n    const actorName = html.querySelector('input[name=\"randomizer.actorName\"]');\n    tokenName.change(() => {\n      if (tokenName.is(':checked')) actorName.prop('checked', false);\n    });\n    actorName.change(() => {\n      if (actorName.is(':checked')) tokenName.prop('checked', false);\n    });\n  }\n\n  _selectNameForgeModels(event) {\n    const inputSelected = event.target.siblings('input');\n    const selected = inputSelected.val().split(',');\n    const genCheckbox = function (name, value) {\n      return `\n      <div class=\"form-group\">\n        <label>${name}</label>\n        <div class=\"form-fields\">\n            <input type=\"checkbox\" name=\"model\" value=\"${value}\" data-dtype=\"Boolean\" ${\n        selected?.find((v) => v === value) ? 'checked' : ''\n      }>\n        </div>\n      </div>\n      `;\n    };\n\n    let content = '<form style=\"overflow-y: scroll; height:400px;\">';\n\n    const models = game.modules.get('nameforge').models;\n    for (const [k, v] of Object.entries(models.defaultModels)) {\n      content += genCheckbox(v.name, 'defaultModels.' + k);\n    }\n    for (const [k, v] of Object.entries(models.userModels)) {\n      content += genCheckbox(v.name, 'userModels.' + k);\n    }\n    content += `</form>`;\n\n    new Dialog({\n      title: `Name Forge Models`,\n      content: content,\n      buttons: {\n        Ok: {\n          label: `Select`,\n          callback: async (html) => {\n            const selectedModels = [];\n            html.querySelector('input[type=\"checkbox\"]').each(function () {\n              if (this.checked) selectedModels.push(this.value);\n            });\n            inputSelected.val(selectedModels.join(','));\n          },\n        },\n      },\n    }).render(true);\n  }\n\n  /**\n   * @param {Event} event\n   * @param {Object} formData\n   */\n  async _updateObject(event, formData) {\n    if (event.submitter.value === 'remove') {\n      await this.actor.unsetFlag('token-variants', 'randomizerSettings');\n    } else {\n      const expanded = foundry.utils.expandObject(formData);\n      if (expanded.randomizer.nameForge?.models) {\n        expanded.randomizer.nameForge.models = expanded.randomizer.nameForge.models.split(',');\n      }\n      this.actor.setFlag('token-variants', 'randomizerSettings', expanded.randomizer);\n    }\n  }\n}\n","export function createToolbarButton({className, iconClass, labelText, onClick}) {\n  const icon = new ElementBuilder(\"i\")\n    .className(iconClass)\n    .build();\n\n  const label = new ElementBuilder(\"label\")\n    .textContent(labelText)\n    .build();\n\n  const builder = new ElementBuilder(\"button\")\n    .className(className)\n    .type(\"button\")\n    .children([icon, label]);\n\n  if (onClick) builder.on(\"click\", onClick);\n\n  return builder.build();\n}\n\nexport function createSearchInput({ className = \"token-variants-side-search\", placeholder = \"\" }) {\n  return new ElementBuilder(\"input\")\n    .className(className)\n    .type(\"text\")\n    .attr(\"placeholder\", placeholder)\n    .build();\n}\n\nexport function createContextMenu() {\n  const menu = new ElementBuilder(\"div\")\n    .className(\"token-variants-context-menu active\")\n    .children([\n      createSearchInput({}),\n      createToolbarButton({\n        className: \"flags\",\n        iconClass: \"fab fa-font-awesome-flag\",\n        labelText: \"Flags\"\n      }),\n      createToolbarButton({\n        className: \"file-picker\",\n        iconClass: \"fas fa-file-import fa-fw\",\n        labelText: \"Browse Folders\"\n      }),\n      createToolbarButton({\n        className: \"effectConfig\",\n        iconClass: \"fas fa-sun\",\n        labelText: \"Mappings\"\n      }),\n      createToolbarButton({\n        className: \"randomizerConfig\",\n        iconClass: \"fas fa-dice\",\n        labelText: \"Randomizer\"\n      })\n    ])\n    .build();\n\n  return new ElementBuilder(\"div\")\n    .className(\"token-variants-wrap contextmenu active\")\n    .child(menu)\n    .build();\n}\n\n","import {\n  getFileName,\n  isImage,\n  isVideo,\n  SEARCH_TYPE,\n  keyPressed,\n  updateActorImage,\n  updateTokenImage,\n  decodeURISafely,\n} from \"../scripts/utils.js\";\nimport TokenCustomConfig from \"./tokenCustomConfig.js\";\nimport EffectMappingForm from \"./effectMappingForm.js\";\nimport { TVA_CONFIG } from \"../scripts/settings.js\";\nimport UserList from \"./userList.js\";\nimport FlagsConfig from \"./flagsConfig.js\";\nimport RandomizerConfig from \"./randomizerConfig.js\";\nimport { doImageSearch, findImagesFuzzy } from \"../scripts/search.js\";\nimport { createContextMenu } from \"../scripts/helpers/domPresets.js\";\n\nexport const TOKEN_HUD_VARIANTS = { variants: null, actor: null };\n\nexport async function renderTokenHUD(\n  hud,\n  html,\n  token,\n  searchText = \"\",\n  fp_files = null,\n) {\n  activateStatusEffectListeners(token);\n\n  const hudSettings = TVA_CONFIG.hud;\n  const FULL_ACCESS = TVA_CONFIG.permissions.hudFullAccess[game.user.role];\n  const PARTIAL_ACCESS = TVA_CONFIG.permissions.hud[game.user.role];\n\n  // Check if the HUD button should be displayed\n  if (\n    !hudSettings.enableSideMenu ||\n    (!PARTIAL_ACCESS && !FULL_ACCESS) ||\n    token.flags[\"token-variants\"]?.disableHUDButton\n  )\n    return;\n\n  const tokenActor = game.actors.get(token.actorId);\n\n  // Disable button if Token HUD Wildcard is e enabled and appropriate setting is set\n  if (\n    TVA_CONFIG.worldHud.disableIfTHWEnabled &&\n    game.modules.get(\"token-hud-wildcard\")?.active\n  ) {\n    if (tokenActor && tokenActor.prototypeToken.randomImg) return;\n  }\n\n  const button = new ElementBuilder(\"button\")\n    .type(\"button\")\n    .className(\"control-icon\")\n    .dataset(\"action\", \"token-variants-side-selector\")\n    .appendChild(\n      new ElementBuilder(\"div\")\n        .className(\"control-icon\")\n        .dataset(\"action\", \"token-variants-side-selector\")\n        .appendChild(\n          new ElementBuilder(\"img\")\n            .attr(\"id\", \"token-variants-side-button\")\n            .attr(\n              \"src\",\n              \"modules/token-variants/token-variants/img/token-images.svg\",\n            )\n            .attr(\"width\", \"36\")\n            .attr(\"height\", \"36\")\n            .attr(\n              \"title\",\n              \"Left-click: Image Menu&#013;Right-click: Search & Additional settings\",\n            )\n            .build(),\n        )\n        .build(),\n    )\n    .on(\"click\", (event) => _onButtonClick(event, token))\n    .when(FULL_ACCESS, (builder) =>\n      builder.on(\"contextmenu\", (event) =>\n        _onButtonRightClick(event, hud, html, token),\n      ),\n    )\n    .build();\n\n  const colRight = html.querySelector(\".col.right\");\n  colRight.appendChild(button);\n  colRight.click(_deactivateTokenVariantsSideSelector);\n}\n\nasync function _onButtonClick(event, token) {\n  const button = event.target.closest(\".control-icon\");\n\n  // De-activate 'Status Effects'\n  button\n    .closest(\"div.right\")\n    .querySelector(\"div.control-icon.effects\")\n    .removeClass(\"active\");\n  button\n    .closest(\"div.right\")\n    .querySelector(\".status-effects\")\n    .removeClass(\"active\");\n\n  // Remove contextmenu\n  button.querySelector(\".contextmenu\").remove();\n\n  // Toggle variants side menu\n  button.toggleClass(\"active\");\n  let variantsWrap = button.querySelector(\".token-variants-wrap\");\n  if (button.hasClass(\"active\")) {\n    if (!variantsWrap.length) {\n      variantsWrap = await renderSideSelect(token);\n      if (variantsWrap) button.querySelector(\"img\").after(variantsWrap);\n      else return;\n    }\n    variantsWrap.addClass(\"active\");\n  } else {\n    variantsWrap.removeClass(\"active\");\n  }\n}\n\nfunction _onButtonRightClick(event, hud, html, token) {\n  // Display side menu if button is not active yet\n  const button = event.target.closest(\".control-icon\");\n  if (!button.hasClass(\"active\")) {\n    // button.trigger('click');\n    button.addClass(\"active\");\n  }\n\n  if (button.querySelector(\".contextmenu\").length) {\n    // Contextmenu already displayed. Remove and activate images\n    button.querySelector(\".contextmenu\").remove();\n    button.removeClass(\"active\").trigger(\"click\");\n    //button.querySelector('.token-variants-wrap.images').addClass('active');\n  } else {\n    // Contextmenu is not displayed. Hide images, create it and add it\n    button.querySelector(\".token-variants-wrap.images\").removeClass(\"active\");\n    const contextMenu = createContextMenu();\n    button.append(contextMenu);\n\n    // Register contextmenu listeners\n    contextMenu\n      .querySelector(\".token-variants-side-search\")\n      .on(\"keyup\", (event) => _onImageSearchKeyUp(event, token))\n      .on(\"click\", (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n      });\n    contextMenu.querySelector(\".flags\").click((event) => {\n      const tkn = canvas.tokens.get(token._id);\n      if (tkn) {\n        event.preventDefault();\n        event.stopPropagation();\n        new FlagsConfig(tkn).render(true);\n      }\n    });\n    contextMenu.querySelector(\".file-picker\").click(async (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n      new FilePicker({\n        type: \"imagevideo\",\n        callback: async (path, fp) => {\n          const content = await FilePicker.browse(\n            fp.activeSource,\n            fp.result.target,\n          );\n          let files = content.files.filter((f) => isImage(f) || isVideo(f));\n          if (files.length) {\n            button.querySelector(\".token-variants-wrap\").remove();\n            const sideSelect = await renderSideSelect(token, \"\", files);\n            if (sideSelect) {\n              sideSelect.addClass(\"active\");\n              button.append(sideSelect);\n            }\n          }\n        },\n      }).render(true);\n    });\n    contextMenu.querySelector(\".effectConfig\").click((event) => {\n      new EffectMappingForm(token).render(true);\n    });\n    contextMenu.querySelector(\".randomizerConfig\").click((event) => {\n      new RandomizerConfig(token).render(true);\n    });\n  }\n}\n\nfunction _deactivateTokenVariantsSideSelector(event) {\n  const controlIcon = event.target.closest(\".control-icon\");\n  const dataAction = controlIcon.attr(\"data-action\");\n\n  switch (dataAction) {\n    case \"effects\":\n      break; // Effects button\n    case \"thwildcard-selector\":\n      break; // Token HUD Wildcard module button\n    default:\n      return;\n  }\n\n  event.target\n    .closest(\"div.right\")\n    .querySelector('.control-icon[data-action=\"token-variants-side-selector\"]')\n    .removeClass(\"active\");\n  event.target\n    .closest(\"div.right\")\n    .querySelector(\".token-variants-wrap\")\n    .removeClass(\"active\");\n}\n\nasync function renderSideSelect(token, searchText = \"\", fp_files = null) {\n  const hudSettings = TVA_CONFIG.hud;\n  const worldHudSettings = TVA_CONFIG.worldHud;\n  const FULL_ACCESS = TVA_CONFIG.permissions.hudFullAccess[game.user.role];\n  const PARTIAL_ACCESS = TVA_CONFIG.permissions.hud[game.user.role];\n\n  const tokenActor = game.actors.get(token.actorId);\n\n  let images = [];\n  let actorVariants = [];\n  let imageDuplicates = new Set();\n  const pushImage = (img) => {\n    if (imageDuplicates.has(img.path)) {\n      if (\n        !images.querySelector(\n          (obj) => obj.path === img.path && obj.name === img.name,\n        )\n      ) {\n        images.push(img);\n      }\n    } else {\n      images.push(img);\n      imageDuplicates.add(img.path);\n    }\n  };\n\n  actorVariants = getVariants(tokenActor);\n\n  if (!fp_files) {\n    if (!searchText) {\n      // Insert current token image\n      if (token.texture?.src && token.texture?.src !== CONST.DEFAULT_TOKEN) {\n        pushImage({\n          path: decodeURISafely(token.texture.src),\n          name:\n            token.flags?.[\"token-variants\"]?.name ??\n            getFileName(token.texture.src),\n        });\n      }\n\n      if (tokenActor) {\n        // Insert default token image\n        const defaultImg =\n          tokenActor.prototypeToken?.flags[\"token-variants\"]?.[\n            \"randomImgDefault\"\n          ] ||\n          tokenActor.prototypeToken?.flags[\"token-hud-wildcard\"]?.[\"default\"] ||\n          \"\";\n        if (defaultImg) {\n          pushImage({\n            path: decodeURISafely(defaultImg),\n            name: getFileName(defaultImg),\n          });\n        }\n\n        if (FULL_ACCESS || PARTIAL_ACCESS) {\n          actorVariants.forEach((variant) => {\n            for (const name of variant.names) {\n              pushImage({ path: decodeURISafely(variant.imgSrc), name: name });\n            }\n          });\n        }\n\n        // Parse directory flag and include the images\n        if (FULL_ACCESS || PARTIAL_ACCESS) {\n          const directoryFlag = tokenActor.getFlag(\n            \"token-variants\",\n            \"directory\",\n          );\n          if (directoryFlag) {\n            let dirFlagImages;\n            try {\n              let path = directoryFlag.path;\n              let source = directoryFlag.source;\n              let bucket = \"\";\n              if (source.startsWith(\"s3:\")) {\n                bucket = source.substring(3, source.length);\n                source = \"s3\";\n              }\n              const content = await FilePicker.browse(source, path, {\n                type: \"imagevideo\",\n                bucket,\n              });\n              dirFlagImages = content.files;\n            } catch (err) {\n              dirFlagImages = [];\n            }\n            dirFlagImages = dirFlagImages.forEach((f) => {\n              if (isImage(f) || isVideo(f))\n                pushImage({ path: decodeURISafely(f), name: getFileName(f) });\n            });\n          }\n        }\n\n        if (\n          (FULL_ACCESS || PARTIAL_ACCESS) &&\n          worldHudSettings.includeWildcard &&\n          !worldHudSettings.displayOnlySharedImages\n        ) {\n          // Merge wildcard images\n          const protoImg = tokenActor.prototypeToken.texture.src;\n          if (tokenActor.prototypeToken.randomImg) {\n            (await tokenActor.getTokenImages())\n              .filter((img) => !img.includes(\"*\"))\n              .forEach((img) => {\n                pushImage({\n                  path: decodeURISafely(img),\n                  name: getFileName(img),\n                });\n              });\n          } else if (\n            protoImg.includes(\"*\") ||\n            protoImg.includes(\"{\") ||\n            protoImg.includes(\"}\")\n          ) {\n            // Modified version of Actor.getTokenImages()\n            const getTokenImages = async () => {\n              if (tokenActor._tokenImages) return tokenActor._tokenImages;\n\n              let source = \"data\";\n              let pattern = tokenActor.prototypeToken.texture.src;\n              const browseOptions = { wildcard: true };\n\n              // Support non-user sources\n              if (/\\.s3\\./.test(pattern)) {\n                source = \"s3\";\n                const { bucket, keyPrefix } = FilePicker.parseS3URL(pattern);\n                if (bucket) {\n                  browseOptions.bucket = bucket;\n                  pattern = keyPrefix;\n                }\n              } else if (pattern.startsWith(\"icons/\")) source = \"public\";\n\n              // Retrieve wildcard content\n              try {\n                const content = await FilePicker.browse(\n                  source,\n                  pattern,\n                  browseOptions,\n                );\n                tokenActor._tokenImages = content.files;\n              } catch (err) {\n                tokenActor._tokenImages = [];\n              }\n              return tokenActor._tokenImages;\n            };\n\n            (await getTokenImages())\n              .filter(\n                (img) => !img.includes(\"*\") && (isImage(img) || isVideo(img)),\n              )\n              .forEach((variant) => {\n                pushImage({\n                  path: decodeURISafely(variant),\n                  name: getFileName(variant),\n                });\n              });\n          }\n        }\n      }\n    }\n\n    // Perform image search if needed\n    if (FULL_ACCESS) {\n      let search;\n      if (searchText) {\n        search = searchText.length > 2 ? searchText : null;\n      } else {\n        if (\n          worldHudSettings.displayOnlySharedImages ||\n          tokenActor?.getFlag(\"token-variants\", \"disableNameSearch\")\n        ) {\n          // No search\n        } else if (token.name.length > 2) {\n          search = token.name;\n        }\n      }\n\n      if (search) {\n        let artSearch = await doImageSearch(search, {\n          searchType: SEARCH_TYPE.TOKEN,\n          searchOptions: { keywordSearch: worldHudSettings.includeKeywords },\n        });\n\n        // Merge full search, and keywords into a single array\n        if (artSearch) {\n          artSearch.forEach((results) => {\n            results.forEach((img) => pushImage(img));\n          });\n        }\n      }\n    }\n  } else {\n    images = fp_files.map((f) => {\n      return { path: decodeURISafely(f), name: getFileName(f) };\n    });\n  }\n\n  // Retrieving the possibly custom name attached as a flag to the token\n  let tokenImageName = \"\";\n  if (token.flags[\"token-variants\"] && token.flags[\"token-variants\"][\"name\"]) {\n    tokenImageName = token.flags[\"token-variants\"][\"name\"];\n  } else {\n    tokenImageName = getFileName(token.texture.src);\n  }\n\n  let imagesParsed = [];\n  const tokenConfigs = (TVA_CONFIG.tokenConfigs || []).flat();\n  const tkn = canvas.tokens.get(token._id);\n  const userMappings =\n    tkn.document.getFlag(\"token-variants\", \"userMappings\") || {};\n\n  for (const imageObj of images) {\n    const img = isImage(imageObj.path);\n    const vid = isVideo(imageObj.path);\n\n    const hasConfig = Boolean(\n      tokenConfigs.querySelector(\n        (config) =>\n          config.tvImgSrc === imageObj.path &&\n          config.tvImgName === imageObj.name,\n      ),\n    );\n    let shared = false;\n    if (TVA_CONFIG.permissions.hudFullAccess[game.user.role]) {\n      actorVariants.forEach((variant) => {\n        if (\n          variant.imgSrc === imageObj.path &&\n          variant.names.includes(imageObj.name)\n        ) {\n          shared = true;\n        }\n      });\n    }\n\n    const [title, style] = genTitleAndStyle(\n      userMappings,\n      imageObj.path,\n      imageObj.name,\n    );\n\n    imagesParsed.push({\n      route: imageObj.path,\n      name: imageObj.name,\n      used:\n        imageObj.path === token.texture.src && imageObj.name === tokenImageName,\n      img,\n      vid,\n      unknownType: !img && !vid,\n      shared: shared,\n      hasConfig: hasConfig,\n      title: title,\n      style: game.user.isGM && style ? \"box-shadow: \" + style + \";\" : null,\n    });\n  }\n\n  //\n  // Render\n  //\n  const imageDisplay = hudSettings.displayAsImage;\n  const imageOpacity = hudSettings.imageOpacity / 100;\n\n  const sideSelect = $(\n    await renderTemplate(\n      \"modules/token-variants/token-variants/templates/sideSelect.html\",\n      {\n        imagesParsed,\n        imageDisplay,\n        imageOpacity,\n        tokenHud: true,\n      },\n    ),\n  );\n\n  // Activate listeners\n  sideSelect.querySelector(\"video\").hover(\n    function () {\n      if (TVA_CONFIG.playVideoOnHover) {\n        this.play();\n        this.siblings(\".fa-play\").hide();\n      }\n    },\n    function () {\n      if (TVA_CONFIG.pauseVideoOnHoverOut) {\n        this.pause();\n        this.currentTime = 0;\n        this.siblings(\".fa-play\").show();\n      }\n    },\n  );\n  sideSelect\n    .querySelector(\".token-variants-button-select\")\n    .click((event) => _onImageClick(event, token._id));\n\n  if (FULL_ACCESS) {\n    sideSelect\n      .querySelector(\".token-variants-button-select\")\n      .on(\"contextmenu\", (event) => _onImageRightClick(event, token._id));\n  }\n\n  return sideSelect;\n}\n\nasync function _onImageClick(event, tokenId) {\n  event.preventDefault();\n  event.stopPropagation();\n\n  const token = canvas.tokens.controlled.querySelector(\n    (t) => t.document.id === tokenId,\n  );\n  if (!token) return;\n\n  const worldHudSettings = TVA_CONFIG.worldHud;\n\n  const imgButton = event.target.closest(\".token-variants-button-select\");\n  const imgSrc = imgButton.attr(\"data-name\");\n  const name = imgButton.attr(\"data-filename\");\n\n  if (!imgSrc || !name) return;\n\n  if (keyPressed(\"config\") && game.user.isGM) {\n    const toggleCog = (saved) => {\n      const cog = imgbutton.querySelector(\".fa-cog\");\n      if (saved) {\n        cog.addClass(\"active\");\n      } else {\n        cog.removeClass(\"active\");\n      }\n    };\n    new TokenCustomConfig(token, {}, imgSrc, name, toggleCog).render(true);\n  } else if (token.document.texture.src === imgSrc) {\n    let tokenImageName = token.document.getFlag(\"token-variants\", \"name\");\n    if (!tokenImageName)\n      tokenImageName = getFileName(token.document.texture.src);\n    if (tokenImageName !== name) {\n      await updateTokenImage(imgSrc, {\n        token: token,\n        imgName: name,\n        animate: worldHudSettings.animate,\n      });\n      if (token.actor && worldHudSettings.updateActorImage) {\n        if (worldHudSettings.useNameSimilarity) {\n          updateActorWithSimilarName(imgSrc, name, token.actor);\n        } else {\n          updateActorImage(token.actor, imgSrc, { imgName: name });\n        }\n      }\n    }\n  } else {\n    await updateTokenImage(imgSrc, {\n      token: token,\n      imgName: name,\n      animate: worldHudSettings.animate,\n    });\n    if (token.actor && worldHudSettings.updateActorImage) {\n      if (worldHudSettings.useNameSimilarity) {\n        updateActorWithSimilarName(imgSrc, name, token.actor);\n      } else {\n        updateActorImage(token.actor, imgSrc, { imgName: name });\n      }\n    }\n  }\n}\n\nasync function _onImageRightClick(event, tokenId) {\n  event.preventDefault();\n  event.stopPropagation();\n  let token = canvas.tokens.controlled.querySelector(\n    (t) => t.document.id === tokenId,\n  );\n  if (!token) return;\n\n  const imgButton = event.target.closest(\".token-variants-button-select\");\n  const imgSrc = imgButton.attr(\"data-name\");\n  const name = imgButton.attr(\"data-filename\");\n\n  if (!imgSrc || !name) return;\n\n  if (keyPressed(\"config\") && game.user.isGM) {\n    const regenStyle = (token, img) => {\n      const mappings =\n        token.document.getFlag(\"token-variants\", \"userMappings\") || {};\n      const name = imgButton.attr(\"data-filename\");\n      const [title, style] = genTitleAndStyle(mappings, img, name);\n      imgButton\n        .closest(\".token-variants-wrap\")\n        .querySelector(`.token-variants-button-select[data-name='${img}']`)\n        .css(\"box-shadow\", style)\n        .prop(\"title\", title);\n    };\n    new UserList(token, imgSrc, regenStyle).render(true);\n  } else if (token.actor) {\n    let tokenActor = game.actors.get(token.actor.id);\n    let variants = getVariants(tokenActor);\n\n    // Remove selected variant if present in the flag, add otherwise\n    let del = false;\n    let updated = false;\n    for (let variant of variants) {\n      if (variant.imgSrc === imgSrc) {\n        let fNames = variant.names.filter((name) => name !== name);\n        if (fNames.length === 0) {\n          del = true;\n        } else if (fNames.length === variant.names.length) {\n          fNames.push(name);\n        }\n        variant.names = fNames;\n        updated = true;\n        break;\n      }\n    }\n    if (del) variants = variants.filter((variant) => variant.imgSrc !== imgSrc);\n    else if (!updated) variants.push({ imgSrc: imgSrc, names: [name] });\n\n    // Set shared variants as an actor flag\n    setVariants(tokenActor, variants);\n    imgbutton.querySelector(\".fa-share\").toggleClass(\"active\"); // Display green arrow\n  }\n}\n\nasync function _onImageSearchKeyUp(event, token) {\n  event.preventDefault();\n  event.stopPropagation();\n  if (event.key === \"Enter\" || event.keyCode === 13) {\n    if (event.target.value.length >= 3) {\n      const button = event.target.closest(\".control-icon\");\n      button.querySelector(\".token-variants-wrap\").remove();\n      const sideSelect = await renderSideSelect(token, event.target.value);\n      if (sideSelect) {\n        sideSelect.addClass(\"active\");\n        button.append(sideSelect);\n      }\n    }\n  }\n}\n\nfunction genTitleAndStyle(mappings, imgSrc, name) {\n  let title = TVA_CONFIG.worldHud.showFullPath ? imgSrc : name;\n  let style = \"\";\n  let offset = 2;\n  for (const [userId, img] of Object.entries(mappings)) {\n    if (img === imgSrc) {\n      const user = game.users.get(userId);\n      if (!user) continue;\n      if (style.length === 0) {\n        style = `inset 0 0 0 ${offset}px ${user.color}`;\n      } else {\n        style += `, inset 0 0 0 ${offset}px ${user.color}`;\n      }\n      offset += 2;\n      title += `\\nDisplayed to: ${user.name}`;\n    }\n  }\n  return [title, style];\n}\n\nasync function updateActorWithSimilarName(imgSrc, imgName, actor) {\n  const results = await findImagesFuzzy(\n    imgName,\n    SEARCH_TYPE.PORTRAIT,\n    {\n      algorithm: {\n        fuzzyThreshold: 0.4,\n        fuzzyLimit: 50,\n      },\n    },\n    true,\n  );\n\n  if (results && results.length !== 0) {\n    updateActorImage(actor, results[0].path, { imgName: results[0].name });\n  } else {\n    updateActorImage(actor, imgSrc, { imgName: imgName });\n  }\n}\n\nfunction activateStatusEffectListeners(token) {\n  if (\n    TVA_CONFIG.permissions.statusConfig[game.user.role] &&\n    token.actorId &&\n    game.actors.get(token.actorId)\n  ) {\n    const iconEffects = document.querySelector(\n      '.control-icon[data-action=\"effects\"]',\n    );\n    if (iconEffects) {\n      iconEffects.querySelector(\"img:first\").click((event) => {\n        event.preventDefault();\n        if (keyPressed(\"config\")) {\n          event.stopPropagation();\n          new EffectMappingForm(token).render(true);\n        }\n      });\n    }\n\n    const iconVisibility = document.querySelector(\n      '.control-icon[data-action=\"visibility\"]',\n    );\n    if (iconVisibility) {\n      iconVisibility.querySelector(\"img\").click((event) => {\n        event.preventDefault();\n        if (keyPressed(\"config\")) {\n          event.stopPropagation();\n          new EffectMappingForm(token, {\n            createMapping: {\n              label: \"In Combat\",\n              expression: \"token-variants-visibility\",\n            },\n          }).render(true);\n        }\n      });\n    }\n\n    const iconCombat = document.querySelector(\n      '.control-icon[data-action=\"combat\"]',\n    );\n    if (iconCombat) {\n      iconCombat.querySelector(\"img\").click((event) => {\n        event.preventDefault();\n        if (keyPressed(\"config\")) {\n          event.stopPropagation();\n          new EffectMappingForm(token, {\n            createMapping: {\n              label: \"In Combat\",\n              expression: \"token-variants-combat\",\n            },\n          }).render(true);\n        }\n      });\n    }\n\n    const statusEffects = document.querySelector(\".status-effects\");\n    if (statusEffects) {\n      statusEffects.querySelector(\"img\").click((event) => {\n        event.preventDefault();\n        if (keyPressed(\"config\")) {\n          event.stopPropagation();\n\n          let effectName = event.target.data(\"tooltip\");\n          if (game.system.id === \"pf2e\") {\n            effectName = event.target.closest(\"picture\").attr(\"title\");\n          }\n          new EffectMappingForm(token, {\n            createMapping: { label: effectName, expression: effectName },\n          }).render(true);\n        }\n      });\n    }\n  }\n}\n\nfunction getVariants(actor) {\n  if (TOKEN_HUD_VARIANTS.variants) return TOKEN_HUD_VARIANTS.variants;\n  else return actor?.getFlag(\"token-variants\", \"variants\") || [];\n}\n\nfunction setVariants(actor, variants) {\n  TOKEN_HUD_VARIANTS.variants = variants;\n  TOKEN_HUD_VARIANTS.actor = actor;\n}\n","import { TVA_CONFIG, updateSettings } from \"../scripts/settings.js\";\nimport { getFileName } from \"../scripts/utils.js\";\nimport { showArtSelect } from \"../token-variants.mjs\";\n\nexport default class MissingImageConfig extends FormApplication {\n  constructor() {\n    super({}, {});\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: \"token-variants-missing-images\",\n      classes: [\"sheet\"],\n      template:\n        \"modules/token-variants/token-variants/templates/missingImageConfig.html\",\n      resizable: true,\n      minimizable: false,\n      title: \"Define Missing Images\",\n      width: 560,\n      height: \"auto\",\n    });\n  }\n\n  async getData(options) {\n    const data = super.getData(options);\n\n    if (!this.missingImages)\n      this.missingImages = foundry.utils.deepClone(\n        TVA_CONFIG.compendiumMapper.missingImages,\n      );\n\n    data.missingImages = this.missingImages;\n\n    data.documents = [\"all\", \"Actor\", \"Cards\", \"Item\", \"Macro\", \"RollTable\"];\n    return data;\n  }\n\n  _processFormData(formData) {\n    if (!Array.isArray(formData.document)) {\n      formData.document = [formData.document];\n      formData.image = [formData.image];\n    }\n\n    const missingImages = [];\n    for (let i = 0; i < formData.document.length; i++) {\n      missingImages.push({\n        document: formData.document[i],\n        image: formData.image[i],\n      });\n    }\n    return missingImages;\n  }\n\n  /**\n   * @param {JQuery} html\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    html.on(\"click\", \".add-row\", () => {\n      const formData = this._getSubmitData();\n      this.missingImages = this._processFormData(formData);\n      this.missingImages.push({ document: \"all\", image: CONST.DEFAULT_TOKEN });\n      this.render();\n    });\n\n    html.on(\"click\", \".delete-row\", (event) => {\n      const formData = this._getSubmitData();\n      this.missingImages = this._processFormData(formData);\n      const index = event.target.closest(\"li\")[0].dataset.index;\n      this.missingImages.splice(index, 1);\n      this.render();\n    });\n\n    html.on(\"click\", \".file-picker\", (event) => {\n      new FilePicker({\n        type: \"imagevideo\",\n        callback: (path) => {\n          event.target.closest(\"li\").find('[name=\"image\"]').val(path);\n          event.target.closest(\"li\").find(\"img\").attr(\"src\", path);\n        },\n      }).render();\n    });\n\n    html.on(\"click\", \".duplicate-picker\", (event) => {\n      let content = `<select style=\"width: 100%;\" name=\"compendium\">`;\n\n      game.packs.forEach((pack) => {\n        content += `<option value='${pack.collection}'>${pack.title}</option>`;\n      });\n\n      content += `</select>`;\n\n      new Dialog({\n        title: `Compendiums`,\n        content: content,\n        buttons: {\n          yes: {\n            icon: \"<i class='far fa-search'></i>\",\n            label: \"Search for Duplicates\",\n            callback: (html) => {\n              const found = new Set();\n              const duplicates = new Set();\n              const compendium = game.packs.get(\n                html.querySelector(\"[name='compendium']\").val(),\n              );\n              compendium.index.forEach((k) => {\n                if (found.has(k.img)) {\n                  duplicates.add(k.img);\n                }\n                found.add(k.img);\n              });\n              if (!duplicates.size) {\n                ui.notifications.info(\n                  \"No duplicates found in: \" + compendium.title,\n                );\n              }\n\n              const images = Array.from(duplicates).map((img) => {\n                return { path: img, name: getFileName(img) };\n              });\n              const allImages = new Map();\n              allImages.set(\"Duplicates\", images);\n\n              showArtSelect(\"Duplicates\", {\n                allImages,\n                callback: (img) => {\n                  event.target.closest(\"li\").find('[name=\"image\"]').val(img);\n                  event.target.closest(\"li\").find(\"img\").attr(\"src\", img);\n                },\n              });\n            },\n          },\n        },\n        default: \"yes\",\n      }).render(true);\n    });\n  }\n\n  async _updateObject(event, formData) {\n    updateSettings({\n      compendiumMapper: { missingImages: this._processFormData(formData) },\n    });\n  }\n}\n","import { showArtSelect } from \"../token-variants.mjs\";\nimport {\n  BASE_IMAGE_CATEGORIES,\n  SEARCH_TYPE,\n  updateActorImage,\n  updateTokenImage,\n  userRequiresImageCache,\n} from \"../scripts/utils.js\";\nimport { addToQueue, ArtSelect, renderFromQueue } from \"./artSelect.js\";\nimport {\n  getSearchOptions,\n  TVA_CONFIG,\n  updateSettings,\n} from \"../scripts/settings.js\";\nimport ConfigureSettings from \"./configureSettings.js\";\nimport MissingImageConfig from \"./missingImageConfig.js\";\nimport { cacheImages, doImageSearch } from \"../scripts/search.js\";\n\nasync function autoApply(actor, image1, image2, formData, typeOverride) {\n  let portraitFound = formData.ignorePortrait;\n  let tokenFound = formData.ignoreToken;\n\n  if (formData.diffImages) {\n    let results = [];\n\n    if (!formData.ignorePortrait) {\n      results = await doImageSearch(actor.name, {\n        searchType: typeOverride ?? SEARCH_TYPE.PORTRAIT,\n        simpleResults: true,\n        searchOptions: formData.searchOptions,\n      });\n\n      if ((results ?? []).length != 0) {\n        portraitFound = true;\n        await updateActorImage(actor, results[0], false, formData.compendium);\n      }\n    }\n\n    if (!formData.ignoreToken) {\n      results = await doImageSearch(actor.prototypeToken.name, {\n        searchType: SEARCH_TYPE.TOKEN,\n        simpleResults: true,\n        searchOptions: formData.searchOptions,\n      });\n\n      if ((results ?? []).length != 0) {\n        tokenFound = true;\n        updateTokenImage(results[0], {\n          actor: actor,\n          pack: formData.compendium,\n          applyDefaultConfig: false,\n        });\n      }\n    }\n  } else {\n    let results = await doImageSearch(actor.name, {\n      searchType: typeOverride ?? SEARCH_TYPE.PORTRAIT_AND_TOKEN,\n      simpleResults: true,\n      searchOptions: formData.searchOptions,\n    });\n\n    if ((results ?? []).length != 0) {\n      portraitFound = tokenFound = true;\n      updateTokenImage(results[0], {\n        actor: actor,\n        actorUpdate: { img: results[0] },\n        pack: formData.compendium,\n        applyDefaultConfig: false,\n      });\n    }\n  }\n\n  if (!(tokenFound && portraitFound) && formData.autoDisplayArtSelect) {\n    addToArtSelectQueue(actor, image1, image2, formData, typeOverride);\n  }\n}\n\nfunction addToArtSelectQueue(actor, image1, image2, formData, typeOverride) {\n  if (formData.diffImages) {\n    if (!formData.ignorePortrait && !formData.ignoreToken) {\n      addToQueue(actor.name, {\n        searchType: typeOverride ?? SEARCH_TYPE.PORTRAIT,\n        object: actor,\n        preventClose: true,\n        image1: image1,\n        image2: image2,\n        displayMode: ArtSelect.IMAGE_DISPLAY.PORTRAIT,\n        searchOptions: formData.searchOptions,\n        callback: async function (imgSrc, _) {\n          await updateActorImage(actor, imgSrc);\n          showArtSelect(actor.prototypeToken.name, {\n            searchType: typeOverride ?? SEARCH_TYPE.TOKEN,\n            object: actor,\n            force: true,\n            image1: imgSrc,\n            image2: image2,\n            displayMode: ArtSelect.IMAGE_DISPLAY.TOKEN,\n            searchOptions: formData.searchOptions,\n            callback: (imgSrc, name) =>\n              updateTokenImage(imgSrc, {\n                actor: actor,\n                imgName: name,\n                applyDefaultConfig: false,\n              }),\n          });\n        },\n      });\n    } else if (formData.ignorePortrait) {\n      addToQueue(actor.name, {\n        searchType: typeOverride ?? SEARCH_TYPE.TOKEN,\n        object: actor,\n        image1: image1,\n        image2: image2,\n        displayMode: ArtSelect.IMAGE_DISPLAY.TOKEN,\n        searchOptions: formData.searchOptions,\n        callback: async function (imgSrc, name) {\n          updateTokenImage(imgSrc, {\n            actor: actor,\n            imgName: name,\n            applyDefaultConfig: false,\n          });\n        },\n      });\n    } else if (formData.ignoreToken) {\n      addToQueue(actor.name, {\n        searchType: typeOverride ?? SEARCH_TYPE.PORTRAIT,\n        object: actor,\n        image1: image1,\n        image2: image2,\n        displayMode: ArtSelect.IMAGE_DISPLAY.PORTRAIT,\n        searchOptions: formData.searchOptions,\n        callback: async function (imgSrc, name) {\n          await updateActorImage(actor, imgSrc);\n        },\n      });\n    }\n  } else {\n    addToQueue(actor.name, {\n      searchType: typeOverride ?? SEARCH_TYPE.PORTRAIT_AND_TOKEN,\n      object: actor,\n      image1: image1,\n      image2: image2,\n      displayMode: ArtSelect.IMAGE_DISPLAY.PORTRAIT_TOKEN,\n      searchOptions: formData.searchOptions,\n      callback: async function (imgSrc, name) {\n        await updateActorImage(actor, imgSrc);\n        updateTokenImage(imgSrc, {\n          actor: actor,\n          imgName: name,\n          applyDefaultConfig: false,\n        });\n      },\n    });\n  }\n}\n\nexport default class CompendiumMapConfig extends FormApplication {\n  constructor() {\n    super({}, {});\n    this.searchOptions = foundry.utils.deepClone(getSearchOptions());\n    foundry.utils.mergeObject(\n      this.searchOptions,\n      foundry.utils.deepClone(TVA_CONFIG.compendiumMapper.searchOptions),\n    );\n    this._fixSearchPaths();\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: \"token-variants-compendium-map-config\",\n      classes: [\"sheet\"],\n      template:\n        \"modules/token-variants/token-variants/templates/compendiumMap.html\",\n      resizable: false,\n      minimizable: false,\n      title: game.i18n.localize(\n        \"token-variants.settings.compendium-mapper.Name\",\n      ),\n      width: 500,\n    });\n  }\n\n  async getData(options) {\n    let data = super.getData(options);\n    data = foundry.utils.mergeObject(data, TVA_CONFIG.compendiumMapper);\n\n    const supportedPacks = [\"Actor\", \"Cards\", \"Item\", \"Macro\", \"RollTable\"];\n    data.supportedPacks = supportedPacks.join(\", \");\n\n    const packs = [];\n    game.packs.forEach((pack) => {\n      if (!pack.locked && supportedPacks.includes(pack.documentName)) {\n        packs.push({\n          title: pack.title,\n          id: pack.collection,\n          type: pack.documentName,\n        });\n      }\n    });\n    data.compendiums = packs;\n    data.compendium = TVA_CONFIG.compendiumMapper.compendium;\n\n    data.categories = BASE_IMAGE_CATEGORIES.concat(\n      TVA_CONFIG.customImageCategories,\n    );\n    data.category = TVA_CONFIG.compendiumMapper.category;\n\n    return data;\n  }\n\n  /**\n   * @param {JQuery} html\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html\n      .querySelector(\".token-variants-override-category\")\n      .change(this._onCategoryOverride)\n      .trigger(\"change\");\n    html.querySelector(\".token-variants-auto-apply\").change(this._onAutoApply);\n    html\n      .querySelector(\".token-variants-diff-images\")\n      .change(this._onDiffImages);\n    html\n      .querySelector(`.token-variants-search-options`)\n      .on(\"click\", this._onSearchOptions.bind(this));\n    html\n      .querySelector(`.token-variants-missing-images`)\n      .on(\"click\", this._onMissingImages.bind(this));\n\n    html\n      .find('[name=\"compendium\"]')\n      .change(this._onCompendiumSelect.bind(this))\n      .trigger(\"change\");\n  }\n\n  async _onAutoApply(event) {\n    event.target\n      .closest(\"form\")\n      .find(\".token-variants-auto-art-select\")\n      .prop(\"disabled\", !event.target.checked);\n  }\n\n  async _onCategoryOverride(event) {\n    event.target\n      .closest(\"form\")\n      .find(\".token-variants-category\")\n      .prop(\"disabled\", !event.target.checked);\n  }\n\n  async _onDiffImages(event) {\n    event.target\n      .closest(\"form\")\n      .find(\".token-variants-tp-ignore\")\n      .prop(\"disabled\", !event.target.checked);\n  }\n\n  async _onCompendiumSelect(event) {\n    const compendium = game.packs.get(event.target.val());\n    if (compendium) {\n      event.target\n        .closest(\"form\")\n        .find(\".token-specific\")\n        .css(\n          \"visibility\",\n          compendium.documentName === \"Actor\" ? \"visible\" : \"hidden\",\n        );\n    }\n  }\n\n  _fixSearchPaths() {\n    if (!this.searchOptions.searchPaths?.length) {\n      this.searchOptions.searchPaths = foundry.utils.deepClone(\n        TVA_CONFIG.searchPaths,\n      );\n    }\n  }\n\n  async _onSearchOptions(event) {\n    this._fixSearchPaths();\n    new ConfigureSettings(this.searchOptions, {\n      searchPaths: true,\n      searchFilters: true,\n      searchAlgorithm: true,\n      randomizer: false,\n      features: false,\n      popup: false,\n      permissions: false,\n      worldHud: false,\n      misc: false,\n      activeEffects: false,\n    }).render(true);\n  }\n\n  async _onMissingImages(event) {\n    new MissingImageConfig().render(true);\n  }\n\n  async startMapping(formData) {\n    if (\n      formData.diffImages &&\n      formData.ignoreToken &&\n      formData.ignorePortrait\n    ) {\n      return;\n    }\n\n    const originalSearchPaths = TVA_CONFIG.searchPaths;\n    if (formData.searchOptions.searchPaths?.length) {\n      TVA_CONFIG.searchPaths = formData.searchOptions.searchPaths;\n    }\n\n    if (\n      formData.cache ||\n      !userRequiresImageCache() ||\n      formData.searchOptions.searchPaths?.length\n    ) {\n      console.log(\"TVA-Mapper: Starting Image caching.\");\n      await cacheImages();\n      console.log(\"TVA-Mapper: Caching finished.\");\n    }\n\n    const endMapping = function () {\n      if (formData.searchOptions.searchPaths?.length) {\n        TVA_CONFIG.searchPaths = originalSearchPaths;\n        cacheImages();\n      }\n    };\n\n    const compendium = game.packs.get(formData.compendium);\n    let missingImageList = TVA_CONFIG.compendiumMapper.missingImages\n      .filter(\n        (mi) =>\n          mi.document === \"all\" || mi.document === compendium.documentName,\n      )\n      .map((mi) => mi.image);\n    const typeOverride = formData.overrideCategory ? formData.category : null;\n    let artSelectDisplayed = false;\n\n    let processItem;\n    let consoleProcessedTracking = 0;\n    if (compendium.documentName === \"Actor\") {\n      processItem = async function (item) {\n        const actor = item;\n        if (actor.name === \"#[CF_tempEntity]\") return; // Compendium Folders module's control entity\n\n        let hasPortrait =\n          actor.img !== CONST.DEFAULT_TOKEN &&\n          !missingImageList.includes(actor.img);\n        let hasToken =\n          actor.prototypeToken.texture.src !== CONST.DEFAULT_TOKEN &&\n          !missingImageList.includes(actor.prototypeToken.texture.src);\n        if (formData.syncImages && hasPortrait !== hasToken) {\n          if (hasPortrait) {\n            await updateTokenImage(actor.img, {\n              actor: actor,\n              applyDefaultConfig: false,\n            });\n          } else {\n            await updateActorImage(actor, actor.prototypeToken.texture.src);\n          }\n          hasPortrait = hasToken = true;\n        }\n\n        let includeThisActor =\n          !(formData.missingOnly && hasPortrait) && !formData.ignorePortrait;\n        let includeThisToken =\n          !(formData.missingOnly && hasToken) && !formData.ignoreToken;\n\n        const image1 = formData.showImages ? actor.img : \"\";\n        const image2 = formData.showImages\n          ? actor.prototypeToken.texture.src\n          : \"\";\n\n        if (includeThisActor || includeThisToken) {\n          if (formData.autoApply) {\n            await autoApply(actor, image1, image2, formData, typeOverride);\n          } else {\n            artSelectDisplayed = true;\n            addToArtSelectQueue(actor, image1, image2, formData, typeOverride);\n          }\n        }\n\n        consoleProcessedTracking++;\n        if (consoleProcessedTracking % 100 === 0)\n          console.log(\n            `TVA-Mapper: Processed ${consoleProcessedTracking} ${compendium.documentName}s`,\n          );\n      };\n    } else {\n      processItem = async function (item) {\n        const doc = item;\n        if (doc.name === \"#[CF_tempEntity]\") return; // Compendium Folders module's control entity\n\n        let defaultImg = \"\";\n        if (doc.schema.fields.img || doc.schema.fields.texture) {\n          defaultImg = (\n            doc.schema.fields.img ?? doc.schema.fields.texture\n          ).initial(doc);\n        }\n        const hasImage =\n          doc.img != null &&\n          doc.img !== defaultImg &&\n          !missingImageList.includes(doc.img);\n\n        let imageFound = false;\n        if (formData.missingOnly && hasImage) return;\n        if (formData.autoApply) {\n          let results = await doImageSearch(doc.name, {\n            searchType: typeOverride ?? compendium.documentName,\n            simpleResults: true,\n            searchOptions: formData.searchOptions,\n          });\n\n          if ((results ?? []).length != 0) {\n            imageFound = true;\n            await updateActorImage(doc, results[0], false, formData.compendium);\n          }\n        }\n\n        if (\n          !formData.autoApply ||\n          (formData.autoDisplayArtSelect && !imageFound)\n        ) {\n          artSelectDisplayed = true;\n          addToQueue(doc.name, {\n            searchType: typeOverride ?? compendium.documentName,\n            object: doc,\n            image1: formData.showImages ? doc.img : \"\",\n            displayMode: ArtSelect.IMAGE_DISPLAY.IMAGE,\n            searchOptions: formData.searchOptions,\n            callback: async function (imgSrc, name) {\n              await updateActorImage(doc, imgSrc);\n            },\n          });\n        }\n\n        consoleProcessedTracking++;\n        if (consoleProcessedTracking % 100 === 0)\n          console.log(\n            `TVA-Mapper: Processed ${consoleProcessedTracking} ${compendium.documentName}s`,\n          );\n      };\n    }\n\n    console.log(`TVA-Mapper: Starting Batch ${compendium.documentName} load.`);\n    const documents = await compendium.getDocuments();\n    console.log(`TVA-Mapper: Load finished. Beginning processing.`);\n\n    if (formData.autoApply) {\n      let processing = true;\n      let stopProcessing = false;\n      let processed = 0;\n      let counter = `<p>CACHING 0/${documents.length}</p>`;\n      let d;\n\n      const startProcessing = async function () {\n        while (processing && processed < documents.length) {\n          await new Promise((resolve, reject) => {\n            setTimeout(async () => {\n              await processItem(documents[processed]);\n              resolve();\n            }, 10);\n          });\n          processed++;\n          counter.html(`${processed}/${documents.length}`);\n        }\n        if (stopProcessing || processed === documents.length) {\n          d?.close(true);\n          addToQueue(\"DUMMY\", { execute: endMapping });\n          renderFromQueue();\n        }\n      };\n\n      d = new Dialog({\n        title: `Mapping: ${compendium.title}`,\n        content: `\n        <div style=\"text-align:center;\" class=\"fa-3x\"><i class=\"fas fa-spinner fa-pulse\"></i></div>\n        <div style=\"text-align:center;\" class=\"counter\"></div>\n        <button style=\"width:100%;\" class=\"pause\"><i class=\"fas fa-play-circle\"></i> Pause/Start</button>`,\n        buttons: {\n          cancel: {\n            icon: '<i class=\"fas fa-stop-circle\"></i>',\n            label: \"Cancel\",\n          },\n        },\n        default: \"cancel\",\n        render: (html) => {\n          html.querySelector(\".counter\").append(counter);\n          const spinner = html.querySelector(\".fa-spinner\");\n          html.querySelector(\".pause\").on(\"click\", () => {\n            if (processing) {\n              processing = false;\n              spinner.removeClass(\"fa-pulse\");\n            } else {\n              processing = true;\n              startProcessing();\n              spinner.addClass(\"fa-pulse\");\n            }\n          });\n          setTimeout(async () => startProcessing(), 1000);\n        },\n        close: () => {\n          if (!stopProcessing) {\n            stopProcessing = true;\n            if (!processing) startProcessing();\n            else processing = false;\n          }\n        },\n      });\n      d.render(true);\n    } else {\n      const tasks = documents.map(processItem);\n      Promise.all(tasks).then(() => {\n        addToQueue(\"DUMMY\", { execute: endMapping });\n        renderFromQueue();\n        if (formData.missingOnly && !artSelectDisplayed) {\n          ui.notifications.warn(\n            \"Token Variant Art: No documents found containing missing images.\",\n          );\n        }\n      });\n    }\n  }\n\n  /**\n   * @param {Event} event\n   * @param {Object} formData\n   */\n  async _updateObject(event, formData) {\n    // If search paths are the same, remove them from searchOptions\n    if (\n      !this.searchOptions.searchPaths?.length ||\n      foundry.utils.isEmpty(\n        foundry.utils.diffObject(\n          this.searchOptions.searchPaths,\n          TVA_CONFIG.searchPaths,\n        ),\n      )\n    ) {\n      this.searchOptions.searchPaths = [];\n    }\n\n    formData.searchOptions = this.searchOptions;\n\n    await updateSettings({ compendiumMapper: formData });\n    if (formData.compendium) {\n      this.startMapping(formData);\n    }\n  }\n}\n","import EffectMappingForm from \"../applications/effectMappingForm.js\";\nimport { OverlayConfig } from \"../applications/overlayConfig.js\";\nimport { TVAOverlay } from \"./sprite/TVAOverlay.js\";\nimport { evaluateOverlayExpressions } from \"./token/overlay.js\";\n\nexport class Reticle {\n  static app;\n  static fields;\n  static reticleOverlay;\n  static active = false;\n  static hitTest;\n  static token = null;\n  static dialog = null;\n\n  // Offset calculation controls\n  static mode = \"tooltip\";\n  static increment = 1;\n\n  static _onReticleMove(event) {\n    if (this.reticleOverlay.isMouseDown) {\n      let pos = event.data.getLocalPosition(this.reticleOverlay);\n\n      this.config.pOffsetX = 0;\n      this.config.pOffsetY = 0;\n      this.config.offsetX = 0;\n      this.config.offsetY = 0;\n\n      if (this.mode === \"token\") {\n        this.config.linkRotation = true;\n        this.config.linkMirror = true;\n      }\n\n      this.tvaOverlay.refresh(this.config, { preview: true });\n\n      const tCoord = { x: this.tvaOverlay.x, y: this.tvaOverlay.y };\n\n      if (this.tvaOverlay.overlayConfig.parentID) {\n        let parent = this.tvaOverlay;\n        do {\n          parent = parent.parent;\n          tCoord.x += parent.x;\n          tCoord.y += parent.y;\n        } while (!(parent instanceof TVAOverlay));\n      }\n\n      let dx = pos.x - tCoord.x;\n      let dy = pos.y - tCoord.y;\n\n      let angle = 0;\n      if (!this.config.animation.relative) {\n        angle = this.config.angle;\n        if (this.config.linkRotation)\n          angle += this.tvaOverlay.object.document.rotation;\n      }\n\n      [dx, dy] = rotate(0, 0, dx, dy, angle);\n      dx = round(dx, this.increment);\n      dy = round(dy, this.increment);\n\n      // let lPos = event.data.getLocalPosition(this.tvaOverlay);\n      // console.log(lPos);\n      // // let dx = lPos.x;\n      // // let dy = lPos.y;\n\n      if (this.mode === \"static\") {\n        this.config.pOffsetX = dx;\n        this.config.pOffsetY = dy;\n      } else if (this.mode === \"token\") {\n        this.config.offsetX = -dx / this.tvaOverlay.object.w;\n        this.config.offsetY = -dy / this.tvaOverlay.object.h;\n      } else {\n        let token = this.tvaOverlay.object;\n\n        let pWidth;\n        let pHeight;\n\n        if (this.tvaOverlay.overlayConfig.parentID) {\n          pWidth =\n            (this.tvaOverlay.parent.shapesWidth ??\n              this.tvaOverlay.parent.width) / this.tvaOverlay.parent.scale.x;\n          pHeight =\n            (this.tvaOverlay.parent.shapesHeight ??\n              this.tvaOverlay.parent.height) / this.tvaOverlay.parent.scale.y;\n        } else {\n          pWidth = token.w;\n          pHeight = token.h;\n        }\n\n        if (this.mode === \"tooltip\") {\n          if (Math.abs(dx) >= pWidth / 2) {\n            this.config.offsetX = 0.5 * (dx < 0 ? 1 : -1);\n            dx += (pWidth / 2) * (dx < 0 ? 1 : -1);\n          } else {\n            this.config.offsetX = -dx / this.tvaOverlay.object.w;\n            dx = 0;\n          }\n\n          if (Math.abs(dy) >= pHeight / 2) {\n            this.config.offsetY = 0.5 * (dy < 0 ? 1 : -1);\n            dy += (pHeight / 2) * (dy < 0 ? 1 : -1);\n          } else {\n            this.config.offsetY = -dy / this.tvaOverlay.object.h;\n            dy = 0;\n          }\n        } else {\n          if (Math.abs(dx) >= pWidth / 2) {\n            this.config.offsetX = 0.5 * (dx < 0 ? 1 : -1);\n            dx += (pWidth / 2) * (dx < 0 ? 1 : -1);\n          } else if (Math.abs(dy) >= pHeight / 2) {\n            this.config.offsetY = 0.5 * (dy < 0 ? 1 : -1);\n            dy += (pHeight / 2) * (dy < 0 ? 1 : -1);\n          } else {\n            this.config.offsetX = -dx / this.tvaOverlay.object.w;\n            dx = 0;\n            this.config.offsetY = -dy / this.tvaOverlay.object.h;\n            dy = 0;\n          }\n        }\n\n        this.config.pOffsetX = dx;\n        this.config.pOffsetY = dy;\n      }\n\n      this.tvaOverlay.refresh(this.config, { preview: true });\n    }\n  }\n\n  static minimizeApps() {\n    Object.values(ui.windows).forEach((app) => {\n      if (app instanceof OverlayConfig || app instanceof EffectMappingForm) {\n        app.minimize();\n      }\n    });\n  }\n\n  static maximizeApps() {\n    Object.values(ui.windows).forEach((app) => {\n      if (app instanceof OverlayConfig || app instanceof EffectMappingForm) {\n        app.maximize();\n      }\n    });\n  }\n\n  static activate({ tvaOverlay = null, config = {} } = {}) {\n    if (this.deactivate() || !canvas.ready) return false;\n    if (!tvaOverlay || !config) return false;\n\n    if (this.reticleOverlay) {\n      this.reticleOverlay.destroy(true);\n    }\n\n    const interaction = canvas.app.renderer.events;\n    if (!interaction.cursorStyles[\"reticle\"]) {\n      interaction.cursorStyles[\"reticle\"] =\n        \"url('modules/token-variants/token-variants/img/reticle.webp'), auto\";\n    }\n\n    this.tvaOverlay = tvaOverlay;\n\n    this.minimizeApps();\n    this.config = evaluateOverlayExpressions(\n      foundry.utils.deepClone(config),\n      this.tvaOverlay.object,\n      {\n        overlayConfig: config,\n      },\n    );\n\n    // Setup the overlay to be always visible while we're adjusting its position\n    this.config.alwaysVisible = true;\n\n    this.active = true;\n\n    // Create the reticle overlay\n    this.reticleOverlay = new PIXI.Container();\n    this.reticleOverlay.hitArea = canvas.dimensions.rect;\n    this.reticleOverlay.cursor = \"reticle\";\n    this.reticleOverlay.interactive = true;\n    this.reticleOverlay.zIndex = Infinity;\n\n    const stopEvent = function (event) {\n      event.preventDefault();\n      // event.stopPropagation();\n    };\n\n    this.reticleOverlay.on(\"mousedown\", (event) => {\n      event.preventDefault();\n\n      if (\n        event.data.originalEvent.which != 2 &&\n        event.data.originalEvent.nativeEvent.which != 2\n      ) {\n        this.reticleOverlay.isMouseDown = true;\n        this._onReticleMove(event);\n      }\n    });\n    this.reticleOverlay.on(\"pointermove\", (event) => {\n      event.preventDefault();\n      // event.stopPropagation();\n      this._onReticleMove(event);\n    });\n    this.reticleOverlay.on(\"mouseup\", (event) => {\n      event.preventDefault();\n      this.reticleOverlay.isMouseDown = false;\n    });\n    this.reticleOverlay.on(\"click\", (event) => {\n      event.preventDefault();\n      if (\n        event.data.originalEvent.which == 2 ||\n        event.data.originalEvent.nativeEvent.which == 2\n      ) {\n        this.deactivate();\n      }\n    });\n\n    canvas.stage.addChild(this.reticleOverlay);\n    this.dialog = displayControlDialog();\n    return true;\n  }\n\n  static deactivate() {\n    if (this.active) {\n      if (this.reticleOverlay)\n        this.reticleOverlay.parent?.removeChild(this.reticleOverlay);\n      this.active = false;\n      this.tvaOverlay = null;\n      if (\n        this.dialog &&\n        this.dialog._state !== Application.RENDER_STATES.CLOSED\n      )\n        this.dialog.close(true);\n      this.dialog = null;\n      this.maximizeApps();\n\n      const app = Object.values(ui.windows).find(\n        (app) => app instanceof OverlayConfig,\n      );\n      if (!app) {\n        this.config = null;\n        return;\n      }\n      const form = app.form;\n\n      [\"pOffsetX\", \"pOffsetY\", \"offsetX\", \"offsetY\"].forEach((field) => {\n        if (field in this.config) {\n          form.find(`[name=\"${field}\"]`).val(this.config[field]);\n        }\n      });\n\n      if (this.mode === \"token\") {\n        [\"linkRotation\", \"linkMirror\"].forEach((field) => {\n          form.find(`[name=\"${field}\"]`).prop(\"checked\", true);\n        });\n        [\"linkDimensionsX\", \"linkDimensionsY\"].forEach((field) => {\n          form.find(`[name=\"${field}\"]`).prop(\"checked\", false);\n        });\n      } else {\n        [\"linkRotation\", \"linkMirror\"].forEach((field) => {\n          form.find(`[name=\"${field}\"]`).prop(\"checked\", false);\n        });\n      }\n\n      if (this.mode === \"hud\") {\n        form.find('[name=\"ui\"]').prop(\"checked\", true).trigger(\"change\");\n      }\n\n      form.find('[name=\"anchor.x\"]').val(this.config.anchor.x);\n      form\n        .find('[name=\"anchor.y\"]')\n        .val(this.config.anchor.y)\n        .trigger(\"change\");\n      this.config = null;\n\n      return true;\n    }\n  }\n}\n\nfunction displayControlDialog() {\n  const d = new Dialog({\n    title: \"Set Overlay Position\",\n    content: `\n      <style>\n        .images { display: flex; }\n        .images a { flex: 20%; width: 50px; margin: 2px; }\n        .images a.active img { border-color: orange; border-width: 2px; }\n        .anchorlbl {margin: auto; display: table; }\n      </style>\n      <div class=\"images\">\n        <a data-id=\"token\"><img src=\"modules/token-variants/token-variants/img/token_mode.png\"></img></a>\n        <a data-id=\"tooltip\"><img src=\"modules/token-variants/token-variants/img/tooltip_mode.png\"></img></a>\n        <a data-id=\"hud\"><img src=\"modules/token-variants/token-variants/img/hud_mode.png\"></img></a>\n        <a data-id=\"static\"><img src=\"modules/token-variants/token-variants/img/static_mode.png\"></img></a>\n      </div>\n     <br>\n      <label class=\"anchorlbl\">Anchor</label>\n      <div class=\"tva-anchor\">\n        <input type=\"radio\" class=\"top left\" name=\"anchor\">\n        <input type=\"radio\" class=\"top center\" name=\"anchor\">\n        <input type=\"radio\" class=\"top right\" name=\"anchor\">\n        <input type=\"radio\" class=\"mid left\" name=\"anchor\">\n        <input type=\"radio\" class=\"mid center\" name=\"anchor\">\n        <input type=\"radio\" class=\"mid right\" name=\"anchor\">\n        <input type=\"radio\" class=\"bot left\" name=\"anchor\">\n        <input type=\"radio\" class=\"bot center\" name=\"anchor\">\n        <input type=\"radio\" class=\"bot right\" name=\"anchor\">\n      </div>\n      <div class=\"form-group\">\n        <label>Step Size</label>\n        <div class=\"form-fields\">\n          <input type=\"number\" name=\"step\" min=\"0\" step=\"1\" value=\"${Reticle.increment}\">\n        </div>\n      </div>\n      <p class=\"notes\"><b>Left-Click</b> to move the overlay</p>\n      <p class=\"notes\"><b>Middle-Click</b> or <b>Close Dialog</b> to exit overlay positioning</p>\n     `,\n    buttons: {},\n    render: (html) => {\n      // Mode Images\n      const images = html.querySelector(\".images a\");\n      html.querySelector(\".images a\").on(\"click\", (event) => {\n        images.removeClass(\"active\");\n        const target = event.target.closest(\"a\");\n        target.addClass(\"active\");\n        Reticle.mode = target.data(\"id\");\n      });\n      html.querySelector(`[data-id=\"${Reticle.mode}\"]`).addClass(\"active\");\n\n      // Anchor\n      let anchorX = Reticle.config?.anchor?.x || 0;\n      let anchorY = Reticle.config?.anchor?.y || 0;\n\n      let classes = \"\";\n      if (anchorX < 0.5) classes += \".left\";\n      else if (anchorX > 0.5) classes += \".right\";\n      else classes += \".center\";\n\n      if (anchorY < 0.5) classes += \".top\";\n      else if (anchorY > 0.5) classes += \".bot\";\n      else classes += \".mid\";\n\n      html.querySelector(\".tva-anchor\").find(classes).prop(\"checked\", true);\n      // end -  Pre-select anchor\n\n      html.querySelector('input[name=\"anchor\"]').on(\"change\", (event) => {\n        const anchor = event.target;\n        let x;\n        let y;\n        if (anchor.hasClass(\"left\")) x = 0;\n        else if (anchor.hasClass(\"center\")) x = 0.5;\n        else x = 1;\n\n        if (anchor.hasClass(\"top\")) y = 0;\n        else if (anchor.hasClass(\"mid\")) y = 0.5;\n        else y = 1;\n\n        Reticle.config.anchor.x = x;\n        Reticle.config.anchor.y = y;\n      });\n\n      html.querySelector('[name=\"step\"]').on(\"input\", (event) => {\n        Reticle.increment = event.target.val() || 1;\n      });\n    },\n    close: () => Reticle.deactivate(),\n  });\n  d.render(true);\n  setTimeout(\n    () =>\n      d.setPosition({ left: 200, top: window.innerHeight / 2, height: \"auto\" }),\n    100,\n  );\n  return d;\n}\n\nfunction round(number, increment, offset = 0) {\n  return Math.ceil((number - offset) / increment) * increment + offset;\n}\n\nfunction rotate(cx, cy, x, y, angle) {\n  var radians = (Math.PI / 180) * angle,\n    cos = Math.cos(radians),\n    sin = Math.sin(radians),\n    nx = cos * (x - cx) + sin * (y - cy) + cx,\n    ny = cos * (y - cy) - sin * (x - cx) + cy;\n  return [nx, ny];\n}\n","export class HTMLOverlay {\n  static container = null;\n  static renderQueue = [];\n  static hudReady = false;\n\n  static hudRendered() {\n    HTMLOverlay.hudReady = true;\n    HTMLOverlay.renderQueue.forEach((ov) => ov.render());\n    HTMLOverlay.renderQueue = [];\n  }\n\n  constructor(overlayConfig, token) {\n    this.overlayConfig = overlayConfig;\n    this.token = token;\n    this.render();\n  }\n\n  render(overlayConfig = null, force = false) {\n    if (!HTMLOverlay.hudReady) {\n      HTMLOverlay.renderQueue.push(this);\n      return;\n    }\n\n    if (!HTMLOverlay.container) {\n      HTMLOverlay.container = '<div id=\"tva-html-overlays\"></div>';\n      \"#hud\".append(HTMLOverlay.container);\n    }\n\n    if (this.element) this.remove();\n    if (overlayConfig) this.overlayConfig = overlayConfig;\n\n    this.element = renderTemplate(this.overlayConfig, this.getData(), force);\n    HTMLOverlay.container.append(this.element);\n    this.activateListeners(this.element);\n    this.setPosition();\n  }\n\n  remove() {\n    if (this.element) this.element.remove();\n    this.element = null;\n  }\n\n  getData(options = {}) {\n    const data = this.token.document.toObject();\n    return foundry.utils.mergeObject(data, {\n      isGM: game.user.isGM,\n    });\n  }\n\n  setPosition({ left, top, width, height, scale, angle, origin } = {}) {\n    if (!HTMLOverlay.hudReady) return;\n    const ratio = canvas.dimensions.size / 100;\n    const position = {\n      width: width || this.token.document.width * 100,\n      height: height || this.token.document.height * 100,\n      left: left ?? this.token.document.x,\n      top: top ?? this.token.document.y,\n    };\n    if (ratio !== 1) position.transform = `scale(${ratio})`;\n    this.element.css(position);\n    if (angle != null) {\n      this.element.css({ transform: \"rotate(\" + angle + \"deg)\" });\n    }\n    if (origin != null) {\n      this.element.css({\n        \"transform-origin\": origin.x + \"px \" + origin.y + \"px\",\n      });\n    }\n  }\n\n  /** @override */\n  activateListeners(html) {\n    try {\n      eval(this.overlayConfig.html.listeners);\n    } catch (e) {}\n  }\n}\n\nconst _templateCache = {};\n\nfunction _compile(html, id) {\n  //      <style scoped>${html.style}</style>\n  return Handlebars.compile(\n    `<div class=\"tva-html-overlay overlay-${id}\">\n      <section class=\"window-content\">\n        <form>${html.template}</form>\n      </section>\n    </div>`,\n  );\n}\n\nfunction constructTemplate(ovConfig, force = false) {\n  if (!_templateCache.hasOwnProperty(ovConfig.id)) {\n    const compiled = _compile(ovConfig.html, ovConfig.id);\n    Handlebars.registerPartial(ovConfig.id, compiled);\n    _templateCache[ovConfig.id] = compiled;\n  } else if (force) {\n    return _compile(ovConfig.html, ovConfig.id);\n  }\n  return _templateCache[ovConfig.id];\n}\n\nfunction renderTemplate(ovConfig, data, force = false) {\n  const template = constructTemplate(ovConfig, force);\n  return template(data || {}, {\n    allowProtoMethodsByDefault: true,\n    allowProtoPropertiesByDefault: true,\n  });\n}\n","import TokenCustomConfig from \"./tokenCustomConfig.js\";\nimport {\n  isVideo,\n  isImage,\n  keyPressed,\n  SEARCH_TYPE,\n  BASE_IMAGE_CATEGORIES,\n  getFileName,\n  waitForTokenTexture,\n} from \"../scripts/utils.js\";\nimport { showArtSelect } from \"../token-variants.mjs\";\nimport { TVA_CONFIG, getSearchOptions } from \"../scripts/settings.js\";\nimport { cacheImages } from \"../scripts/search.js\";\n\nfunction showButtonWithText(id, text) {\n  const btn = document.getElementById(id);\n  if (btn) {\n    btn.innerHTML = text;\n    btn.style.display = \"\";\n  }\n}\n\nexport function addToArtSelectQueue(search, options) {\n  ArtSelect.queue.push({\n    search: search,\n    options: options,\n  });\n  showButtonWithText(\n    \"button#token-variant-art-clear-queue\",\n    `Clear Queue (${ArtSelect.queue.length})`,\n  );\n}\n\nexport function addToQueue(search, options) {\n  ArtSelect.queue.push({\n    search: search,\n    options: options,\n  });\n}\n\nexport function renderFromQueue(force = false) {\n  if (!force) {\n    const artSelects = Object.values(ui.windows).filter(\n      (app) => app instanceof ArtSelect,\n    );\n    if (artSelects.length !== 0) {\n      if (ArtSelect.queue.length !== 0)\n        showButtonWithText(\n          \"button#token-variant-art-clear-queue\",\n          `Clear Queue (${ArtSelect.queue.length})`,\n        );\n      return;\n    }\n  }\n\n  let callData = ArtSelect.queue.shift();\n  if (callData?.options.execute) {\n    callData.options.execute();\n    callData = ArtSelect.queue.shift();\n  }\n  if (callData) {\n    showArtSelect(callData.search, callData.options);\n  }\n}\n\nfunction delay(fn, ms) {\n  let timer = 0;\n  return function (...args) {\n    clearTimeout(timer);\n    timer = setTimeout(fn.bind(this, ...args), ms || 0);\n  };\n}\n\nexport class ArtSelect extends FormApplication {\n  static queue = [];\n\n  static instance = null;\n\n  // showArtSelect(...) can take a while to fully execute and it is possible for it to be called\n  // multiple times in very quick succession especially if copy pasting tokens or importing actors.\n  // This variable set early in the function execution is used to queue additional requests rather\n  // than continue execution\n  static executing = false;\n\n  static IMAGE_DISPLAY = {\n    NONE: 0,\n    PORTRAIT: 1,\n    TOKEN: 2,\n    PORTRAIT_TOKEN: 3,\n    IMAGE: 4,\n  };\n\n  constructor(\n    search,\n    {\n      preventClose = false,\n      object = null,\n      callback = null,\n      searchType = null,\n      allImages = null,\n      image1 = \"\",\n      image2 = \"\",\n      displayMode = ArtSelect.IMAGE_DISPLAY.NONE,\n      multipleSelection = false,\n      searchOptions = {},\n    } = {},\n  ) {\n    let title = game.i18n.localize(\n      \"token-variants.windows.art-select.select-variant\",\n    );\n    if (searchType === SEARCH_TYPE.TOKEN)\n      title = game.i18n.localize(\n        \"token-variants.windows.art-select.select-token-art\",\n      );\n    else if (searchType === SEARCH_TYPE.PORTRAIT)\n      title = game.i18n.localize(\n        \"token-variants.windows.art-select.select-portrait-art\",\n      );\n\n    super(\n      {},\n      {\n        closeOnSubmit: false,\n        width: ArtSelect.WIDTH || 500,\n        height: ArtSelect.HEIGHT || 500,\n        left: ArtSelect.LEFT,\n        top: ArtSelect.TOP,\n        title: title,\n      },\n    );\n    this.search = search;\n    this.allImages = allImages;\n    this.callback = callback;\n    this.doc = object;\n    this.preventClose = preventClose;\n    this.image1 = image1;\n    this.image2 = image2;\n    this.displayMode = displayMode;\n    this.multipleSelection = multipleSelection;\n    this.searchType = searchType;\n    this.searchOptions = foundry.utils.mergeObject(\n      searchOptions,\n      getSearchOptions(),\n      {\n        overwrite: false,\n      },\n    );\n    ArtSelect.instance = this;\n\n    const constructorName = `ArtSelect`;\n    Object.defineProperty(ArtSelect.prototype.constructor, \"name\", {\n      value: constructorName,\n    });\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: \"token-variants-art-select\",\n      classes: [\"sheet\"],\n      template:\n        \"modules/token-variants/token-variants/templates/artSelect.html\",\n      resizable: true,\n      minimizable: false,\n    });\n  }\n\n  _getHeaderButtons() {\n    const buttons = super._getHeaderButtons();\n\n    buttons.unshift({\n      label: \"Rebuild Cache\",\n      class: \"cache-rebuild\",\n      icon: \"fas fa-sync-alt\",\n      onclick: async () => {\n        await cacheImages();\n        this._performSearch(this.search, true);\n      },\n    });\n\n    buttons.unshift({\n      label: \"FilePicker\",\n      class: \"file-picker\",\n      icon: \"fas fa-file-import fa-fw\",\n      onclick: () => {\n        new FilePicker({\n          type: \"imagevideo\",\n          callback: (path) => {\n            if (!this.preventClose) {\n              this.close();\n            }\n            if (this.callback) {\n              this.callback(path, getFileName(path));\n            }\n          },\n        }).render();\n      },\n    });\n    buttons.unshift({\n      label: \"Image Category\",\n      class: \"type\",\n      icon: \"fas fa-swatchbook\",\n      onclick: () => {\n        if (ArtSelect.instance) ArtSelect.instance._typeSelect();\n      },\n    });\n\n    return buttons;\n  }\n\n  _typeSelect() {\n    const categories = BASE_IMAGE_CATEGORIES.concat(\n      TVA_CONFIG.customImageCategories,\n    );\n\n    const buttons = {};\n    for (const c of categories) {\n      let label = c;\n      if (c === this.searchType) {\n        label = \"<b>>>> \" + label + \" <<<</b>\";\n      }\n      buttons[c] = {\n        label: label,\n        callback: () => {\n          if (this.searchType !== c) {\n            this.searchType = c;\n            this._performSearch(this.search, true);\n          }\n        },\n      };\n    }\n\n    new Dialog({\n      title: `Select Image Category and Filter`,\n      content: `<style>.dialog .dialog-button {flex: 0 0 auto;}</style>`,\n      buttons: buttons,\n    }).render(true);\n  }\n\n  async getData(options) {\n    const data = super.getData(options);\n    if (this.doc instanceof Item) {\n      data.item = true;\n      data.description = this.doc.system?.description?.value ?? \"\";\n    }\n    const searchOptions = this.searchOptions;\n    const algorithm = searchOptions.algorithm;\n\n    //\n    // Create buttons\n    //\n    const tokenConfigs = (TVA_CONFIG.tokenConfigs || []).flat();\n    const fuzzySearch = algorithm.fuzzy;\n\n    let allButtons = new Map();\n    let artFound = false;\n\n    const genLabel = function (\n      str,\n      indices,\n      start = \"<mark>\",\n      end = \"</mark>\",\n      fillChar = null,\n    ) {\n      if (!indices) return str;\n      let fillStr = fillChar ? fillChar.repeat(str.length) : str;\n      let label = \"\";\n      let lastIndex = 0;\n      for (const index of indices) {\n        label += fillStr.slice(lastIndex, index[0]);\n        label += start + str.slice(index[0], index[1] + 1) + end;\n        lastIndex = index[1] + 1;\n      }\n      label += fillStr.slice(lastIndex, fillStr.length);\n\n      return label;\n    };\n\n    const genTitle = function (obj) {\n      if (!fuzzySearch) return obj.path;\n\n      let percent = Math.ceil((1 - obj.score) * 100) + \"%\";\n      if (searchOptions.runSearchOnPath) {\n        return (\n          percent +\n          \"\\n\" +\n          genLabel(obj.path, obj.indices, \"\", \"\", \"-\") +\n          \"\\n\" +\n          obj.path\n        );\n      }\n      return percent;\n    };\n\n    this.allImages.forEach((images, search) => {\n      const buttons = [];\n      images.forEach((imageObj) => {\n        artFound = true;\n        const vid = isVideo(imageObj.path);\n        const img = isImage(imageObj.path);\n        buttons.push({\n          path: imageObj.path,\n          img: img,\n          vid: vid,\n          type: vid || img,\n          name: imageObj.name,\n          label:\n            fuzzySearch && !searchOptions.runSearchOnPath\n              ? genLabel(imageObj.name, imageObj.indices)\n              : imageObj.name,\n          title: genTitle(imageObj),\n          hasConfig:\n            this.searchType === SEARCH_TYPE.TOKEN ||\n            this.searchType === SEARCH_TYPE.PORTRAIT_AND_TOKEN\n              ? Boolean(\n                  tokenConfigs.find(\n                    (config) =>\n                      config.tvImgSrc == imageObj.path &&\n                      config.tvImgName == imageObj.name,\n                  ),\n                )\n              : false,\n        });\n      });\n      allButtons.set(search, buttons);\n    });\n\n    if (artFound) data.allImages = allButtons;\n\n    data.search = this.search;\n    data.queue = ArtSelect.queue.length;\n    data.image1 = this.image1;\n    data.image2 = this.image2;\n    data.displayMode = this.displayMode;\n    data.multipleSelection = this.multipleSelection;\n    data.displaySlider =\n      algorithm.fuzzy && algorithm.fuzzyArtSelectPercentSlider;\n    data.fuzzyThreshold = algorithm.fuzzyThreshold;\n    if (data.displaySlider) {\n      data.fuzzyThreshold = 100 - data.fuzzyThreshold * 100;\n      data.fuzzyThreshold = data.fuzzyThreshold.toFixed(0);\n    }\n    data.autoplay = !TVA_CONFIG.playVideoOnHover;\n    return data;\n  }\n\n  /**\n   * @param {DOM} html\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n    const callback = this.callback;\n    const close = () => this.close();\n    const object = this.doc;\n    const preventClose = this.preventClose;\n    const multipleSelection = this.multipleSelection;\n\n    const boxes = html.querySelector(`.token-variants-grid-box`);\n    boxes.hover(\n      function () {\n        if (TVA_CONFIG.playVideoOnHover) {\n          const vid = this.siblings(\"video\");\n          if (vid.length) {\n            vid[0].play();\n            this.siblings(\".fa-play\").hide();\n          }\n        }\n      },\n      function () {\n        if (TVA_CONFIG.pauseVideoOnHoverOut) {\n          const vid = this.siblings(\"video\");\n          if (vid.length) {\n            vid[0].pause();\n            vid[0].currentTime = 0;\n            this.siblings(\".fa-play\").show();\n          }\n        }\n      },\n    );\n    boxes.map((box) => {\n      boxes[box].addEventListener(\"click\", async function (event) {\n        if (keyPressed(\"config\")) {\n          if (object)\n            new TokenCustomConfig(\n              object,\n              {},\n              event.target.dataset.name,\n              event.target.dataset.filename,\n            ).render(true);\n        } else {\n          if (!preventClose) {\n            close();\n          }\n          if (callback) {\n            callback(event.target.dataset.name, event.target.dataset.filename);\n          }\n        }\n      });\n      if (multipleSelection) {\n        boxes[box].addEventListener(\"contextmenu\", async function (event) {\n          event.target.classList.classList.toggle(\"selected\");\n        });\n      }\n    });\n\n    let searchInput = html.querySelector(\"#custom-art-search\");\n    searchInput.focus();\n    searchInput[0].selectionStart = searchInput[0].selectionEnd = 10000;\n\n    searchInput.on(\n      \"input\",\n      delay((event) => {\n        this._performSearch(event.target.value);\n      }, 350),\n    );\n\n    html\n      .querySelector(`button#token-variant-art-clear-queue`)\n      .on(\"click\", (event) => {\n        ArtSelect.queue = ArtSelect.queue.filter(\n          (callData) => callData.options.execute,\n        );\n        event.target.hide();\n      });\n\n    html\n      .find('[name=\"fuzzyThreshold\"]')\n      .change((e) => {\n        e.target\n          .siblings(\".token-variants-range-value\")\n          .html(`${parseFloat(e.target.value).toFixed(0)}%`);\n        this.searchOptions.algorithm.fuzzyThreshold =\n          (100 - e.target.value) / 100;\n      })\n      .change(\n        delay((event) => {\n          this._performSearch(this.search, true);\n        }, 350),\n      );\n\n    if (multipleSelection) {\n      html\n        .querySelector(`button#token-variant-art-return-selected`)\n        .on(\"click\", () => {\n          if (callback) {\n            const images = [];\n            html\n              .find(`.token-variants-grid-box.selected`)\n              .siblings(\".token-variants-grid-image\")\n              .each(function () {\n                images.push(this.getAttribute(\"src\"));\n              });\n            callback(images);\n          }\n          close();\n        });\n      html\n        .querySelector(`button#token-variant-art-return-all`)\n        .on(\"click\", () => {\n          if (callback) {\n            const images = [];\n            html.querySelector(`.token-variants-grid-image`).each(function () {\n              images.push(this.getAttribute(\"src\"));\n            });\n            callback(images);\n          }\n          close();\n        });\n    }\n  }\n\n  _performSearch(search, force = false) {\n    if (!force && this.search.trim() === search.trim()) return;\n    showArtSelect(search, {\n      callback: this.callback,\n      searchType: this.searchType,\n      object: this.doc,\n      force: true,\n      image1: this.image1,\n      image2: this.image2,\n      displayMode: this.displayMode,\n      multipleSelection: this.multipleSelection,\n      searchOptions: this.searchOptions,\n      preventClose: this.preventClose,\n    });\n  }\n\n  /**\n   * @param {Event} event\n   * @param {Object} formData\n   */\n  async _updateObject(event, formData) {\n    if (formData && formData.search != this.search) {\n      this._performSearch(formData.search);\n    } else {\n      this.close();\n    }\n  }\n\n  setPosition(options = {}) {\n    if (options.width) ArtSelect.WIDTH = options.width;\n    if (options.height) ArtSelect.HEIGHT = options.height;\n    if (options.top) ArtSelect.TOP = options.top;\n    if (options.left) ArtSelect.LEFT = options.left;\n    super.setPosition(options);\n  }\n\n  async close(options = {}) {\n    let callData = ArtSelect.queue.shift();\n    if (callData?.options.execute) {\n      callData.options.execute();\n      callData = ArtSelect.queue.shift();\n    }\n    if (callData) {\n      callData.options.force = true;\n      showArtSelect(callData.search, callData.options);\n    } else {\n      // For some reason there might be app instances that have not closed themselves by this point\n      // If there are, close them now\n      const artSelects = Object.values(ui.windows)\n        .filter((app) => app instanceof ArtSelect)\n        .filter((app) => app.appId !== this.appId);\n      for (const app of artSelects) {\n        app.close();\n      }\n\n      return super.close(options);\n    }\n  }\n}\n\nexport function insertArtSelectButton(\n  html,\n  target,\n  { search = \"\", searchType = SEARCH_TYPE.TOKEN } = {},\n) {\n  const icon = new ElementBuilder(\"i\").className(\"fas fa-images\").build();\n\n  const button = new ElementBuilder(\"button\")\n    .className(\"token-variants-image-select-button\")\n    .type(\"button\")\n    .dataset(\"type\", \"imagevideo\")\n    .dataset(\"target\", target)\n    .title(\"token-variants.windows.art-select.select-variant\")\n    .on(\"click\", () => {\n      showArtSelect(search, {\n        callback: (imgSrc, name) => {\n          button.siblings(`[name=\"${target}\"]`).val(imgSrc);\n        },\n        searchType,\n      });\n    })\n    .child(icon)\n    .build();\n\n  const input = html.querySelector(`[name=\"${target}\"]`);\n  input.after(button);\n  return Boolean(input.length);\n}\n","/**\n * Fuse.js v6.5.3 - Lightweight fuzzy-search (http://fusejs.io)\n *\n * Copyright (c) 2021 Kiro Risk (http://kiro.me)\n * All Rights Reserved. Apache Software License 2.0\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly &&\n      (symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      })),\n      keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2\n      ? ownKeys(Object(source), !0).forEach(function (key) {\n          _defineProperty(target, key, source[key]);\n        })\n      : Object.getOwnPropertyDescriptors\n      ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source))\n      : ownKeys(Object(source)).forEach(function (key) {\n          Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n        });\n  }\n\n  return target;\n}\n\nfunction _typeof(obj) {\n  '@babel/helpers - typeof';\n\n  return (\n    (_typeof =\n      'function' == typeof Symbol && 'symbol' == typeof Symbol.iterator\n        ? function (obj) {\n            return typeof obj;\n          }\n        : function (obj) {\n            return obj &&\n              'function' == typeof Symbol &&\n              obj.constructor === Symbol &&\n              obj !== Symbol.prototype\n              ? 'symbol'\n              : typeof obj;\n          }),\n    _typeof(obj)\n  );\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError('Cannot call a class as a function');\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if ('value' in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, 'prototype', {\n    writable: false,\n  });\n  return Constructor;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true,\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== 'function' && superClass !== null) {\n    throw new TypeError('Super expression must either be null or a function');\n  }\n\n  Object.defineProperty(subClass, 'prototype', {\n    value: Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        writable: true,\n        configurable: true,\n      },\n    }),\n    writable: false,\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf\n    ? Object.getPrototypeOf\n    : function _getPrototypeOf(o) {\n        return o.__proto__ || Object.getPrototypeOf(o);\n      };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf =\n    Object.setPrototypeOf ||\n    function _setPrototypeOf(o, p) {\n      o.__proto__ = p;\n      return o;\n    };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === 'undefined' || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === 'function') return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === 'object' || typeof call === 'function')) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError('Derived constructors may only return object or undefined');\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return (\n    _arrayWithoutHoles(arr) ||\n    _iterableToArray(arr) ||\n    _unsupportedIterableToArray(arr) ||\n    _nonIterableSpread()\n  );\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _iterableToArray(iter) {\n  if (\n    (typeof Symbol !== 'undefined' && iter[Symbol.iterator] != null) ||\n    iter['@@iterator'] != null\n  )\n    return Array.from(iter);\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === 'string') return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === 'Object' && o.constructor) n = o.constructor.name;\n  if (n === 'Map' || n === 'Set') return Array.from(o);\n  if (n === 'Arguments' || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))\n    return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\n    'Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.'\n  );\n}\n\nfunction isArray(value) {\n  return !Array.isArray ? getTag(value) === '[object Array]' : Array.isArray(value);\n} // Adapted from: https://github.com/lodash/lodash/blob/master/.internal/baseToString.js\n\nvar INFINITY = 1 / 0;\nfunction baseToString(value) {\n  // Exit early for strings to avoid a performance hit in some environments.\n  if (typeof value == 'string') {\n    return value;\n  }\n\n  var result = value + '';\n  return result == '0' && 1 / value == -INFINITY ? '-0' : result;\n}\nfunction toString(value) {\n  return value == null ? '' : baseToString(value);\n}\nfunction isString(value) {\n  return typeof value === 'string';\n}\nfunction isNumber(value) {\n  return typeof value === 'number';\n} // Adapted from: https://github.com/lodash/lodash/blob/master/isBoolean.js\n\nfunction isBoolean(value) {\n  return (\n    value === true ||\n    value === false ||\n    (isObjectLike(value) && getTag(value) == '[object Boolean]')\n  );\n}\nfunction isObject(value) {\n  return _typeof(value) === 'object';\n} // Checks if `value` is object-like.\n\nfunction isObjectLike(value) {\n  return isObject(value) && value !== null;\n}\nfunction isDefined(value) {\n  return value !== undefined && value !== null;\n}\nfunction isBlank(value) {\n  return !value.trim().length;\n} // Gets the `toStringTag` of `value`.\n// Adapted from: https://github.com/lodash/lodash/blob/master/.internal/getTag.js\n\nfunction getTag(value) {\n  return value == null\n    ? value === undefined\n      ? '[object Undefined]'\n      : '[object Null]'\n    : Object.prototype.toString.call(value);\n}\n\nvar EXTENDED_SEARCH_UNAVAILABLE = 'Extended search is not available';\nvar INCORRECT_INDEX_TYPE = \"Incorrect 'index' type\";\nvar LOGICAL_SEARCH_INVALID_QUERY_FOR_KEY = function LOGICAL_SEARCH_INVALID_QUERY_FOR_KEY(key) {\n  return 'Invalid value for key '.concat(key);\n};\nvar PATTERN_LENGTH_TOO_LARGE = function PATTERN_LENGTH_TOO_LARGE(max) {\n  return 'Pattern length exceeds max of '.concat(max, '.');\n};\nvar MISSING_KEY_PROPERTY = function MISSING_KEY_PROPERTY(name) {\n  return 'Missing '.concat(name, ' property in key');\n};\nvar INVALID_KEY_WEIGHT_VALUE = function INVALID_KEY_WEIGHT_VALUE(key) {\n  return \"Property 'weight' in key '\".concat(key, \"' must be a positive integer\");\n};\n\nvar hasOwn = Object.prototype.hasOwnProperty;\n\nvar KeyStore = /*#__PURE__*/ (function () {\n  function KeyStore(keys) {\n    var _this = this;\n\n    _classCallCheck(this, KeyStore);\n\n    this._keys = [];\n    this._keyMap = {};\n    var totalWeight = 0;\n    keys.forEach(function (key) {\n      var obj = createKey(key);\n      totalWeight += obj.weight;\n\n      _this._keys.push(obj);\n\n      _this._keyMap[obj.id] = obj;\n      totalWeight += obj.weight;\n    }); // Normalize weights so that their sum is equal to 1\n\n    this._keys.forEach(function (key) {\n      key.weight /= totalWeight;\n    });\n  }\n\n  _createClass(KeyStore, [\n    {\n      key: 'get',\n      value: function get(keyId) {\n        return this._keyMap[keyId];\n      },\n    },\n    {\n      key: 'keys',\n      value: function keys() {\n        return this._keys;\n      },\n    },\n    {\n      key: 'toJSON',\n      value: function toJSON() {\n        return JSON.stringify(this._keys);\n      },\n    },\n  ]);\n\n  return KeyStore;\n})();\nfunction createKey(key) {\n  var path = null;\n  var id = null;\n  var src = null;\n  var weight = 1;\n\n  if (isString(key) || isArray(key)) {\n    src = key;\n    path = createKeyPath(key);\n    id = createKeyId(key);\n  } else {\n    if (!hasOwn.call(key, 'name')) {\n      throw new Error(MISSING_KEY_PROPERTY('name'));\n    }\n\n    var name = key.name;\n    src = name;\n\n    if (hasOwn.call(key, 'weight')) {\n      weight = key.weight;\n\n      if (weight <= 0) {\n        throw new Error(INVALID_KEY_WEIGHT_VALUE(name));\n      }\n    }\n\n    path = createKeyPath(name);\n    id = createKeyId(name);\n  }\n\n  return {\n    path: path,\n    id: id,\n    weight: weight,\n    src: src,\n  };\n}\nfunction createKeyPath(key) {\n  return isArray(key) ? key : key.split('.');\n}\nfunction createKeyId(key) {\n  return isArray(key) ? key.join('.') : key;\n}\n\nfunction get(obj, path) {\n  var list = [];\n  var arr = false;\n\n  var deepGet = function deepGet(obj, path, index) {\n    if (!isDefined(obj)) {\n      return;\n    }\n\n    if (!path[index]) {\n      // If there's no path left, we've arrived at the object we care about.\n      list.push(obj);\n    } else {\n      var key = path[index];\n      var value = obj[key];\n\n      if (!isDefined(value)) {\n        return;\n      } // If we're at the last value in the path, and if it's a string/number/bool,\n      // add it to the list\n\n      if (index === path.length - 1 && (isString(value) || isNumber(value) || isBoolean(value))) {\n        list.push(toString(value));\n      } else if (isArray(value)) {\n        arr = true; // Search each item in the array.\n\n        for (var i = 0, len = value.length; i < len; i += 1) {\n          deepGet(value[i], path, index + 1);\n        }\n      } else if (path.length) {\n        // An object. Recurse further.\n        deepGet(value, path, index + 1);\n      }\n    }\n  }; // Backwards compatibility (since path used to be a string)\n\n  deepGet(obj, isString(path) ? path.split('.') : path, 0);\n  return arr ? list : list[0];\n}\n\nvar MatchOptions = {\n  // Whether the matches should be included in the result set. When `true`, each record in the result\n  // set will include the indices of the matched characters.\n  // These can consequently be used for highlighting purposes.\n  includeMatches: false,\n  // When `true`, the matching function will continue to the end of a search pattern even if\n  // a perfect match has already been located in the string.\n  findAllMatches: false,\n  // Minimum number of characters that must be matched before a result is considered a match\n  minMatchCharLength: 1,\n};\nvar BasicOptions = {\n  // When `true`, the algorithm continues searching to the end of the input even if a perfect\n  // match is found before the end of the same input.\n  isCaseSensitive: false,\n  // When true, the matching function will continue to the end of a search pattern even if\n  includeScore: false,\n  // List of properties that will be searched. This also supports nested properties.\n  keys: [],\n  // Whether to sort the result list, by score\n  shouldSort: true,\n  // Default sort function: sort by ascending score, ascending index\n  sortFn: function sortFn(a, b) {\n    return a.score === b.score ? (a.idx < b.idx ? -1 : 1) : a.score < b.score ? -1 : 1;\n  },\n};\nvar FuzzyOptions = {\n  // Approximately where in the text is the pattern expected to be found?\n  location: 0,\n  // At what point does the match algorithm give up. A threshold of '0.0' requires a perfect match\n  // (of both letters and location), a threshold of '1.0' would match anything.\n  threshold: 0.6,\n  // Determines how close the match must be to the fuzzy location (specified above).\n  // An exact letter match which is 'distance' characters away from the fuzzy location\n  // would score as a complete mismatch. A distance of '0' requires the match be at\n  // the exact location specified, a threshold of '1000' would require a perfect match\n  // to be within 800 characters of the fuzzy location to be found using a 0.8 threshold.\n  distance: 100,\n};\nvar AdvancedOptions = {\n  // When `true`, it enables the use of unix-like search commands\n  useExtendedSearch: false,\n  // The get function to use when fetching an object's properties.\n  // The default will search nested paths *ie foo.bar.baz*\n  getFn: get,\n  // When `true`, search will ignore `location` and `distance`, so it won't matter\n  // where in the string the pattern appears.\n  // More info: https://fusejs.io/concepts/scoring-theory.html#fuzziness-score\n  ignoreLocation: false,\n  // When `true`, the calculation for the relevance score (used for sorting) will\n  // ignore the field-length norm.\n  // More info: https://fusejs.io/concepts/scoring-theory.html#field-length-norm\n  ignoreFieldNorm: false,\n  // The weight to determine how much field length norm effects scoring.\n  fieldNormWeight: 1,\n};\nvar Config = _objectSpread2(\n  _objectSpread2(_objectSpread2(_objectSpread2({}, BasicOptions), MatchOptions), FuzzyOptions),\n  AdvancedOptions\n);\n\nvar SPACE = /[^ ]+/g; // Field-length norm: the shorter the field, the higher the weight.\n// Set to 3 decimals to reduce index size.\n\nfunction norm() {\n  var weight = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n  var mantissa = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 3;\n  var cache = new Map();\n  var m = Math.pow(10, mantissa);\n  return {\n    get: function get(value) {\n      var numTokens = value.match(SPACE).length;\n\n      if (cache.has(numTokens)) {\n        return cache.get(numTokens);\n      } // Default function is 1/sqrt(x), weight makes that variable\n\n      var norm = 1 / Math.pow(numTokens, 0.5 * weight); // In place of `toFixed(mantissa)`, for faster computation\n\n      var n = parseFloat(Math.round(norm * m) / m);\n      cache.set(numTokens, n);\n      return n;\n    },\n    clear: function clear() {\n      cache.clear();\n    },\n  };\n}\n\nvar FuseIndex = /*#__PURE__*/ (function () {\n  function FuseIndex() {\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      _ref$getFn = _ref.getFn,\n      getFn = _ref$getFn === void 0 ? Config.getFn : _ref$getFn,\n      _ref$fieldNormWeight = _ref.fieldNormWeight,\n      fieldNormWeight =\n        _ref$fieldNormWeight === void 0 ? Config.fieldNormWeight : _ref$fieldNormWeight;\n\n    _classCallCheck(this, FuseIndex);\n\n    this.norm = norm(fieldNormWeight, 3);\n    this.getFn = getFn;\n    this.isCreated = false;\n    this.setIndexRecords();\n  }\n\n  _createClass(FuseIndex, [\n    {\n      key: 'setSources',\n      value: function setSources() {\n        var docs = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n        this.docs = docs;\n      },\n    },\n    {\n      key: 'setIndexRecords',\n      value: function setIndexRecords() {\n        var records = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n        this.records = records;\n      },\n    },\n    {\n      key: 'setKeys',\n      value: function setKeys() {\n        var _this = this;\n\n        var keys = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n        this.keys = keys;\n        this._keysMap = {};\n        keys.forEach(function (key, idx) {\n          _this._keysMap[key.id] = idx;\n        });\n      },\n    },\n    {\n      key: 'create',\n      value: function create() {\n        var _this2 = this;\n\n        if (this.isCreated || !this.docs.length) {\n          return;\n        }\n\n        this.isCreated = true; // List is Array<String>\n\n        if (isString(this.docs[0])) {\n          this.docs.forEach(function (doc, docIndex) {\n            _this2._addString(doc, docIndex);\n          });\n        } else {\n          // List is Array<Object>\n          this.docs.forEach(function (doc, docIndex) {\n            _this2._addObject(doc, docIndex);\n          });\n        }\n\n        this.norm.clear();\n      }, // Adds a doc to the end of the index\n    },\n    {\n      key: 'add',\n      value: function add(doc) {\n        var idx = this.size();\n\n        if (isString(doc)) {\n          this._addString(doc, idx);\n        } else {\n          this._addObject(doc, idx);\n        }\n      }, // Removes the doc at the specified index of the index\n    },\n    {\n      key: 'removeAt',\n      value: function removeAt(idx) {\n        this.records.splice(idx, 1); // Change ref index of every subsquent doc\n\n        for (var i = idx, len = this.size(); i < len; i += 1) {\n          this.records[i].i -= 1;\n        }\n      },\n    },\n    {\n      key: 'getValueForItemAtKeyId',\n      value: function getValueForItemAtKeyId(item, keyId) {\n        return item[this._keysMap[keyId]];\n      },\n    },\n    {\n      key: 'size',\n      value: function size() {\n        return this.records.length;\n      },\n    },\n    {\n      key: '_addString',\n      value: function _addString(doc, docIndex) {\n        if (!isDefined(doc) || isBlank(doc)) {\n          return;\n        }\n\n        var record = {\n          v: doc,\n          i: docIndex,\n          n: this.norm.get(doc),\n        };\n        this.records.push(record);\n      },\n    },\n    {\n      key: '_addObject',\n      value: function _addObject(doc, docIndex) {\n        var _this3 = this;\n\n        var record = {\n          i: docIndex,\n          $: {},\n        }; // Iterate over every key (i.e, path), and fetch the value at that key\n\n        this.keys.forEach(function (key, keyIndex) {\n          var value = _this3.getFn(doc, key.path);\n\n          if (!isDefined(value)) {\n            return;\n          }\n\n          if (isArray(value)) {\n            (function () {\n              var subRecords = [];\n              var stack = [\n                {\n                  nestedArrIndex: -1,\n                  value: value,\n                },\n              ];\n\n              while (stack.length) {\n                var _stack$pop = stack.pop(),\n                  nestedArrIndex = _stack$pop.nestedArrIndex,\n                  _value = _stack$pop.value;\n\n                if (!isDefined(_value)) {\n                  continue;\n                }\n\n                if (isString(_value) && !isBlank(_value)) {\n                  var subRecord = {\n                    v: _value,\n                    i: nestedArrIndex,\n                    n: _this3.norm.get(_value),\n                  };\n                  subRecords.push(subRecord);\n                } else if (isArray(_value)) {\n                  _value.forEach(function (item, k) {\n                    stack.push({\n                      nestedArrIndex: k,\n                      value: item,\n                    });\n                  });\n                } else;\n              }\n\n              record.$[keyIndex] = subRecords;\n            })();\n          } else if (!isBlank(value)) {\n            var subRecord = {\n              v: value,\n              n: _this3.norm.get(value),\n            };\n            record.$[keyIndex] = subRecord;\n          }\n        });\n        this.records.push(record);\n      },\n    },\n    {\n      key: 'toJSON',\n      value: function toJSON() {\n        return {\n          keys: this.keys,\n          records: this.records,\n        };\n      },\n    },\n  ]);\n\n  return FuseIndex;\n})();\nfunction createIndex(keys, docs) {\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n    _ref2$getFn = _ref2.getFn,\n    getFn = _ref2$getFn === void 0 ? Config.getFn : _ref2$getFn,\n    _ref2$fieldNormWeight = _ref2.fieldNormWeight,\n    fieldNormWeight =\n      _ref2$fieldNormWeight === void 0 ? Config.fieldNormWeight : _ref2$fieldNormWeight;\n\n  var myIndex = new FuseIndex({\n    getFn: getFn,\n    fieldNormWeight: fieldNormWeight,\n  });\n  myIndex.setKeys(keys.map(createKey));\n  myIndex.setSources(docs);\n  myIndex.create();\n  return myIndex;\n}\nfunction parseIndex(data) {\n  var _ref3 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n    _ref3$getFn = _ref3.getFn,\n    getFn = _ref3$getFn === void 0 ? Config.getFn : _ref3$getFn,\n    _ref3$fieldNormWeight = _ref3.fieldNormWeight,\n    fieldNormWeight =\n      _ref3$fieldNormWeight === void 0 ? Config.fieldNormWeight : _ref3$fieldNormWeight;\n\n  var keys = data.keys,\n    records = data.records;\n  var myIndex = new FuseIndex({\n    getFn: getFn,\n    fieldNormWeight: fieldNormWeight,\n  });\n  myIndex.setKeys(keys);\n  myIndex.setIndexRecords(records);\n  return myIndex;\n}\n\nfunction computeScore$1(pattern) {\n  var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n    _ref$errors = _ref.errors,\n    errors = _ref$errors === void 0 ? 0 : _ref$errors,\n    _ref$currentLocation = _ref.currentLocation,\n    currentLocation = _ref$currentLocation === void 0 ? 0 : _ref$currentLocation,\n    _ref$expectedLocation = _ref.expectedLocation,\n    expectedLocation = _ref$expectedLocation === void 0 ? 0 : _ref$expectedLocation,\n    _ref$distance = _ref.distance,\n    distance = _ref$distance === void 0 ? Config.distance : _ref$distance,\n    _ref$ignoreLocation = _ref.ignoreLocation,\n    ignoreLocation = _ref$ignoreLocation === void 0 ? Config.ignoreLocation : _ref$ignoreLocation;\n\n  var accuracy = errors / pattern.length;\n\n  if (ignoreLocation) {\n    return accuracy;\n  }\n\n  var proximity = Math.abs(expectedLocation - currentLocation);\n\n  if (!distance) {\n    // Dodge divide by zero error.\n    return proximity ? 1.0 : accuracy;\n  }\n\n  return accuracy + proximity / distance;\n}\n\nfunction convertMaskToIndices() {\n  var matchmask = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var minMatchCharLength =\n    arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Config.minMatchCharLength;\n  var indices = [];\n  var start = -1;\n  var end = -1;\n  var i = 0;\n\n  for (var len = matchmask.length; i < len; i += 1) {\n    var match = matchmask[i];\n\n    if (match && start === -1) {\n      start = i;\n    } else if (!match && start !== -1) {\n      end = i - 1;\n\n      if (end - start + 1 >= minMatchCharLength) {\n        indices.push([start, end]);\n      }\n\n      start = -1;\n    }\n  } // (i-1 - start) + 1 => i - start\n\n  if (matchmask[i - 1] && i - start >= minMatchCharLength) {\n    indices.push([start, i - 1]);\n  }\n\n  return indices;\n}\n\n// Machine word size\nvar MAX_BITS = 32;\n\nfunction search(text, pattern, patternAlphabet) {\n  var _ref = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {},\n    _ref$location = _ref.location,\n    location = _ref$location === void 0 ? Config.location : _ref$location,\n    _ref$distance = _ref.distance,\n    distance = _ref$distance === void 0 ? Config.distance : _ref$distance,\n    _ref$threshold = _ref.threshold,\n    threshold = _ref$threshold === void 0 ? Config.threshold : _ref$threshold,\n    _ref$findAllMatches = _ref.findAllMatches,\n    findAllMatches = _ref$findAllMatches === void 0 ? Config.findAllMatches : _ref$findAllMatches,\n    _ref$minMatchCharLeng = _ref.minMatchCharLength,\n    minMatchCharLength =\n      _ref$minMatchCharLeng === void 0 ? Config.minMatchCharLength : _ref$minMatchCharLeng,\n    _ref$includeMatches = _ref.includeMatches,\n    includeMatches = _ref$includeMatches === void 0 ? Config.includeMatches : _ref$includeMatches,\n    _ref$ignoreLocation = _ref.ignoreLocation,\n    ignoreLocation = _ref$ignoreLocation === void 0 ? Config.ignoreLocation : _ref$ignoreLocation;\n\n  if (pattern.length > MAX_BITS) {\n    throw new Error(PATTERN_LENGTH_TOO_LARGE(MAX_BITS));\n  }\n\n  var patternLen = pattern.length; // Set starting location at beginning text and initialize the alphabet.\n\n  var textLen = text.length; // Handle the case when location > text.length\n\n  var expectedLocation = Math.max(0, Math.min(location, textLen)); // Highest score beyond which we give up.\n\n  var currentThreshold = threshold; // Is there a nearby exact match? (speedup)\n\n  var bestLocation = expectedLocation; // Performance: only computer matches when the minMatchCharLength > 1\n  // OR if `includeMatches` is true.\n\n  var computeMatches = minMatchCharLength > 1 || includeMatches; // A mask of the matches, used for building the indices\n\n  var matchMask = computeMatches ? Array(textLen) : [];\n  var index; // Get all exact matches, here for speed up\n\n  while ((index = text.indexOf(pattern, bestLocation)) > -1) {\n    var score = computeScore$1(pattern, {\n      currentLocation: index,\n      expectedLocation: expectedLocation,\n      distance: distance,\n      ignoreLocation: ignoreLocation,\n    });\n    currentThreshold = Math.min(score, currentThreshold);\n    bestLocation = index + patternLen;\n\n    if (computeMatches) {\n      var i = 0;\n\n      while (i < patternLen) {\n        matchMask[index + i] = 1;\n        i += 1;\n      }\n    }\n  } // Reset the best location\n\n  bestLocation = -1;\n  var lastBitArr = [];\n  var finalScore = 1;\n  var binMax = patternLen + textLen;\n  var mask = 1 << (patternLen - 1);\n\n  for (var _i = 0; _i < patternLen; _i += 1) {\n    // Scan for the best match; each iteration allows for one more error.\n    // Run a binary search to determine how far from the match location we can stray\n    // at this error level.\n    var binMin = 0;\n    var binMid = binMax;\n\n    while (binMin < binMid) {\n      var _score2 = computeScore$1(pattern, {\n        errors: _i,\n        currentLocation: expectedLocation + binMid,\n        expectedLocation: expectedLocation,\n        distance: distance,\n        ignoreLocation: ignoreLocation,\n      });\n\n      if (_score2 <= currentThreshold) {\n        binMin = binMid;\n      } else {\n        binMax = binMid;\n      }\n\n      binMid = Math.floor((binMax - binMin) / 2 + binMin);\n    } // Use the result from this iteration as the maximum for the next.\n\n    binMax = binMid;\n    var start = Math.max(1, expectedLocation - binMid + 1);\n    var finish = findAllMatches\n      ? textLen\n      : Math.min(expectedLocation + binMid, textLen) + patternLen; // Initialize the bit array\n\n    var bitArr = Array(finish + 2);\n    bitArr[finish + 1] = (1 << _i) - 1;\n\n    for (var j = finish; j >= start; j -= 1) {\n      var currentLocation = j - 1;\n      var charMatch = patternAlphabet[text.charAt(currentLocation)];\n\n      if (computeMatches) {\n        // Speed up: quick bool to int conversion (i.e, `charMatch ? 1 : 0`)\n        matchMask[currentLocation] = +!!charMatch;\n      } // First pass: exact match\n\n      bitArr[j] = ((bitArr[j + 1] << 1) | 1) & charMatch; // Subsequent passes: fuzzy match\n\n      if (_i) {\n        bitArr[j] |= ((lastBitArr[j + 1] | lastBitArr[j]) << 1) | 1 | lastBitArr[j + 1];\n      }\n\n      if (bitArr[j] & mask) {\n        finalScore = computeScore$1(pattern, {\n          errors: _i,\n          currentLocation: currentLocation,\n          expectedLocation: expectedLocation,\n          distance: distance,\n          ignoreLocation: ignoreLocation,\n        }); // This match will almost certainly be better than any existing match.\n        // But check anyway.\n\n        if (finalScore <= currentThreshold) {\n          // Indeed it is\n          currentThreshold = finalScore;\n          bestLocation = currentLocation; // Already passed `loc`, downhill from here on in.\n\n          if (bestLocation <= expectedLocation) {\n            break;\n          } // When passing `bestLocation`, don't exceed our current distance from `expectedLocation`.\n\n          start = Math.max(1, 2 * expectedLocation - bestLocation);\n        }\n      }\n    } // No hope for a (better) match at greater error levels.\n\n    var _score = computeScore$1(pattern, {\n      errors: _i + 1,\n      currentLocation: expectedLocation,\n      expectedLocation: expectedLocation,\n      distance: distance,\n      ignoreLocation: ignoreLocation,\n    });\n\n    if (_score > currentThreshold) {\n      break;\n    }\n\n    lastBitArr = bitArr;\n  }\n\n  var result = {\n    isMatch: bestLocation >= 0,\n    // Count exact matches (those with a score of 0) to be \"almost\" exact\n    score: Math.max(0.001, finalScore),\n  };\n\n  if (computeMatches) {\n    var indices = convertMaskToIndices(matchMask, minMatchCharLength);\n\n    if (!indices.length) {\n      result.isMatch = false;\n    } else if (includeMatches) {\n      result.indices = indices;\n    }\n  }\n\n  return result;\n}\n\nfunction createPatternAlphabet(pattern) {\n  var mask = {};\n\n  for (var i = 0, len = pattern.length; i < len; i += 1) {\n    var _char = pattern.charAt(i);\n\n    mask[_char] = (mask[_char] || 0) | (1 << (len - i - 1));\n  }\n\n  return mask;\n}\n\nvar BitapSearch = /*#__PURE__*/ (function () {\n  function BitapSearch(pattern) {\n    var _this = this;\n\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$location = _ref.location,\n      location = _ref$location === void 0 ? Config.location : _ref$location,\n      _ref$threshold = _ref.threshold,\n      threshold = _ref$threshold === void 0 ? Config.threshold : _ref$threshold,\n      _ref$distance = _ref.distance,\n      distance = _ref$distance === void 0 ? Config.distance : _ref$distance,\n      _ref$includeMatches = _ref.includeMatches,\n      includeMatches = _ref$includeMatches === void 0 ? Config.includeMatches : _ref$includeMatches,\n      _ref$findAllMatches = _ref.findAllMatches,\n      findAllMatches = _ref$findAllMatches === void 0 ? Config.findAllMatches : _ref$findAllMatches,\n      _ref$minMatchCharLeng = _ref.minMatchCharLength,\n      minMatchCharLength =\n        _ref$minMatchCharLeng === void 0 ? Config.minMatchCharLength : _ref$minMatchCharLeng,\n      _ref$isCaseSensitive = _ref.isCaseSensitive,\n      isCaseSensitive =\n        _ref$isCaseSensitive === void 0 ? Config.isCaseSensitive : _ref$isCaseSensitive,\n      _ref$ignoreLocation = _ref.ignoreLocation,\n      ignoreLocation = _ref$ignoreLocation === void 0 ? Config.ignoreLocation : _ref$ignoreLocation;\n\n    _classCallCheck(this, BitapSearch);\n\n    this.options = {\n      location: location,\n      threshold: threshold,\n      distance: distance,\n      includeMatches: includeMatches,\n      findAllMatches: findAllMatches,\n      minMatchCharLength: minMatchCharLength,\n      isCaseSensitive: isCaseSensitive,\n      ignoreLocation: ignoreLocation,\n    };\n    this.pattern = isCaseSensitive ? pattern : pattern.toLowerCase();\n    this.chunks = [];\n\n    if (!this.pattern.length) {\n      return;\n    }\n\n    var addChunk = function addChunk(pattern, startIndex) {\n      _this.chunks.push({\n        pattern: pattern,\n        alphabet: createPatternAlphabet(pattern),\n        startIndex: startIndex,\n      });\n    };\n\n    var len = this.pattern.length;\n\n    if (len > MAX_BITS) {\n      var i = 0;\n      var remainder = len % MAX_BITS;\n      var end = len - remainder;\n\n      while (i < end) {\n        addChunk(this.pattern.substr(i, MAX_BITS), i);\n        i += MAX_BITS;\n      }\n\n      if (remainder) {\n        var startIndex = len - MAX_BITS;\n        addChunk(this.pattern.substr(startIndex), startIndex);\n      }\n    } else {\n      addChunk(this.pattern, 0);\n    }\n  }\n\n  _createClass(BitapSearch, [\n    {\n      key: 'searchIn',\n      value: function searchIn(text) {\n        var _this$options = this.options,\n          isCaseSensitive = _this$options.isCaseSensitive,\n          includeMatches = _this$options.includeMatches;\n\n        if (!isCaseSensitive) {\n          text = text.toLowerCase();\n        } // Exact match\n\n        if (this.pattern === text) {\n          var _result = {\n            isMatch: true,\n            score: 0,\n          };\n\n          if (includeMatches) {\n            _result.indices = [[0, text.length - 1]];\n          }\n\n          return _result;\n        } // Otherwise, use Bitap algorithm\n\n        var _this$options2 = this.options,\n          location = _this$options2.location,\n          distance = _this$options2.distance,\n          threshold = _this$options2.threshold,\n          findAllMatches = _this$options2.findAllMatches,\n          minMatchCharLength = _this$options2.minMatchCharLength,\n          ignoreLocation = _this$options2.ignoreLocation;\n        var allIndices = [];\n        var totalScore = 0;\n        var hasMatches = false;\n        this.chunks.forEach(function (_ref2) {\n          var pattern = _ref2.pattern,\n            alphabet = _ref2.alphabet,\n            startIndex = _ref2.startIndex;\n\n          var _search = search(text, pattern, alphabet, {\n              location: location + startIndex,\n              distance: distance,\n              threshold: threshold,\n              findAllMatches: findAllMatches,\n              minMatchCharLength: minMatchCharLength,\n              includeMatches: includeMatches,\n              ignoreLocation: ignoreLocation,\n            }),\n            isMatch = _search.isMatch,\n            score = _search.score,\n            indices = _search.indices;\n\n          if (isMatch) {\n            hasMatches = true;\n          }\n\n          totalScore += score;\n\n          if (isMatch && indices) {\n            allIndices = [].concat(_toConsumableArray(allIndices), _toConsumableArray(indices));\n          }\n        });\n        var result = {\n          isMatch: hasMatches,\n          score: hasMatches ? totalScore / this.chunks.length : 1,\n        };\n\n        if (hasMatches && includeMatches) {\n          result.indices = allIndices;\n        }\n\n        return result;\n      },\n    },\n  ]);\n\n  return BitapSearch;\n})();\n\nvar BaseMatch = /*#__PURE__*/ (function () {\n  function BaseMatch(pattern) {\n    _classCallCheck(this, BaseMatch);\n\n    this.pattern = pattern;\n  }\n\n  _createClass(\n    BaseMatch,\n    [\n      {\n        key: 'search',\n        value: function /*text*/ search() {},\n      },\n    ],\n    [\n      {\n        key: 'isMultiMatch',\n        value: function isMultiMatch(pattern) {\n          return getMatch(pattern, this.multiRegex);\n        },\n      },\n      {\n        key: 'isSingleMatch',\n        value: function isSingleMatch(pattern) {\n          return getMatch(pattern, this.singleRegex);\n        },\n      },\n    ]\n  );\n\n  return BaseMatch;\n})();\n\nfunction getMatch(pattern, exp) {\n  var matches = pattern.match(exp);\n  return matches ? matches[1] : null;\n}\n\nvar ExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\n  _inherits(ExactMatch, _BaseMatch);\n\n  var _super = _createSuper(ExactMatch);\n\n  function ExactMatch(pattern) {\n    _classCallCheck(this, ExactMatch);\n\n    return _super.call(this, pattern);\n  }\n\n  _createClass(\n    ExactMatch,\n    [\n      {\n        key: 'search',\n        value: function search(text) {\n          var isMatch = text === this.pattern;\n          return {\n            isMatch: isMatch,\n            score: isMatch ? 0 : 1,\n            indices: [0, this.pattern.length - 1],\n          };\n        },\n      },\n    ],\n    [\n      {\n        key: 'type',\n        get: function get() {\n          return 'exact';\n        },\n      },\n      {\n        key: 'multiRegex',\n        get: function get() {\n          return /^=\"(.*)\"$/;\n        },\n      },\n      {\n        key: 'singleRegex',\n        get: function get() {\n          return /^=(.*)$/;\n        },\n      },\n    ]\n  );\n\n  return ExactMatch;\n})(BaseMatch);\n\nvar InverseExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\n  _inherits(InverseExactMatch, _BaseMatch);\n\n  var _super = _createSuper(InverseExactMatch);\n\n  function InverseExactMatch(pattern) {\n    _classCallCheck(this, InverseExactMatch);\n\n    return _super.call(this, pattern);\n  }\n\n  _createClass(\n    InverseExactMatch,\n    [\n      {\n        key: 'search',\n        value: function search(text) {\n          var index = text.indexOf(this.pattern);\n          var isMatch = index === -1;\n          return {\n            isMatch: isMatch,\n            score: isMatch ? 0 : 1,\n            indices: [0, text.length - 1],\n          };\n        },\n      },\n    ],\n    [\n      {\n        key: 'type',\n        get: function get() {\n          return 'inverse-exact';\n        },\n      },\n      {\n        key: 'multiRegex',\n        get: function get() {\n          return /^!\"(.*)\"$/;\n        },\n      },\n      {\n        key: 'singleRegex',\n        get: function get() {\n          return /^!(.*)$/;\n        },\n      },\n    ]\n  );\n\n  return InverseExactMatch;\n})(BaseMatch);\n\nvar PrefixExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\n  _inherits(PrefixExactMatch, _BaseMatch);\n\n  var _super = _createSuper(PrefixExactMatch);\n\n  function PrefixExactMatch(pattern) {\n    _classCallCheck(this, PrefixExactMatch);\n\n    return _super.call(this, pattern);\n  }\n\n  _createClass(\n    PrefixExactMatch,\n    [\n      {\n        key: 'search',\n        value: function search(text) {\n          var isMatch = text.startsWith(this.pattern);\n          return {\n            isMatch: isMatch,\n            score: isMatch ? 0 : 1,\n            indices: [0, this.pattern.length - 1],\n          };\n        },\n      },\n    ],\n    [\n      {\n        key: 'type',\n        get: function get() {\n          return 'prefix-exact';\n        },\n      },\n      {\n        key: 'multiRegex',\n        get: function get() {\n          return /^\\^\"(.*)\"$/;\n        },\n      },\n      {\n        key: 'singleRegex',\n        get: function get() {\n          return /^\\^(.*)$/;\n        },\n      },\n    ]\n  );\n\n  return PrefixExactMatch;\n})(BaseMatch);\n\nvar InversePrefixExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\n  _inherits(InversePrefixExactMatch, _BaseMatch);\n\n  var _super = _createSuper(InversePrefixExactMatch);\n\n  function InversePrefixExactMatch(pattern) {\n    _classCallCheck(this, InversePrefixExactMatch);\n\n    return _super.call(this, pattern);\n  }\n\n  _createClass(\n    InversePrefixExactMatch,\n    [\n      {\n        key: 'search',\n        value: function search(text) {\n          var isMatch = !text.startsWith(this.pattern);\n          return {\n            isMatch: isMatch,\n            score: isMatch ? 0 : 1,\n            indices: [0, text.length - 1],\n          };\n        },\n      },\n    ],\n    [\n      {\n        key: 'type',\n        get: function get() {\n          return 'inverse-prefix-exact';\n        },\n      },\n      {\n        key: 'multiRegex',\n        get: function get() {\n          return /^!\\^\"(.*)\"$/;\n        },\n      },\n      {\n        key: 'singleRegex',\n        get: function get() {\n          return /^!\\^(.*)$/;\n        },\n      },\n    ]\n  );\n\n  return InversePrefixExactMatch;\n})(BaseMatch);\n\nvar SuffixExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\n  _inherits(SuffixExactMatch, _BaseMatch);\n\n  var _super = _createSuper(SuffixExactMatch);\n\n  function SuffixExactMatch(pattern) {\n    _classCallCheck(this, SuffixExactMatch);\n\n    return _super.call(this, pattern);\n  }\n\n  _createClass(\n    SuffixExactMatch,\n    [\n      {\n        key: 'search',\n        value: function search(text) {\n          var isMatch = text.endsWith(this.pattern);\n          return {\n            isMatch: isMatch,\n            score: isMatch ? 0 : 1,\n            indices: [text.length - this.pattern.length, text.length - 1],\n          };\n        },\n      },\n    ],\n    [\n      {\n        key: 'type',\n        get: function get() {\n          return 'suffix-exact';\n        },\n      },\n      {\n        key: 'multiRegex',\n        get: function get() {\n          return /^\"(.*)\"\\$$/;\n        },\n      },\n      {\n        key: 'singleRegex',\n        get: function get() {\n          return /^(.*)\\$$/;\n        },\n      },\n    ]\n  );\n\n  return SuffixExactMatch;\n})(BaseMatch);\n\nvar InverseSuffixExactMatch = /*#__PURE__*/ (function (_BaseMatch) {\n  _inherits(InverseSuffixExactMatch, _BaseMatch);\n\n  var _super = _createSuper(InverseSuffixExactMatch);\n\n  function InverseSuffixExactMatch(pattern) {\n    _classCallCheck(this, InverseSuffixExactMatch);\n\n    return _super.call(this, pattern);\n  }\n\n  _createClass(\n    InverseSuffixExactMatch,\n    [\n      {\n        key: 'search',\n        value: function search(text) {\n          var isMatch = !text.endsWith(this.pattern);\n          return {\n            isMatch: isMatch,\n            score: isMatch ? 0 : 1,\n            indices: [0, text.length - 1],\n          };\n        },\n      },\n    ],\n    [\n      {\n        key: 'type',\n        get: function get() {\n          return 'inverse-suffix-exact';\n        },\n      },\n      {\n        key: 'multiRegex',\n        get: function get() {\n          return /^!\"(.*)\"\\$$/;\n        },\n      },\n      {\n        key: 'singleRegex',\n        get: function get() {\n          return /^!(.*)\\$$/;\n        },\n      },\n    ]\n  );\n\n  return InverseSuffixExactMatch;\n})(BaseMatch);\n\nvar FuzzyMatch = /*#__PURE__*/ (function (_BaseMatch) {\n  _inherits(FuzzyMatch, _BaseMatch);\n\n  var _super = _createSuper(FuzzyMatch);\n\n  function FuzzyMatch(pattern) {\n    var _this;\n\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$location = _ref.location,\n      location = _ref$location === void 0 ? Config.location : _ref$location,\n      _ref$threshold = _ref.threshold,\n      threshold = _ref$threshold === void 0 ? Config.threshold : _ref$threshold,\n      _ref$distance = _ref.distance,\n      distance = _ref$distance === void 0 ? Config.distance : _ref$distance,\n      _ref$includeMatches = _ref.includeMatches,\n      includeMatches = _ref$includeMatches === void 0 ? Config.includeMatches : _ref$includeMatches,\n      _ref$findAllMatches = _ref.findAllMatches,\n      findAllMatches = _ref$findAllMatches === void 0 ? Config.findAllMatches : _ref$findAllMatches,\n      _ref$minMatchCharLeng = _ref.minMatchCharLength,\n      minMatchCharLength =\n        _ref$minMatchCharLeng === void 0 ? Config.minMatchCharLength : _ref$minMatchCharLeng,\n      _ref$isCaseSensitive = _ref.isCaseSensitive,\n      isCaseSensitive =\n        _ref$isCaseSensitive === void 0 ? Config.isCaseSensitive : _ref$isCaseSensitive,\n      _ref$ignoreLocation = _ref.ignoreLocation,\n      ignoreLocation = _ref$ignoreLocation === void 0 ? Config.ignoreLocation : _ref$ignoreLocation;\n\n    _classCallCheck(this, FuzzyMatch);\n\n    _this = _super.call(this, pattern);\n    _this._bitapSearch = new BitapSearch(pattern, {\n      location: location,\n      threshold: threshold,\n      distance: distance,\n      includeMatches: includeMatches,\n      findAllMatches: findAllMatches,\n      minMatchCharLength: minMatchCharLength,\n      isCaseSensitive: isCaseSensitive,\n      ignoreLocation: ignoreLocation,\n    });\n    return _this;\n  }\n\n  _createClass(\n    FuzzyMatch,\n    [\n      {\n        key: 'search',\n        value: function search(text) {\n          return this._bitapSearch.searchIn(text);\n        },\n      },\n    ],\n    [\n      {\n        key: 'type',\n        get: function get() {\n          return 'fuzzy';\n        },\n      },\n      {\n        key: 'multiRegex',\n        get: function get() {\n          return /^\"(.*)\"$/;\n        },\n      },\n      {\n        key: 'singleRegex',\n        get: function get() {\n          return /^(.*)$/;\n        },\n      },\n    ]\n  );\n\n  return FuzzyMatch;\n})(BaseMatch);\n\nvar IncludeMatch = /*#__PURE__*/ (function (_BaseMatch) {\n  _inherits(IncludeMatch, _BaseMatch);\n\n  var _super = _createSuper(IncludeMatch);\n\n  function IncludeMatch(pattern) {\n    _classCallCheck(this, IncludeMatch);\n\n    return _super.call(this, pattern);\n  }\n\n  _createClass(\n    IncludeMatch,\n    [\n      {\n        key: 'search',\n        value: function search(text) {\n          var location = 0;\n          var index;\n          var indices = [];\n          var patternLen = this.pattern.length; // Get all exact matches\n\n          while ((index = text.indexOf(this.pattern, location)) > -1) {\n            location = index + patternLen;\n            indices.push([index, location - 1]);\n          }\n\n          var isMatch = !!indices.length;\n          return {\n            isMatch: isMatch,\n            score: isMatch ? 0 : 1,\n            indices: indices,\n          };\n        },\n      },\n    ],\n    [\n      {\n        key: 'type',\n        get: function get() {\n          return 'include';\n        },\n      },\n      {\n        key: 'multiRegex',\n        get: function get() {\n          return /^'\"(.*)\"$/;\n        },\n      },\n      {\n        key: 'singleRegex',\n        get: function get() {\n          return /^'(.*)$/;\n        },\n      },\n    ]\n  );\n\n  return IncludeMatch;\n})(BaseMatch);\n\nvar searchers = [\n  ExactMatch,\n  IncludeMatch,\n  PrefixExactMatch,\n  InversePrefixExactMatch,\n  InverseSuffixExactMatch,\n  SuffixExactMatch,\n  InverseExactMatch,\n  FuzzyMatch,\n];\nvar searchersLen = searchers.length; // Regex to split by spaces, but keep anything in quotes together\n\nvar SPACE_RE = / +(?=([^\\\"]*\\\"[^\\\"]*\\\")*[^\\\"]*$)/;\nvar OR_TOKEN = '|'; // Return a 2D array representation of the query, for simpler parsing.\n// Example:\n// \"^core go$ | rb$ | py$ xy$\" => [[\"^core\", \"go$\"], [\"rb$\"], [\"py$\", \"xy$\"]]\n\nfunction parseQuery(pattern) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  return pattern.split(OR_TOKEN).map(function (item) {\n    var query = item\n      .trim()\n      .split(SPACE_RE)\n      .filter(function (item) {\n        return item && !!item.trim();\n      });\n    var results = [];\n\n    for (var i = 0, len = query.length; i < len; i += 1) {\n      var queryItem = query[i]; // 1. Handle multiple query match (i.e, once that are quoted, like `\"hello world\"`)\n\n      var found = false;\n      var idx = -1;\n\n      while (!found && ++idx < searchersLen) {\n        var searcher = searchers[idx];\n        var token = searcher.isMultiMatch(queryItem);\n\n        if (token) {\n          results.push(new searcher(token, options));\n          found = true;\n        }\n      }\n\n      if (found) {\n        continue;\n      } // 2. Handle single query matches (i.e, once that are *not* quoted)\n\n      idx = -1;\n\n      while (++idx < searchersLen) {\n        var _searcher = searchers[idx];\n\n        var _token = _searcher.isSingleMatch(queryItem);\n\n        if (_token) {\n          results.push(new _searcher(_token, options));\n          break;\n        }\n      }\n    }\n\n    return results;\n  });\n}\n\n// to a singl match\n\nvar MultiMatchSet = new Set([FuzzyMatch.type, IncludeMatch.type]);\n/**\n * Command-like searching\n * ======================\n *\n * Given multiple search terms delimited by spaces.e.g. `^jscript .python$ ruby !java`,\n * search in a given text.\n *\n * Search syntax:\n *\n * | Token       | Match type                 | Description                            |\n * | ----------- | -------------------------- | -------------------------------------- |\n * | `jscript`   | fuzzy-match                | Items that fuzzy match `jscript`       |\n * | `=scheme`   | exact-match                | Items that are `scheme`                |\n * | `'python`   | include-match              | Items that include `python`            |\n * | `!ruby`     | inverse-exact-match        | Items that do not include `ruby`       |\n * | `^java`     | prefix-exact-match         | Items that start with `java`           |\n * | `!^earlang` | inverse-prefix-exact-match | Items that do not start with `earlang` |\n * | `.js$`      | suffix-exact-match         | Items that end with `.js`              |\n * | `!.go$`     | inverse-suffix-exact-match | Items that do not end with `.go`       |\n *\n * A single pipe character acts as an OR operator. For example, the following\n * query matches entries that start with `core` and end with either`go`, `rb`,\n * or`py`.\n *\n * ```\n * ^core go$ | rb$ | py$\n * ```\n */\n\nvar ExtendedSearch = /*#__PURE__*/ (function () {\n  function ExtendedSearch(pattern) {\n    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n      _ref$isCaseSensitive = _ref.isCaseSensitive,\n      isCaseSensitive =\n        _ref$isCaseSensitive === void 0 ? Config.isCaseSensitive : _ref$isCaseSensitive,\n      _ref$includeMatches = _ref.includeMatches,\n      includeMatches = _ref$includeMatches === void 0 ? Config.includeMatches : _ref$includeMatches,\n      _ref$minMatchCharLeng = _ref.minMatchCharLength,\n      minMatchCharLength =\n        _ref$minMatchCharLeng === void 0 ? Config.minMatchCharLength : _ref$minMatchCharLeng,\n      _ref$ignoreLocation = _ref.ignoreLocation,\n      ignoreLocation = _ref$ignoreLocation === void 0 ? Config.ignoreLocation : _ref$ignoreLocation,\n      _ref$findAllMatches = _ref.findAllMatches,\n      findAllMatches = _ref$findAllMatches === void 0 ? Config.findAllMatches : _ref$findAllMatches,\n      _ref$location = _ref.location,\n      location = _ref$location === void 0 ? Config.location : _ref$location,\n      _ref$threshold = _ref.threshold,\n      threshold = _ref$threshold === void 0 ? Config.threshold : _ref$threshold,\n      _ref$distance = _ref.distance,\n      distance = _ref$distance === void 0 ? Config.distance : _ref$distance;\n\n    _classCallCheck(this, ExtendedSearch);\n\n    this.query = null;\n    this.options = {\n      isCaseSensitive: isCaseSensitive,\n      includeMatches: includeMatches,\n      minMatchCharLength: minMatchCharLength,\n      findAllMatches: findAllMatches,\n      ignoreLocation: ignoreLocation,\n      location: location,\n      threshold: threshold,\n      distance: distance,\n    };\n    this.pattern = isCaseSensitive ? pattern : pattern.toLowerCase();\n    this.query = parseQuery(this.pattern, this.options);\n  }\n\n  _createClass(\n    ExtendedSearch,\n    [\n      {\n        key: 'searchIn',\n        value: function searchIn(text) {\n          var query = this.query;\n\n          if (!query) {\n            return {\n              isMatch: false,\n              score: 1,\n            };\n          }\n\n          var _this$options = this.options,\n            includeMatches = _this$options.includeMatches,\n            isCaseSensitive = _this$options.isCaseSensitive;\n          text = isCaseSensitive ? text : text.toLowerCase();\n          var numMatches = 0;\n          var allIndices = [];\n          var totalScore = 0; // ORs\n\n          for (var i = 0, qLen = query.length; i < qLen; i += 1) {\n            var searchers = query[i]; // Reset indices\n\n            allIndices.length = 0;\n            numMatches = 0; // ANDs\n\n            for (var j = 0, pLen = searchers.length; j < pLen; j += 1) {\n              var searcher = searchers[j];\n\n              var _searcher$search = searcher.search(text),\n                isMatch = _searcher$search.isMatch,\n                indices = _searcher$search.indices,\n                score = _searcher$search.score;\n\n              if (isMatch) {\n                numMatches += 1;\n                totalScore += score;\n\n                if (includeMatches) {\n                  var type = searcher.constructor.type;\n\n                  if (MultiMatchSet.has(type)) {\n                    allIndices = [].concat(\n                      _toConsumableArray(allIndices),\n                      _toConsumableArray(indices)\n                    );\n                  } else {\n                    allIndices.push(indices);\n                  }\n                }\n              } else {\n                totalScore = 0;\n                numMatches = 0;\n                allIndices.length = 0;\n                break;\n              }\n            } // OR condition, so if TRUE, return\n\n            if (numMatches) {\n              var result = {\n                isMatch: true,\n                score: totalScore / numMatches,\n              };\n\n              if (includeMatches) {\n                result.indices = allIndices;\n              }\n\n              return result;\n            }\n          } // Nothing was matched\n\n          return {\n            isMatch: false,\n            score: 1,\n          };\n        },\n      },\n    ],\n    [\n      {\n        key: 'condition',\n        value: function condition(_, options) {\n          return options.useExtendedSearch;\n        },\n      },\n    ]\n  );\n\n  return ExtendedSearch;\n})();\n\nvar registeredSearchers = [];\nfunction register() {\n  registeredSearchers.push.apply(registeredSearchers, arguments);\n}\nfunction createSearcher(pattern, options) {\n  for (var i = 0, len = registeredSearchers.length; i < len; i += 1) {\n    var searcherClass = registeredSearchers[i];\n\n    if (searcherClass.condition(pattern, options)) {\n      return new searcherClass(pattern, options);\n    }\n  }\n\n  return new BitapSearch(pattern, options);\n}\n\nvar LogicalOperator = {\n  AND: '$and',\n  OR: '$or',\n};\nvar KeyType = {\n  PATH: '$path',\n  PATTERN: '$val',\n};\n\nvar isExpression = function isExpression(query) {\n  return !!(query[LogicalOperator.AND] || query[LogicalOperator.OR]);\n};\n\nvar isPath = function isPath(query) {\n  return !!query[KeyType.PATH];\n};\n\nvar isLeaf = function isLeaf(query) {\n  return !isArray(query) && isObject(query) && !isExpression(query);\n};\n\nvar convertToExplicit = function convertToExplicit(query) {\n  return _defineProperty(\n    {},\n    LogicalOperator.AND,\n    Object.keys(query).map(function (key) {\n      return _defineProperty({}, key, query[key]);\n    })\n  );\n}; // When `auto` is `true`, the parse function will infer and initialize and add\n// the appropriate `Searcher` instance\n\nfunction parse(query, options) {\n  var _ref3 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n    _ref3$auto = _ref3.auto,\n    auto = _ref3$auto === void 0 ? true : _ref3$auto;\n\n  var next = function next(query) {\n    var keys = Object.keys(query);\n    var isQueryPath = isPath(query);\n\n    if (!isQueryPath && keys.length > 1 && !isExpression(query)) {\n      return next(convertToExplicit(query));\n    }\n\n    if (isLeaf(query)) {\n      var key = isQueryPath ? query[KeyType.PATH] : keys[0];\n      var pattern = isQueryPath ? query[KeyType.PATTERN] : query[key];\n\n      if (!isString(pattern)) {\n        throw new Error(LOGICAL_SEARCH_INVALID_QUERY_FOR_KEY(key));\n      }\n\n      var obj = {\n        keyId: createKeyId(key),\n        pattern: pattern,\n      };\n\n      if (auto) {\n        obj.searcher = createSearcher(pattern, options);\n      }\n\n      return obj;\n    }\n\n    var node = {\n      children: [],\n      operator: keys[0],\n    };\n    keys.forEach(function (key) {\n      var value = query[key];\n\n      if (isArray(value)) {\n        value.forEach(function (item) {\n          node.children.push(next(item));\n        });\n      }\n    });\n    return node;\n  };\n\n  if (!isExpression(query)) {\n    query = convertToExplicit(query);\n  }\n\n  return next(query);\n}\n\nfunction computeScore(results, _ref) {\n  var _ref$ignoreFieldNorm = _ref.ignoreFieldNorm,\n    ignoreFieldNorm =\n      _ref$ignoreFieldNorm === void 0 ? Config.ignoreFieldNorm : _ref$ignoreFieldNorm;\n  results.forEach(function (result) {\n    var totalScore = 1;\n    result.matches.forEach(function (_ref2) {\n      var key = _ref2.key,\n        norm = _ref2.norm,\n        score = _ref2.score;\n      var weight = key ? key.weight : null;\n      totalScore *= Math.pow(\n        score === 0 && weight ? Number.EPSILON : score,\n        (weight || 1) * (ignoreFieldNorm ? 1 : norm)\n      );\n    });\n    result.score = totalScore;\n  });\n}\n\nfunction transformMatches(result, data) {\n  var matches = result.matches;\n  data.matches = [];\n\n  if (!isDefined(matches)) {\n    return;\n  }\n\n  matches.forEach(function (match) {\n    if (!isDefined(match.indices) || !match.indices.length) {\n      return;\n    }\n\n    var indices = match.indices,\n      value = match.value;\n    var obj = {\n      indices: indices,\n      value: value,\n    };\n\n    if (match.key) {\n      obj.key = match.key.src;\n    }\n\n    if (match.idx > -1) {\n      obj.refIndex = match.idx;\n    }\n\n    data.matches.push(obj);\n  });\n}\n\nfunction transformScore(result, data) {\n  data.score = result.score;\n}\n\nfunction format(results, docs) {\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n    _ref$includeMatches = _ref.includeMatches,\n    includeMatches = _ref$includeMatches === void 0 ? Config.includeMatches : _ref$includeMatches,\n    _ref$includeScore = _ref.includeScore,\n    includeScore = _ref$includeScore === void 0 ? Config.includeScore : _ref$includeScore;\n\n  var transformers = [];\n  if (includeMatches) transformers.push(transformMatches);\n  if (includeScore) transformers.push(transformScore);\n  return results.map(function (result) {\n    var idx = result.idx;\n    var data = {\n      item: docs[idx],\n      refIndex: idx,\n    };\n\n    if (transformers.length) {\n      transformers.forEach(function (transformer) {\n        transformer(result, data);\n      });\n    }\n\n    return data;\n  });\n}\n\nvar Fuse$1 = /*#__PURE__*/ (function () {\n  function Fuse(docs) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var index = arguments.length > 2 ? arguments[2] : undefined;\n\n    _classCallCheck(this, Fuse);\n\n    this.options = _objectSpread2(_objectSpread2({}, Config), options);\n\n    if (this.options.useExtendedSearch && !true) {\n      throw new Error(EXTENDED_SEARCH_UNAVAILABLE);\n    }\n\n    this._keyStore = new KeyStore(this.options.keys);\n    this.setCollection(docs, index);\n  }\n\n  _createClass(Fuse, [\n    {\n      key: 'setCollection',\n      value: function setCollection(docs, index) {\n        this._docs = docs;\n\n        if (index && !(index instanceof FuseIndex)) {\n          throw new Error(INCORRECT_INDEX_TYPE);\n        }\n\n        this._myIndex =\n          index ||\n          createIndex(this.options.keys, this._docs, {\n            getFn: this.options.getFn,\n            fieldNormWeight: this.options.fieldNormWeight,\n          });\n      },\n    },\n    {\n      key: 'add',\n      value: function add(doc) {\n        if (!isDefined(doc)) {\n          return;\n        }\n\n        this._docs.push(doc);\n\n        this._myIndex.add(doc);\n      },\n    },\n    {\n      key: 'remove',\n      value: function remove() {\n        var predicate =\n          arguments.length > 0 && arguments[0] !== undefined\n            ? arguments[0]\n            : function () /* doc, idx */\n              {\n                return false;\n              };\n        var results = [];\n\n        for (var i = 0, len = this._docs.length; i < len; i += 1) {\n          var doc = this._docs[i];\n\n          if (predicate(doc, i)) {\n            this.removeAt(i);\n            i -= 1;\n            len -= 1;\n            results.push(doc);\n          }\n        }\n\n        return results;\n      },\n    },\n    {\n      key: 'removeAt',\n      value: function removeAt(idx) {\n        this._docs.splice(idx, 1);\n\n        this._myIndex.removeAt(idx);\n      },\n    },\n    {\n      key: 'getIndex',\n      value: function getIndex() {\n        return this._myIndex;\n      },\n    },\n    {\n      key: 'search',\n      value: function search(query) {\n        var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n          _ref$limit = _ref.limit,\n          limit = _ref$limit === void 0 ? -1 : _ref$limit;\n\n        var _this$options = this.options,\n          includeMatches = _this$options.includeMatches,\n          includeScore = _this$options.includeScore,\n          shouldSort = _this$options.shouldSort,\n          sortFn = _this$options.sortFn,\n          ignoreFieldNorm = _this$options.ignoreFieldNorm;\n        var results = isString(query)\n          ? isString(this._docs[0])\n            ? this._searchStringList(query)\n            : this._searchObjectList(query)\n          : this._searchLogical(query);\n        computeScore(results, {\n          ignoreFieldNorm: ignoreFieldNorm,\n        });\n\n        if (shouldSort) {\n          results.sort(sortFn);\n        }\n\n        if (isNumber(limit) && limit > -1) {\n          results = results.slice(0, limit);\n        }\n\n        return format(results, this._docs, {\n          includeMatches: includeMatches,\n          includeScore: includeScore,\n        });\n      },\n    },\n    {\n      key: '_searchStringList',\n      value: function _searchStringList(query) {\n        var searcher = createSearcher(query, this.options);\n        var records = this._myIndex.records;\n        var results = []; // Iterate over every string in the index\n\n        records.forEach(function (_ref2) {\n          var text = _ref2.v,\n            idx = _ref2.i,\n            norm = _ref2.n;\n\n          if (!isDefined(text)) {\n            return;\n          }\n\n          var _searcher$searchIn = searcher.searchIn(text),\n            isMatch = _searcher$searchIn.isMatch,\n            score = _searcher$searchIn.score,\n            indices = _searcher$searchIn.indices;\n\n          if (isMatch) {\n            results.push({\n              item: text,\n              idx: idx,\n              matches: [\n                {\n                  score: score,\n                  value: text,\n                  norm: norm,\n                  indices: indices,\n                },\n              ],\n            });\n          }\n        });\n        return results;\n      },\n    },\n    {\n      key: '_searchLogical',\n      value: function _searchLogical(query) {\n        var _this = this;\n\n        var expression = parse(query, this.options);\n\n        var evaluate = function evaluate(node, item, idx) {\n          if (!node.children) {\n            var keyId = node.keyId,\n              searcher = node.searcher;\n\n            var matches = _this._findMatches({\n              key: _this._keyStore.get(keyId),\n              value: _this._myIndex.getValueForItemAtKeyId(item, keyId),\n              searcher: searcher,\n            });\n\n            if (matches && matches.length) {\n              return [\n                {\n                  idx: idx,\n                  item: item,\n                  matches: matches,\n                },\n              ];\n            }\n\n            return [];\n          }\n\n          var res = [];\n\n          for (var i = 0, len = node.children.length; i < len; i += 1) {\n            var child = node.children[i];\n            var result = evaluate(child, item, idx);\n\n            if (result.length) {\n              res.push.apply(res, _toConsumableArray(result));\n            } else if (node.operator === LogicalOperator.AND) {\n              return [];\n            }\n          }\n\n          return res;\n        };\n\n        var records = this._myIndex.records;\n        var resultMap = {};\n        var results = [];\n        records.forEach(function (_ref3) {\n          var item = _ref3.$,\n            idx = _ref3.i;\n\n          if (isDefined(item)) {\n            var expResults = evaluate(expression, item, idx);\n\n            if (expResults.length) {\n              // Dedupe when adding\n              if (!resultMap[idx]) {\n                resultMap[idx] = {\n                  idx: idx,\n                  item: item,\n                  matches: [],\n                };\n                results.push(resultMap[idx]);\n              }\n\n              expResults.forEach(function (_ref4) {\n                var _resultMap$idx$matche;\n\n                var matches = _ref4.matches;\n\n                (_resultMap$idx$matche = resultMap[idx].matches).push.apply(\n                  _resultMap$idx$matche,\n                  _toConsumableArray(matches)\n                );\n              });\n            }\n          }\n        });\n        return results;\n      },\n    },\n    {\n      key: '_searchObjectList',\n      value: function _searchObjectList(query) {\n        var _this2 = this;\n\n        var searcher = createSearcher(query, this.options);\n        var _this$_myIndex = this._myIndex,\n          keys = _this$_myIndex.keys,\n          records = _this$_myIndex.records;\n        var results = []; // List is Array<Object>\n\n        records.forEach(function (_ref5) {\n          var item = _ref5.$,\n            idx = _ref5.i;\n\n          if (!isDefined(item)) {\n            return;\n          }\n\n          var matches = []; // Iterate over every key (i.e, path), and fetch the value at that key\n\n          keys.forEach(function (key, keyIndex) {\n            matches.push.apply(\n              matches,\n              _toConsumableArray(\n                _this2._findMatches({\n                  key: key,\n                  value: item[keyIndex],\n                  searcher: searcher,\n                })\n              )\n            );\n          });\n\n          if (matches.length) {\n            results.push({\n              idx: idx,\n              item: item,\n              matches: matches,\n            });\n          }\n        });\n        return results;\n      },\n    },\n    {\n      key: '_findMatches',\n      value: function _findMatches(_ref6) {\n        var key = _ref6.key,\n          value = _ref6.value,\n          searcher = _ref6.searcher;\n\n        if (!isDefined(value)) {\n          return [];\n        }\n\n        var matches = [];\n\n        if (isArray(value)) {\n          value.forEach(function (_ref7) {\n            var text = _ref7.v,\n              idx = _ref7.i,\n              norm = _ref7.n;\n\n            if (!isDefined(text)) {\n              return;\n            }\n\n            var _searcher$searchIn2 = searcher.searchIn(text),\n              isMatch = _searcher$searchIn2.isMatch,\n              score = _searcher$searchIn2.score,\n              indices = _searcher$searchIn2.indices;\n\n            if (isMatch) {\n              matches.push({\n                score: score,\n                key: key,\n                value: text,\n                idx: idx,\n                norm: norm,\n                indices: indices,\n              });\n            }\n          });\n        } else {\n          var text = value.v,\n            norm = value.n;\n\n          var _searcher$searchIn3 = searcher.searchIn(text),\n            isMatch = _searcher$searchIn3.isMatch,\n            score = _searcher$searchIn3.score,\n            indices = _searcher$searchIn3.indices;\n\n          if (isMatch) {\n            matches.push({\n              score: score,\n              key: key,\n              value: text,\n              norm: norm,\n              indices: indices,\n            });\n          }\n        }\n\n        return matches;\n      },\n    },\n  ]);\n\n  return Fuse;\n})();\n\nFuse$1.version = '6.5.3';\nFuse$1.createIndex = createIndex;\nFuse$1.parseIndex = parseIndex;\nFuse$1.config = Config;\n\n{\n  Fuse$1.parseQuery = parse;\n}\n\n{\n  register(ExtendedSearch);\n}\n\nexport var Fuse = Fuse$1;\n","import { isInitialized } from '../token-variants.mjs';\nimport { Fuse } from './fuse/fuse.js';\nimport { getSearchOptions, TVA_CONFIG } from './settings.js';\nimport {\n  callForgeVTT,\n  decodeURIComponentSafely,\n  decodeURISafely,\n  flattenSearchResults,\n  getFileName,\n  getFileNameWithExt,\n  getFilePath,\n  getFilters,\n  isImage,\n  isVideo,\n  parseKeywords,\n  SEARCH_TYPE,\n  simplifyName,\n  simplifyPath,\n} from './utils.js';\n\n// True if in the middle of caching image paths\nlet caching = false;\nexport function isCaching() {\n  return caching;\n}\n\n// Cached images\nlet CACHED_IMAGES = {};\n\n/**\n * @param {string} search Text to be used as the search criteria\n * @param {object} [options={}] Options which customize the search\n * @param {SEARCH_TYPE|string} [options.searchType] Controls filters applied to the search results\n * @param {Boolean} [options.simpleResults] Results will be returned as an array of all image paths found\n * @param {Function[]} [options.callback] Function to be called with the found images\n * @param {object} [options.searchOptions] Override search settings\n * @returns {Promise<Map<string, Array<object>|Array<string>>} All images found split by original criteria and keywords\n */\nexport async function doImageSearch(\n  search,\n  { searchType = SEARCH_TYPE.PORTRAIT_AND_TOKEN, simpleResults = false, callback = null, searchOptions = {} } = {}\n) {\n  if (caching) return;\n\n  searchOptions = foundry.utils.mergeObject(searchOptions, getSearchOptions(), { overwrite: false });\n\n  search = search.trim();\n\n  if (TVA_CONFIG.debug) console.info('TVA | STARTING: Art Search', search, searchType, searchOptions);\n\n  let searches = [search];\n  let allImages = new Map();\n  const keywords = parseKeywords(searchOptions.excludedKeywords);\n\n  if (searchOptions.keywordSearch) {\n    searches = searches.concat(\n      search\n        .split(/[_\\- :,\\|\\(\\)\\[\\]]/)\n        .filter((word) => word.length > 2 && !keywords.includes(word.toLowerCase()))\n        .reverse()\n    );\n  }\n\n  let usedImages = new Set();\n  for (const search of searches) {\n    if (allImages.get(search) !== undefined) continue;\n\n    let results = await findImages(search, searchType, searchOptions);\n    results = results.filter((pathObj) => !usedImages.has(pathObj));\n\n    allImages.set(search, results);\n    results.forEach(usedImages.add, usedImages);\n  }\n\n  if (TVA_CONFIG.debug) console.info('TVA | ENDING: Art Search');\n\n  if (simpleResults) {\n    allImages = Array.from(usedImages).map((obj) => obj.path);\n  }\n\n  if (callback) callback(allImages);\n  return allImages;\n}\n\n/**\n * @param {*} search Text to be used as the search criteria\n * @param {object} [options={}] Options which customize the search\n * @param {SEARCH_TYPE|string} [options.searchType] Controls filters applied to the search results\n * @param {Actor} [options.actor] Used to retrieve 'shared' images from if enabled in the Randomizer Settings\n * @param {Function[]} [options.callback] Function to be called with the random image\n * @param {object} [options.searchOptions] Override search settings\n * @param {object} [options.randomizerOptions] Override randomizer settings. These take precedence over searchOptions\n * @returns Array<string>|null} Image path and name\n */\nexport async function doRandomSearch(\n  search,\n  {\n    searchType = SEARCH_TYPE.PORTRAIT_AND_TOKEN,\n    actor = null,\n    callback = null,\n    randomizerOptions = {},\n    searchOptions = {},\n  } = {}\n) {\n  if (caching) return null;\n\n  let results = flattenSearchResults(\n    await _randSearchUtil(search, {\n      searchType: searchType,\n      actor: actor,\n      randomizerOptions: randomizerOptions,\n      searchOptions: searchOptions,\n    })\n  );\n  if (results.length === 0) return null;\n\n  let result;\n\n  // If `nonRepeat` option is enabled keep attempting random selection until a unique token image is found\n  // in case of no such image, just pick a random one\n  if (results.length !== 1 && randomizerOptions.nonRepeat && searchType === SEARCH_TYPE.TOKEN) {\n    const tokens = canvas.tokens?.placeables || [];\n    const placedImages = new Set(tokens.map((t) => t.document.texture.src));\n    let checkedImages = [];\n    let tmpResult = results[Math.floor(Math.random() * results.length)];\n\n    while (results.length && !result) {\n      if (placedImages.has(tmpResult.path)) {\n        checkedImages.push(tmpResult);\n        results.splice(results.indexOf(tmpResult), 1);\n        tmpResult = results[Math.floor(Math.random() * results.length)];\n      } else {\n        result = tmpResult;\n      }\n    }\n\n    if (!result) results = checkedImages;\n  }\n\n  if (!result) {\n    result = results[Math.floor(Math.random() * results.length)];\n  }\n\n  // Pick random image\n  if (callback) callback([result.path, result.name]);\n  return [result.path, result.name];\n}\n\nexport async function doSyncSearch(target, { searchType = SEARCH_TYPE.TOKEN } = {}) {\n  if (caching) return null;\n\n  const fResults = await findImages(target, searchType, { algorithm: { fuzzy: true } });\n\n  if (fResults && fResults.length !== 0) {\n    return [fResults[0].path, fResults[0].name];\n  } else {\n    return null;\n  }\n}\n\nasync function _randSearchUtil(\n  search,\n  { searchType = SEARCH_TYPE.PORTRAIT_AND_TOKEN, actor = null, randomizerOptions = {}, searchOptions = {} } = {}\n) {\n  const randSettings = foundry.utils.mergeObject(randomizerOptions, TVA_CONFIG.randomizer, { overwrite: false });\n  if (\n    !(\n      randSettings.tokenName ||\n      randSettings.actorName ||\n      randSettings.keywords ||\n      randSettings.shared ||\n      randSettings.wildcard\n    )\n  )\n    return null;\n\n  // Randomizer settings take precedence\n  searchOptions.keywordSearch = randSettings.keywords;\n\n  // Swap search to the actor name if need be\n  if (randSettings.actorName && actor) {\n    search = actor.name;\n  }\n\n  // Gather all images\n  let results =\n    randSettings.actorName || randSettings.tokenName || randSettings.keywords\n      ? await doImageSearch(search, {\n          searchType: searchType,\n          searchOptions: searchOptions,\n        })\n      : new Map();\n\n  if (!randSettings.tokenName && !randSettings.actorName) {\n    results.delete(search);\n  }\n  if (randSettings.shared && actor) {\n    let sharedVariants = actor.getFlag('token-variants', 'variants') || [];\n    if (sharedVariants.length != 0) {\n      const sv = [];\n      sharedVariants.forEach((variant) => {\n        variant.names.forEach((name) => {\n          sv.push({ path: variant.imgSrc, name: name });\n        });\n      });\n      results.set('variants95436723', sv);\n    }\n  }\n  if (randSettings.wildcard && actor) {\n    let protoImg = actor.prototypeToken.texture.src;\n    if (protoImg.includes('*') || (protoImg.includes('{') && protoImg.includes('}'))) {\n      // Modified version of Actor.getTokenImages()\n      const getTokenImages = async (actor) => {\n        if (actor._tokenImages) return actor._tokenImages;\n        let source = 'data';\n        const browseOptions = { wildcard: true };\n\n        // Support non-user sources\n        if (/\\.s3\\./.test(protoImg)) {\n          source = 's3';\n          const { bucket, keyPrefix } = FilePicker.parseS3URL(protoImg);\n          if (bucket) {\n            browseOptions.bucket = bucket;\n            protoImg = keyPrefix;\n          }\n        } else if (protoImg.startsWith('icons/')) source = 'public';\n\n        // Retrieve wildcard content\n        try {\n          const content = await FilePicker.browse(source, protoImg, browseOptions);\n          return content.files;\n        } catch (err) {\n          return [];\n        }\n      };\n\n      const wildcardImages = (await getTokenImages(actor))\n        .filter((img) => !img.includes('*') && (isImage(img) || isVideo(img)))\n        .map((variant) => {\n          return { path: variant, name: getFileName(variant) };\n        });\n      results.set('variants95436623', wildcardImages);\n    }\n  }\n\n  return results;\n}\n\n/**\n * Recursive image search through a directory\n * @param {*} path starting path\n * @param {*} options.apiKey ForgeVTT AssetLibrary API key\n * @param {*} found_images all the images found\n * @returns void\n */\nasync function walkFindImages(path, { apiKey = '' } = {}, found_images) {\n  let files = {};\n  if (!path.source) {\n    path.source = 'data';\n  }\n  const typeKey = path.types.sort().join(',');\n  try {\n    if (path.source.startsWith('s3:')) {\n      files = await FilePicker.browse('s3', path.text, {\n        bucket: path.source.replace('s3:', ''),\n      });\n    } else if (path.source.startsWith('forgevtt')) {\n      if (apiKey) {\n        const response = await callForgeVTT(path.text, apiKey);\n        files.files = response.files.map((f) => f.url);\n      } else {\n        files = await FilePicker.browse('forgevtt', path.text, { recursive: true });\n      }\n    } else if (path.source.startsWith('forge-bazaar')) {\n      files = await FilePicker.browse('forge-bazaar', path.text, { recursive: true });\n    } else if (path.source.startsWith('imgur')) {\n      await fetch('https://api.imgur.com/3/gallery/album/' + path.text, {\n        headers: {\n          Authorization: 'Client-ID ' + (TVA_CONFIG.imgurClientId ? TVA_CONFIG.imgurClientId : 'df9d991443bb222'),\n          Accept: 'application/json',\n        },\n      })\n        .then((response) => response.json())\n        .then(async function (result) {\n          if (!result.success) {\n            return;\n          }\n          result.data.images.forEach((img) => {\n            const rtName = img.title ?? img.description ?? getFileName(img.link);\n            _addToFound({ path: decodeURISafely(img.link), name: rtName }, typeKey, found_images);\n          });\n        })\n        .catch((error) => console.warn('TVA |', error));\n      return;\n    } else if (path.source.startsWith('rolltable')) {\n      const table = game.tables.contents.find((t) => t.name === path.text);\n      if (!table) {\n        const rollTableName = path.text;\n        ui.notifications.warn(\n          game.i18n.format('token-variants.notifications.warn.invalid-table', {\n            rollTableName,\n          })\n        );\n      } else {\n        for (let baseTableData of table.results) {\n          const rtPath = baseTableData.img;\n          const rtName = baseTableData.text || getFileName(rtPath);\n          _addToFound({ path: decodeURISafely(rtPath), name: rtName }, typeKey, found_images);\n        }\n      }\n      return;\n    } else if (path.source.startsWith('json')) {\n      await fetch(path.text, {\n        headers: {\n          Accept: 'application/json',\n        },\n      })\n        .then((response) => response.json())\n        .then(async function (result) {\n          if (!result.length > 0) {\n            return;\n          }\n          result.forEach((img) => {\n            const rtName = img.name ?? getFileName(img.path);\n            _addToFound({ path: decodeURISafely(img.path), name: rtName, tags: img.tags }, typeKey, found_images);\n          });\n        })\n        .catch((error) => console.warn('TVA |', error));\n      return;\n    } else {\n      files = await FilePicker.browse(path.source, path.text);\n    }\n  } catch (err) {\n    console.warn(\n      `TVA | ${game.i18n.localize('token-variants.notifications.warn.path-not-found')} ${path.source}:${path.text}`\n    );\n    return;\n  }\n\n  if (files.target == '.') return;\n\n  if (files.files) {\n    files.files.forEach((tokenSrc) => {\n      _addToFound({ path: decodeURISafely(tokenSrc), name: getFileName(tokenSrc) }, typeKey, found_images);\n    });\n  }\n\n  // ForgeVTT requires special treatment\n  // Bazaar paths fail recursive search if one level above root\n  if (path.source.startsWith('forgevtt')) return;\n  else if (\n    path.source.startsWith('forge-bazaar') &&\n    !['modules', 'systems', 'worlds', 'assets'].includes(path.text.replaceAll(/[\\/\\\\]/g, ''))\n  ) {\n    return;\n  }\n\n  for (let f_dir of files.dirs) {\n    await walkFindImages({ text: f_dir, source: path.source, types: path.types }, { apiKey: apiKey }, found_images);\n  }\n}\n\nfunction _addToFound(img, typeKey, found_images) {\n  if (isImage(img.path) || isVideo(img.path)) {\n    if (found_images[typeKey] == null) {\n      found_images[typeKey] = [img];\n    } else {\n      found_images[typeKey].push(img);\n    }\n  }\n}\n\n/**\n * Recursive walks through all paths exposed to the module and caches them\n * @param {*} searchType\n * @returns\n */\nasync function walkAllPaths(searchType) {\n  const found_images = {};\n  const paths = _filterPathsByType(TVA_CONFIG.searchPaths, searchType);\n\n  for (const path of paths) {\n    if ((path.cache && caching) || (!path.cache && !caching)) await walkFindImages(path, {}, found_images);\n  }\n\n  // ForgeVTT specific path handling\n  const userId = typeof ForgeAPI !== 'undefined' ? await ForgeAPI.getUserId() : '';\n  for (const uid in TVA_CONFIG.forgeSearchPaths) {\n    const apiKey = TVA_CONFIG.forgeSearchPaths[uid].apiKey;\n    const paths = _filterPathsByType(TVA_CONFIG.forgeSearchPaths[uid].paths, searchType);\n    if (uid === userId) {\n      for (const path of paths) {\n        if ((path.cache && caching) || (!path.cache && !caching)) await walkFindImages(path, {}, found_images);\n      }\n    } else if (apiKey) {\n      for (const path of paths) {\n        if ((path.cache && caching) || (!path.cache && !caching)) {\n          if (path.share) await walkFindImages(path, { apiKey: apiKey }, found_images);\n        }\n      }\n    }\n  }\n\n  return found_images;\n}\n\nfunction _filterPathsByType(paths, searchType) {\n  if (!searchType) return paths;\n  return paths.filter((p) => p.types.includes(searchType));\n}\n\nexport async function findImagesFuzzy(name, searchType, searchOptions, forceSearchName = false) {\n  if (TVA_CONFIG.debug)\n    console.info('TVA | STARTING: Fuzzy Image Search', name, searchType, searchOptions, forceSearchName);\n\n  const filters = getFilters(searchType, searchOptions.searchFilters);\n\n  const fuse = new Fuse([], {\n    keys: [!forceSearchName && searchOptions.runSearchOnPath ? 'path' : 'name', 'tags'],\n    includeScore: true,\n    includeMatches: true,\n    minMatchCharLength: 1,\n    ignoreLocation: true,\n    threshold: searchOptions.algorithm.fuzzyThreshold,\n  });\n\n  const found_images = await walkAllPaths(searchType);\n\n  for (const container of [CACHED_IMAGES, found_images]) {\n    for (const typeKey in container) {\n      const types = typeKey.split(',');\n      if (types.includes(searchType)) {\n        for (const imgObj of container[typeKey]) {\n          if (_imagePassesFilter(imgObj.name, imgObj.path, filters, searchOptions.runSearchOnPath)) {\n            fuse.add(imgObj);\n          }\n        }\n      }\n    }\n  }\n\n  let results;\n  if (name === '') {\n    results = fuse.getIndex().docs.slice(0, searchOptions.algorithm.fuzzyLimit);\n  } else {\n    results = fuse.search(name).slice(0, searchOptions.algorithm.fuzzyLimit);\n    results = results.map((r) => {\n      r.item.indices = r.matches[0].indices;\n      r.item.score = r.score;\n      return r.item;\n    });\n  }\n\n  if (TVA_CONFIG.debug) console.info('TVA | ENDING: Fuzzy Image Search', results);\n\n  return results;\n}\n\nasync function findImagesExact(name, searchType, searchOptions) {\n  if (TVA_CONFIG.debug) console.info('TVA | STARTING: Exact Image Search', name, searchType, searchOptions);\n\n  const found_images = await walkAllPaths(searchType);\n\n  const simpleName = simplifyName(name);\n  const filters = getFilters(searchType, searchOptions.searchFilters);\n\n  const matchedImages = [];\n\n  for (const container of [CACHED_IMAGES, found_images]) {\n    for (const typeKey in container) {\n      const types = typeKey.split(',');\n      if (types.includes(searchType)) {\n        for (const imgOBj of container[typeKey]) {\n          if (_exactSearchMatchesImage(simpleName, imgOBj.path, imgOBj.name, filters, searchOptions.runSearchOnPath)) {\n            matchedImages.push(imgOBj);\n          }\n        }\n      }\n    }\n  }\n\n  if (TVA_CONFIG.debug) console.info('TVA | ENDING: Exact Image Search', matchedImages);\n  return matchedImages;\n}\n\nasync function findImages(name, searchType = '', searchOptions = {}) {\n  const sOptions = foundry.utils.mergeObject(searchOptions, getSearchOptions(), { overwrite: false });\n  if (sOptions.algorithm.exact) {\n    return await findImagesExact(name, searchType, sOptions);\n  } else {\n    return await findImagesFuzzy(name, searchType, sOptions);\n  }\n}\n\n/**\n * Checks if image path and name match the provided search text and filters\n * @param imagePath image path\n * @param imageName image name\n * @param filters filters to be applied\n * @returns true|false\n */\nfunction _exactSearchMatchesImage(simplifiedSearch, imagePath, imageName, filters, runSearchOnPath) {\n  // Is the search text contained in the name/path\n  const simplified = runSearchOnPath ? simplifyPath(imagePath) : simplifyName(imageName);\n  if (!simplified.includes(simplifiedSearch)) {\n    return false;\n  }\n\n  if (!filters) return true;\n  return _imagePassesFilter(imageName, imagePath, filters, runSearchOnPath);\n}\n\nfunction _imagePassesFilter(imageName, imagePath, filters, runSearchOnPath) {\n  // Filters are applied to path depending on the 'runSearchOnPath' setting, and actual or custom rolltable name\n  let text;\n  if (runSearchOnPath) {\n    text = decodeURIComponentSafely(imagePath);\n  } else if (getFileName(imagePath) === imageName) {\n    text = getFileNameWithExt(imagePath);\n  } else {\n    text = imageName;\n  }\n\n  if (filters.regex) {\n    return filters.regex.test(text);\n  }\n  if (filters.include) {\n    if (!text.includes(filters.include)) return false;\n  }\n  if (filters.exclude) {\n    if (text.includes(filters.exclude)) return false;\n  }\n  return true;\n}\n\n// ===================================\n// ==== CACHING RELATED FUNCTIONS ====\n// ===================================\n\nexport async function saveCache(cacheFile) {\n  const data = {};\n\n  const caches = Object.keys(CACHED_IMAGES);\n  for (const c of caches) {\n    if (!(c in data)) data[c] = [];\n    for (const img of CACHED_IMAGES[c]) {\n      if (img.tags) {\n        data[c].push([img.path, img.name, img.tags]);\n      } else if (getFileName(img.path) === img.name) {\n        data[c].push(img.path);\n      } else {\n        data[c].push([img.path, img.name]);\n      }\n    }\n  }\n\n  let file = new File([JSON.stringify(data)], getFileNameWithExt(cacheFile), {\n    type: 'text/plain',\n  });\n  FilePicker.upload('data', getFilePath(cacheFile), file);\n}\n\n/**\n * Search for and cache all the found token art\n */\nexport async function cacheImages({\n  staticCache = TVA_CONFIG.staticCache,\n  staticCacheFile = TVA_CONFIG.staticCacheFile,\n} = {}) {\n  if (caching) return;\n  caching = true;\n\n  if (!isInitialized() && staticCache) {\n    if (await _readCacheFromFile(staticCacheFile)) {\n      caching = false;\n      return;\n    }\n  }\n\n  if (!TVA_CONFIG.disableNotifs)\n    ui.notifications.info(game.i18n.format('token-variants.notifications.info.caching-started'));\n\n  if (TVA_CONFIG.debug) console.info('TVA | STARTING: Token Caching');\n  const found_images = await walkAllPaths();\n  CACHED_IMAGES = found_images;\n\n  if (TVA_CONFIG.debug) console.info('TVA | ENDING: Token Caching');\n\n  caching = false;\n  if (!TVA_CONFIG.disableNotifs)\n    ui.notifications.info(\n      game.i18n.format('token-variants.notifications.info.caching-finished', {\n        imageCount: Object.keys(CACHED_IMAGES).reduce((count, types) => count + CACHED_IMAGES[types].length, 0),\n      })\n    );\n\n  if (staticCache && game.user.isGM) {\n    saveCache(staticCacheFile);\n  }\n}\n\nasync function _readCacheFromFile(fileName) {\n  CACHED_IMAGES = {};\n  try {\n    await jQuery.getJSON(fileName, (json) => {\n      for (let category in json) {\n        CACHED_IMAGES[category] = [];\n\n        for (const img of json[category]) {\n          if (Array.isArray(img)) {\n            if (img.length === 3) {\n              CACHED_IMAGES[category].push({ path: img[0], name: img[1], tags: img[2] });\n            } else {\n              CACHED_IMAGES[category].push({ path: img[0], name: img[1] });\n            }\n          } else {\n            CACHED_IMAGES[category].push({ path: img, name: getFileName(img) });\n          }\n        }\n      }\n      if (!TVA_CONFIG.disableNotifs)\n        ui.notifications.info(\n          `Token Variant Art: Using Static Cache (${Object.keys(CACHED_IMAGES).reduce(\n            (count, c) => count + CACHED_IMAGES[c].length,\n            0\n          )} images)`\n        );\n    });\n  } catch (error) {\n    ui.notifications.warn(`Token Variant Art: Static Cache not found`);\n    CACHED_IMAGES = {};\n    return false;\n  }\n  return true;\n}\n","import { CORE_TEMPLATES } from \"../scripts/mappingTemplates.js\";\nimport { TVA_CONFIG, updateSettings } from \"../scripts/settings.js\";\nimport {\n  showMappingSelectDialog,\n  showUserTemplateCreateDialog,\n} from \"./dialogs.js\";\n\nexport class Templates extends FormApplication {\n  constructor({ mappings = null, callback = null } = {}) {\n    super({}, {});\n    this.mappings = mappings;\n    this.callback = callback;\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: \"token-variants-templates\",\n      classes: [\"sheet\"],\n      template:\n        \"modules/token-variants/token-variants/templates/templates.html\",\n      resizable: false,\n      minimizable: false,\n      title: \"Mapping Templates\",\n      width: 500,\n      height: \"auto\",\n    });\n  }\n\n  async getData(options) {\n    const data = super.getData(options);\n\n    if (!this.category)\n      this.category = TVA_CONFIG.templateMappings?.length ? \"user\" : \"core\";\n    if (this.category === \"user\") {\n      this.templates = TVA_CONFIG.templateMappings;\n    } else if (this.category === \"core\") {\n      this.templates = CORE_TEMPLATES;\n    } else {\n      this.templates = await communityTemplates();\n    }\n\n    for (const template of this.templates) {\n      template.hint = template.hint?.replace(/(\\r\\n|\\n|\\r)/gm, \"<br>\");\n    }\n\n    data.category = this.category;\n    data.templates = this.templates;\n    data.allowDelete = this.category === \"user\";\n    data.allowCreate = this.category === \"user\";\n    data.allowCopy = this.category === \"community\" || this.category === \"core\";\n\n    return data;\n  }\n\n  /**\n   * @param {JQuery} html\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    // Position tooltip\n    const appWindow = html.closest(\"#token-variants-templates\");\n    html.querySelector(\".template\").on(\"mouseover\", (event) => {\n      const template = event.target.closest(\".template\");\n      const pos = template.position();\n      const tooltip = template.find(\".tooltiptext\");\n      const windowPos = appWindow.position();\n      tooltip\n        .css(\"top\", windowPos.top + pos.top)\n        .css(\"left\", windowPos.left + pos.left);\n\n      // Lazy load image\n      const img = template.find(\"img\");\n      if (!img.attr(\"src\")) img.attr(\"src\", img.data(\"src\"));\n    });\n\n    if (this.callback) {\n      html.querySelector(\".template\").on(\"click\", async (event) => {\n        const li = event.target.closest(\".template\");\n        const id = li.data(\"id\");\n        const url = li.data(\"url\");\n        let mappings;\n        let templateName;\n        if (url) {\n          const template = await getTemplateFromFileURL(url);\n          if (template) mappings = template.mappings;\n        } else if (id) {\n          const template = this.templates.find((t) => t.id === id);\n          if (template) {\n            templateName = template.name;\n            mappings = template.mappings;\n          }\n        }\n\n        if (mappings) this.callback(templateName, mappings);\n      });\n    }\n\n    html.querySelector(\".search\").on(\"input\", () => {\n      const filter = html.querySelector(\".search\").val().trim().toLowerCase();\n      html.querySelector(\".template-list li\").each(function () {\n        const li = this;\n        const description = li.find(\".description\").text().trim().toLowerCase();\n        const name = li.data(\"name\").trim().toLowerCase();\n        const createdBy = li.data(\"creator\").trim().toLowerCase();\n        if (\n          name.includes(filter) ||\n          description.includes(filter) ||\n          createdBy.includes(filter)\n        )\n          li.show();\n        else li.hide();\n      });\n    });\n\n    html.querySelector('[name=\"category\"]').on(\"change\", (event) => {\n      this.category = event.target.value;\n      this.render(true);\n    });\n\n    html.querySelector(\".delete\").on(\"click\", async (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      const id = event.target.closest(\".template\").data(\"id\");\n      if (id) {\n        await updateSettings({\n          templateMappings: TVA_CONFIG.templateMappings.filter(\n            (m) => m.id !== id,\n          ),\n        });\n        this.render(true);\n      }\n    });\n\n    html.querySelector(\".copy\").on(\"click\", async (event) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      const id = event.target.closest(\".template\").data(\"id\");\n      if (id) {\n        let template;\n        if (this.category === \"core\") {\n          template = foundry.utils.deepClone(\n            CORE_TEMPLATES.find((t) => t.id === id),\n          );\n        } else {\n          const fileURL = event.target.closest(\".template\").data(\"url\");\n          if (fileURL) template = await getTemplateFromFileURL(fileURL);\n        }\n\n        if (template) {\n          TVA_CONFIG.templateMappings.push(template);\n          await updateSettings({\n            templateMappings: TVA_CONFIG.templateMappings,\n          });\n          ui.notifications.info(\n            `Template {${template.name}} copied to User templates.`,\n          );\n          this.render(true);\n        }\n      }\n    });\n\n    html.querySelector(\".create\").on(\"click\", () => {\n      showMappingSelectDialog(this.mappings, {\n        title1: \"Create Template\",\n        callback: (selectedMappings) => {\n          if (selectedMappings?.length)\n            showUserTemplateCreateDialog(selectedMappings);\n        },\n      });\n    });\n  }\n\n  _getHeaderButtons() {\n    const buttons = super._getHeaderButtons();\n    buttons.unshift({\n      label: \"Upload Template\",\n      class: \".token-variants-submit-template\",\n      icon: \"fa-solid fa-cloud-arrow-up\",\n      onclick: () => {\n        new TemplateSubmissionForm().render(true);\n      },\n    });\n    return buttons;\n  }\n\n  /**\n   * @param {Event} event\n   * @param {Object} formData\n   */\n  async _updateObject(event, formData) {}\n}\n\nclass TemplateSubmissionForm extends FormApplication {\n  constructor() {\n    super({}, {});\n  }\n\n  static apiKey = \"AIzaSyCJpwIkpjrG10jaHwcpllvSChxRPawcMXE\";\n\n  static get pk() {\n    const k2 = \"AIzaSyCJpw\";\n    const k1 = \"IkpjrG10jaHwcpllv\";\n    const k3 = \"SChxRPawcMXE\";\n    return k2 + k1 + k3;\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: \"token-variants-template-submission\",\n      classes: [\"sheet\"],\n      template:\n        \"modules/token-variants/token-variants/templates/templateSubmission.html\",\n      resizable: true,\n      minimizable: false,\n      closeOnSubmit: false,\n      title: \"Upload Template\",\n      width: 500,\n      height: \"auto\",\n    });\n  }\n\n  async getData(options) {\n    const data = super.getData(options);\n\n    data.systemID = game.system.id;\n    data.systemTitle = game.system.title;\n    data.templates = TVA_CONFIG.templateMappings;\n\n    data.modules = game.modules\n      .filter((m) => m.active)\n      .map((m) => {\n        return { id: m.name, name: m.title };\n      });\n\n    return data;\n  }\n\n  /**\n   * @param {Event} event\n   * @param {Object} formData\n   */\n  async _updateObject(event, formData) {\n    if (!formData.template) return;\n    let template = TVA_CONFIG.templateMappings.find(\n      (t) => t.id === formData.template,\n    );\n    if (!template) return;\n\n    const name = formData.name.trim() || template.name;\n    const hint = formData.hint.trim() || template.hint?.trim();\n    const createdBy = formData.createdBy.trim();\n    const system = formData.system;\n\n    if (!(formData.modules instanceof Array))\n      formData.modules = [formData.modules];\n    const modules = formData.modules.filter(Boolean).map((id) => {\n      return { id, name: game.modules.get(id).title };\n    });\n\n    const id = foundry.utils.randomID();\n    const img = formData.img.trim();\n\n    const result = await submitTemplate({\n      id,\n      name,\n      hint,\n      img,\n      createdBy,\n      system,\n      modules,\n      mappings: template.mappings,\n    });\n    if (result) this.close();\n  }\n}\n\nfunction _setStringField(template, fields, field) {\n  if (template[field] && template[field] !== \"\") {\n    fields[field] = { stringValue: template[field] };\n  }\n}\n\nasync function submitTemplate(template) {\n  const fields = {};\n  [\"name\", \"hint\", \"img\", \"id\", \"createdBy\", \"system\"].forEach((field) =>\n    _setStringField(template, fields, field),\n  );\n  fields.modules = {\n    stringValue: template.modules.length\n      ? JSON.stringify(template.modules)\n      : \"\",\n  };\n  fields.mappings = { stringValue: JSON.stringify(template.mappings) };\n  fields.createTime = { integerValue: new Date().getTime() };\n  fields.approved = { booleanValue: false };\n\n  const response = await fetch(\n    `https://firestore.googleapis.com/v1/projects/tva---templates/databases/(default)/documents/templates?key=${TemplateSubmissionForm.pk}`,\n    {\n      method: \"POST\",\n      body: JSON.stringify({\n        fields: fields,\n      }),\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\",\n      },\n    },\n  );\n\n  if (response.ok && response.status === 200) {\n    ui.notifications.info(\"Template submission completed.\");\n    return true;\n  } else {\n    ui.notifications.warn(\"Template submission failed.\");\n    return false;\n  }\n}\n\nconst SEARCH_QUERY = {\n  structuredQuery: {\n    select: {\n      fields: [\n        {\n          fieldPath: \"id\",\n        },\n        {\n          fieldPath: \"name\",\n        },\n        {\n          fieldPath: \"hint\",\n        },\n        {\n          fieldPath: \"createdBy\",\n        },\n        {\n          fieldPath: \"img\",\n        },\n        {\n          fieldPath: \"system\",\n        },\n        {\n          fieldPath: \"modules\",\n        },\n      ],\n    },\n    where: {\n      fieldFilter: {\n        field: {\n          fieldPath: \"approved\",\n        },\n        op: \"EQUAL\",\n        value: {\n          booleanValue: true,\n        },\n      },\n    },\n    from: [{ collectionId: \"templates\" }],\n    orderBy: [\n      {\n        field: {\n          fieldPath: \"createTime\",\n        },\n      },\n    ],\n    offset: 0,\n    limit: 50,\n  },\n};\n\nasync function communityTemplates(search = null) {\n  const response = await fetch(\n    `https://firestore.googleapis.com/v1/projects/tva---templates/databases/(default)/documents:runQuery?key=${TemplateSubmissionForm.pk}`,\n    {\n      method: \"POST\",\n      body: JSON.stringify(SEARCH_QUERY),\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\",\n      },\n    },\n  );\n\n  const templates = [];\n  if (response.ok && response.status === 200) {\n    const documents = await response.json();\n\n    for (let doc of documents) {\n      if (\"document\" in doc) templates.push(_docToTemplate(doc.document));\n    }\n  } else {\n    ui.notifications.warn(\"Failed to retrieve Community templates.\");\n  }\n  return templates;\n}\n\nfunction _docToTemplate(doc) {\n  const template = {};\n  [\n    \"id\",\n    \"name\",\n    \"mappings\",\n    \"createdBy\",\n    \"img\",\n    \"hint\",\n    \"system\",\n    \"modules\",\n  ].forEach((f) => {\n    template[f] = doc.fields[f]?.stringValue || \"\";\n  });\n  if (template.mappings) template.mappings = JSON.parse(template.mappings);\n  else template.fileURL = doc.name;\n\n  if (template.modules) template.modules = JSON.parse(template.modules);\n\n  if (!template.createdBy) template.createdBy = \"Anonymous\";\n  return template;\n}\n\nasync function getTemplateFromFileURL(fileURL) {\n  const response = await fetch(\n    `https://firestore.googleapis.com/v1/${fileURL}?key=${TemplateSubmissionForm.pk}`,\n    {\n      method: \"GET\",\n      headers: {\n        Accept: \"application/json\",\n        \"Content-Type\": \"application/json\",\n      },\n    },\n  );\n\n  if (response.ok && response.status === 200) {\n    const doc = await response.json();\n    return _docToTemplate(doc);\n  }\n  return null;\n}\n","import { TVA_CONFIG, updateSettings } from \"../scripts/settings.js\";\nimport {\n  showPathSelectCategoryDialog,\n  showPathSelectConfigForm,\n} from \"./dialogs.js\";\n\nexport class ForgeSearchPaths extends FormApplication {\n  constructor() {\n    super({}, {});\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: \"token-variants-search-paths\",\n      classes: [\"sheet\"],\n      template:\n        \"modules/token-variants/token-variants/templates/forgeSearchPaths.html\",\n      resizable: true,\n      minimizable: false,\n      closeOnSubmit: false,\n      title: game.i18n.localize(\"token-variants.settings.search-paths.Name\"),\n      width: 592,\n      height: \"auto\",\n      scrollY: [\"ol.token-variant-table\"],\n      dragDrop: [{ dragSelector: null, dropSelector: null }],\n    });\n  }\n\n  async getData(options) {\n    if (!this.object.paths) this.object.paths = await this._getPaths();\n\n    const paths = this.object.paths.map((path) => {\n      const r = {};\n      r.text = path.text;\n      r.cache = path.cache;\n      r.share = path.share;\n      r.types = path.types.join(\",\");\n      r.config = JSON.stringify(path.config ?? {});\n      return r;\n    });\n\n    const data = super.getData(options);\n    data.paths = paths;\n    data.apiKey = this.apiKey;\n    return data;\n  }\n\n  async _getPaths() {\n    const forgePaths =\n      foundry.utils.deepClone(TVA_CONFIG.forgeSearchPaths) || {};\n    this.userId =\n      typeof ForgeAPI !== \"undefined\" ? await ForgeAPI.getUserId() : \"tempUser\"; // TODO\n    this.apiKey = forgePaths[this.userId]?.apiKey;\n    return forgePaths[this.userId]?.paths || [];\n  }\n\n  /**\n   * @param {JQuery} html\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.querySelector(\"a.create-path\").click(this._onCreatePath.bind(this));\n    html.on(\n      \"click\",\n      \"a.select-category\",\n      showPathSelectCategoryDialog.bind(this),\n    );\n    html.on(\"click\", \"a.select-config\", showPathSelectConfigForm.bind(this));\n    html.querySelector(\"a.delete-path\").click(this._onDeletePath.bind(this));\n    html.querySelector(\"button.reset\").click(this._onReset.bind(this));\n    html.querySelector(\"button.update\").click(this._onUpdate.bind(this));\n    html.on(\n      \"click\",\n      \".path-image.source-icon a\",\n      this._onBrowseFolder.bind(this),\n    );\n  }\n\n  /**\n   * Open a FilePicker so the user can select a local folder to use as an image source\n   */\n  async _onBrowseFolder(event) {\n    const pathInput = event.target\n      .closest(\".table-row\")\n      .find(\".path-text input\");\n\n    new FilePicker({\n      type: \"folder\",\n      activeSource: \"forgevtt\",\n      current: pathInput.val(),\n      callback: (path, fp) => {\n        if (fp.activeSource !== \"forgevtt\") {\n          ui.notifications.warn(\n            \"Token Variant Art: Only 'Assets Library' paths are supported\",\n          );\n        } else {\n          pathInput.val(fp.result.target);\n        }\n      },\n    }).render(true);\n  }\n\n  async _onCreatePath(event) {\n    event.preventDefault();\n    await this._onSubmit(event);\n\n    this.object.paths.push({\n      text: \"\",\n      cache: true,\n      share: true,\n      types: [\"Portrait\", \"Token\", \"PortraitAndToken\"],\n    });\n    this.render();\n  }\n\n  async _onDeletePath(event) {\n    event.preventDefault();\n    await this._onSubmit(event);\n\n    const li = event.currentTarget.closest(\".table-row\");\n    this.object.paths.splice(li.dataset.index, 1);\n    this.render();\n  }\n\n  _onReset(event) {\n    event.preventDefault();\n    this.object.paths = this._getPaths();\n    this.render();\n  }\n\n  async _onUpdate(event) {\n    event.preventDefault();\n    await this._onSubmit(event);\n    this._updatePaths();\n  }\n\n  async _updateObject(event, formData) {\n    const expanded = foundry.utils.expandObject(formData);\n    expanded.paths = expanded.hasOwnProperty(\"paths\")\n      ? Object.values(expanded.paths)\n      : [];\n    expanded.paths.forEach((path, index) => {\n      this.object.paths[index] = {\n        text: path.text,\n        cache: path.cache,\n        share: path.share,\n        source: path.source,\n        types: path.types.split(\",\"),\n      };\n      if (path.config) {\n        try {\n          path.config = JSON.parse(path.config);\n          if (!foundry.utils.isEmpty(path.config)) {\n            this.object.paths[index].config = path.config;\n          }\n        } catch (e) {}\n      }\n    });\n    this.apiKey = expanded.apiKey;\n  }\n\n  _cleanPaths() {\n    // Cleanup empty and duplicate paths\n    let uniquePaths = new Set();\n    let paths = this.object.paths.filter((path) => {\n      if (!path.text || uniquePaths.has(path.text)) return false;\n      uniquePaths.add(path.text);\n      return true;\n    });\n    return paths;\n  }\n\n  _updatePaths() {\n    if (this.userId) {\n      const forgePaths =\n        foundry.utils.deepClone(TVA_CONFIG.forgeSearchPaths) || {};\n      forgePaths[this.userId] = {\n        paths: this._cleanPaths(),\n        apiKey: this.apiKey,\n      };\n\n      if (game.user.isGM) {\n        updateSettings({ forgeSearchPaths: forgePaths });\n      } else {\n        // Workaround for forgeSearchPaths setting to be updated by non-GM clients\n        const message = {\n          handlerName: \"forgeSearchPaths\",\n          args: forgePaths,\n          type: \"UPDATE\",\n        };\n        game.socket?.emit(\"module.token-variants\", message);\n      }\n    }\n  }\n\n  async close(options = {}) {\n    await this._onSubmit(event);\n    this._updatePaths();\n    return super.close(options);\n  }\n}\n","import { TVA_CONFIG } from '../scripts/settings.js';\n\nexport default class TokenHUDClientSettings extends FormApplication {\n  constructor() {\n    super({}, { title: `Token HUD Settings` });\n  }\n\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: 'token-variants-hud-settings',\n      classes: ['sheet'],\n      template: 'modules/token-variants/token-variants/templates/tokenHUDClientSettings.html',\n      resizable: false,\n      minimizable: false,\n      title: '',\n      width: 500,\n    });\n  }\n\n  async getData(options) {\n    const data = super.getData(options);\n    return foundry.utils.mergeObject(data, TVA_CONFIG.hud);\n  }\n\n  /**\n   * @param {Event} event\n   * @param {Object} formData\n   */\n  async _updateObject(event, formData) {\n    game.settings.set('token-variants', 'hudSettings', foundry.utils.mergeObject(TVA_CONFIG.hud, formData));\n  }\n}\n","import { importSettingsFromJSON, exportSettingsToJSON } from '../scripts/settings.js';\n\nexport default class ImportExport extends FormApplication {\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      id: 'token-variants-import-export',\n      classes: ['sheet'],\n      template: 'modules/token-variants/token-variants/templates/importExport.html',\n      resizable: false,\n      minimizable: false,\n      title: 'Import/Export',\n      width: 250,\n    });\n  }\n\n  /**\n   * @param {JQuery} html\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.querySelector('.import').click(this._importFromJSONDialog.bind(this));\n    html.querySelector('.export').click(() => {\n      exportSettingsToJSON();\n      this.close();\n    });\n  }\n\n  async _importFromJSONDialog() {\n    const content = await renderTemplate('templates/apps/import-data.html', {\n      entity: 'token-variants',\n      name: 'settings',\n    });\n    let dialog = new Promise((resolve, reject) => {\n      new Dialog(\n        {\n          title: game.i18n.localize('token-variants.settings.import-export.window.import-dialog'),\n          content: content,\n          buttons: {\n            import: {\n              icon: '<i class=\"fas fa-file-import\"></i>',\n              label: game.i18n.localize('token-variants.common.import'),\n              callback: (html) => {\n                const form = html.querySelector('form')[0];\n                if (!form.data.files.length) return ui.notifications?.error('You did not upload a data file!');\n                readTextFromFile(form.data.files[0]).then((json) => {\n                  importSettingsFromJSON(json);\n                  resolve(true);\n                });\n              },\n            },\n            no: {\n              icon: '<i class=\"fas fa-times\"></i>',\n              label: 'Cancel',\n              callback: (html) => resolve(false),\n            },\n          },\n          default: 'import',\n        },\n        {\n          width: 400,\n        }\n      ).render(true);\n    });\n    this.close();\n    return await dialog;\n  }\n}\n","import { BASE_IMAGE_CATEGORIES, userRequiresImageCache, waitForTokenTexture } from './utils.js';\nimport { ForgeSearchPaths } from '../applications/forgeSearchPaths.js';\nimport TokenHUDClientSettings from '../applications/tokenHUDClientSettings.js';\nimport CompendiumMapConfig from '../applications/compendiumMap.js';\nimport ImportExport from '../applications/importExport.js';\nimport ConfigureSettings from '../applications/configureSettings.js';\nimport { cacheImages, saveCache } from './search.js';\nimport { registerAllHooks } from './hooks/hooks.js';\nimport { registerAllWrappers } from './wrappers/wrappers.js';\n\nexport const TVA_CONFIG = {\n  debug: false,\n  disableNotifs: false,\n  searchPaths: [\n    {\n      text: 'modules/caeora-maps-tokens-assets/assets/tokens',\n      cache: true,\n      source: typeof ForgeAPI === 'undefined' ? 'data' : 'forge-bazaar',\n      types: ['Portrait', 'Token', 'PortraitAndToken'],\n    },\n  ],\n  forgeSearchPaths: {},\n  worldHud: {\n    displayOnlySharedImages: false,\n    disableIfTHWEnabled: false,\n    includeKeywords: false,\n    updateActorImage: false,\n    useNameSimilarity: false,\n    includeWildcard: true,\n    showFullPath: false,\n    animate: true,\n  },\n  hud: {\n    enableSideMenu: true,\n    displayAsImage: true,\n    imageOpacity: 50,\n  },\n  keywordSearch: true,\n  excludedKeywords: 'and,for',\n  runSearchOnPath: false,\n  searchFilters: {},\n  algorithm: {\n    exact: false,\n    fuzzy: true,\n    fuzzyLimit: 100,\n    fuzzyThreshold: 0.3,\n    fuzzyArtSelectPercentSlider: true,\n  },\n  tokenConfigs: [],\n  randomizer: {\n    actorCreate: false,\n    tokenCreate: false,\n    tokenCopyPaste: false,\n    tokenName: true,\n    keywords: false,\n    shared: false,\n    wildcard: false,\n    representedActorDisable: false,\n    linkedActorDisable: true,\n    popupOnDisable: false,\n    diffImages: false,\n    syncImages: false,\n    nonRepeat: false,\n  },\n  popup: {\n    disableAutoPopupOnActorCreate: true,\n    disableAutoPopupOnTokenCreate: true,\n    disableAutoPopupOnTokenCopyPaste: true,\n    twoPopups: false,\n    twoPopupsNoDialog: false,\n  },\n  imgurClientId: '',\n  stackStatusConfig: true,\n  mergeGroup: false,\n  staticCache: false,\n  staticCacheFile: 'modules/token-variants/token-variants-cache.json',\n  tilesEnabled: true,\n  compendiumMapper: {\n    missingOnly: false,\n    diffImages: false,\n    showImages: true,\n    cache: false,\n    autoDisplayArtSelect: true,\n    syncImages: false,\n    overrideCategory: false,\n    category: 'Token',\n    missingImages: [{ document: 'all', image: CONST.DEFAULT_TOKEN }],\n    searchOptions: {},\n  },\n  permissions: {\n    popups: {\n      1: false,\n      2: false,\n      3: true,\n      4: true,\n    },\n    portrait_right_click: {\n      1: false,\n      2: false,\n      3: true,\n      4: true,\n    },\n    image_path_button: {\n      1: false,\n      2: false,\n      3: true,\n      4: true,\n    },\n    hud: {\n      1: true,\n      2: true,\n      3: true,\n      4: true,\n    },\n    hudFullAccess: {\n      1: false,\n      2: false,\n      3: true,\n      4: true,\n    },\n    statusConfig: {\n      1: false,\n      2: false,\n      3: true,\n      4: true,\n    },\n  },\n  globalMappings: [],\n  templateMappings: [],\n  customImageCategories: [],\n  displayEffectIconsOnHover: false,\n  disableEffectIcons: false,\n  filterEffectIcons: false,\n  filterCustomEffectIcons: true,\n  filterIconList: [],\n  updateTokenProto: false,\n  imgNameContainsDimensions: false,\n  imgNameContainsFADimensions: false,\n  playVideoOnHover: true,\n  pauseVideoOnHoverOut: false,\n  disableImageChangeOnPolymorphed: false,\n  disableImageUpdateOnNonPrototype: false,\n  disableTokenUpdateAnimation: false,\n  evaluateOverlayOnHover: true,\n  invisibleImage: '',\n  systemHpPath: '',\n  internalEffects: {\n    hpChange: { enabled: false, duration: null },\n  },\n  hideElevationTooltip: false,\n  hideTokenBorder: false,\n};\n\nexport const FEATURE_CONTROL = {\n  EffectMappings: true,\n  EffectIcons: true,\n  Overlays: true,\n  UserMappings: true,\n  Wildcards: true,\n  PopUpAndRandomize: true,\n  HUD: true,\n  HideElement: true,\n};\n\nexport function registerSettings() {\n  game.settings.register('token-variants', 'featureControl', {\n    scope: 'world',\n    config: false,\n    type: Object,\n    default: FEATURE_CONTROL,\n    onChange: async (val) => {\n      foundry.utils.mergeObject(FEATURE_CONTROL, val);\n      registerAllHooks();\n      registerAllWrappers();\n    },\n  });\n  foundry.utils.mergeObject(FEATURE_CONTROL, game.settings.get('token-variants', 'featureControl'));\n\n  game.settings.registerMenu('token-variants', 'settings', {\n    name: 'Configure Settings',\n    hint: 'Configure Token Variant Art settings',\n    label: 'Settings',\n    scope: 'world',\n    icon: 'fas fa-cog',\n    type: ConfigureSettings,\n    restricted: true,\n  });\n\n  const systemHpPaths = {\n    'cyberpunk-red-core': 'derivedStats.hp',\n    lfg: 'health',\n    worldbuilding: 'health',\n    twodsix: 'hits',\n  };\n  TVA_CONFIG.systemHpPath = systemHpPaths[game.system.id] ?? 'attributes.hp';\n\n  game.settings.register('token-variants', 'effectMappingToggleGroups', {\n    scope: 'world',\n    config: false,\n    type: Object,\n    default: { Default: true },\n  });\n\n  game.settings.register('token-variants', 'settings', {\n    scope: 'world',\n    config: false,\n    type: Object,\n    default: TVA_CONFIG,\n    onChange: async (val) => {\n      // Generate a diff, it will be required when doing post-processing of the modified settings\n      const diff = _arrayAwareDiffObject(TVA_CONFIG, val);\n\n      // Check image re-cache required due to permission changes\n      let requiresImageCache = false;\n      if ('permissions' in diff) {\n        if (!userRequiresImageCache(TVA_CONFIG.permissions) && userRequiresImageCache(val.permissions))\n          requiresImageCache = true;\n      }\n\n      // Update live settings\n      foundry.utils.mergeObject(TVA_CONFIG, val);\n\n      if (TVA_CONFIG.filterEffectIcons && ('filterCustomEffectIcons' in diff || 'filterIconList' in diff)) {\n        for (const tkn of canvas.tokens.placeables) {\n          waitForTokenTexture(tkn, (token) => {\n            token.drawEffects();\n          });\n        }\n      }\n\n      // Check image re-cache required due to search path changes\n      if ('searchPaths' in diff || 'forgeSearchPaths' in diff) {\n        if (userRequiresImageCache(TVA_CONFIG.permissions)) requiresImageCache = true;\n      }\n\n      // Cache/re-cache images if necessary\n      if (requiresImageCache) {\n        await cacheImages();\n      }\n\n      if (diff.staticCache) {\n        const cacheFile = diff.staticCacheFile ? diff.staticCacheFile : TVA_CONFIG.staticCacheFile;\n        saveCache(cacheFile);\n      }\n\n      TVA_CONFIG.hud = game.settings.get('token-variants', 'hudSettings');\n\n      registerAllHooks();\n      registerAllWrappers();\n\n      if ('displayEffectIconsOnHover' in diff) {\n        for (const tkn of canvas.tokens.placeables) {\n          if (tkn.effects) tkn.effects.visible = !diff.displayEffectIconsOnHover;\n        }\n      }\n\n      if ('hideElevationTooltip' in diff) {\n        for (const tkn of canvas.tokens.placeables) {\n          if (tkn.tooltip) tkn.tooltip.text = tkn._getTooltipText();\n        }\n      }\n\n      if ('hideTokenBorder' in diff) {\n        for (const tkn of canvas.tokens.placeables) {\n          if (tkn.border) tkn.border.visible = !diff.hideTokenBorder;\n        }\n      }\n\n      if ('filterEffectIcons' in diff || 'disableEffectIcons' in diff) {\n        for (const tkn of canvas.tokens.placeables) {\n          tkn.drawEffects();\n        }\n      }\n    },\n  });\n\n  game.settings.register('token-variants', 'debug', {\n    scope: 'world',\n    config: false,\n    type: Boolean,\n    default: TVA_CONFIG.debug,\n    onChange: (val) => (TVA_CONFIG.debug = val),\n  });\n\n  if (typeof ForgeAPI !== 'undefined') {\n    game.settings.registerMenu('token-variants', 'forgeSearchPaths', {\n      name: game.i18n.localize('token-variants.settings.forge-search-paths.Name'),\n      hint: game.i18n.localize('token-variants.settings.forge-search-paths.Hint'),\n      icon: 'fas fa-search',\n      type: ForgeSearchPaths,\n      scope: 'client',\n      restricted: false,\n    });\n  }\n\n  game.settings.register('token-variants', 'tokenConfigs', {\n    scope: 'world',\n    config: false,\n    type: Array,\n    default: TVA_CONFIG.tokenConfigs,\n    onChange: (val) => (TVA_CONFIG.tokenConfigs = val),\n  });\n\n  game.settings.registerMenu('token-variants', 'tokenHUDSettings', {\n    name: game.i18n.localize('token-variants.settings.token-hud.Name'),\n    hint: game.i18n.localize('token-variants.settings.token-hud.Hint'),\n    scope: 'client',\n    icon: 'fas fa-images',\n    type: TokenHUDClientSettings,\n    restricted: false,\n  });\n\n  game.settings.registerMenu('token-variants', 'compendiumMapper', {\n    name: game.i18n.localize('token-variants.settings.compendium-mapper.Name'),\n    hint: game.i18n.localize('token-variants.settings.compendium-mapper.Hint'),\n    scope: 'world',\n    icon: 'fas fa-cogs',\n    type: CompendiumMapConfig,\n    restricted: true,\n  });\n\n  game.settings.register('token-variants', 'compendiumMapper', {\n    scope: 'world',\n    config: false,\n    type: Object,\n    default: TVA_CONFIG.compendiumMapper,\n    onChange: (val) => (TVA_CONFIG.compendiumMapper = val),\n  });\n\n  game.settings.register('token-variants', 'hudSettings', {\n    scope: 'client',\n    config: false,\n    type: Object,\n    default: TVA_CONFIG.hud,\n    onChange: (val) => (TVA_CONFIG.hud = val),\n  });\n\n  game.settings.registerMenu('token-variants', 'importExport', {\n    name: `Import/Export`,\n    hint: game.i18n.localize('token-variants.settings.import-export.Hint'),\n    scope: 'world',\n    icon: 'fas fa-toolbox',\n    type: ImportExport,\n    restricted: true,\n  });\n\n  // Read settings\n  const settings = game.settings.get('token-variants', 'settings');\n  foundry.utils.mergeObject(TVA_CONFIG, settings);\n\n  if (foundry.utils.isEmpty(TVA_CONFIG.searchFilters)) {\n    BASE_IMAGE_CATEGORIES.forEach((cat) => {\n      TVA_CONFIG.searchFilters[cat] = {\n        include: '',\n        exclude: '',\n        regex: '',\n      };\n    });\n  }\n\n  for (let uid in TVA_CONFIG.forgeSearchPaths) {\n    TVA_CONFIG.forgeSearchPaths[uid].paths = TVA_CONFIG.forgeSearchPaths[uid].paths.map((p) => {\n      if (!p.source) {\n        p.source = 'forgevtt';\n      }\n      if (!p.types) {\n        if (p.tiles) p.types = ['Tile'];\n        else p.types = ['Portrait', 'Token', 'PortraitAndToken'];\n      }\n      return p;\n    });\n  }\n\n  // 20/07/2023 Convert globalMappings to a new format\n  if (foundry.utils.getType(settings.globalMappings) === 'Object') {\n    Hooks.once('ready', () => {\n      TVA_CONFIG.globalMappings = migrateMappings(settings.globalMappings);\n      setTimeout(() => updateSettings({ globalMappings: TVA_CONFIG.globalMappings }), 10000);\n    });\n  }\n\n  // Read client settings\n  TVA_CONFIG.hud = game.settings.get('token-variants', 'hudSettings');\n}\n\nexport function migrateMappings(mappings, globalMappings = []) {\n  if (!mappings) return [];\n  if (foundry.utils.getType(mappings) === 'Object') {\n    let nMappings = [];\n    for (const [effect, mapping] of Object.entries(mappings)) {\n      if (!mapping.label) mapping.label = effect.replaceAll('¶', '.');\n      if (!mapping.expression) mapping.expression = effect.replaceAll('¶', '.');\n      if (!mapping.id) mapping.id = foundry.utils.randomID(8);\n      delete mapping.effect;\n      if (mapping.overlayConfig) mapping.overlayConfig.id = mapping.id;\n      delete mapping.overlayConfig?.effect;\n      nMappings.push(mapping);\n    }\n    // Convert parents to parentIDs\n    let combMappings = nMappings.concat(globalMappings);\n    for (const mapping of nMappings) {\n      if (mapping.overlayConfig?.parent) {\n        if (mapping.overlayConfig.parent === 'Token (Placeable)') {\n          mapping.overlayConfig.parentID = 'TOKEN';\n        } else {\n          const parent = combMappings.find((m) => m.label === mapping.overlayConfig.parent);\n          if (parent) mapping.overlayConfig.parentID = parent.id;\n          else mapping.overlayConfig.parentID = '';\n        }\n        delete mapping.overlayConfig.parent;\n      }\n    }\n    mappings = nMappings;\n  }\n  // If overlay enabled but no image, text, or shape is being rendered, assume that imgSrs if available should be\n  // used as the image\n  for (const m of mappings) {\n    if (m.overlay && m.overlayConfig) {\n      if (m.imgSrc && !m.overlayConfig.img && !m.overlayConfig.text?.text && !m.overlayConfig.shapes?.length) {\n        m.overlayConfig.img = m.imgSrc;\n        m.imgSrc = '';\n        m.imgName = '';\n      }\n    }\n  }\n  return mappings;\n}\n\nexport function getFlagMappings(object) {\n  if (!object) return [];\n  let doc = object.document ?? object;\n  const actorId = doc.actor?.id;\n  if (actorId) {\n    doc = game.actors.get(actorId);\n    if (!doc) return [];\n  }\n\n  // 23/07/2023\n  let mappings = doc.getFlag('token-variants', 'effectMappings') ?? [];\n  if (foundry.utils.getType(mappings) === 'Object') {\n    mappings = migrateMappings(mappings, TVA_CONFIG.globalMappings);\n    doc.setFlag('token-variants', 'effectMappings', mappings);\n  }\n  return mappings;\n}\n\nexport function exportSettingsToJSON() {\n  const settings = foundry.utils.deepClone(TVA_CONFIG);\n  const filename = `token-variants-settings.json`;\n  saveDataToFile(JSON.stringify(settings, null, 2), 'text/json', filename);\n}\n\nexport async function importSettingsFromJSON(json) {\n  if (typeof json === 'string') json = JSON.parse(json);\n\n  if (json.forgeSearchPaths)\n    for (let uid in json.forgeSearchPaths) {\n      json.forgeSearchPaths[uid].paths = json.forgeSearchPaths[uid].paths.map((p) => {\n        if (!p.source) {\n          p.source = 'forgevtt';\n        }\n        if (!p.types) {\n          if (p.tiles) p.types = ['Tile'];\n          else p.types = ['Portrait', 'Token', 'PortraitAndToken'];\n        }\n        return p;\n      });\n    }\n\n  // 09/07/2022 Convert filters to new format if old one is still in use\n  if (json.searchFilters && json.searchFilters.portraitFilterInclude != null) {\n    const filters = json.searchFilters;\n    json.searchFilters = {\n      Portrait: {\n        include: filters.portraitFilterInclude ?? '',\n        exclude: filters.portraitFilterExclude ?? '',\n        regex: filters.portraitFilterRegex ?? '',\n      },\n      Token: {\n        include: filters.tokenFilterInclude ?? '',\n        exclude: filters.tokenFilterExclude ?? '',\n        regex: filters.tokenFilterRegex ?? '',\n      },\n      PortraitAndToken: {\n        include: filters.generalFilterInclude ?? '',\n        exclude: filters.generalFilterExclude ?? '',\n        regex: filters.generalFilterRegex ?? '',\n      },\n    };\n    if (json.compendiumMapper) delete json.compendiumMapper.searchFilters;\n  }\n\n  // Global Mappings need special merge\n  if (json.globalMappings) {\n    const nMappings = migrateMappings(json.globalMappings);\n    for (const m of nMappings) {\n      const i = TVA_CONFIG.globalMappings.findIndex((mapping) => m.label === mapping.label);\n      if (i === -1) TVA_CONFIG.globalMappings.push(m);\n      else TVA_CONFIG.globalMappings[i] = m;\n    }\n    json.globalMappings = TVA_CONFIG.globalMappings;\n  }\n\n  updateSettings(json);\n}\n\nfunction _refreshFilters(filters, customCategories, updateTVAConfig = false) {\n  const categories = BASE_IMAGE_CATEGORIES.concat(customCategories ?? TVA_CONFIG.customImageCategories);\n  for (const filter in filters) {\n    if (!categories.includes(filter)) {\n      delete filters[filter];\n      if (updateTVAConfig) delete TVA_CONFIG.searchFilters[filter];\n    }\n  }\n  for (const category of customCategories) {\n    if (filters[category] == null) {\n      filters[category] = {\n        include: '',\n        exclude: '',\n        regex: '',\n      };\n    }\n  }\n}\n\nexport async function updateSettings(newSettings) {\n  const settings = foundry.utils.mergeObject(foundry.utils.deepClone(TVA_CONFIG), newSettings, { insertKeys: false });\n  // Custom image categories might have changed, meaning we may have filters that are no longer relevant\n  // or need to be added\n  if ('customImageCategories' in newSettings) {\n    _refreshFilters(settings.searchFilters, newSettings.customImageCategories, true);\n    if (settings.compendiumMapper?.searchOptions?.searchFilters != null) {\n      _refreshFilters(settings.compendiumMapper.searchOptions.searchFilters, newSettings.customImageCategories);\n      TVA_CONFIG.compendiumMapper.searchOptions.searchFilters = settings.compendiumMapper.searchOptions.searchFilters;\n    }\n  }\n  await game.settings.set('token-variants', 'settings', settings);\n}\n\nexport function _arrayAwareDiffObject(original, other, { inner = false } = {}) {\n  function _difference(v0, v1) {\n    let t0 = foundry.utils.getType(v0);\n    let t1 = foundry.utils.getType(v1);\n    if (t0 !== t1) return [true, v1];\n    if (t0 === 'Array') return [!_arrayEquality(v0, v1), v1];\n    if (t0 === 'Object') {\n      if (foundry.utils.isEmpty(v0) !== foundry.utils.isEmpty(v1)) return [true, v1];\n      let d = _arrayAwareDiffObject(v0, v1, { inner });\n      return [!foundry.utils.isEmpty(d), d];\n    }\n    return [v0 !== v1, v1];\n  }\n\n  // Recursively call the _difference function\n  return Object.keys(other).reduce((obj, key) => {\n    if (inner && !(key in original)) return obj;\n    let [isDifferent, difference] = _difference(original[key], other[key]);\n    if (isDifferent) obj[key] = difference;\n    return obj;\n  }, {});\n}\n\nfunction _arrayEquality(a1, a2) {\n  if (!(a2 instanceof Array) || a2.length !== a1.length) return false;\n  return a1.every((v, i) => {\n    if (foundry.utils.getType(v) === 'Object') return Object.keys(_arrayAwareDiffObject(v, a2[i])).length === 0;\n    return a2[i] === v;\n  });\n}\n\nexport function getSearchOptions() {\n  return {\n    keywordSearch: TVA_CONFIG.keywordSearch,\n    excludedKeywords: TVA_CONFIG.excludedKeywords,\n    runSearchOnPath: TVA_CONFIG.runSearchOnPath,\n    algorithm: TVA_CONFIG.algorithm,\n    searchFilters: TVA_CONFIG.searchFilters,\n  };\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(652);\n"],"names":["EditJsonConfig","FormApplication","constructor","config","callback","super","this","defaultOptions","foundry","utils","mergeObject","id","classes","template","resizable","minimizable","title","width","height","getData","options","data","hasConfig","Object","keys","length","JSON","stringify","activateListeners","html","on","_validateJSON","bind","e","key","shiftKey","preventDefault","start","selectionStart","end","selectionEnd","value","substring","querySelector","click","_onRemove","_onFormat","event","controls","target","closest","find","parse","expandObject","flag","prop","submit","val","_updateObject","formData","EditScriptConfig","script","hasScript","isEmpty","onApply","onRemove","macroOnApply","macroOnRemove","tmfxPreset","tmfxActive","game","modules","get","active","tmfxPresets","TokenMagic","getPresets","map","p","name","ceActive","ceEffect","apply","remove","ceEffects","dfreds","effectInterface","findEffects","ef","macros","m","close","forEach","k","trim","TOGGLED_GROUPS","NO_IMAGE","EffectMappingForm","token","globalMappings","createMapping","deepClone","filter","Boolean","objectToFlag","actors","actorId","settings","Default","closeOnSubmit","scrollY","scope","_processConfig","mapping","hasTokenConfig","flags","tv_script","randomID","label","expression","codeExp","hasCodeExp","highlightedExpression","highlightOperators","imgName","imgSrc","isVideo","priority","overlay","alwaysOn","tokens","tokensString","join","tokenIDs","disabled","overlayConfig","targetActors","group","parentID","mappings","object","effectMappings","push","_getNewEffectConfig","sort","m1","m2","priorityDiff","localeCompare","sMappings","groupedMappings","sortMappingsToGroups","groups","global","_onClone","_onCreate","_onSaveMappings","_onSaveMappingsClose","permissions","image_path_button","user","role","_onImageClick","mousedown","_onImageMouseDown","_onConfigureApplicableActors","contextmenu","_onImageRightClick","_onConfigClick","_onConfigEditClick","_onConfigScriptClick","_onOverlayConfigClick","_onOverlayConfigRightClick","_onOverlayChange","trigger","_onExpressionChange","_onGroupToggle","each","groupName","setPosition","_onDisable","_onGroupDisable","_onGroupDelete","_onGroupChange","_onExpressionSwitch","focus","animate","focusout","_state","Application","RENDER_STATES","RENDERED","_onTokensRemove","_onSubmit","li","currentTarget","dataset","index","undefined","render","container","divInput","hasClass","removeClass","addClass","disableGroupToggle","checkboxes","numChecked","chks","input","toggle","set","el","siblings","innerText","childNodes","sel","window","getSelection","focusNode","offset","focusOffset","ch","nodeName","text","setCaretPosition","checked","show","hide","gear","attr","actor","_toggleActiveControls","tokenConfig","configEdit","scriptEdit","_removeImage","vid","img","add","which","search","searchType","TOKEN","FilePicker","type","current","path","splice","clone","_getHeaderButtons","buttons","unshift","class","icon","onclick","ev","_exportConfigs","_importConfigs","async","templateName","_insertMappings","_copyGlobalConfig","canvas","_id","filename","Promise","resolve","actorName","replace","saveDataToFile","content","renderTemplate","entity","dialog","reject","Dialog","import","i18n","localize","form","files","ui","notifications","error","readTextFromFile","then","json","no","default","title1","title2","buttonTitle","cMappings","actorTypes","system","documentTypes","Actor","t","CONFIG","typeLabels","has","enabled","includes","act","Ok","inplace","insertKeys","recursive","setFlag","unsetFlag","placeables","getActiveTokens","tkn","filterEffectIcons","drawEffects","message","handlerName","args","all","sceneId","scene","socket","emit","i","replaceAll","String","fromCharCode","split","re","RegExp","match","op","pos","node","nodeType","range","document","createRange","setStart","collapse","removeAllRanges","addRange","list","feature_id","_modTokenConfig","_modTemplateConfig","TILE","_modDrawingConfig","customImageCategories","_modNoteConfig","ITEM","_modSceneConfig","_modTileConfig","tileConfig","getFlag","_modActiveEffectConfig","effectConfig","_modItemSheet","itemSheet","item","update","_modMacroConfig","macroConfig","MACRO","_modJournalSheet","journalSheet","journal","JOURNAL","_modRollTableSheet","sheet","table","_modActorSheet","actorSheet","editable","portrait_right_click","profile","profileQueries","pf2e","query","console","warn","addEventListener","PORTRAIT","renderTileHUD","hud","tileData","searchText","fp_files","tile","enableSideMenu","tilesEnabled","button","$","last","append","_deactivateTokenVariantsSideSelector","tileName","tiles","clear","setNameDialog","classList","variantsWrap","renderSideSelect","after","_onButtonClick","contextMenu","keyCode","sideSelect","_onImageSearchKeyUp","stopPropagation","fp","browse","activeSource","result","f","_onButtonRightClick","hudSettings","worldHudSettings","worldHud","FULL_ACCESS","hudFullAccess","images","variants","imageDuplicates","Set","pushImage","obj","variant","names","directoryFlag","dirFlagImages","source","bucket","startsWith","err","artSearch","displayOnlySharedImages","searchOptions","keywordSearch","includeKeywords","results","tileImageName","texture","src","imagesParsed","imageObj","shared","isGM","userMappings","style","genTitleAndStyle","route","used","unknownType","imageDisplay","displayAsImage","imageOpacity","autoplay","playVideoOnHover","hover","play","pauseVideoOnHoverOut","pause","currentTime","imgButton","regenStyle","css","del","updated","fNames","showFullPath","userId","entries","users","color","_updateToken","change","draw","visibility","restrictVisibility","_updateTile","_sightRefresh","_isInvisible","visible","invisibleImage","_renderTokenConfig","checkboxRandomize","defaultImg","prototypeToken","field","disableHUDButton","tvaFieldset","rdmImgFormGroup","showHideGroup","is","_preCreateToken","tokenDocument","randomImg","imgNameContainsDimensions","imgNameContainsFADimensions","updateSource","_createToken","actorRandSettings","randSettings","randomizer","vDown","popupFlag","tokenCopyPaste","tokenCreate","performRandomSearch","representedActorDisable","linkedActorDisable","actorLink","_disableRandomSearchForType","randomName","randomizerOptions","diffImages","imgPortrait","syncImages","tokenName","wildcard","tokenToPortrait","popupOnDisable","popups","dirKeyDown","popup","disableAutoPopupOnTokenCopyPaste","disableAutoPopupOnTokenCreate","_disablePopupForType","twoPopups","_twoPopupPrompt","preventClose","twoPopupsNoDialog","_createActor","actorCreate","imgToken","disableAutoPopupOnActorCreate","actTokens","PORTRAIT_AND_TOKEN","force","d","one","artSelects","values","windows","app","ArtSelect","two","REGISTERED_HOOKS","registerHook","fn","once","debug","info","num","Hooks","unregisterHook","off","registerAllHooks","displayEffectIconsOnHover","hoverIn","effects","meVisible","showOverlayJsonConfigDialog","effect","yes","showPathSelectCategoryDialog","typesInput","selectedTypes","categories","concat","splits","currSplit","types","showPathSelectConfigForm","configInput","setting","DefaultTokenConfig","SETTING","PrototypeToken","TokenDocument","conf","cog","showTokenCaptureDialog","mesh","parseFloat","isNaN","showMappingSelectDialog","_","mappingGroups","selectedMappings","cMapping","showUserTemplateCreateDialog","create","hint","templateMappings","cancel","toggleTemplateDialog","DEFAULT_ACTIVE_EFFECT_CONFIG","DEFAULT_OVERLAY_CONFIG","imgLinked","alpha","scaleX","scaleY","offsetX","offsetY","angle","filterOptions","inheritTint","top","bottom","underlay","linkRotation","linkMirror","linkOpacity","linkScale","linkDimensionX","linkDimensionY","linkStageScale","mirror","tint","loop","playOnce","animation","rotate","duration","clockwise","relative","limitedUsers","limitedToOwner","limitOnProperty","alwaysVisible","align","canvasTextStyle","fontSize","fontFamily","fill","dropShadow","strokeThickness","stroke","curve","radius","invert","letterSpacing","repeating","wordWrap","wordWrapWidth","breakWords","maxHeight","anchor","x","y","shapes","variables","interactivity","OVERLAY_SHAPES","Rectangle","Ellipse","Polygon","points","scale","Torus","innerRadius","outerRadius","startAngle","endAngle","CutCircle","cut","rotation","CORE_SHAPE","line","color2","prc","TokenCustomConfig","TokenConfig","_getSubmitData","updateData","Error","FormDataExtended","editors","flattenObject","detectionModes","filtered","tva_checkbox","saved","applyCustomConfig","_onCheckboxChange","processFormGroup","formGroup","savedField","flatConfig","checkbox","before","_onRemoveConfig","activeElement","blur","MutationObserver","mutations","mutation","addedNodes","className","observe","characterData","attributes","childList","subtree","onInputChange","parentNode","ConfigureSettings","dummySettings","searchPaths","searchFilters","searchAlgorithm","misc","activeEffects","features","enabledTabs","tabs","navSelector","contentSelector","initial","paths","r","_pathIcon","cache","algorithm","fuzzyThreshold","reduce","disable","tokenToPortraitDisabled","allTypes","tempTypes","tokenHUDWildcardActive","internalEffects","excludedKeywords","systemHpPath","runSearchOnPath","imgurClientId","enableStatusConfig","disableNotifs","staticCache","staticCacheFile","stackStatusConfig","mergeGroup","disableEffectIcons","hideElevationTooltip","hideTokenBorder","filterCustomEffectIcons","filterIconList","updateTokenProto","disableImageChangeOnPolymorphed","disableImageUpdateOnNonPrototype","disableTokenUpdateAnimation","evaluateOverlayOnHover","pathfinder","dnd5e","_onCreatePath","_onSearchSourceTextChange","_onDeletePath","_onConvertImgurPath","_onConvertJsonPath","_onBrowseFolder","_validateRegex","algorithmTab","_toggle","tab","staticOn","staticFile","_validRegex","backgroundColor","pathInput","sourceInput","bucketName","s3","endpoint","protocol","host","tables","rollTable","tableName","albumHash","fetch","headers","Authorization","Accept","response","success","location","hostname","format","resultsArray","description","weight","collection","drawn","link","RollTable","replacement","displayRoll","catch","jsonPath","row","_reIndexPaths","image","imgur","imgurControl","jsonControl","hasOwnProperty","regex","fuzzyLimit","parseInt","mergeObjectFix","original","other","insertValues","overwrite","enforceTypes","_d","some","test","v","_mergeUpdate","_mergeInsertFix","slice","tv","getType","tx","TVAOverlay","PrimarySpriteMesh","pTexture","addChild","pseudoTexture","occludedAlpha","ready","overlaySort","filtersApplied","addHTMLOverlay","linkDimensions","linkDimensionsX","linkDimensionsY","_registerHooks","_tvaPlay","refresh","defineProperty","_customVisible","configurable","eventMode","enableInteractivity","mouseInteractionManager","removeAllListeners","cursor","primary","parent","sprite","runInteraction","listener","macro","callbacks","hoverOut","clickLeft","clickLeft2","clickRight","clickRight2","dragLeftStart","dragLeftMove","dragLeftDrop","dragLeftCancel","dragRightStart","dragRightMove","dragRightDrop","dragRightCancel","longPress","mgr","MouseInteractionManager","stage","dragStart","activate","_onAdded","ov","isOwner","limitOnEffect","speaker","ChatMessage","getSpeaker","detectionLevel","impreciseVisible","limitOnHover","limitOnControl","limitOnHighlight","limitOnHUD","limitOnTarget","limitOnAnyTarget","ruler","Ruler","STATES","INACTIVE","controlled","highlightObjects","_highlight","hasActiveHUD","targeted","size","u","sortLayer","zIndex","_lastSortedIndex","elevation","baseTexture","resource","tagName","s","cloneNode","onended","tvaVideoEnded","oncanplay","PIXI","Texture","from","resourceOptions","autoPlay","volume","playing","video","addChildAuto","children","setTexture","preview","configuration","refreshFilters","_swapChildren","originalTexture","_destroyTexture","removeChild","fullRefresh","previewTexture","htmlOverlay","getProperty","stop","dimensions","w","Math","abs","Number","h","xOff","yOff","position","pivot","pOffsetX","pOffsetY","pWidth","shapesWidth","pHeight","shapesHeight","interpolateColor","Color","stopAnimation","_applyFilters","left","_activateTicker","_deactivateTicker","ticker","updatePosition","UPDATE_PRIORITY","HIGH","coord","canvasCoordinatesFromClient","innerWidth","innerHeight","filterName","FilterClass","filters","defaultValues","argType","c","OutlineFilter","thickness","trueThickness","animated","applyTVAFilters","constructTMFXFilters","params","removeTVAFilters","tvaFilter","animationName","CanvasAnimation","terminateAnimation","sourceId","attribute","to","removeChildren","textLabel","destroyable","destroy","removeHTMLOverlay","tvaRemove","calculateTrimmedVertices","Sprite","prototype","call","paramsArray","eval","Array","isArray","getPreset","filterTypes","filterType","rank","filterId","filterInternalId","gms","filterOwner","updateId","filterClass","ModTMFX","assignPlaceable","targetPlaceable","placeableImg","_TMFXsetAnimeFlag","OutlineOverlayFilter","createFragmentShader","CONSTANTS","WAVE","toFixed","performance","mode","CONST","CANVAS_PERFORMANCE_MODES","LOW","PI","MED","UserList","avatar","affectedImages","FlagsConfig","Tile","isTile","disableNameSearch","directory","popupsSetFlag","disableNameSearchSetFlag","directorySource","directorySetFlag","sourceEl","CORE_TEMPLATES","distance","shadowOnly","quality","shape","repeat","increment","isPercentage","maxValue","perRow","maxRows","paddingX","paddingY","EXPRESSION_MATCH_RE","PF2E_ITEM_TYPES","ITEM_TYPES","registerEffectMappingHooks","_refreshTokenMappings","activeEffect","_updateImageOnEffectChange","_preUpdateActiveEffect","_updateActiveEffect","_preUpdateToken","_preUpdateActor","_updateActor","_createCombatant","combatant","_deleteCombatant","_preUpdateCombat","_updateCombat","combat","combatants","applicable_item_types","_preUpdateAssign","getActorParent","_updateItem","updateWithEffectMapping","_token","tokenId","added","removed","_updateImageOnMultiEffectChange","preUpdateEffects","getTokenEffects","setProperty","isPolymorphed","tvaOverlays","addedEffects","removedEffects","postUpdateEffects","hidden","tokenVariantFlags","_preUpdateCheck","hpChange","applyHpChangeEffect","pAdded","pRemoved","round","combatantId","nextCombatantId","nextCombatant","previousCombatantId","previousNextCombatantId","currentCombatantId","currentNextCombatantId","updateCombatant","EFFECT_M_QUEUES","EFFECT_M_TIMER","clearTimeout","opts","a","setTimeout","_updateWithEffectMapping","placeable","_object","tokenImgName","tokenDefaultImg","tokenUpdateObj","hadActiveHUD","toggleStatus","_statusEffects","findIndex","getAllEffectMappings","evaluateMappingExpression","executeOnCallback","deferredUpdateScripts","action","ef1","ef2","updateCall","disableImageUpdate","tknImg","newImg","iSrc","tokenUpdate","_postTokenUpdateProcessing","tvaUpdate","scripts","_toggleStatusEffects","scr","includeDisabled","allMappings","unique","applicableGlobal","actorType","setOverlayVisibility","userName","tokenMappings","updateToken","updateGlobal","updateMappings","found","_getTemplateMappings","applyTemplate","tm","actMappings","removeTemplate","toggleTemplate","toggleTemplateOnSelected","getHPChangeEffect","internals","delta","newHpValue","currentHpVal","getTokenHP","includeExpressions","tokenDoc","combats","started","getEffectsFromActor","items","_activePF2EItem","isSuppressed","evaluateComparatorEffects","evaluateStateEffects","temporaryEffects","technology","equipped","isEquipped","VALID_EXPRESSION","evaluateComparator","property","currVal","maxVal","_source","sign","toCompare","passed","matched","expressions","exp","statuses","_findReplaceBracketWildcard","nExp","lIndex","i1","indexOf","i2","_testRegExEffect","arrExpression","temp","hasAdded","hasRemoved","rExp","evaluation","max","effectName","ent","registerUserMappingWrappers","_draw","wrapped","previous","tva_iconOverride","overrideVisibility","tva_customVisibility","originalIsVisible","_getIsVisibleDescriptor","isVisible","iObj","getPrototypeOf","descriptor","getOwnPropertyDescriptor","assignUserSpecificImage","unassignUserSpecificImage","doc","assignUserSpecificImageToSelected","selected","unassignUserSpecificImageFromSelected","registerOverlayHooks","child","hudRendered","REFRESH_HOOKS","registerOverlayRefreshHook","tvaOverlay","hookName","unregisterOverlayRefreshHooks","unregister","hook","OverlayConfig","linked","previewConfig","icons","getPreviewIcons","fieldset","shapeLegends","legend","_onAddShape","_onAddImage","_onAddEvent","_onDeleteShape","_onDeleteImage","_onDeleteEvent","_onMoveShapeUp","_onMoveShapeDown","_onCloneShape","_onInputChange","parentId","empty","genFilterOptionControls","presetName","preset","scaleState","locked","lockButtons","sliderScaleWidth","sliderScaleHeight","sliderWidth","sliderHeight","textarea","param","promptParamChoice","api","showGenericForm","inputChangeCallback","_onCreateVariable","_onDeleteVariable","nShape","_swapShapes","_convertColor","colString","fromString","rgb","_applyPreviews","previewIcons","targets","_removePreviews","fonts","fontDefinitions","FontConfig","fontWeights","parents","shapeName","getTemplate","allShapes","textAlignmentOptions","vision5e","uid","outlineColor","lightColor","shadowColor","FILTERS","min","step","AlphaFilter","BlurFilter","strength","BlurFilterPass","horizontal","NoiseFilter","noise","seed","AdjustmentFilter","gamma","saturation","contrast","brightness","red","green","blue","AdvancedBloomFilter","threshold","bloomScale","AsciiFilter","BevelFilter","lightAlpha","shadowAlpha","BloomFilter","BulgePinchFilter","CRTFilter","curvature","lineWidth","lineContrast","verticalLine","noiseSize","vignetting","vignettingAlpha","vignettingBlur","time","DotFilter","DropShadowFilter","EmbossFilter","GlitchFilter","slices","direction","fillMode","average","minSize","sampleSize","GlowFilter","outerStrength","innerStrength","knockout","GodrayFilter","gain","lacunarity","parallel","KawaseBlurFilter","clamp","OldFilmFilter","sepia","scratch","scratchDensity","scratchWidth","PixelateFilter","RGBSplitFilter","RadialBlurFilter","center","ReflectionFilter","boundary","amplitude","waveLength","DisplacementFilter","textureScale","displacementScale","getControlValues","controlsHTML","control","genControl","fromRGB","toString","charAt","toUpperCase","select","opt","massEdit","FONT_LOADING","drawOverlays","tva_drawing_overlays","processedMappings","overlays","evaluateOverlayExpressions","_markAllOverlaysForRemoval","underlaySort","_findTVAOverlay","_evaluateLinkedImages","diff","diffObject","genTexture","sortableChildren","sortDirty","removeMarkedOverlays","_removeAllOverlays","tokenImage","generateImage","generateTextTexture","generateShapeTexture","loadTexture","floor","random","fallback","numRepeats","ceil","n","rows","Infinity","xOffset","yOffset","Container","_renderContainer","resolution","bounds","getLocalBounds","matrix","Matrix","ty","renderTexture","RenderTexture","renderer","transform","skipUpdateTransform","_drawShape","graphics","drawRoundedRect","drawEllipse","drawPolygon","drawTorus","toRadians","drawCutCircle","Graphics","beginFill","lineStyle","EMPTY","startArc","endArc","drawCircle","beginHole","endHole","finishPoly","arc","closePath","minColor","interpolate","rString","_interpolateV10","percentage","maxColor","minHsv","rgb2hsv","maxHsv","deltaHue","deltaAngle","targetHue","targetSaturation","targetValue","toHex","toNumber","hex2rgb","fromHSV","g","b","CORE_VARIABLES","grid","_evaluateString","str","re2","substr","_executeString","evalString","_evaluateObjExpressions","loading","tmp","PreciseText","getTextStyle","updateText","maxRopePoints","ropePoints","cos","sin","Point","rope","SimpleRope","sprites","broadcastDrawOverlays","simplifyRegex","EXPRESSION_OPERATORS","SEARCH_TYPE","BASE_IMAGE_CATEGORIES","PRESSED_KEYS","popupOverride","BATCH_UPDATES","TOKEN_CALLBACKS","TOKEN_CONTEXT","ACTOR","ACTOR_CONTEXT","startBatchUpdater","updateEmbeddedDocuments","cb","updateDocuments","queueActorUpdate","context","updateTokenImage","actorUpdate","pack","applyDefaultConfig","browseOptions","keyPrefix","parseS3URL","wildcardImageSearch","constructDefaultConfig","origData","customConfig","flatOrigData","TokenDataAdapter","dataToForm","flatCustomConfig","filterObject","splitK","getFileName","tokenCustomConfig","imgConfig","getTokenConfig","tvImgSrc","tvImgName","formToData","extractDimensionsFromImgName","getTokenConfigForUpdate","usingCustomConfig","defaultConfig","configEntries","tokenData","fromEntries","getDefaultConfig","modMergeObject","toObject","defConf","baseActor","queueTokenUpdate","updateActorImage","directUpdate","showTileArtSelect","keyPressed","keyboard","downKeys","registerKeybinds","keybindings","register","onDown","onUp","restricted","precedence","KEYBINDING_PRECEDENCE","NORMAL","modifiers","decodeURISafely","tokenConfigs","flat","setTokenConfig","tcIndex","deleteConfig","pop","getFileNameWithExt","getFilePath","simplifyName","toLowerCase","simplifyPath","decodeURIComponentSafely","parseKeywords","keywords","word","isImage","extension","callForgeVTT","apiKey","ForgeVTT","usingTheForge","url","FORGE_URL","xhr","XMLHttpRequest","withCredentials","open","setRequestHeader","ForgeAPI","getXSRFToken","responseType","onreadystatechange","readyState","onerror","code","send","getFilters","include","exclude","userRequiresImageCache","perm","waitForTokenTexture","checks","flattenSearchResults","flattened","_modMergeUpdate","_modMergeInsert","tv_executeScript","character","AsyncFunction","executeMacro","macroName","execute","applyTMFXPreset","addUpdateFilters","deleteFilters","toggleTMFXPreset","hasFilterId","applyCEEffect","uuid","addEffect","origin","removeEffect","toggleCEEffect","toggleEffect","uuids","mirrorX","mirrorY","determineAddedRemovedEffects","newEffects","oldEffects","nameForgeRandomize","randomizerSettings","nameForgeSettings","nameForge","randomize","models","randomNames","modelKey","modelProp","model","createModel","generateName","uploadTokenImage","viewPosition","_viewPosition","resize","screen","screenDimensions","pan","cacheParent","enableTempParent","updateTransform","disableTempParent","spritesToRender","_onResize","captureToken","b64","extract","base64","res","blob","file","File","upload","getAllActorTokens","isToken","scenes","string2Hex","hexString","string2hex","uri","decodeURI","decodeURIComponent","mergeMappings","changedIDs","pID","isResponsibleGM","isActive","MODULE_INITIALIZED","isInitialized","onInit","showArtSelect","image1","image2","displayMode","IMAGE_DISPLAY","NONE","multipleSelection","allImages","executing","loadFont","editor","urls","bg","forgeSearchPaths","cacheImages","doImageSearch","doRandomSearch","exportSettingsToJSON","TVA_CONFIG","_drawEffects_hoverOnly","_drawEffects_fullReplace","_combatTrackerGetData","turns","turn","restrictedEffects","_getRestrictedEffects","overlayEffect","specialStatusEffects","DEFEATED","_drawEffects","renderable","findLast","promises","promise","_drawOverlay","_drawEffect","allSettled","sortChildren","renderFlags","refreshEffects","_getTooltipText","_refreshVisibility","_clear","_applyVariantFlags","REGISTERED_WRAPPERS","registerWrapper","method","libWrapper","unregisterWrapper","registerAllWrappers","RandomizerConfig","hasSettings","nameForgeActive","_selectNameForgeModels","inputSelected","genCheckbox","defaultModels","userModels","selectedModels","submitter","expanded","createToolbarButton","iconClass","labelText","onClick","ElementBuilder","build","textContent","builder","createSearchInput","placeholder","TOKEN_HUD_VARIANTS","renderTokenHUD","statusConfig","iconEffects","iconVisibility","iconCombat","statusEffects","activateStatusEffectListeners","PARTIAL_ACCESS","tokenActor","disableIfTHWEnabled","appendChild","toggleClass","when","menu","createContextMenu","colRight","actorVariants","getVariants","DEFAULT_TOKEN","includeWildcard","protoImg","getTokenImages","_tokenImages","pattern","tokenImageName","tokenHud","toggleCog","imgbutton","useNameSimilarity","updateActorWithSimilarName","setVariants","MissingImageConfig","missingImages","compendiumMapper","documents","_processFormData","packs","duplicates","compendium","Map","addToArtSelectQueue","typeOverride","ignorePortrait","ignoreToken","PORTRAIT_TOKEN","CompendiumMapConfig","_fixSearchPaths","supportedPacks","documentName","compendiums","category","_onCategoryOverride","_onAutoApply","_onDiffImages","_onSearchOptions","_onMissingImages","_onCompendiumSelect","startMapping","originalSearchPaths","log","endMapping","missingImageList","mi","overrideCategory","processItem","artSelectDisplayed","consoleProcessedTracking","hasPortrait","hasToken","includeThisActor","missingOnly","includeThisToken","showImages","autoApply","portraitFound","tokenFound","simpleResults","autoDisplayArtSelect","schema","fields","hasImage","imageFound","IMAGE","getDocuments","processing","stopProcessing","processed","counter","startProcessing","spinner","tasks","Reticle","static","_onReticleMove","reticleOverlay","isMouseDown","getLocalPosition","tCoord","dx","dy","cx","cy","radians","minimizeApps","minimize","maximizeApps","maximize","deactivate","interaction","events","cursorStyles","hitArea","rect","interactive","originalEvent","nativeEvent","anchorX","anchorY","displayControlDialog","CLOSED","number","HTMLOverlay","hudReady","renderQueue","element","ratio","listeners","_templateCache","_compile","Handlebars","compile","constructTemplate","ovConfig","compiled","registerPartial","allowProtoMethodsByDefault","allowProtoPropertiesByDefault","showButtonWithText","btn","getElementById","innerHTML","display","queue","addToQueue","renderFromQueue","callData","shift","delay","ms","timer","WIDTH","HEIGHT","LEFT","TOP","instance","_performSearch","_typeSelect","Item","fuzzySearch","fuzzy","allButtons","artFound","genLabel","indices","fillChar","fillStr","lastIndex","genTitle","percent","score","displaySlider","fuzzyArtSelectPercentSlider","boxes","box","searchInput","getAttribute","appId","insertArtSelectButton","ownKeys","enumerableOnly","getOwnPropertySymbols","symbols","sym","enumerable","_objectSpread2","arguments","_defineProperty","getOwnPropertyDescriptors","defineProperties","_typeof","Symbol","iterator","_classCallCheck","Constructor","TypeError","_defineProperties","props","writable","_createClass","protoProps","staticProps","_inherits","subClass","superClass","_setPrototypeOf","_getPrototypeOf","o","setPrototypeOf","__proto__","_possibleConstructorReturn","self","ReferenceError","_assertThisInitialized","_createSuper","Derived","hasNativeReflectConstruct","Reflect","construct","sham","Proxy","valueOf","_isNativeReflectConstruct","Super","NewTarget","_toConsumableArray","arr","_arrayLikeToArray","_arrayWithoutHoles","iter","_iterableToArray","minLen","_unsupportedIterableToArray","_nonIterableSpread","len","arr2","getTag","isString","isNumber","isBoolean","isObject","isObjectLike","isDefined","isBlank","hasOwn","KeyStore","_this","_keys","_keyMap","totalWeight","createKey","keyId","createKeyPath","createKeyId","MISSING_KEY_PROPERTY","INVALID_KEY_WEIGHT_VALUE","AdvancedOptions","useExtendedSearch","getFn","deepGet","baseToString","ignoreLocation","ignoreFieldNorm","fieldNormWeight","Config","isCaseSensitive","includeScore","shouldSort","sortFn","idx","includeMatches","findAllMatches","minMatchCharLength","SPACE","FuseIndex","_ref","_ref$getFn","_ref$fieldNormWeight","norm","mantissa","pow","numTokens","isCreated","setIndexRecords","docs","records","_keysMap","_this2","docIndex","_addString","_addObject","record","_this3","keyIndex","subRecords","stack","nestedArrIndex","_stack$pop","_value","subRecord","createIndex","_ref2","_ref2$getFn","_ref2$fieldNormWeight","myIndex","setKeys","setSources","computeScore$1","_ref$errors","errors","_ref$currentLocation","currentLocation","_ref$expectedLocation","expectedLocation","_ref$distance","_ref$ignoreLocation","accuracy","proximity","MAX_BITS","patternAlphabet","_ref$location","_ref$threshold","_ref$findAllMatches","_ref$minMatchCharLeng","_ref$includeMatches","patternLen","textLen","currentThreshold","bestLocation","computeMatches","matchMask","lastBitArr","finalScore","binMax","mask","_i","binMin","binMid","finish","bitArr","j","charMatch","isMatch","matchmask","convertMaskToIndices","createPatternAlphabet","_char","BitapSearch","_ref$isCaseSensitive","chunks","addChunk","startIndex","alphabet","remainder","_this$options","_result","_this$options2","allIndices","totalScore","hasMatches","_search","BaseMatch","getMatch","multiRegex","singleRegex","matches","ExactMatch","_BaseMatch","_super","InverseExactMatch","PrefixExactMatch","InversePrefixExactMatch","SuffixExactMatch","endsWith","InverseSuffixExactMatch","FuzzyMatch","_bitapSearch","searchIn","IncludeMatch","searchers","searchersLen","SPACE_RE","MultiMatchSet","ExtendedSearch","queryItem","searcher","isMultiMatch","_searcher","isSingleMatch","parseQuery","numMatches","qLen","pLen","_searcher$search","registeredSearchers","createSearcher","searcherClass","condition","LogicalOperator","KeyType","isExpression","convertToExplicit","_ref3$auto","auto","next","isQueryPath","isPath","isLeaf","LOGICAL_SEARCH_INVALID_QUERY_FOR_KEY","operator","transformMatches","refIndex","transformScore","Fuse$1","Fuse","_keyStore","setCollection","_docs","_myIndex","predicate","removeAt","_ref$limit","limit","_searchStringList","_searchObjectList","_searchLogical","_ref$ignoreFieldNorm","EPSILON","computeScore","_ref$includeScore","transformers","transformer","_searcher$searchIn","evaluate","_findMatches","getValueForItemAtKeyId","resultMap","_ref3","expResults","_ref4","_resultMap$idx$matche","_this$_myIndex","_ref5","_ref6","_ref7","_searcher$searchIn2","_searcher$searchIn3","version","parseIndex","_ref3$getFn","_ref3$fieldNormWeight","caching","isCaching","CACHED_IMAGES","searches","reverse","usedImages","findImages","pathObj","delete","sharedVariants","sv","wildcardImages","_randSearchUtil","nonRepeat","placedImages","checkedImages","tmpResult","doSyncSearch","fResults","walkFindImages","found_images","typeKey","rtName","_addToFound","contents","baseTableData","rtPath","rollTableName","tags","tokenSrc","f_dir","dirs","walkAllPaths","_filterPathsByType","getUserId","share","findImagesFuzzy","forceSearchName","fuse","imgObj","_imagePassesFilter","getIndex","sOptions","exact","simpleName","matchedImages","imgOBj","_exactSearchMatchesImage","findImagesExact","simplifiedSearch","imagePath","imageName","saveCache","cacheFile","caches","fileName","jQuery","getJSON","count","_readCacheFromFile","imageCount","Templates","templates","TemplateSubmissionForm","pk","body","SEARCH_QUERY","ok","status","_docToTemplate","communityTemplates","allowDelete","allowCreate","allowCopy","appWindow","tooltip","windowPos","getTemplateFromFileURL","createdBy","fileURL","k2","systemID","systemTitle","stringValue","_setStringField","createTime","integerValue","Date","getTime","approved","booleanValue","submitTemplate","structuredQuery","fieldPath","where","fieldFilter","collectionId","orderBy","ForgeSearchPaths","dragDrop","dragSelector","dropSelector","_getPaths","forgePaths","_onReset","_onUpdate","_updatePaths","_cleanPaths","uniquePaths","updateSettings","TokenHUDClientSettings","ImportExport","_importFromJSONDialog","importSettingsFromJSON","FEATURE_CONTROL","EffectMappings","EffectIcons","Overlays","UserMappings","Wildcards","PopUpAndRandomize","HUD","HideElement","registerSettings","onChange","registerMenu","lfg","worldbuilding","twodsix","_arrayAwareDiffObject","requiresImageCache","border","cat","migrateMappings","nMappings","combMappings","getFlagMappings","portraitFilterInclude","Portrait","portraitFilterExclude","portraitFilterRegex","Token","tokenFilterInclude","tokenFilterExclude","tokenFilterRegex","PortraitAndToken","generalFilterInclude","generalFilterExclude","generalFilterRegex","_refreshFilters","customCategories","updateTVAConfig","newSettings","inner","isDifferent","difference","v0","v1","t0","_arrayEquality","_difference","a1","a2","every","getSearchOptions","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","definition","__webpack_exports__"],"sourceRoot":""}